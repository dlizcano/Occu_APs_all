[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Occupancy in Protected Areas",
    "section": "",
    "text": "We want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border. We used a multispecies occupancy model incorporating spatial autocorrelation, to asses occupancy as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index (FLII) as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe problem we want to asses\n\n\n\nmodel\n\n\n\n\nMay 20, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nFitting a Spatial Factor Multi-Species Occupancy Model\n\n\n\nmodel\n\ncode\n\nanalysis\n\n\n\n\nMay 16, 2025\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html",
    "href": "blog/2025-10-10-the-model/index.html",
    "title": "The problem we want to asses",
    "section": "",
    "text": "Codelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\nlibrary(unmarked) # Models for Data from Unmarked Animals\nlibrary(ubms) # Bayesian Models for Data from Unmarked Animals using 'Stan'\n\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'\nWe want to Asses the role of Protected Areas (PA) in the conservation of vertebrates using on the ground data.\nEvaluating whether PA are working is essential as they are perhaps the primary strategy for averting biodiversity loss. Its been suggested that some do no work, paper parks Its crucial to continue working on best methods to evaluate their impact.\nOver a decade ago researchers started evaluating role of PA, mostly focused on the effects of PA in reducing threats (fires, deforestation) and focused on forest cover. However assessments of PA on species comparing inside vs outside is not a common practice.\nEven if we are effective in protecting forests, and the forest is in very good condition, PA could have “empty forests” and loosed biodiversity (by hunting-poaching, diseases or introduced species). So when we say a PA is effective, are we looking at this?\nWe want to compare apples with apples and control for covariates related with occupancy and abundance of species, like elevation, human pressures, ecosystem type, etc.\nOccupancy is a cost effective method for evaluation a population, it is a state variable, representing the proportion of the area occupied by the species, solving the problem of imperfect detection.\nWe compiled camera trap deployment data sets that have intentionally sampled inside and outside PAS, in a quasi-experimental design, using camera traps.\nEach case each camera is adequately matched, in a similar fashion as the remote sensing approaches.\nWe used a multispecies occupancy model, and a variation incorporating spatial autocorrelation, to compare occupancy inside and outside the PA and also as a distance to the protected area border."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#package-citation",
    "href": "blog/2025-10-10-the-model/index.html#package-citation",
    "title": "The problem we want to asses",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), terra v. 1.8.60 (Hijmans 2025), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018), ubms v. 1.2.7 (Kellner et al. 2021), unmarked v. 1.5.0 (Fiske and Chandler 2011; Kellner et al. 2023)."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#sesion-info",
    "href": "blog/2025-10-10-the-model/index.html#sesion-info",
    "title": "The problem we want to asses",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] lubridate_1.9.4 forcats_1.0.0   stringr_1.5.2   dplyr_1.1.4    \n [5] purrr_1.1.0     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n [9] ggplot2_4.0.0   tidyverse_2.0.0 ubms_1.2.7      unmarked_1.5.0 \n[13] elevatr_0.99.0  terra_1.8-60    tmap_4.2        maps_3.4.3     \n[17] mapview_2.11.4  sf_1.0-21       DT_0.34.0       readxl_1.4.3   \n[21] grateful_0.3.0 \n\nloaded via a namespace (and not attached):\n [1] DBI_1.2.3            pbapply_1.7-2        gridExtra_2.3       \n [4] tmaptools_3.3        s2_1.1.9             inline_0.3.20       \n [7] logger_0.4.0         rlang_1.1.6          magrittr_2.0.3      \n[10] matrixStats_1.5.0    e1071_1.7-16         compiler_4.4.2      \n[13] loo_2.8.0            png_0.1-8            vctrs_0.6.5         \n[16] pkgconfig_2.0.3      wk_0.9.4             fastmap_1.2.0       \n[19] lwgeom_0.2-14        leafem_0.2.4         rmarkdown_2.29      \n[22] tzdb_0.4.0           spacesXYZ_1.6-0      xfun_0.52           \n[25] satellite_1.0.5      jsonlite_2.0.0       parallel_4.4.2      \n[28] R6_2.6.1             stringi_1.8.4        RColorBrewer_1.1-3  \n[31] StanHeaders_2.32.10  cellranger_1.1.0     stars_0.6-8         \n[34] Rcpp_1.1.0           rstan_2.32.6         knitr_1.50          \n[37] base64enc_0.1-3      timechange_0.3.0     Matrix_1.7-1        \n[40] tidyselect_1.2.1     rstudioapi_0.17.1    dichromat_2.0-0.1   \n[43] abind_1.4-8          yaml_2.3.10          maptiles_0.10.0     \n[46] codetools_0.2-20     curl_7.0.0           pkgbuild_1.4.8      \n[49] lattice_0.22-6       leafsync_0.1.0       withr_3.0.2         \n[52] S7_0.2.0             evaluate_1.0.4       units_0.8-7         \n[55] proxy_0.4-27         RcppParallel_5.1.9   pillar_1.11.1       \n[58] KernSmooth_2.23-24   stats4_4.4.2         generics_0.1.3      \n[61] sp_2.2-0             hms_1.1.3            rstantools_2.4.0    \n[64] scales_1.4.0         class_7.3-22         glue_1.8.0          \n[67] tools_4.4.2          leaflegend_1.2.1     data.table_1.17.8   \n[70] RSpectra_0.16-2      XML_3.99-0.18        grid_4.4.2          \n[73] QuickJSR_1.4.0       crosstalk_1.2.1      colorspace_2.1-1    \n[76] cols4all_0.8-1       raster_3.6-32        cli_3.6.5           \n[79] V8_6.0.0             gtable_0.3.6         digest_0.6.37       \n[82] progressr_0.15.0     classInt_0.4-11      htmlwidgets_1.6.4   \n[85] farver_2.1.2         htmltools_0.5.8.1    lifecycle_1.0.4     \n[88] leaflet_2.2.3        microbenchmark_1.5.0 MASS_7.3-61"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html",
    "href": "blog/2025-10-15-analysis/index.html",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "href": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Multi-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables.\n\nCodelibrary(grateful)\nlibrary(readxl)\nlibrary(DT)\nlibrary(sf)\nlibrary(mapview)\nlibrary(maps)\nlibrary(tmap)\nlibrary(terra)\nlibrary(elevatr)\n#library(spOccupancy)\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis)\nlibrary(coda)\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR)\nlibrary(spOccupancy)\nlibrary(tidyverse)"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "href": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Fitting a Multi-Species Spatial Occupancy Model",
    "text": "Fitting a Multi-Species Spatial Occupancy Model\nWe use a more computationally efficient approach for fitting spatial multi-species occupancy models. This alternative approach is called a “spatial factor multi-species occupancy model”, and is described in depth in Doser, Finley, and Banerjee (2023). This newer approach also accounts for residual species correlations (i.e., it is a joint species distribution model with imperfect detection). The simulation results from Doser, Finley, and Banerjee (2023) show that this new alternative approach outperforms, or performs equally to spMsPGOcc(), while being substantially faster.\nThe Latent factor multi-species occupancy model is described in detail here\nTamshiyacu Tahuayo data\nHere we use the tables: - PER-003_BD_ACRCTT_T0.xlsx - PER-002_BD_ACRTT-PILOTO.xlsx\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Pacaya &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PacayaSamiria/WDPA_WDOECM_Jun2025_Public_249_shp-polygons.shp\")\n\nAP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\nPer_Tahuayo_piloto &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-002_BD_ACRTT-PILOTO.xlsx\")\n\n50 cameras in Cameras. \n 50 cameras in Deployment. \n 50 deployments in Deployment. \n 50 points in Deployment. \n 50 cameras in Images. \n 50 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodePer_Tahuayo &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n85 cameras in Cameras. \n 84 cameras in Deployment. \n 84 deployments in Deployment. \n 84 points in Deployment. \n 84 cameras in Images. \n 84 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeFLII2016 &lt;- rast(\"C:/CodigoR/WCS_2024/FLI/raster/FLII_final/FLII_2016.tif\")\n\n# get sites\n# Per_Pacaya_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n# get sites\nPer_Tahuayo_sites1 &lt;- Per_Tahuayo |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_sites &lt;- sf::st_as_sf(Per_Tahuayo_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_sites) &lt;- 4326\n\n\n\n# get Pacaya sites\nPer_Tahuayo_piloto_sites1 &lt;- Per_Tahuayo_piloto |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_piloto_sites &lt;- sf::st_as_sf(Per_Tahuayo_piloto_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_piloto_sites) &lt;- 4326\n\n\n\n\n# get elevation map\nelevation_PE &lt;- rast(get_elev_raster(Per_Tahuayo_sites, z = 10)) #z =1-14\n\nMosaicing & Projecting\nNote: Elevation units are in meters.\n\nCode# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_sites &lt;- cbind(Per_Tahuayo_sites,\n                                terra::extract(elevation_PE,\n                                               Per_Tahuayo_sites)\n                                )\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_piloto_sites &lt;- cbind(Per_Tahuayo_piloto_sites, terra::extract(elevation_PE, Per_Tahuayo_piloto_sites))\n\n\n\n# get which are in and out\ncovs_Per_Tahuayo_sites$in_AP = st_intersects(covs_Per_Tahuayo_sites, AP_Tahuayo, sparse = FALSE)\n\ncovs_Per_Tahuayo_piloto_sites$in_AP = st_intersects(covs_Per_Tahuayo_piloto_sites, AP_Tahuayo, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_PE, alpha=0.5) + \n  mapview (AP_Pacaya, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Per_Tahuayo_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +   \n  mapview (covs_Per_Tahuayo_piloto_sites, \n           zcol = \"in_AP\", \n           col.regions =c(\"blue\"), \n           burst = TRUE) \n\nNumber of pixels is above 5e+05.Only about 5e+05 pixels will be shown.\nYou can increase the value of `maxpixels` to 523775 to avoid this.\n\n\n\n\n\nCode  # mapview (covs_Ecu_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_18_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_20_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_21_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_22_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"blue\") ) #+\n  # mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\nYasuni data\nHere we use the tables Ecu-13, Ecu-17, Ecu-18 y Ecu-20\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Yasuni &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Yasuni/WDPA_WDOECM_May2025_Public_186_shp-polygons.shp\")\n\n### Ecu 17, Ecu 18, ECU 20, Ecu 22  \n\n# load data and make array_locID column\nEcu_13 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_13\", locationID, sep=\"_\"))\n\n28 cameras in Cameras. \n 28 cameras in Deployment. \n 28 deployments in Deployment. \n 28 points in Deployment. \n 28 cameras in Images. \n 28 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_17 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_17\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_18\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeEcu_20 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_20\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 25 cameras in Deployment. \n 25 deployments in Deployment. \n 25 points in Deployment. \n 25 cameras in Images. \n 25 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# Ecu_21 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_14\", locationID, sep=\"_\"))\nEcu_22 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_22\", locationID, sep=\"_\"))\n\nWarning: Expecting numeric in O5508 / R5508C15: got 'NA'\n\n\nWarning: Expecting numeric in O5509 / R5509C15: got 'NA'\n\n\nWarning: Expecting numeric in O5510 / R5510C15: got 'NA'\n\n\nWarning: Expecting numeric in O5511 / R5511C15: got 'NA'\n\n\nWarning: Expecting numeric in O5512 / R5512C15: got 'NA'\n\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# get sites\nEcu_13_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\")\n\nJoining with `by = join_by(Camera_Id)`\nJoining with `by = join_by(Point)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType, Deployment_ID, start_date, end_date,\n`Bait Type`, `Feature Type`, `Feature Type methodology`, Camera_Id, `Quiet\nPeriod Setting`, `Restriction on Access`, `Camera Failure Details`, `Project\nId`, Make, Model, `Serial Number`, Year_Purchased)`\n\nCodeEcu_17_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\")\n\nJoining with `by = join_by(Camera_Id)`\nJoining with `by = join_by(Point)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType, Deployment_ID, start_date, end_date,\n`Bait Type`, `Feature Type`, `Feature Type methodology`, Camera_Id, `Quiet\nPeriod Setting`, `Restriction on Access`, `Camera Failure Details`, `Project\nId`, Make, Model, `Serial Number`, Year_Purchased)`\n\nCodeEcu_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")\n\nJoining with `by = join_by(Camera_Id)`\nJoining with `by = join_by(Point)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType, Deployment_ID, start_date, end_date,\n`Bait Type`, `Feature Type`, `Feature Type methodology`, Camera_Id, `Quiet\nPeriod Setting`, `Restriction on Access`, `Camera Failure Details`, `Project\nId`, Make, Model, `Serial Number`, Year_Purchased)`\n\nCodeEcu_20_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")\n\nJoining with `by = join_by(Camera_Id)`\nJoining with `by = join_by(Point)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType, Deployment_ID, start_date, end_date,\n`Bait Type`, `Feature Type`, `Feature Type methodology`, Camera_Id, `Quiet\nPeriod Setting`, `Restriction on Access`, `Camera Failure Details`, `Project\nId`, Make, Model, `Serial Number`, Year_Purchased)`\n\nCode# Ecu_21_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\")\nEcu_22_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")\n\nJoining with `by = join_by(Camera_Id)`\nJoining with `by = join_by(Point)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType)`\nJoining with `by = join_by(Point, Longitude, Latitude, bait, season, rio_playa,\narroyo, camino, senda_animal, senda_gente, salitral, pozo_agua, bosque, sabana,\nintermedio, intervalo_trigger, CamType, Deployment_ID, start_date, end_date,\n`Bait Type`, `Feature Type`, `Feature Type methodology`, Camera_Id, `Quiet\nPeriod Setting`, `Restriction on Access`, `Camera Failure Details`, `Project\nId`, Make, Model, `Serial Number`, Year_Purchased)`\n\nCode# get elevation map\nelevation_EC &lt;- rast(get_elev_raster(Ecu_17_sites, z = 7)) #z =1-14\n\nMosaicing & Projecting\nNote: Elevation units are in meters.\n\nCodebb &lt;-  st_as_sfc(st_bbox(elevation_EC)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Ecu_13_sites &lt;- cbind(Ecu_13_sites, terra::extract(elevation_EC, Ecu_13_sites))\ncovs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_EC, Ecu_17_sites))\ncovs_Ecu_18_sites &lt;- cbind(Ecu_18_sites, terra::extract(elevation_EC, Ecu_18_sites))\ncovs_Ecu_20_sites &lt;- cbind(Ecu_20_sites, terra::extract(elevation_EC, Ecu_20_sites))\n#covs_Ecu_21_sites &lt;- cbind(Ecu_21_sites, terra::extract(elevation_17, Ecu_21_sites))\ncovs_Ecu_22_sites &lt;- cbind(Ecu_22_sites, terra::extract(elevation_EC, Ecu_22_sites))\n\n# get which are in and out\ncovs_Ecu_13_sites$in_AP = st_intersects(covs_Ecu_13_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_18_sites$in_AP = st_intersects(covs_Ecu_18_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_20_sites$in_AP = st_intersects(covs_Ecu_20_sites, AP_Yasuni, sparse = FALSE)\n#covs_Ecu_21_sites$in_AP = st_intersects(covs_Ecu_21_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_22_sites$in_AP = st_intersects(covs_Ecu_22_sites, AP_Yasuni, sparse = FALSE)\n\n# covs_Ecu_16_sites$in_AP = st_intersects(covs_Ecu_16_sites, AP_Llanganates, sparse = FALSE)\n\n\n\n# make a map\nmapview (elevation_EC, alpha=0.5) + \n  mapview (AP_Yasuni, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Ecu_13_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  mapview (covs_Ecu_18_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_20_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n#  mapview (covs_Ecu_21_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_22_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"red\") ) #+\n\n\n\n\nCode  # mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\nCamera trap operation data and detection history\n\nCode# Join 3 tables\n# fix count in ECU 13, 17, 22,\nEcu_13$Count &lt;- as.character(Ecu_13$Count)\nEcu_17$Count &lt;- as.character(Ecu_17$Count)\nEcu_22$Count &lt;- as.character(Ecu_22$Count)\n\nEcu_full &lt;- Ecu_13 |&gt; full_join(Ecu_17) |&gt; \n                      full_join(Ecu_18) |&gt; \n                      full_join(Ecu_20) |&gt; \n#                      full_join(Ecu_21) |&gt; \n                      full_join(Ecu_22)\n\nJoining with `by = join_by(`Project Id`, Camera_Id, Make, Model, `Serial\nNumber`, Year_Purchased, Deployment_ID, Point.x, Longitude, Latitude,\nstart_date, end_date, `Bait Type`, `Bait Description`, `Feature Type`, `Feature\nType methodology`, `Camera Type`, `Quiet Period Setting`, `Restriction on\nAccess`, `Camera Failure Details`, season, rio_playa, arroyo, camino,\nsenda_animal, senda_gente, salitral, pozo_agua, bosque, sabana, intermedio,\nintervalo_trigger, locationID, `Image Id`, `Photo Type`, `Photo Type Identified\nby`, Point.y, scientificName, Date_Time_Captured, `Independent event`, Age,\nSex, `Individual ID`, Count, Jaguar_Design, year, array_locID)`\nJoining with `by = join_by(`Project Id`, Camera_Id, Make, Model, `Serial\nNumber`, Year_Purchased, Deployment_ID, Point.x, Longitude, Latitude,\nstart_date, end_date, `Bait Type`, `Bait Description`, `Feature Type`, `Feature\nType methodology`, `Camera Type`, `Quiet Period Setting`, `Restriction on\nAccess`, `Camera Failure Details`, season, rio_playa, arroyo, camino,\nsenda_animal, senda_gente, salitral, pozo_agua, bosque, sabana, intermedio,\nintervalo_trigger, locationID, `Image Id`, `Photo Type`, `Photo Type Identified\nby`, Point.y, scientificName, Date_Time_Captured, `Independent event`, Age,\nSex, `Individual ID`, Count, Jaguar_Design, year, array_locID)`\nJoining with `by = join_by(`Project Id`, Camera_Id, Make, Model, `Serial\nNumber`, Year_Purchased, Deployment_ID, Point.x, Longitude, Latitude,\nstart_date, end_date, `Bait Type`, `Bait Description`, `Feature Type`, `Feature\nType methodology`, `Camera Type`, `Quiet Period Setting`, `Restriction on\nAccess`, `Camera Failure Details`, season, rio_playa, arroyo, camino,\nsenda_animal, senda_gente, salitral, pozo_agua, bosque, sabana, intermedio,\nintervalo_trigger, locationID, `Image Id`, `Photo Type`, `Photo Type Identified\nby`, Point.y, scientificName, Date_Time_Captured, `Independent event`, Age,\nSex, `Individual ID`, Count, Jaguar_Design, year, array_locID)`\nJoining with `by = join_by(`Project Id`, Camera_Id, Make, Model, `Serial\nNumber`, Year_Purchased, Deployment_ID, Point.x, Longitude, Latitude,\nstart_date, end_date, `Bait Type`, `Bait Description`, `Feature Type`, `Feature\nType methodology`, `Camera Type`, `Quiet Period Setting`, `Restriction on\nAccess`, `Camera Failure Details`, season, rio_playa, arroyo, camino,\nsenda_animal, senda_gente, salitral, pozo_agua, bosque, sabana, intermedio,\nintervalo_trigger, locationID, `Image Id`, `Photo Type`, `Photo Type Identified\nby`, Point.y, scientificName, Date_Time_Captured, `Independent event`, Age,\nSex, `Individual ID`, Count, Jaguar_Design, year, array_locID)`\n\nCode# Ecu_18$Count &lt;- as.numeric(Ecu_18$Count)\nPer_Tahuayo_piloto$Longitude &lt;- as.numeric(Per_Tahuayo_piloto$Longitude)\nPer_Tahuayo_piloto$Latitude &lt;- as.numeric(Per_Tahuayo_piloto$Latitude)\n\n\nPer_full &lt;- Per_Tahuayo|&gt; \n  full_join(Per_Tahuayo_piloto) #|&gt; \n\nJoining with `by = join_by(`Project Id`, Camera_Id, Make, Model, `Serial\nNumber`, Year_Purchased, Deployment_ID, Point.x, Longitude, Latitude,\nstart_date, end_date, `Bait Type`, `Bait Description`, `Feature Type`, `Feature\nType methodology`, `Camera Type`, `Quiet Period Setting`, `Restriction on\nAccess`, `Camera Failure Details`, season, rio_playa, arroyo, camino,\nsenda_animal, senda_gente, salitral, pozo_agua, bosque, sabana, intermedio,\nintervalo_trigger, locationID, `Image Id`, `Photo Type`, `Photo Type Identified\nby`, Point.y, scientificName, Date_Time_Captured, `Independent event`, Age,\nSex, `Individual ID`, Count, Jaguar_Design, year)`\n\nCode                      # full_join(Ecu_18) |&gt; \n                      # full_join(Ecu_20) |&gt; \n                      # full_join(Ecu_21) |&gt; \n                      # full_join(Ecu_22)\n\n# rename camera id\n# Per_full$camid &lt;- Per_full$`Camera_Id`\n\nEcu_full$Count &lt;- as.numeric(Ecu_full$Count)\n\nWarning: NAs introducidos por coerción\n\nCodePer_full$Count &lt;- as.numeric(Per_full$Count)\n\nWarning: NAs introducidos por coerción\n\nCodeEcu_full &lt;- Ecu_full[,-47]\n\n##################################\ndata_full &lt;- rbind(Ecu_full, Per_full)\n\n\n# fix date format\n# \n# Formatting a Date object\ndata_full$start_date &lt;- as.Date(data_full$\"start_date\", \"%Y/%m/%d\")\ndata_full$start_date &lt;- format(data_full$start_date, \"%Y-%m-%d\")\n\ndata_full$end_date &lt;- as.Date(data_full$\"end_date\", \"%Y/%m/%d\")\ndata_full$end_date &lt;- format(data_full$end_date, \"%Y-%m-%d\")\n\ndata_full$eventDate &lt;- as.Date(data_full$\"Date_Time_Captured\", \"%Y/%m/%d\")\n\nWarning in as.POSIXlt.POSIXct(x, tz = tz): unknown timezone '%Y/%m/%d'\n\nCodedata_full$eventDate &lt;- format(data_full$eventDate, \"%Y-%m-%d\")\n\n# Per_full$eventDateTime &lt;- ymd_hms(paste(Per_full$\"photo_date\", Per_full$\"photo_time\", sep=\" \"))\ndata_full$eventDateTime &lt;- ymd_hms(data_full$\"Date_Time_Captured\")\n\n\n# remove duplicated cameras\nind1 &lt;- which(data_full$Camera_Id==\"ECU-020-C0027\")\nind2 &lt;- which(data_full$Camera_Id==\"ECU-020-C0006\")\ndata_full &lt;- data_full[-ind1,]\ndata_full &lt;- data_full[-ind2,]\n\n\n\n# filter 2021 and make uniques\nCToperation  &lt;- data_full |&gt; dplyr::group_by(Camera_Id) |&gt; #(array_locID) |&gt; \n                           mutate(minStart=start_date, maxEnd=end_date) |&gt; distinct(Longitude, Latitude, minStart, maxEnd) |&gt; dplyr::ungroup()\n# remove one duplicated\n# View(CToperation)\n# CToperation &lt;- CToperation[-15,]\n\n\nCToperation[231,3] &lt;- -4.482831 #Latitude\nCToperation[93,3] &lt;- -0.5548211 #Latitude\nCToperation[93,2] &lt;- -76.48333\n\n### remove duplicated\n# View(as.data.frame(table(CToperation$Latitude)))\n# View(as.data.frame(table(CToperation$Longitude)))\n# CToperation &lt;- CToperation[-c(90,94),]\n# Latitude -4.48283\n# Latitude -0.554820969700813\n# Longitude -76.4833290316164\n\n# Generamos la matríz de operación de las cámaras\n\ncamop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operación\n                         stationCol= \"Camera_Id\", # Columna que define la estación\n                         setupCol= \"minStart\", #Columna fecha de colocación\n                         retrievalCol= \"maxEnd\", #Columna fecha de retiro\n                         #hasProblems= T, # Hubo fallos de cámaras\n                         dateFormat= \"%Y-%m-%d\")#, #, # Formato de las fechas\n                         #cameraCol=\"Camera_Id\")\n                         # sessionCol= \"Year\")\n\n# Generar las historias de detección ---------------------------------------\n## remove plroblem species\n\n# Per_full$scientificName &lt;- paste(Per_full$genus, Per_full$species, sep=\" \")\n\n#### remove stups\n# ind &lt;- which(Per_full$scientificName==\"NA NA\")\n# Per_full &lt;- Per_full[-ind,]\n\n# ind &lt;- which(Per_full$scientificName==\"Set up\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Blank\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Unidentifiable\")\n# Per_full &lt;- Per_full[-ind,]\n\n\nDetHist_list &lt;- lapply(unique(data_full$scientificName), FUN = function(x) {\n  detectionHistory(\n    recordTable         = data_full, # abla de registros\n    camOp                = camop, # Matriz de operación de cámaras\n    stationCol           = \"Camera_Id\",\n    speciesCol           = \"scientificName\",\n    recordDateTimeCol    = \"eventDateTime\",\n    recordDateTimeFormat  = \"%Y-%m-%d %H:%M:%S\",\n    species              = x,     # la función reemplaza x por cada una de las especies\n    occasionLength       = 7, # Colapso de las historias a 10 ías\n    day1                 = \"station\", # \"survey\" a specific date, \"station\", #inicie en la fecha de cada survey\n    datesAsOccasionNames = FALSE,\n    includeEffort        = TRUE,\n    scaleEffort          = FALSE,\n    #unmarkedMultFrameInput=TRUE\n    timeZone             = \"America/Bogota\" \n    )\n  }\n)\n\nWarning: \nAt 1 stations there were records after camera operation date range:  PER-003-C0070\n\n\nWarning: \n\n5 records (out of 4155) were removed because they were taken after the end of the last occasion, e.g.:\nPER-003-C0070: 2016-11-03 11:56:53\nPER-003-C0070: 2016-11-03 11:56:54\nPER-003-C0070: 2016-11-03 11:56:55\nPER-003-C0070: 2016-11-03 11:56:56\nPER-003-C0070: 2016-11-03 11:56:57\n\n\nWarning: \nAt 1 stations there were records before camera operation date range:  PER-003-C0071\n\n\nWarning: \nAt 1 stations there were records after camera operation date range:  PER-002-C0036\n\n\nWarning: 5 records (out of 1588) were removed because they were taken before day1 (if a date was specified),  within the buffer period, or before occasionStartTime on the 1st day, e.g.:\nPER-003-C0071: 2016-08-28 16:28:21\nPER-003-C0071: 2016-08-28 16:28:22\nPER-003-C0071: 2016-08-28 16:28:23\nPER-003-C0071: 2016-08-28 16:28:24\nPER-003-C0071: 2016-08-28 16:28:25\n\n\nWarning: \n\n1 records (out of 1588) were removed because they were taken after the end of the last occasion, e.g.:\nPER-002-C0036: 2015-05-25 13:38:49\n\nCode# names\nnames(DetHist_list) &lt;- unique(data_full$scientificName)\n\n# Finalmente creamos una lista nueva donde estén solo las historias de detección\nylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)\n# otra lista con effort scaled\nefort &lt;- lapply(DetHist_list, FUN = function(x) x$effort)\n\n# number of observetions per sp, collapsed to 7 days\n# lapply(ylist, sum, na.rm = TRUE)\n\n\nArrange spatial covariates\nThe standard EPSG code for a Lambert Azimuthal Equal-Area projection for South America is EPSG:10603 (WGS 84 / GLANCE South America). This projection is specifically designed for the continent and has its center located around the central meridian for the region. The units are meters.\nFLII scores range from 0 (lowest integrity) to 10 (highest). Grantham discretized this range to define three broad illustrative categories: low (≤6.0); medium (&gt;6.0 and &lt;9.6); and high integrity (≥9.6).\n\nCode#transform coord data to Lambert Azimuthal Equal-Area\nAP_Tahuayo_UTM &lt;- st_transform(AP_Tahuayo, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Tahuayo_UTM_line &lt;- st_cast(AP_Tahuayo_UTM,\"MULTILINESTRING\")# \"LINESTRING\")\n#transform Yasuni to Lambert Azimuthal Equal-Area\nAP_Yasuni_UTM &lt;- st_transform(AP_Yasuni, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Yasuni_UTM_line &lt;- st_cast(AP_Yasuni_UTM, \"MULTILINESTRING\")\n\n\n############## sf AP Union \nAP_merged_sf_UTM &lt;- st_union(AP_Tahuayo_UTM, AP_Yasuni_UTM)\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\nCodeAP_merged_line &lt;- st_cast(AP_merged_sf_UTM, to=\"MULTILINESTRING\")\n\n\n# make sf() from data table\ndata_full_sf &lt;- CToperation |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"), \n              crs = 4326)\n\n# gete elevation proint from AWS\nelev_data &lt;- elevatr::get_elev_point(locations = data_full_sf, src = \"aws\")\n\nMosaicing & Projecting\n\n\nNote: Elevation units are in meters\n\nCode# extract elev and paste to table\ndata_full_sf$elev &lt;- elev_data$elevation\nstr(data_full_sf$elev)\n\n num [1:275] 448 380 577 490 522 404 522 543 456 496 ...\n\nCode# extract in AP\ndata_full_sf$in_AP = as.factor(st_intersects(data_full_sf, AP_Tahuayo, sparse = FALSE))\n\nin_AP &lt;- as.numeric((st_drop_geometry(data_full_sf$in_AP)))\n\n# extract FLII\ndata_full_sf$FLII &lt;- terra::extract(FLII2016, data_full_sf)[,2]\nstr(data_full_sf$FLII)\n\n num [1:275] 9.57 9.65 9.69 9.66 9.92 ...\n\nCode# mapview(full_sites_14_15_16_sf, zcol = \"in_AP\", burst = TRUE)\n\n# Transform coord to Lambert Azimuthal Equal-Area\ndata_full_sf_UTM &lt;- st_transform(data_full_sf, \"EPSG:10603\")\n\n\ncoords &lt;- st_coordinates(data_full_sf_UTM)\n#str(coords)\n\n#### fix duplicated coord\n# -1840583.53296873  en x\n# -1842515.36969736  en x\n# 1547741.44311964  en y\n# 1541202.24796904 en y\n\n# which(coords[,1]==\"-1840583.53296873\")\n# which(coords[,1]==\"-1842515.36969736\")\n# which(coords[,2]==\"1547741.44311964\")\n# which(coords[,2]==\"1541202.24796904\")\n\n# make Ecu_14_15_16 an sf object\n#    cam_sf &lt;- st_as_sf(Ecu_14_15_16, coords = c(\"lon\",\"lat\"))   #crs=\"EPSG:4326\")\n    #--- set CRS ---#\n#    st_crs(cam_sf) &lt;- 4326\n\n\n\n\n# Calculate the distance\n#multiplic &lt;- full_sites_14_15_16_sf_UTM |&gt; mutate(multiplic= as.numeric(in_AP)) \nmultiplic=ifelse(data_full_sf_UTM$in_AP==\"TRUE\",-1,1)\ndata_full_sf_UTM$border_dist &lt;- as.numeric(st_distance(data_full_sf_UTM, AP_Tahuayo_UTM_line) * multiplic )\n# print(border_dist)\n\n# convert true false to inside outside\ndata_full_sf_UTM &lt;- data_full_sf_UTM |&gt; \n  mutate(in_AP = case_when(\n    str_detect(in_AP, \"TRUE\") ~ \"inside_AP\",\n    str_detect(in_AP, \"FALSE\") ~ \"outside_AP\"\n  )) |&gt; mutate(in_AP=as.factor(in_AP))\n\n\nhist(data_full_sf_UTM$border_dist)\n\n\n\n\n\n\n\nPrepare the model\n\n\n\n\n\n\nTipData in a 3D array\n\n\n\nThe data must be placed in a three-dimensional array with dimensions corresponding to species, sites, and replicates in that order.\n\n\nThe function sfMsPGOcc\nFits multi-species spatial occupancy models with species correlations (i.e., a spatially-explicit joint species distribution model with imperfect detection). We use Polya-Gamma latent variables and a spatial factor modeling approach. Currently, models are implemented using a Nearest Neighbor Gaussian Process.\n\nCode# Detection-nondetection data ---------\n# Species of interest, can select individually\n# curr.sp &lt;- sort(unique(Ecu_14_15_16$.id))# c('BAWW', 'BLJA', 'GCFL')\n# sort(names(DetHist_list))\nselected.sp &lt;-  c(\n\"Atelocynus microtis\" ,\n\"Coendou prehensilis\" ,\n\"Cuniculus paca\",           \n\"Dasyprocta fuliginosa\",      \n\"Dasypus sp.\" ,    \n\"Didelphis marsupialis\",    \n\"Eira barbara\",  \n\"Herpailurus yagouaroundi\",\n\"Leopardus pardalis\",    \n\"Leopardus tigrinus\" ,\n\"Leopardus wiedii\",         \n\"Mazama americana\",\n\"Mazama nemorivaga\",\n#\"Mitu tuberosum\" ,\n\"Myoprocta pratti\",\n\"Myrmecophaga tridactyla\",\n\"Nasua nasua\" ,\n# \"Mazama americana\",         \n# \"Myotis myotis\",           \n# \"Nasua narica\",             \n# \"Odocoileus virginianus\",   \n\"Panthera onca\" ,\n# \"Procyon cancrivorus\" ,\n\"Pecari tajacu\",    \n#\"Penelope jacquacu\" ,\n\"Priodontes maximus\" ,\n\"Procyon cancrivorous\",      \n# \"Psophia leucoptera\",\n\"Puma concolor\" ,\n\"Puma yagouaroundi\",        \n# \"Rattus rattus\" ,\n# \"Roedor sp.\",\n# \"Sciurus sp.\",       \n# \"Sus scrofa\",               \n# \"Sylvilagus brasiliensis\",  \n\"Tamandua tetradactyla\",   \n\"Tapirus terrestris\",\n\"Tayassu pecari\"\n#\"Tinamus major\"            \n              )\n\n# y.msom &lt;- y[which(sp.codes %in% selected.sp), , ]\n# str(y.msom)\n\n# Use selection\ny.selected &lt;- ylist[selected.sp]   \n\n#### three-dimensional array with dimensions corresponding to species, sites, and replicates\n\n# 1. Load the abind library to make arrays easily \nlibrary(abind)\nmy_array_abind &lt;- abind(y.selected, # start from list\n                        along = 3, # 3D array\n                        use.first.dimnames=TRUE) # keep names\n\n# Transpose the array to have:\n# species, sites, and sampling occasions in that order\n# The new order is (3rd dim, 1st dim, 2nd dim)\ntransposed_array &lt;- aperm(my_array_abind, c(3, 1, 2))\n\n#### site covs\nsitecovs &lt;- as.data.frame(st_drop_geometry(\n                    data_full_sf_UTM[,5:8]))\n\n sitecovs[, 1] &lt;- as.vector((sitecovs[,1]))   # scale numeric covariates\n sitecovs[, 3] &lt;- as.vector((sitecovs[,3]))   # scale numeric covariates\n sitecovs[, 4] &lt;- as.vector((sitecovs[,4]))   # scale numeric covariates\n # sitecovs$fact &lt;- factor(c(\"A\", \"A\", \"B\"))    # categorical covariate\n\nnames(sitecovs) &lt;- c(\"elev\", \"in_AP\", \"FLII\", \"border_dist\")\n\n# check consistancy equal number of spatial covariates and rows in data\n# identical(nrow(ylist[[1]]), nrow(covars)) \n\n# Base de datos para los análisis -----------------------------------------\n\n# match the names to \"y\"  \"occ.covs\" \"det.covs\" \"coords\" \ndata_list &lt;- list(y = transposed_array, # Historias de detección\n                  occ.covs = sitecovs, # covs de sitio\n                  det.covs  = list(effort = DetHist_list[[1]]$effort),\n                  coords = st_coordinates(data_full_sf_UTM)\n                  )  # agregamos el esfuerzo de muestreo como covariable de observación\n\n\nRunning the model\nWe let spOccupancy set the initial values by default based on the prior distributions.\n\nCode# Running the model\n\n# 3. 1 Modelo multi-especie  -----------------------------------------\n\n# 2. Model fitting --------------------------------------------------------\n# Fit a non-spatial, multi-species occupancy model. \nout &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort) , # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.samples = 6000, \n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 275 sites and 25 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 1 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCode# Fit a non-spatial, Latent Factor Multi-Species Occupancy Model. \n  out.lfMs &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.omp.threads = 6,\n                 n.samples = 6000, \n                 n.factors = 5, # balance of rare sp. and run time\n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nWarning in msPGOcc(occ.formula = ~scale(elev) + scale(border_dist) +\nscale(FLII), : 'n.factors' is not an argument\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 275 sites and 25 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.report = 1000, n.burn = 1000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 5.3693\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -1.7390 0.4085 -2.5217 -1.7299 -0.9329 1.0643 173\nscale(elev)        -0.5305 0.1543 -0.8503 -0.5290 -0.2350 1.0148 764\nscale(border_dist)  0.2108 0.2862 -0.3771  0.2172  0.7780 1.0003 975\nscale(FLII)         0.2943 0.1663 -0.0035  0.2822  0.6602 1.0120 756\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        3.0666 1.2542 1.3838 2.8131 6.2378 1.0026 414\nscale(elev)        0.1179 0.1003 0.0280 0.0900 0.3716 1.0066 751\nscale(border_dist) 1.6622 0.7389 0.6852 1.5266 3.4788 1.0235 426\nscale(FLII)        0.3375 0.2257 0.0785 0.2785 0.8994 1.0110 449\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.3235 0.3067 -3.0009 -2.3049 -1.7721 1.0844  169\nscale(effort)  0.2979 0.0687  0.1706  0.2969  0.4422 1.0052 1210\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.5875 0.7433 0.6393 1.4248 3.5392 1.1474   98\nscale(effort) 0.0476 0.0278 0.0162 0.0418 0.1199 1.0019 1164\n\nCode# Fit a Spatial Factor Multi-Species Occupancy Model\n# latent spatial factors.\ntictoc::tic()\n  out.sp &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 275 sites and 25 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n1282.4 sec elapsed\n\nCode#########################\n# tictoc::tic()\n#   out.sp.gaus &lt;- sfMsPGOcc(occ.formula = ~ scale(border_dist) , \n#                            det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,              \n#                            data = data_list, \n#                            n.batch = 400, \n#                            batch.length = 25,\n#                            n.thin = 5, \n#                            n.burn = 5000, \n#                            n.chains = 1,\n#                            NNGP = TRUE,\n#                            n.factors = 5,\n#                            n.neighbors = 15,\n#                            cov.model = 'gaussian',\n#                            n.report = 100);beep(sound = 4)\n# tictoc::toc()\n\n# save the results to not run again\n# save(out, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/result_2.R\") # guardamos los resultados para no correr de nuevo\n# save the results to not run again\n# save(out.sp, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n# save(out.lfMs, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/lfms_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n\n# load(\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\")\n# summary(fit.commu)\n\n\nModel validation\nWe next perform a posterior predictive check using the Freeman-Tukey statistic grouping the data by sites. We summarize the posterior predictive check with the summary() function, which reports a Bayesian p-value. A Bayesian p-value that hovers around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well (Hobbs and Hooten 2015). As always with a simulation-based analysis using MCMC, you will get numerically slightly different values.\n\nCode# 3. Model validation -----------------------------------------------------\n# Perform a posterior predictive check to assess model fit. \nppc.out &lt;- ppcOcc(out, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.lfMs &lt;- ppcOcc(out.lfMs, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.sp &lt;- ppcOcc(out.sp, fit.stat = 'freeman-tukey',\n                     group = 1)\n\n# Calculate a Bayesian p-value as a simple measure of Goodness of Fit.\n# Bayesian p-values between 0.1 and 0.9 indicate adequate model fit. \nsummary(ppc.out)\n\n\nCall:\nppcOcc(object = out, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3506 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.5253\nCoendou prehensilis Bayesian p-value: 0.6247\nCuniculus paca Bayesian p-value: 0.0027\nDasyprocta fuliginosa Bayesian p-value: 0.0027\nDasypus sp. Bayesian p-value: 0.1387\nDidelphis marsupialis Bayesian p-value: 0.3927\nEira barbara Bayesian p-value: 0.4787\nHerpailurus yagouaroundi Bayesian p-value: 0.5527\nLeopardus pardalis Bayesian p-value: 0.3207\nLeopardus tigrinus Bayesian p-value: 0.2067\nLeopardus wiedii Bayesian p-value: 0.4613\nMazama americana Bayesian p-value: 0.0407\nMazama nemorivaga Bayesian p-value: 0.47\nMyoprocta pratti Bayesian p-value: 0.228\nMyrmecophaga tridactyla Bayesian p-value: 0.4067\nNasua nasua Bayesian p-value: 0.4887\nPanthera onca Bayesian p-value: 0.5007\nPecari tajacu Bayesian p-value: 0.1053\nPriodontes maximus Bayesian p-value: 0.5833\nProcyon cancrivorous Bayesian p-value: 0.4633\nPuma concolor Bayesian p-value: 0.3413\nPuma yagouaroundi Bayesian p-value: 0.6587\nTamandua tetradactyla Bayesian p-value: 0.4113\nTapirus terrestris Bayesian p-value: 0.0693\nTayassu pecari Bayesian p-value: 0.2913\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.lfMs)\n\n\nCall:\nppcOcc(object = out.lfMs, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3563 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.506\nCoendou prehensilis Bayesian p-value: 0.6367\nCuniculus paca Bayesian p-value: 7e-04\nDasyprocta fuliginosa Bayesian p-value: 0.006\nDasypus sp. Bayesian p-value: 0.1433\nDidelphis marsupialis Bayesian p-value: 0.3993\nEira barbara Bayesian p-value: 0.454\nHerpailurus yagouaroundi Bayesian p-value: 0.558\nLeopardus pardalis Bayesian p-value: 0.3067\nLeopardus tigrinus Bayesian p-value: 0.2507\nLeopardus wiedii Bayesian p-value: 0.4727\nMazama americana Bayesian p-value: 0.04\nMazama nemorivaga Bayesian p-value: 0.5\nMyoprocta pratti Bayesian p-value: 0.2393\nMyrmecophaga tridactyla Bayesian p-value: 0.4633\nNasua nasua Bayesian p-value: 0.478\nPanthera onca Bayesian p-value: 0.5127\nPecari tajacu Bayesian p-value: 0.1007\nPriodontes maximus Bayesian p-value: 0.584\nProcyon cancrivorous Bayesian p-value: 0.4933\nPuma concolor Bayesian p-value: 0.3107\nPuma yagouaroundi Bayesian p-value: 0.658\nTamandua tetradactyla Bayesian p-value: 0.4147\nTapirus terrestris Bayesian p-value: 0.072\nTayassu pecari Bayesian p-value: 0.3073\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.sp)\n\n\nCall:\nppcOcc(object = out.sp, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3512 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.4947\nCoendou prehensilis Bayesian p-value: 0.615\nCuniculus paca Bayesian p-value: 0.0017\nDasyprocta fuliginosa Bayesian p-value: 0.001\nDasypus sp. Bayesian p-value: 0.1607\nDidelphis marsupialis Bayesian p-value: 0.352\nEira barbara Bayesian p-value: 0.5113\nHerpailurus yagouaroundi Bayesian p-value: 0.5777\nLeopardus pardalis Bayesian p-value: 0.3227\nLeopardus tigrinus Bayesian p-value: 0.2577\nLeopardus wiedii Bayesian p-value: 0.4577\nMazama americana Bayesian p-value: 0.051\nMazama nemorivaga Bayesian p-value: 0.584\nMyoprocta pratti Bayesian p-value: 0.246\nMyrmecophaga tridactyla Bayesian p-value: 0.3277\nNasua nasua Bayesian p-value: 0.4343\nPanthera onca Bayesian p-value: 0.5287\nPecari tajacu Bayesian p-value: 0.0667\nPriodontes maximus Bayesian p-value: 0.5577\nProcyon cancrivorous Bayesian p-value: 0.478\nPuma concolor Bayesian p-value: 0.3493\nPuma yagouaroundi Bayesian p-value: 0.6063\nTamandua tetradactyla Bayesian p-value: 0.4233\nTapirus terrestris Bayesian p-value: 0.054\nTayassu pecari Bayesian p-value: 0.3203\nFit statistic:  freeman-tukey \n\n\n\n\n\n\n\n\nImportant\n\n\n\nA Bayesian p-value that around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well.\n\n\nFit plot\n\nCode#### fit plot\nppc.df &lt;- data.frame(fit = ppc.out.sp$fit.y, \n                     fit.rep = ppc.out.sp$fit.y.rep, \n                     color = 'lightskyblue1')\n\nppc.df$color[ppc.df$fit.rep.1 &gt; ppc.df$fit.1] &lt;- 'lightsalmon'\nplot(ppc.df$fit.1, ppc.df$fit.rep.1, bg = ppc.df$color, pch = 21, \n     ylab = 'Fit', xlab = 'True')\nlines(ppc.df$fit.1, ppc.df$fit.1, col = 'black')\n\n\n\nThe most symmetrical, better fit!\n\n\n\nModel comparison\n\nCode# 4. Model comparison -----------------------------------------------------\n# Compute Widely Applicable Information Criterion (WAIC)\n# Lower values indicate better model fit. \nwaicOcc(out)\n\n       elpd          pD        WAIC \n-6286.65398    94.58919 12762.48634 \n\nCodewaicOcc(out.lfMs)\n\n       elpd          pD        WAIC \n-6286.13570    93.69457 12759.66055 \n\nCodewaicOcc(out.sp)\n\n      elpd         pD       WAIC \n-5681.7084   519.3579 12402.1327 \n\n\nModel comparison as table\n\nCode# Here we summarize the spatial factor loadings\n# summary(out.sp$lambda.samples)\n\n# Resultados --------------------------------------------------------------\n# Extraemos lo tabla de valores estimados\nmodresult &lt;- cbind(as.data.frame(waicOcc(out)),\n                  as.data.frame(waicOcc(out.sp)),\n                  as.data.frame(waicOcc(out.lfMs))\n                  #as.data.frame(waicOcc(out.sp.gaus))\n                  )\n# View(modresult)\nmodresult_sorted &lt;- as.data.frame(t(modresult)) |&gt; \n  arrange(WAIC) # sort by\n  \nDT::datatable(modresult_sorted)\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\nLower values in WAIC indicate better model fit.\n\n\nPosterior Summary\n\nCode# 5. Posterior summaries --------------------------------------------------\n# Concise summary of main parameter estimates\nsummary(out.sp, level = 'community')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 21.3693\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -2.3556 0.5613 -3.4416 -2.3635 -1.2299 1.0149 233\nscale(elev)        -0.8954 0.2544 -1.4309 -0.8934 -0.4145 1.1604 404\nscale(border_dist)  0.4657 0.4721 -0.4847  0.4775  1.4029 1.2294 386\nscale(FLII)         0.3092 0.2098 -0.0707  0.2956  0.7598 1.0207 766\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat ESS\n(Intercept)        6.5368 2.9210 2.8801 5.9125 14.0293 1.3010 272\nscale(elev)        0.1677 0.1672 0.0303 0.1186  0.6067 1.0306 851\nscale(border_dist) 3.6680 1.6633 1.5649 3.3125  7.9357 1.0846 352\nscale(FLII)        0.4199 0.3270 0.0702 0.3331  1.2903 1.1985 545\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.3896 0.3009 -3.0039 -2.3844 -1.8322 1.0079  581\nscale(effort)  0.2986 0.0667  0.1701  0.2962  0.4329 1.0010 2273\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.8505 0.7622 0.8063 1.7059 3.7325 1.0109  209\nscale(effort) 0.0477 0.0273 0.0168 0.0411 0.1131 1.0058 2052\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  9.0645 9.1966 0.0000  6.4957 26.5533 4.0543    8\nphi-2 13.5413 8.0203 0.4755 13.3527 26.9094 1.0006 2405\nphi-3  8.8927 9.1088 0.0000  6.0873 26.4164 3.9828    8\nphi-4 13.9092 7.8909 0.7025 14.2706 26.7527 1.0013 3000\nphi-5 13.8039 8.0059 0.5725 13.7579 26.7511 0.9996 3000\n\nCodesummary(out.sp, level = 'species')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 21.3693\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD     2.5%     50%\n(Intercept)-Atelocynus microtis             -1.2447 1.9690  -3.6104 -1.8567\n(Intercept)-Coendou prehensilis             -5.0068 1.7412  -8.0888 -5.1041\n(Intercept)-Cuniculus paca                   0.5448 0.3734  -0.1526  0.5436\n(Intercept)-Dasyprocta fuliginosa           -1.2008 0.7588  -2.7752 -1.0905\n(Intercept)-Dasypus sp.                     -3.9965 0.8895  -5.9661 -3.8856\n(Intercept)-Didelphis marsupialis           -5.1758 1.2220  -7.7534 -5.0950\n(Intercept)-Eira barbara                    -1.6825 1.0306  -3.4725 -1.7829\n(Intercept)-Herpailurus yagouaroundi        -3.8420 1.6500  -7.0590 -3.8985\n(Intercept)-Leopardus pardalis              -1.5795 0.5746  -2.7305 -1.5722\n(Intercept)-Leopardus tigrinus              -6.9887 1.3575 -10.1608 -6.8285\n(Intercept)-Leopardus wiedii                -3.0034 1.4393  -5.5070 -3.1733\n(Intercept)-Mazama americana                -4.9703 1.0184  -7.2119 -4.8898\n(Intercept)-Mazama nemorivaga               -4.6760 1.0225  -6.9421 -4.6104\n(Intercept)-Myoprocta pratti                -4.3491 0.8055  -6.0377 -4.2865\n(Intercept)-Myrmecophaga tridactyla         -1.0323 1.2651  -2.9713 -1.2485\n(Intercept)-Nasua nasua                     -0.9354 1.2480  -3.1910 -1.0310\n(Intercept)-Panthera onca                   -1.5584 0.7754  -3.0622 -1.5787\n(Intercept)-Pecari tajacu                    1.6194 0.6008   0.5180  1.5907\n(Intercept)-Priodontes maximus              -0.7851 1.3960  -3.1681 -0.8584\n(Intercept)-Procyon cancrivorous            -3.9337 1.7305  -7.1243 -4.0398\n(Intercept)-Puma concolor                   -2.5281 0.5607  -3.7888 -2.4657\n(Intercept)-Puma yagouaroundi               -3.7984 2.0217  -7.1723 -3.9629\n(Intercept)-Tamandua tetradactyla           -3.6120 1.5013  -6.1012 -3.7581\n(Intercept)-Tapirus terrestris               0.5614 0.3365  -0.0567  0.5443\n(Intercept)-Tayassu pecari                  -1.0524 0.4846  -2.1429 -1.0285\nscale(elev)-Atelocynus microtis             -0.7646 0.4459  -1.5920 -0.7836\nscale(elev)-Coendou prehensilis             -0.8954 0.4713  -1.8454 -0.8863\nscale(elev)-Cuniculus paca                  -0.8038 0.3295  -1.4672 -0.7940\nscale(elev)-Dasyprocta fuliginosa           -0.7867 0.3918  -1.5301 -0.7969\nscale(elev)-Dasypus sp.                     -1.0194 0.5044  -2.0823 -0.9872\nscale(elev)-Didelphis marsupialis           -0.9383 0.4628  -1.9580 -0.9166\nscale(elev)-Eira barbara                    -0.9119 0.4360  -1.8253 -0.8928\nscale(elev)-Herpailurus yagouaroundi        -0.7530 0.4698  -1.6518 -0.7596\nscale(elev)-Leopardus pardalis              -0.8248 0.3804  -1.5656 -0.8262\nscale(elev)-Leopardus tigrinus              -0.8203 0.4465  -1.6856 -0.8341\nscale(elev)-Leopardus wiedii                -0.9309 0.4638  -1.9239 -0.9089\nscale(elev)-Mazama americana                -0.9710 0.4805  -1.9858 -0.9545\nscale(elev)-Mazama nemorivaga               -0.9067 0.4633  -1.8802 -0.8984\nscale(elev)-Myoprocta pratti                -0.9699 0.4280  -1.8692 -0.9420\nscale(elev)-Myrmecophaga tridactyla         -1.0009 0.4472  -1.9735 -0.9678\nscale(elev)-Nasua nasua                     -1.0097 0.4827  -2.0695 -0.9752\nscale(elev)-Panthera onca                   -1.0409 0.4428  -2.0277 -1.0129\nscale(elev)-Pecari tajacu                   -0.7235 0.3683  -1.4378 -0.7349\nscale(elev)-Priodontes maximus              -0.8019 0.4529  -1.6590 -0.8125\nscale(elev)-Procyon cancrivorous            -0.9673 0.4787  -2.0303 -0.9378\nscale(elev)-Puma concolor                   -0.8517 0.3817  -1.6276 -0.8412\nscale(elev)-Puma yagouaroundi               -0.9294 0.4672  -1.9621 -0.9023\nscale(elev)-Tamandua tetradactyla           -0.9215 0.4418  -1.8198 -0.9015\nscale(elev)-Tapirus terrestris              -0.8273 0.3384  -1.5116 -0.8260\nscale(elev)-Tayassu pecari                  -1.0361 0.3720  -1.8501 -1.0125\nscale(border_dist)-Atelocynus microtis       1.0949 0.8500  -0.4508  1.0346\nscale(border_dist)-Coendou prehensilis       0.0353 1.1490  -2.2754  0.0683\nscale(border_dist)-Cuniculus paca            0.4280 0.4712  -0.4926  0.4116\nscale(border_dist)-Dasyprocta fuliginosa     1.9160 0.8016   0.3551  1.8524\nscale(border_dist)-Dasypus sp.              -3.0272 0.9525  -5.1879 -2.9299\nscale(border_dist)-Didelphis marsupialis    -0.8423 0.9963  -3.0447 -0.7362\nscale(border_dist)-Eira barbara             -0.6474 0.7555  -2.2141 -0.5947\nscale(border_dist)-Herpailurus yagouaroundi  2.8185 1.1679   0.8719  2.6814\nscale(border_dist)-Leopardus pardalis        1.0967 0.4968   0.1588  1.0795\nscale(border_dist)-Leopardus tigrinus        1.4605 0.9921  -0.3536  1.4025\nscale(border_dist)-Leopardus wiedii          0.7974 0.8404  -0.8475  0.7871\nscale(border_dist)-Mazama americana         -2.3200 1.0032  -4.5913 -2.2440\nscale(border_dist)-Mazama nemorivaga        -2.3046 1.0497  -4.5824 -2.2697\nscale(border_dist)-Myoprocta pratti          1.6717 0.5783   0.6103  1.6454\nscale(border_dist)-Myrmecophaga tridactyla   1.3486 0.7457  -0.0079  1.3005\nscale(border_dist)-Nasua nasua              -1.6585 1.0493  -4.0615 -1.5432\nscale(border_dist)-Panthera onca             1.8110 0.6090   0.7341  1.7866\nscale(border_dist)-Pecari tajacu             1.6093 0.6494   0.4013  1.5870\nscale(border_dist)-Priodontes maximus        2.5699 0.9858   0.9694  2.4720\nscale(border_dist)-Procyon cancrivorous     -1.1479 1.1955  -3.7943 -1.0396\nscale(border_dist)-Puma concolor             2.0791 0.5225   1.1135  2.0634\nscale(border_dist)-Puma yagouaroundi        -0.7815 1.2931  -3.6693 -0.6486\nscale(border_dist)-Tamandua tetradactyla     0.9455 0.8383  -0.6490  0.9022\nscale(border_dist)-Tapirus terrestris        1.2127 0.4681   0.3571  1.1784\nscale(border_dist)-Tayassu pecari            2.0875 0.5542   1.0371  2.0630\nscale(FLII)-Atelocynus microtis             -0.3755 0.4469  -1.4699 -0.3172\nscale(FLII)-Coendou prehensilis              0.3499 0.6020  -0.7564  0.3136\nscale(FLII)-Cuniculus paca                  -0.3922 0.3021  -1.0521 -0.3664\nscale(FLII)-Dasyprocta fuliginosa           -0.1609 0.2952  -0.7866 -0.1449\nscale(FLII)-Dasypus sp.                      0.1085 0.4219  -0.6990  0.1015\nscale(FLII)-Didelphis marsupialis            0.1903 0.5428  -0.8345  0.1773\nscale(FLII)-Eira barbara                     0.0691 0.5233  -1.0713  0.0903\nscale(FLII)-Herpailurus yagouaroundi         0.1570 0.5702  -1.0278  0.1644\nscale(FLII)-Leopardus pardalis               0.3452 0.4059  -0.4456  0.3384\nscale(FLII)-Leopardus tigrinus               0.4432 0.5772  -0.5061  0.3771\nscale(FLII)-Leopardus wiedii                -0.0312 0.5889  -1.3743  0.0082\nscale(FLII)-Mazama americana                 0.7583 0.6015  -0.1788  0.6779\nscale(FLII)-Mazama nemorivaga                0.5437 0.5638  -0.3996  0.4875\nscale(FLII)-Myoprocta pratti                 0.3890 0.4190  -0.3377  0.3453\nscale(FLII)-Myrmecophaga tridactyla          0.3197 0.5583  -0.8150  0.3224\nscale(FLII)-Nasua nasua                      0.5609 0.6194  -0.4858  0.4938\nscale(FLII)-Panthera onca                    0.9361 0.5636   0.0082  0.8735\nscale(FLII)-Pecari tajacu                    0.1451 0.2648  -0.4266  0.1638\nscale(FLII)-Priodontes maximus               0.4273 0.6113  -0.7536  0.4038\nscale(FLII)-Procyon cancrivorous             0.4719 0.6654  -0.6401  0.4086\nscale(FLII)-Puma concolor                    1.1852 0.5724   0.2546  1.1377\nscale(FLII)-Puma yagouaroundi                0.3959 0.6511  -0.8494  0.3585\nscale(FLII)-Tamandua tetradactyla            0.3998 0.6126  -0.6971  0.3488\nscale(FLII)-Tapirus terrestris              -0.0110 0.2570  -0.5701  0.0023\nscale(FLII)-Tayassu pecari                   0.5121 0.3700  -0.2092  0.4934\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis              3.5004 1.8341   44\n(Intercept)-Coendou prehensilis             -0.8733 1.1266  145\n(Intercept)-Cuniculus paca                   1.3167 1.4191   68\n(Intercept)-Dasyprocta fuliginosa            0.1003 2.1969   27\n(Intercept)-Dasypus sp.                     -2.5478 1.0610  523\n(Intercept)-Didelphis marsupialis           -2.9272 1.1312  308\n(Intercept)-Eira barbara                     0.5880 1.0075  237\n(Intercept)-Herpailurus yagouaroundi        -0.5364 1.2466  153\n(Intercept)-Leopardus pardalis              -0.4407 1.0407  529\n(Intercept)-Leopardus tigrinus              -4.7237 1.1190  340\n(Intercept)-Leopardus wiedii                 0.1249 1.1833  158\n(Intercept)-Mazama americana                -3.2022 1.0596  328\n(Intercept)-Mazama nemorivaga               -2.9332 1.0788  329\n(Intercept)-Myoprocta pratti                -2.9434 1.0696  480\n(Intercept)-Myrmecophaga tridactyla          2.3272 1.1813   99\n(Intercept)-Nasua nasua                      1.6953 1.0050  215\n(Intercept)-Panthera onca                    0.0425 1.0155  323\n(Intercept)-Pecari tajacu                    2.8976 1.5219  101\n(Intercept)-Priodontes maximus               2.1955 1.0474  134\n(Intercept)-Procyon cancrivorous            -0.3323 1.2843  134\n(Intercept)-Puma concolor                   -1.6024 1.0990  453\n(Intercept)-Puma yagouaroundi                0.5988 1.0628   94\n(Intercept)-Tamandua tetradactyla           -0.3285 1.1147  116\n(Intercept)-Tapirus terrestris               1.2339 1.1284  245\n(Intercept)-Tayassu pecari                  -0.1795 1.3897   64\nscale(elev)-Atelocynus microtis              0.1952 1.0575  823\nscale(elev)-Coendou prehensilis              0.0025 1.0477  895\nscale(elev)-Cuniculus paca                  -0.1570 1.0867  914\nscale(elev)-Dasyprocta fuliginosa            0.0110 1.1871  282\nscale(elev)-Dasypus sp.                     -0.1427 1.0784  832\nscale(elev)-Didelphis marsupialis           -0.0955 1.0683 1164\nscale(elev)-Eira barbara                    -0.0957 1.0604 1268\nscale(elev)-Herpailurus yagouaroundi         0.2465 1.0290  968\nscale(elev)-Leopardus pardalis              -0.0807 1.0258 1169\nscale(elev)-Leopardus tigrinus               0.0924 1.0415 1483\nscale(elev)-Leopardus wiedii                -0.0505 1.0598 1181\nscale(elev)-Mazama americana                -0.0826 1.0371  969\nscale(elev)-Mazama nemorivaga               -0.0397 1.0400 1105\nscale(elev)-Myoprocta pratti                -0.1781 1.0550 1128\nscale(elev)-Myrmecophaga tridactyla         -0.1821 1.0436 1060\nscale(elev)-Nasua nasua                     -0.1411 1.0536  945\nscale(elev)-Panthera onca                   -0.2436 1.0721  889\nscale(elev)-Pecari tajacu                    0.0275 1.0364  684\nscale(elev)-Priodontes maximus               0.1419 1.0455 1136\nscale(elev)-Procyon cancrivorous            -0.0863 1.0681 1118\nscale(elev)-Puma concolor                   -0.1174 1.0396 1295\nscale(elev)-Puma yagouaroundi               -0.0361 1.0325 1121\nscale(elev)-Tamandua tetradactyla           -0.0928 1.0686 1189\nscale(elev)-Tapirus terrestris              -0.1646 1.0556  976\nscale(elev)-Tayassu pecari                  -0.3505 1.1472  900\nscale(border_dist)-Atelocynus microtis       3.0415 1.3479  294\nscale(border_dist)-Coendou prehensilis       2.2218 1.0690  484\nscale(border_dist)-Cuniculus paca            1.4073 1.8764  124\nscale(border_dist)-Dasyprocta fuliginosa     3.5766 2.6792   44\nscale(border_dist)-Dasypus sp.              -1.3948 1.1776  531\nscale(border_dist)-Didelphis marsupialis     0.9095 1.0147  492\nscale(border_dist)-Eira barbara              0.6831 1.0518  574\nscale(border_dist)-Herpailurus yagouaroundi  5.5202 1.0572  222\nscale(border_dist)-Leopardus pardalis        2.1501 1.1070  591\nscale(border_dist)-Leopardus tigrinus        3.5944 1.0092  836\nscale(border_dist)-Leopardus wiedii          2.5316 1.0227  598\nscale(border_dist)-Mazama americana         -0.5887 1.3539  260\nscale(border_dist)-Mazama nemorivaga        -0.4627 1.5747  104\nscale(border_dist)-Myoprocta pratti          2.8864 1.2409  238\nscale(border_dist)-Myrmecophaga tridactyla   2.9475 1.1158  449\nscale(border_dist)-Nasua nasua               0.1156 1.0179  320\nscale(border_dist)-Panthera onca             3.1381 1.2110  448\nscale(border_dist)-Pecari tajacu             2.9703 1.3755  229\nscale(border_dist)-Priodontes maximus        4.8078 1.0633  269\nscale(border_dist)-Procyon cancrivorous      0.9032 1.0268  268\nscale(border_dist)-Puma concolor             3.1644 1.0919  565\nscale(border_dist)-Puma yagouaroundi         1.3510 1.1468  193\nscale(border_dist)-Tamandua tetradactyla     2.6906 1.0172  708\nscale(border_dist)-Tapirus terrestris        2.1903 1.2434  180\nscale(border_dist)-Tayassu pecari            3.2784 1.4874  171\nscale(FLII)-Atelocynus microtis              0.3593 1.0859  468\nscale(FLII)-Coendou prehensilis              1.6382 1.0020 1255\nscale(FLII)-Cuniculus paca                   0.1303 1.1170  953\nscale(FLII)-Dasyprocta fuliginosa            0.3718 1.2121  471\nscale(FLII)-Dasypus sp.                      0.9563 1.0039 2203\nscale(FLII)-Didelphis marsupialis            1.3182 1.0138 1541\nscale(FLII)-Eira barbara                     1.0575 1.0300  869\nscale(FLII)-Herpailurus yagouaroundi         1.2852 1.0072 1058\nscale(FLII)-Leopardus pardalis               1.1923 1.0124 1803\nscale(FLII)-Leopardus tigrinus               1.7832 1.0477 1284\nscale(FLII)-Leopardus wiedii                 1.0009 1.0117  871\nscale(FLII)-Mazama americana                 2.1273 1.1109  963\nscale(FLII)-Mazama nemorivaga                1.8721 1.1146  541\nscale(FLII)-Myoprocta pratti                 1.3211 1.0190 1822\nscale(FLII)-Myrmecophaga tridactyla          1.4492 1.0134 1110\nscale(FLII)-Nasua nasua                      1.9596 1.0353 1044\nscale(FLII)-Panthera onca                    2.1902 1.0895  796\nscale(FLII)-Pecari tajacu                    0.6391 1.0374 1772\nscale(FLII)-Priodontes maximus               1.7177 1.0180  881\nscale(FLII)-Procyon cancrivorous             1.9351 1.0330  823\nscale(FLII)-Puma concolor                    2.4393 1.1388  741\nscale(FLII)-Puma yagouaroundi                1.8217 1.0230  948\nscale(FLII)-Tamandua tetradactyla            1.8303 1.0135 1067\nscale(FLII)-Tapirus terrestris               0.4582 1.0190 2662\nscale(FLII)-Tayassu pecari                   1.2947 1.0359 1512\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -3.7352 0.9038 -5.4040 -3.6492 -2.1733\n(Intercept)-Coendou prehensilis        -3.7112 1.1543 -6.0954 -3.6225 -1.7110\n(Intercept)-Cuniculus paca             -0.7926 0.0686 -0.9300 -0.7911 -0.6592\n(Intercept)-Dasyprocta fuliginosa      -0.3631 0.0763 -0.5144 -0.3613 -0.2132\n(Intercept)-Dasypus sp.                -1.5000 0.1244 -1.7609 -1.4964 -1.2699\n(Intercept)-Didelphis marsupialis      -2.5927 0.6594 -3.9605 -2.5304 -1.4449\n(Intercept)-Eira barbara               -3.1408 0.3583 -3.8288 -3.1428 -2.4639\n(Intercept)-Herpailurus yagouaroundi   -3.7051 0.7875 -5.1603 -3.7156 -2.1538\n(Intercept)-Leopardus pardalis         -2.1780 0.2252 -2.6496 -2.1658 -1.7617\n(Intercept)-Leopardus tigrinus         -1.1704 0.9677 -3.1932 -1.1177  0.5850\n(Intercept)-Leopardus wiedii           -3.5111 0.7786 -5.0170 -3.4660 -2.0605\n(Intercept)-Mazama americana           -1.0744 0.1229 -1.3198 -1.0733 -0.8351\n(Intercept)-Mazama nemorivaga          -1.9967 0.1807 -2.3641 -1.9952 -1.6506\n(Intercept)-Myoprocta pratti           -1.5397 0.2771 -2.1139 -1.5282 -1.0241\n(Intercept)-Myrmecophaga tridactyla    -3.2007 0.4428 -4.1026 -3.1931 -2.3424\n(Intercept)-Nasua nasua                -3.6931 0.3650 -4.3246 -3.7280 -2.9104\n(Intercept)-Panthera onca              -2.5699 0.2872 -3.1723 -2.5596 -2.0495\n(Intercept)-Pecari tajacu              -1.2477 0.0752 -1.3952 -1.2473 -1.1013\n(Intercept)-Priodontes maximus         -3.6738 0.4685 -4.5051 -3.7176 -2.6893\n(Intercept)-Procyon cancrivorous       -3.7753 0.8684 -5.4045 -3.7535 -2.1045\n(Intercept)-Puma concolor              -1.6820 0.2147 -2.1215 -1.6758 -1.2782\n(Intercept)-Puma yagouaroundi          -4.2818 1.0479 -6.1807 -4.3275 -2.2824\n(Intercept)-Tamandua tetradactyla      -3.4121 0.8470 -5.0935 -3.3789 -1.8535\n(Intercept)-Tapirus terrestris         -1.1226 0.0820 -1.2858 -1.1215 -0.9587\n(Intercept)-Tayassu pecari             -1.8402 0.1653 -2.1892 -1.8337 -1.5241\nscale(effort)-Atelocynus microtis       0.3435 0.2000 -0.0323  0.3378  0.7598\nscale(effort)-Coendou prehensilis       0.2983 0.2203 -0.1491  0.2964  0.7416\nscale(effort)-Cuniculus paca            0.2468 0.0695  0.1173  0.2450  0.3865\nscale(effort)-Dasyprocta fuliginosa     0.3245 0.0851  0.1593  0.3236  0.4970\nscale(effort)-Dasypus sp.               0.3758 0.1297  0.1414  0.3698  0.6515\nscale(effort)-Didelphis marsupialis     0.3413 0.2125 -0.0429  0.3355  0.8037\nscale(effort)-Eira barbara              0.4406 0.1970  0.0975  0.4255  0.8752\nscale(effort)-Herpailurus yagouaroundi  0.1748 0.2114 -0.2663  0.1864  0.5750\nscale(effort)-Leopardus pardalis        0.1686 0.1283 -0.0784  0.1679  0.4278\nscale(effort)-Leopardus tigrinus        0.3372 0.2292 -0.1148  0.3329  0.8090\nscale(effort)-Leopardus wiedii          0.3316 0.2179 -0.0759  0.3271  0.7888\nscale(effort)-Mazama americana          0.3913 0.1466  0.1294  0.3821  0.7035\nscale(effort)-Mazama nemorivaga         0.2189 0.1368 -0.0381  0.2146  0.4950\nscale(effort)-Myoprocta pratti          0.2307 0.1722 -0.1053  0.2284  0.5700\nscale(effort)-Myrmecophaga tridactyla   0.3734 0.1838  0.0537  0.3601  0.7497\nscale(effort)-Nasua nasua               0.3384 0.1812  0.0100  0.3262  0.7365\nscale(effort)-Panthera onca             0.1647 0.1398 -0.1075  0.1618  0.4469\nscale(effort)-Pecari tajacu             0.2636 0.0753  0.1229  0.2613  0.4202\nscale(effort)-Priodontes maximus        0.1149 0.1715 -0.2165  0.1123  0.4399\nscale(effort)-Procyon cancrivorous      0.3442 0.2095 -0.0447  0.3369  0.7776\nscale(effort)-Puma concolor             0.3225 0.1494  0.0516  0.3151  0.6437\nscale(effort)-Puma yagouaroundi         0.3165 0.2103 -0.0751  0.3099  0.7395\nscale(effort)-Tamandua tetradactyla     0.2363 0.2095 -0.1716  0.2307  0.6636\nscale(effort)-Tapirus terrestris        0.3225 0.0850  0.1626  0.3192  0.4916\nscale(effort)-Tayassu pecari            0.4712 0.1487  0.2109  0.4592  0.7943\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        1.8226   74\n(Intercept)-Coendou prehensilis        1.0931  224\n(Intercept)-Cuniculus paca             1.0045 3000\n(Intercept)-Dasyprocta fuliginosa      1.0003 3000\n(Intercept)-Dasypus sp.                1.0028 2500\n(Intercept)-Didelphis marsupialis      1.0142  722\n(Intercept)-Eira barbara               1.0181  306\n(Intercept)-Herpailurus yagouaroundi   1.1009  215\n(Intercept)-Leopardus pardalis         1.0052 1060\n(Intercept)-Leopardus tigrinus         1.0028 1484\n(Intercept)-Leopardus wiedii           1.1704  189\n(Intercept)-Mazama americana           1.0011 3000\n(Intercept)-Mazama nemorivaga          1.0129 2220\n(Intercept)-Myoprocta pratti           1.0081 2495\n(Intercept)-Myrmecophaga tridactyla    1.0977  204\n(Intercept)-Nasua nasua                1.0087  280\n(Intercept)-Panthera onca              1.0005  572\n(Intercept)-Pecari tajacu              1.0048 2231\n(Intercept)-Priodontes maximus         1.0555  208\n(Intercept)-Procyon cancrivorous       1.1471  156\n(Intercept)-Puma concolor              1.0078 1963\n(Intercept)-Puma yagouaroundi          1.0211  132\n(Intercept)-Tamandua tetradactyla      1.1307  144\n(Intercept)-Tapirus terrestris         1.0092 2537\n(Intercept)-Tayassu pecari             1.0069 1689\nscale(effort)-Atelocynus microtis      1.0028 2655\nscale(effort)-Coendou prehensilis      1.0045 3082\nscale(effort)-Cuniculus paca           1.0002 3000\nscale(effort)-Dasyprocta fuliginosa    1.0031 3000\nscale(effort)-Dasypus sp.              1.0023 3000\nscale(effort)-Didelphis marsupialis    1.0001 2579\nscale(effort)-Eira barbara             1.0013 2434\nscale(effort)-Herpailurus yagouaroundi 1.0040 3000\nscale(effort)-Leopardus pardalis       0.9999 3000\nscale(effort)-Leopardus tigrinus       1.0012 2640\nscale(effort)-Leopardus wiedii         0.9999 3000\nscale(effort)-Mazama americana         1.0024 2746\nscale(effort)-Mazama nemorivaga        1.0045 3000\nscale(effort)-Myoprocta pratti         1.0023 3000\nscale(effort)-Myrmecophaga tridactyla  1.0032 2503\nscale(effort)-Nasua nasua              1.0032 2115\nscale(effort)-Panthera onca            1.0027 3000\nscale(effort)-Pecari tajacu            1.0055 3000\nscale(effort)-Priodontes maximus       1.0004 2834\nscale(effort)-Procyon cancrivorous     1.0037 2708\nscale(effort)-Puma concolor            1.0021 3000\nscale(effort)-Puma yagouaroundi        1.0000 2429\nscale(effort)-Tamandua tetradactyla    1.0005 2813\nscale(effort)-Tapirus terrestris       1.0012 3000\nscale(effort)-Tayassu pecari           1.0066 3000\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  9.0645 9.1966 0.0000  6.4957 26.5533 4.0543    8\nphi-2 13.5413 8.0203 0.4755 13.3527 26.9094 1.0006 2405\nphi-3  8.8927 9.1088 0.0000  6.0873 26.4164 3.9828    8\nphi-4 13.9092 7.8909 0.7025 14.2706 26.7527 1.0013 3000\nphi-5 13.8039 8.0059 0.5725 13.7579 26.7511 0.9996 3000\n\nCodesummary(out.sp, level = 'both')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 21.3693\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -2.3556 0.5613 -3.4416 -2.3635 -1.2299 1.0149 233\nscale(elev)        -0.8954 0.2544 -1.4309 -0.8934 -0.4145 1.1604 404\nscale(border_dist)  0.4657 0.4721 -0.4847  0.4775  1.4029 1.2294 386\nscale(FLII)         0.3092 0.2098 -0.0707  0.2956  0.7598 1.0207 766\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat ESS\n(Intercept)        6.5368 2.9210 2.8801 5.9125 14.0293 1.3010 272\nscale(elev)        0.1677 0.1672 0.0303 0.1186  0.6067 1.0306 851\nscale(border_dist) 3.6680 1.6633 1.5649 3.3125  7.9357 1.0846 352\nscale(FLII)        0.4199 0.3270 0.0702 0.3331  1.2903 1.1985 545\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.3896 0.3009 -3.0039 -2.3844 -1.8322 1.0079  581\nscale(effort)  0.2986 0.0667  0.1701  0.2962  0.4329 1.0010 2273\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.8505 0.7622 0.8063 1.7059 3.7325 1.0109  209\nscale(effort) 0.0477 0.0273 0.0168 0.0411 0.1131 1.0058 2052\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD     2.5%     50%\n(Intercept)-Atelocynus microtis             -1.2447 1.9690  -3.6104 -1.8567\n(Intercept)-Coendou prehensilis             -5.0068 1.7412  -8.0888 -5.1041\n(Intercept)-Cuniculus paca                   0.5448 0.3734  -0.1526  0.5436\n(Intercept)-Dasyprocta fuliginosa           -1.2008 0.7588  -2.7752 -1.0905\n(Intercept)-Dasypus sp.                     -3.9965 0.8895  -5.9661 -3.8856\n(Intercept)-Didelphis marsupialis           -5.1758 1.2220  -7.7534 -5.0950\n(Intercept)-Eira barbara                    -1.6825 1.0306  -3.4725 -1.7829\n(Intercept)-Herpailurus yagouaroundi        -3.8420 1.6500  -7.0590 -3.8985\n(Intercept)-Leopardus pardalis              -1.5795 0.5746  -2.7305 -1.5722\n(Intercept)-Leopardus tigrinus              -6.9887 1.3575 -10.1608 -6.8285\n(Intercept)-Leopardus wiedii                -3.0034 1.4393  -5.5070 -3.1733\n(Intercept)-Mazama americana                -4.9703 1.0184  -7.2119 -4.8898\n(Intercept)-Mazama nemorivaga               -4.6760 1.0225  -6.9421 -4.6104\n(Intercept)-Myoprocta pratti                -4.3491 0.8055  -6.0377 -4.2865\n(Intercept)-Myrmecophaga tridactyla         -1.0323 1.2651  -2.9713 -1.2485\n(Intercept)-Nasua nasua                     -0.9354 1.2480  -3.1910 -1.0310\n(Intercept)-Panthera onca                   -1.5584 0.7754  -3.0622 -1.5787\n(Intercept)-Pecari tajacu                    1.6194 0.6008   0.5180  1.5907\n(Intercept)-Priodontes maximus              -0.7851 1.3960  -3.1681 -0.8584\n(Intercept)-Procyon cancrivorous            -3.9337 1.7305  -7.1243 -4.0398\n(Intercept)-Puma concolor                   -2.5281 0.5607  -3.7888 -2.4657\n(Intercept)-Puma yagouaroundi               -3.7984 2.0217  -7.1723 -3.9629\n(Intercept)-Tamandua tetradactyla           -3.6120 1.5013  -6.1012 -3.7581\n(Intercept)-Tapirus terrestris               0.5614 0.3365  -0.0567  0.5443\n(Intercept)-Tayassu pecari                  -1.0524 0.4846  -2.1429 -1.0285\nscale(elev)-Atelocynus microtis             -0.7646 0.4459  -1.5920 -0.7836\nscale(elev)-Coendou prehensilis             -0.8954 0.4713  -1.8454 -0.8863\nscale(elev)-Cuniculus paca                  -0.8038 0.3295  -1.4672 -0.7940\nscale(elev)-Dasyprocta fuliginosa           -0.7867 0.3918  -1.5301 -0.7969\nscale(elev)-Dasypus sp.                     -1.0194 0.5044  -2.0823 -0.9872\nscale(elev)-Didelphis marsupialis           -0.9383 0.4628  -1.9580 -0.9166\nscale(elev)-Eira barbara                    -0.9119 0.4360  -1.8253 -0.8928\nscale(elev)-Herpailurus yagouaroundi        -0.7530 0.4698  -1.6518 -0.7596\nscale(elev)-Leopardus pardalis              -0.8248 0.3804  -1.5656 -0.8262\nscale(elev)-Leopardus tigrinus              -0.8203 0.4465  -1.6856 -0.8341\nscale(elev)-Leopardus wiedii                -0.9309 0.4638  -1.9239 -0.9089\nscale(elev)-Mazama americana                -0.9710 0.4805  -1.9858 -0.9545\nscale(elev)-Mazama nemorivaga               -0.9067 0.4633  -1.8802 -0.8984\nscale(elev)-Myoprocta pratti                -0.9699 0.4280  -1.8692 -0.9420\nscale(elev)-Myrmecophaga tridactyla         -1.0009 0.4472  -1.9735 -0.9678\nscale(elev)-Nasua nasua                     -1.0097 0.4827  -2.0695 -0.9752\nscale(elev)-Panthera onca                   -1.0409 0.4428  -2.0277 -1.0129\nscale(elev)-Pecari tajacu                   -0.7235 0.3683  -1.4378 -0.7349\nscale(elev)-Priodontes maximus              -0.8019 0.4529  -1.6590 -0.8125\nscale(elev)-Procyon cancrivorous            -0.9673 0.4787  -2.0303 -0.9378\nscale(elev)-Puma concolor                   -0.8517 0.3817  -1.6276 -0.8412\nscale(elev)-Puma yagouaroundi               -0.9294 0.4672  -1.9621 -0.9023\nscale(elev)-Tamandua tetradactyla           -0.9215 0.4418  -1.8198 -0.9015\nscale(elev)-Tapirus terrestris              -0.8273 0.3384  -1.5116 -0.8260\nscale(elev)-Tayassu pecari                  -1.0361 0.3720  -1.8501 -1.0125\nscale(border_dist)-Atelocynus microtis       1.0949 0.8500  -0.4508  1.0346\nscale(border_dist)-Coendou prehensilis       0.0353 1.1490  -2.2754  0.0683\nscale(border_dist)-Cuniculus paca            0.4280 0.4712  -0.4926  0.4116\nscale(border_dist)-Dasyprocta fuliginosa     1.9160 0.8016   0.3551  1.8524\nscale(border_dist)-Dasypus sp.              -3.0272 0.9525  -5.1879 -2.9299\nscale(border_dist)-Didelphis marsupialis    -0.8423 0.9963  -3.0447 -0.7362\nscale(border_dist)-Eira barbara             -0.6474 0.7555  -2.2141 -0.5947\nscale(border_dist)-Herpailurus yagouaroundi  2.8185 1.1679   0.8719  2.6814\nscale(border_dist)-Leopardus pardalis        1.0967 0.4968   0.1588  1.0795\nscale(border_dist)-Leopardus tigrinus        1.4605 0.9921  -0.3536  1.4025\nscale(border_dist)-Leopardus wiedii          0.7974 0.8404  -0.8475  0.7871\nscale(border_dist)-Mazama americana         -2.3200 1.0032  -4.5913 -2.2440\nscale(border_dist)-Mazama nemorivaga        -2.3046 1.0497  -4.5824 -2.2697\nscale(border_dist)-Myoprocta pratti          1.6717 0.5783   0.6103  1.6454\nscale(border_dist)-Myrmecophaga tridactyla   1.3486 0.7457  -0.0079  1.3005\nscale(border_dist)-Nasua nasua              -1.6585 1.0493  -4.0615 -1.5432\nscale(border_dist)-Panthera onca             1.8110 0.6090   0.7341  1.7866\nscale(border_dist)-Pecari tajacu             1.6093 0.6494   0.4013  1.5870\nscale(border_dist)-Priodontes maximus        2.5699 0.9858   0.9694  2.4720\nscale(border_dist)-Procyon cancrivorous     -1.1479 1.1955  -3.7943 -1.0396\nscale(border_dist)-Puma concolor             2.0791 0.5225   1.1135  2.0634\nscale(border_dist)-Puma yagouaroundi        -0.7815 1.2931  -3.6693 -0.6486\nscale(border_dist)-Tamandua tetradactyla     0.9455 0.8383  -0.6490  0.9022\nscale(border_dist)-Tapirus terrestris        1.2127 0.4681   0.3571  1.1784\nscale(border_dist)-Tayassu pecari            2.0875 0.5542   1.0371  2.0630\nscale(FLII)-Atelocynus microtis             -0.3755 0.4469  -1.4699 -0.3172\nscale(FLII)-Coendou prehensilis              0.3499 0.6020  -0.7564  0.3136\nscale(FLII)-Cuniculus paca                  -0.3922 0.3021  -1.0521 -0.3664\nscale(FLII)-Dasyprocta fuliginosa           -0.1609 0.2952  -0.7866 -0.1449\nscale(FLII)-Dasypus sp.                      0.1085 0.4219  -0.6990  0.1015\nscale(FLII)-Didelphis marsupialis            0.1903 0.5428  -0.8345  0.1773\nscale(FLII)-Eira barbara                     0.0691 0.5233  -1.0713  0.0903\nscale(FLII)-Herpailurus yagouaroundi         0.1570 0.5702  -1.0278  0.1644\nscale(FLII)-Leopardus pardalis               0.3452 0.4059  -0.4456  0.3384\nscale(FLII)-Leopardus tigrinus               0.4432 0.5772  -0.5061  0.3771\nscale(FLII)-Leopardus wiedii                -0.0312 0.5889  -1.3743  0.0082\nscale(FLII)-Mazama americana                 0.7583 0.6015  -0.1788  0.6779\nscale(FLII)-Mazama nemorivaga                0.5437 0.5638  -0.3996  0.4875\nscale(FLII)-Myoprocta pratti                 0.3890 0.4190  -0.3377  0.3453\nscale(FLII)-Myrmecophaga tridactyla          0.3197 0.5583  -0.8150  0.3224\nscale(FLII)-Nasua nasua                      0.5609 0.6194  -0.4858  0.4938\nscale(FLII)-Panthera onca                    0.9361 0.5636   0.0082  0.8735\nscale(FLII)-Pecari tajacu                    0.1451 0.2648  -0.4266  0.1638\nscale(FLII)-Priodontes maximus               0.4273 0.6113  -0.7536  0.4038\nscale(FLII)-Procyon cancrivorous             0.4719 0.6654  -0.6401  0.4086\nscale(FLII)-Puma concolor                    1.1852 0.5724   0.2546  1.1377\nscale(FLII)-Puma yagouaroundi                0.3959 0.6511  -0.8494  0.3585\nscale(FLII)-Tamandua tetradactyla            0.3998 0.6126  -0.6971  0.3488\nscale(FLII)-Tapirus terrestris              -0.0110 0.2570  -0.5701  0.0023\nscale(FLII)-Tayassu pecari                   0.5121 0.3700  -0.2092  0.4934\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis              3.5004 1.8341   44\n(Intercept)-Coendou prehensilis             -0.8733 1.1266  145\n(Intercept)-Cuniculus paca                   1.3167 1.4191   68\n(Intercept)-Dasyprocta fuliginosa            0.1003 2.1969   27\n(Intercept)-Dasypus sp.                     -2.5478 1.0610  523\n(Intercept)-Didelphis marsupialis           -2.9272 1.1312  308\n(Intercept)-Eira barbara                     0.5880 1.0075  237\n(Intercept)-Herpailurus yagouaroundi        -0.5364 1.2466  153\n(Intercept)-Leopardus pardalis              -0.4407 1.0407  529\n(Intercept)-Leopardus tigrinus              -4.7237 1.1190  340\n(Intercept)-Leopardus wiedii                 0.1249 1.1833  158\n(Intercept)-Mazama americana                -3.2022 1.0596  328\n(Intercept)-Mazama nemorivaga               -2.9332 1.0788  329\n(Intercept)-Myoprocta pratti                -2.9434 1.0696  480\n(Intercept)-Myrmecophaga tridactyla          2.3272 1.1813   99\n(Intercept)-Nasua nasua                      1.6953 1.0050  215\n(Intercept)-Panthera onca                    0.0425 1.0155  323\n(Intercept)-Pecari tajacu                    2.8976 1.5219  101\n(Intercept)-Priodontes maximus               2.1955 1.0474  134\n(Intercept)-Procyon cancrivorous            -0.3323 1.2843  134\n(Intercept)-Puma concolor                   -1.6024 1.0990  453\n(Intercept)-Puma yagouaroundi                0.5988 1.0628   94\n(Intercept)-Tamandua tetradactyla           -0.3285 1.1147  116\n(Intercept)-Tapirus terrestris               1.2339 1.1284  245\n(Intercept)-Tayassu pecari                  -0.1795 1.3897   64\nscale(elev)-Atelocynus microtis              0.1952 1.0575  823\nscale(elev)-Coendou prehensilis              0.0025 1.0477  895\nscale(elev)-Cuniculus paca                  -0.1570 1.0867  914\nscale(elev)-Dasyprocta fuliginosa            0.0110 1.1871  282\nscale(elev)-Dasypus sp.                     -0.1427 1.0784  832\nscale(elev)-Didelphis marsupialis           -0.0955 1.0683 1164\nscale(elev)-Eira barbara                    -0.0957 1.0604 1268\nscale(elev)-Herpailurus yagouaroundi         0.2465 1.0290  968\nscale(elev)-Leopardus pardalis              -0.0807 1.0258 1169\nscale(elev)-Leopardus tigrinus               0.0924 1.0415 1483\nscale(elev)-Leopardus wiedii                -0.0505 1.0598 1181\nscale(elev)-Mazama americana                -0.0826 1.0371  969\nscale(elev)-Mazama nemorivaga               -0.0397 1.0400 1105\nscale(elev)-Myoprocta pratti                -0.1781 1.0550 1128\nscale(elev)-Myrmecophaga tridactyla         -0.1821 1.0436 1060\nscale(elev)-Nasua nasua                     -0.1411 1.0536  945\nscale(elev)-Panthera onca                   -0.2436 1.0721  889\nscale(elev)-Pecari tajacu                    0.0275 1.0364  684\nscale(elev)-Priodontes maximus               0.1419 1.0455 1136\nscale(elev)-Procyon cancrivorous            -0.0863 1.0681 1118\nscale(elev)-Puma concolor                   -0.1174 1.0396 1295\nscale(elev)-Puma yagouaroundi               -0.0361 1.0325 1121\nscale(elev)-Tamandua tetradactyla           -0.0928 1.0686 1189\nscale(elev)-Tapirus terrestris              -0.1646 1.0556  976\nscale(elev)-Tayassu pecari                  -0.3505 1.1472  900\nscale(border_dist)-Atelocynus microtis       3.0415 1.3479  294\nscale(border_dist)-Coendou prehensilis       2.2218 1.0690  484\nscale(border_dist)-Cuniculus paca            1.4073 1.8764  124\nscale(border_dist)-Dasyprocta fuliginosa     3.5766 2.6792   44\nscale(border_dist)-Dasypus sp.              -1.3948 1.1776  531\nscale(border_dist)-Didelphis marsupialis     0.9095 1.0147  492\nscale(border_dist)-Eira barbara              0.6831 1.0518  574\nscale(border_dist)-Herpailurus yagouaroundi  5.5202 1.0572  222\nscale(border_dist)-Leopardus pardalis        2.1501 1.1070  591\nscale(border_dist)-Leopardus tigrinus        3.5944 1.0092  836\nscale(border_dist)-Leopardus wiedii          2.5316 1.0227  598\nscale(border_dist)-Mazama americana         -0.5887 1.3539  260\nscale(border_dist)-Mazama nemorivaga        -0.4627 1.5747  104\nscale(border_dist)-Myoprocta pratti          2.8864 1.2409  238\nscale(border_dist)-Myrmecophaga tridactyla   2.9475 1.1158  449\nscale(border_dist)-Nasua nasua               0.1156 1.0179  320\nscale(border_dist)-Panthera onca             3.1381 1.2110  448\nscale(border_dist)-Pecari tajacu             2.9703 1.3755  229\nscale(border_dist)-Priodontes maximus        4.8078 1.0633  269\nscale(border_dist)-Procyon cancrivorous      0.9032 1.0268  268\nscale(border_dist)-Puma concolor             3.1644 1.0919  565\nscale(border_dist)-Puma yagouaroundi         1.3510 1.1468  193\nscale(border_dist)-Tamandua tetradactyla     2.6906 1.0172  708\nscale(border_dist)-Tapirus terrestris        2.1903 1.2434  180\nscale(border_dist)-Tayassu pecari            3.2784 1.4874  171\nscale(FLII)-Atelocynus microtis              0.3593 1.0859  468\nscale(FLII)-Coendou prehensilis              1.6382 1.0020 1255\nscale(FLII)-Cuniculus paca                   0.1303 1.1170  953\nscale(FLII)-Dasyprocta fuliginosa            0.3718 1.2121  471\nscale(FLII)-Dasypus sp.                      0.9563 1.0039 2203\nscale(FLII)-Didelphis marsupialis            1.3182 1.0138 1541\nscale(FLII)-Eira barbara                     1.0575 1.0300  869\nscale(FLII)-Herpailurus yagouaroundi         1.2852 1.0072 1058\nscale(FLII)-Leopardus pardalis               1.1923 1.0124 1803\nscale(FLII)-Leopardus tigrinus               1.7832 1.0477 1284\nscale(FLII)-Leopardus wiedii                 1.0009 1.0117  871\nscale(FLII)-Mazama americana                 2.1273 1.1109  963\nscale(FLII)-Mazama nemorivaga                1.8721 1.1146  541\nscale(FLII)-Myoprocta pratti                 1.3211 1.0190 1822\nscale(FLII)-Myrmecophaga tridactyla          1.4492 1.0134 1110\nscale(FLII)-Nasua nasua                      1.9596 1.0353 1044\nscale(FLII)-Panthera onca                    2.1902 1.0895  796\nscale(FLII)-Pecari tajacu                    0.6391 1.0374 1772\nscale(FLII)-Priodontes maximus               1.7177 1.0180  881\nscale(FLII)-Procyon cancrivorous             1.9351 1.0330  823\nscale(FLII)-Puma concolor                    2.4393 1.1388  741\nscale(FLII)-Puma yagouaroundi                1.8217 1.0230  948\nscale(FLII)-Tamandua tetradactyla            1.8303 1.0135 1067\nscale(FLII)-Tapirus terrestris               0.4582 1.0190 2662\nscale(FLII)-Tayassu pecari                   1.2947 1.0359 1512\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -3.7352 0.9038 -5.4040 -3.6492 -2.1733\n(Intercept)-Coendou prehensilis        -3.7112 1.1543 -6.0954 -3.6225 -1.7110\n(Intercept)-Cuniculus paca             -0.7926 0.0686 -0.9300 -0.7911 -0.6592\n(Intercept)-Dasyprocta fuliginosa      -0.3631 0.0763 -0.5144 -0.3613 -0.2132\n(Intercept)-Dasypus sp.                -1.5000 0.1244 -1.7609 -1.4964 -1.2699\n(Intercept)-Didelphis marsupialis      -2.5927 0.6594 -3.9605 -2.5304 -1.4449\n(Intercept)-Eira barbara               -3.1408 0.3583 -3.8288 -3.1428 -2.4639\n(Intercept)-Herpailurus yagouaroundi   -3.7051 0.7875 -5.1603 -3.7156 -2.1538\n(Intercept)-Leopardus pardalis         -2.1780 0.2252 -2.6496 -2.1658 -1.7617\n(Intercept)-Leopardus tigrinus         -1.1704 0.9677 -3.1932 -1.1177  0.5850\n(Intercept)-Leopardus wiedii           -3.5111 0.7786 -5.0170 -3.4660 -2.0605\n(Intercept)-Mazama americana           -1.0744 0.1229 -1.3198 -1.0733 -0.8351\n(Intercept)-Mazama nemorivaga          -1.9967 0.1807 -2.3641 -1.9952 -1.6506\n(Intercept)-Myoprocta pratti           -1.5397 0.2771 -2.1139 -1.5282 -1.0241\n(Intercept)-Myrmecophaga tridactyla    -3.2007 0.4428 -4.1026 -3.1931 -2.3424\n(Intercept)-Nasua nasua                -3.6931 0.3650 -4.3246 -3.7280 -2.9104\n(Intercept)-Panthera onca              -2.5699 0.2872 -3.1723 -2.5596 -2.0495\n(Intercept)-Pecari tajacu              -1.2477 0.0752 -1.3952 -1.2473 -1.1013\n(Intercept)-Priodontes maximus         -3.6738 0.4685 -4.5051 -3.7176 -2.6893\n(Intercept)-Procyon cancrivorous       -3.7753 0.8684 -5.4045 -3.7535 -2.1045\n(Intercept)-Puma concolor              -1.6820 0.2147 -2.1215 -1.6758 -1.2782\n(Intercept)-Puma yagouaroundi          -4.2818 1.0479 -6.1807 -4.3275 -2.2824\n(Intercept)-Tamandua tetradactyla      -3.4121 0.8470 -5.0935 -3.3789 -1.8535\n(Intercept)-Tapirus terrestris         -1.1226 0.0820 -1.2858 -1.1215 -0.9587\n(Intercept)-Tayassu pecari             -1.8402 0.1653 -2.1892 -1.8337 -1.5241\nscale(effort)-Atelocynus microtis       0.3435 0.2000 -0.0323  0.3378  0.7598\nscale(effort)-Coendou prehensilis       0.2983 0.2203 -0.1491  0.2964  0.7416\nscale(effort)-Cuniculus paca            0.2468 0.0695  0.1173  0.2450  0.3865\nscale(effort)-Dasyprocta fuliginosa     0.3245 0.0851  0.1593  0.3236  0.4970\nscale(effort)-Dasypus sp.               0.3758 0.1297  0.1414  0.3698  0.6515\nscale(effort)-Didelphis marsupialis     0.3413 0.2125 -0.0429  0.3355  0.8037\nscale(effort)-Eira barbara              0.4406 0.1970  0.0975  0.4255  0.8752\nscale(effort)-Herpailurus yagouaroundi  0.1748 0.2114 -0.2663  0.1864  0.5750\nscale(effort)-Leopardus pardalis        0.1686 0.1283 -0.0784  0.1679  0.4278\nscale(effort)-Leopardus tigrinus        0.3372 0.2292 -0.1148  0.3329  0.8090\nscale(effort)-Leopardus wiedii          0.3316 0.2179 -0.0759  0.3271  0.7888\nscale(effort)-Mazama americana          0.3913 0.1466  0.1294  0.3821  0.7035\nscale(effort)-Mazama nemorivaga         0.2189 0.1368 -0.0381  0.2146  0.4950\nscale(effort)-Myoprocta pratti          0.2307 0.1722 -0.1053  0.2284  0.5700\nscale(effort)-Myrmecophaga tridactyla   0.3734 0.1838  0.0537  0.3601  0.7497\nscale(effort)-Nasua nasua               0.3384 0.1812  0.0100  0.3262  0.7365\nscale(effort)-Panthera onca             0.1647 0.1398 -0.1075  0.1618  0.4469\nscale(effort)-Pecari tajacu             0.2636 0.0753  0.1229  0.2613  0.4202\nscale(effort)-Priodontes maximus        0.1149 0.1715 -0.2165  0.1123  0.4399\nscale(effort)-Procyon cancrivorous      0.3442 0.2095 -0.0447  0.3369  0.7776\nscale(effort)-Puma concolor             0.3225 0.1494  0.0516  0.3151  0.6437\nscale(effort)-Puma yagouaroundi         0.3165 0.2103 -0.0751  0.3099  0.7395\nscale(effort)-Tamandua tetradactyla     0.2363 0.2095 -0.1716  0.2307  0.6636\nscale(effort)-Tapirus terrestris        0.3225 0.0850  0.1626  0.3192  0.4916\nscale(effort)-Tayassu pecari            0.4712 0.1487  0.2109  0.4592  0.7943\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        1.8226   74\n(Intercept)-Coendou prehensilis        1.0931  224\n(Intercept)-Cuniculus paca             1.0045 3000\n(Intercept)-Dasyprocta fuliginosa      1.0003 3000\n(Intercept)-Dasypus sp.                1.0028 2500\n(Intercept)-Didelphis marsupialis      1.0142  722\n(Intercept)-Eira barbara               1.0181  306\n(Intercept)-Herpailurus yagouaroundi   1.1009  215\n(Intercept)-Leopardus pardalis         1.0052 1060\n(Intercept)-Leopardus tigrinus         1.0028 1484\n(Intercept)-Leopardus wiedii           1.1704  189\n(Intercept)-Mazama americana           1.0011 3000\n(Intercept)-Mazama nemorivaga          1.0129 2220\n(Intercept)-Myoprocta pratti           1.0081 2495\n(Intercept)-Myrmecophaga tridactyla    1.0977  204\n(Intercept)-Nasua nasua                1.0087  280\n(Intercept)-Panthera onca              1.0005  572\n(Intercept)-Pecari tajacu              1.0048 2231\n(Intercept)-Priodontes maximus         1.0555  208\n(Intercept)-Procyon cancrivorous       1.1471  156\n(Intercept)-Puma concolor              1.0078 1963\n(Intercept)-Puma yagouaroundi          1.0211  132\n(Intercept)-Tamandua tetradactyla      1.1307  144\n(Intercept)-Tapirus terrestris         1.0092 2537\n(Intercept)-Tayassu pecari             1.0069 1689\nscale(effort)-Atelocynus microtis      1.0028 2655\nscale(effort)-Coendou prehensilis      1.0045 3082\nscale(effort)-Cuniculus paca           1.0002 3000\nscale(effort)-Dasyprocta fuliginosa    1.0031 3000\nscale(effort)-Dasypus sp.              1.0023 3000\nscale(effort)-Didelphis marsupialis    1.0001 2579\nscale(effort)-Eira barbara             1.0013 2434\nscale(effort)-Herpailurus yagouaroundi 1.0040 3000\nscale(effort)-Leopardus pardalis       0.9999 3000\nscale(effort)-Leopardus tigrinus       1.0012 2640\nscale(effort)-Leopardus wiedii         0.9999 3000\nscale(effort)-Mazama americana         1.0024 2746\nscale(effort)-Mazama nemorivaga        1.0045 3000\nscale(effort)-Myoprocta pratti         1.0023 3000\nscale(effort)-Myrmecophaga tridactyla  1.0032 2503\nscale(effort)-Nasua nasua              1.0032 2115\nscale(effort)-Panthera onca            1.0027 3000\nscale(effort)-Pecari tajacu            1.0055 3000\nscale(effort)-Priodontes maximus       1.0004 2834\nscale(effort)-Procyon cancrivorous     1.0037 2708\nscale(effort)-Puma concolor            1.0021 3000\nscale(effort)-Puma yagouaroundi        1.0000 2429\nscale(effort)-Tamandua tetradactyla    1.0005 2813\nscale(effort)-Tapirus terrestris       1.0012 3000\nscale(effort)-Tayassu pecari           1.0066 3000\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  9.0645 9.1966 0.0000  6.4957 26.5533 4.0543    8\nphi-2 13.5413 8.0203 0.4755 13.3527 26.9094 1.0006 2405\nphi-3  8.8927 9.1088 0.0000  6.0873 26.4164 3.9828    8\nphi-4 13.9092 7.8909 0.7025 14.2706 26.7527 1.0013 3000\nphi-5 13.8039 8.0059 0.5725 13.7579 26.7511 0.9996 3000\n\n\nBayesian p-values can be inspected to check for lack of fit (overall or by species). Lack of fit at significance level = 0.05 is indicated by Bayesian p-values below 0.025 or greater than 0.975. The overall Bayesian p-value (Bpvalue) indicates no problems with lack of fit. Likewise, species-level Bayesian p-values (Bpvalue_species) indicate no lack of fit for any species.\n\nGelman and Rubin’s convergence diagnostic: Approximate convergence is diagnosed when the upper limit is close to 1.\n\nConvergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable. The gelman.diag diagnostic is applied to a single variable from the chain. It is based a comparison of within-chain and between-chain variances, and is similar to a classical analysis of variance.\nValues substantially above 1 indicate lack of convergence.\nModel Diagnostics\n\nCode#| eval: true\n#| echo: true\n#| code-fold: true\n#| warning: false\n#| message: false\n# Extract posterior draws for later use\nposterior1 &lt;- as.array(out.sp)\n\n# Trace plots to check chain mixing. Extract posterior samples and bind in a single matrix.\nPOSTERIOR.MATRIX &lt;- cbind(out.sp$alpha.comm.samples, \n                          out.sp$beta.comm.samples,  \n                          out.sp$alpha.samples, \n                          out.sp$beta.samples)\n\n# Matrix output is all chains combined, split into 3 chains.\nCHAIN.1 &lt;- as.mcmc(POSTERIOR.MATRIX[1:1000,])\nCHAIN.2 &lt;- as.mcmc(POSTERIOR.MATRIX[1001:2000,])\nCHAIN.3 &lt;- as.mcmc(POSTERIOR.MATRIX[2001:3000,])\n# CHAIN.4 &lt;- as.mcmc(POSTERIOR.MATRIX[8001:10000,])\n\n# Bind four chains as coda mcmc.list object.\nPOSTERIOR.CHAINS &lt;- mcmc.list(CHAIN.1, CHAIN.2, CHAIN.3)#, CHAIN.4)\n\n# Create an empty folder.\n# dir.create (\"Beetle_plots\")\n\n# Plot chain mixing of each parameter to a multi-panel plot and save to the new folder. ART 5 mins\n\n######################################\n#### SAVE Diagnostics at PDF\n# MCMCtrace(POSTERIOR.CHAINS, params = \"all\", Rhat = TRUE, n.eff = TRUE)#, pdf = TRUE, filename = \"Beetle_240909_traceplots.pdf\", wd = \"Beetle_plots\")\n\n\n\n#mcmc_trace(fit.commu, parms = c(\"beta.ranef.cont.border_dist.mean\"))\n\n#posterior2 &lt;- extract(fit.commu, inc_warmup = TRUE, permuted = FALSE)\n\n#color_scheme_set(\"mix-blue-pink\")\n#p &lt;- mcmc_trace(posterior1,  pars = c(\"mu\", \"tau\"), n_warmup = 300,\n#                facet_args = list(nrow = 2, labeller = label_parsed))\n#p + facet_text(size = 15)\n\n\n\n#outMCMC &lt;- fit.commu #Convert output to MCMC object\n#diagnostics chains \n\n# all as pdf\n# MCMCtrace(outMCMC)\n\n# MCMCtrace(outMCMC, params = c(\"alpha0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(out.sp, params = c(\"beta.ranef.cont.border_dist.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n\n### density\n# MCMCtrace(outMCMC, params = c(\"Nspecies\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n#MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n#coda::gelman.diag(outMCMC,  multivariate = FALSE, transform=FALSE)\n                    \n# coda::gelman.plot(outMCMC,  multivariate = FALSE)\n\n\n\n# \n# mcmc_intervals(outMCMC, pars = c(\"Nspecies_in_AP[1]\",\n#                                  \"Nspecies_in_AP[2]\"),\n#                point_est = \"mean\",\n#                prob = 0.75, prob_outer = 0.95) +\n#   ggtitle(\"Number of species\") + \n#   scale_y_discrete(labels = c(\"Nspecies_in_AP[1]\"=levels(sitecovs$in_AP)[1],\n#              \"Nspecies_in_AP[2]\"=levels(sitecovs$in_AP)[2]))\n# \n# #Continuous\n# p &lt;- mcmc_intervals(outMCMC, \n#                pars = c(\"beta.ranef.cont.border_dist.mean\",\n#                          #\"beta.ranef.cont.elev.mean\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"))\n# \n# # relabel parameters\n# p + scale_y_discrete(\n#   labels = c(\"beta.ranef.cont.border_dist.mean\"=\"Dist_border\",\n#                          #\"beta.ranef.cont.elev.mean\"=\"Elevation\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"=\"in_AP\")\n# ) +\n#   ggtitle(\"Treatment effect on all species\")\n# \n\n\nPosterior Summary (effect)\nCommunity effects\nCode# Create simple plot summaries using MCMCvis package.\n# Detection covariate effects --------- \nMCMCplot(out.sp$alpha.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n# Occupancy community-level effects \nMCMCplot(out.sp$beta.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) Detection\n\n\n\n\n\n\n\n\n\n(b) Occupancy\n\n\n\n\n\n\nFigure 1: Community effects\n\n\nSpecies effects\nCode# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,26:50], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,51:75], ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) elevation\n\n\n\n\n\n\n\n\n\n(b) distance border\n\n\n\n\n\n\nFigure 2: Species effects\n\n\nSpecies effects using bayesplot\n\n\nCodelibrary(bayesplot)\n#mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n# mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n\nmcmc_intervals(out.sp$beta.samples[,26:50] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,51:75] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,76:100] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\n\nPrediction as graph\nThis prediction uses the non spatial model\n\nCode# 6. Prediction -----------------------------------------------------------\n# Predict occupancy along a gradient of elev   \n# Create a set of values across the range of observed elev values\nelev.pred.vals &lt;- seq(min(data_list$occ.covs$elev), \n                              max(data_list$occ.covs$elev), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nelev.pred.vals.scale &lt;- (elev.pred.vals - mean(data_list$occ.covs$elev)) / \n                             sd(data_list$occ.covs$elev)\n# Create a set of values across the range of observed elev values\nborder_dist.pred.vals &lt;- seq(min(data_list$occ.covs$border_dist), \n                              max(data_list$occ.covs$border_dist), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nborder_dist.pred.vals.scale &lt;- (border_dist.pred.vals -\n                                  mean(data_list$occ.covs$border_dist)) /\n                                  sd(data_list$occ.covs$border_dist)\n\n# Predict occupancy across elev  values at mean values of all other variables\npred.df1 &lt;- as.matrix(data.frame(intercept = 1, \n                                 elev = elev.pred.vals.scale, \n                                 border_dist = 0,\n                                 FLII=0))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df2 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = border_dist.pred.vals.scale,\n                         FLII= 0 ))#, catchment = 0, density = 0, \n                         # slope = 0))\n\nout.pred1 &lt;- predict(out, pred.df1) # using non spatial\nstr(out.pred1)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.1513 0.0449 0.1096 0.1336 0.0787 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 0 0 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out, X.0 = pred.df1)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred1$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           elev = elev.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(elev.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = elev, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'elevation (m)', y = 'Occupancy Probability') \n\n\n\n\n\n\nCodeout.pred2 &lt;- predict(out, pred.df2) # using non spatial\nstr(out.pred2)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.0598 0.0359 0.0885 0.0973 0.0627 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 0 0 1 0 0 0 1 0 0 ...\n $ call         : language predict.msPGOcc(object = out, X.0 = pred.df2)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred2$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           border_dist = border_dist.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(border_dist.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = border_dist/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'border_dist (Km)', y = 'Occupancy Probability') \n\n\n\n\n\n\n\nSpatial Prediction in elevation_EC\n\nCode#aggregate  resolution to (factor = 3)\n#transform coord data to UTM\nelevation_UTM &lt;- project(elevation_EC, \"EPSG:10603\")\nelevation_17.aggregate &lt;- aggregate(elevation_UTM, fact=10)\nres(elevation_17.aggregate)\n\n[1] 5984.313 5984.313\n\nCode# Convert the SpatRaster to a data frame with coordinates\ndf_coords &lt;- as.data.frame(elevation_17.aggregate, xy = TRUE)\nnames(df_coords) &lt;-c(\"X\",\"Y\",\"elev\")\n\nelev.pred &lt;- (df_coords$elev - mean(data_list$occ.covs$elev)) / sd(data_list$occ.covs$elev)\n\n\n############### Predict new data ############### \n# we predict at one covariate varing and others at mean value = 0\n# intercept = 1, elev = 0, border_dist = 0, FLII= 0\n# in that order\n################ ################ ################ \npredict_data &lt;- cbind(1, elev.pred, 0, 0)\ncolnames(predict_data) &lt;- c(\"intercept\",\n                            \"elev\",\n                            \"border_dist\",\n                            \"FLII\" )\n\n# X.0 &lt;- cbind(1, 1, elev.pred)#, elev.pred^2)\n\n# coords.0 &lt;- as.matrix(hbefElev[, c('Easting', 'Northing')])\nout.sp.ms.pred &lt;- predict(out.sp, \n                          X.0=predict_data, \n                          df_coords[,1:2],\n                          threads=4) #Warning :'threads' is not an argument\n\nWarning in predict.sfMsPGOcc(out.sp, X.0 = predict_data, df_coords[, 1:2], :\n'threads' is not an argument\n\n\n----------------------------------------\n    Prediction description\n----------------------------------------\nSpatial Factor NNGP Multispecies Occupancy model with Polya-Gamma latent\nvariable fit with 275 observations.\n\nNumber of covariates 4 (including intercept if specified).\n\nUsing the exponential spatial correlation model.\n\nUsing 15 nearest neighbors.\nUsing 5 latent spatial factors.\n\nNumber of MCMC samples 3000.\n\nPredicting at 2618 non-sampled locations.\n\n\nSource compiled with OpenMP support and model fit using 1 threads.\n-------------------------------------------------\n        Predicting\n-------------------------------------------------\nLocation: 100 of 2618, 3.82%\nLocation: 200 of 2618, 7.64%\nLocation: 300 of 2618, 11.46%\nLocation: 400 of 2618, 15.28%\nLocation: 500 of 2618, 19.10%\nLocation: 600 of 2618, 22.92%\nLocation: 700 of 2618, 26.74%\nLocation: 800 of 2618, 30.56%\nLocation: 900 of 2618, 34.38%\nLocation: 1000 of 2618, 38.20%\nLocation: 1100 of 2618, 42.02%\nLocation: 1200 of 2618, 45.84%\nLocation: 1300 of 2618, 49.66%\nLocation: 1400 of 2618, 53.48%\nLocation: 1500 of 2618, 57.30%\nLocation: 1600 of 2618, 61.12%\nLocation: 1700 of 2618, 64.94%\nLocation: 1800 of 2618, 68.75%\nLocation: 1900 of 2618, 72.57%\nLocation: 2000 of 2618, 76.39%\nLocation: 2100 of 2618, 80.21%\nLocation: 2200 of 2618, 84.03%\nLocation: 2300 of 2618, 87.85%\nLocation: 2400 of 2618, 91.67%\nLocation: 2500 of 2618, 95.49%\nLocation: 2600 of 2618, 99.31%\nLocation: 2618 of 2618, 100.00%\nGenerating latent occupancy state\n\nCode# extract the array of interest= occupancy\npredicted_array &lt;- out.sp.ms.pred$psi.0.samples\n\n\n\ndim(predicted_array)\n\n[1] 3000   25 2618\n\nCode# df_plot &lt;- NA # empty column\npredicted_raster_list &lt;- list() # rast(nrows = 52, ncols = 103,\n                         #ext(elevation_17.aggregate), \n                         # crs = \"EPSG:32717\")\n\n###################################################\n# simpler way to make mean in the array by species\n# array order: itera=3000, sp=22, pixels=5202\n# we wan to keep index 2 and 3\nlibrary(plyr)\n\n------------------------------------------------------------------------------\n\n\nYou have loaded plyr after dplyr - this is likely to cause problems.\nIf you need functions from both plyr and dplyr, please load plyr first, then dplyr:\nlibrary(plyr); library(dplyr)\n\n\n------------------------------------------------------------------------------\n\n\n\nAdjuntando el paquete: 'plyr'\n\n\nThe following objects are masked from 'package:dplyr':\n\n    arrange, count, desc, failwith, id, mutate, rename, summarise,\n    summarize\n\n\nThe following object is masked from 'package:purrr':\n\n    compact\n\n\nThe following object is masked from 'package:maps':\n\n    ozone\n\nCodearesult = (plyr::aaply(predicted_array, # mean fo all iterations\n                       c(2,3), \n                       mean))\n\n##############################################\n#### Loop to make rasters and put in a list\n# array order: itera=3000, sp=22, pixels=5202\nfor (i in 1:dim(predicted_array)[2]){\n # Convert array slice to data frame\n # df_plot[i] &lt;- as.data.frame(predicted_array[1, i, ]) # sp_i\n # df_plot[i] &lt;- as.vector(aresult[i,]) # Extract sp\n # Producing an SDM for all (posterior mean)\n plot.dat &lt;- data.frame(x = df_coords$X, \n                        y = df_coords$Y, \n                        psi.sp = as.vector(aresult[i,]))\n pred_rast &lt;- rast(plot.dat, \n                   type = \"xyz\", \n                   crs = \"EPSG:10603\") # Replace EPSG:4326 with your CRS\n predicted_raster_list[[i]] &lt;- pred_rast\n}\n\n# Convert the list to a SpatRaster stack\npredictad_raster_stack &lt;- rast(predicted_raster_list)\n# put species names\nnames(predictad_raster_stack) &lt;- selected.sp\n\nplot(predictad_raster_stack)\n\n\n\n\n\n\nCode# get the mean\npredicted_mean &lt;- mean(predictad_raster_stack)\n\nplot(predicted_mean, main=\"mean occupancy\")\n\n\n\n\n\n\nCodemapview(predicted_mean) + mapview(AP_Yasuni_UTM_line)\n\n\n\n\nCode#"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#package-citation",
    "href": "blog/2025-10-15-analysis/index.html#package-citation",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: abind v. 1.4.8 (Plate and Heiberger 2024), bayesplot v. 1.14.0 (Gabry et al. 2019; Gabry and Mahr 2025), beepr v. 2.0 (Bååth 2024), camtrapR v. 3.0.0 (Niedballa et al. 2016), coda v. 0.19.4.1 (Plummer et al. 2006), DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), MCMCvis v. 0.16.3 (Youngflesh 2018), plyr v. 1.8.9 (Wickham 2011), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), snow v. 0.4.4 (Tierney et al. 2021), snowfall v. 1.84.6.3 (Knaus 2023), spOccupancy v. 0.8.0 (Doser et al. 2022, 2024; Doser, Finley, and Banerjee 2023), terra v. 1.8.70 (Hijmans 2025), tictoc v. 1.2.1 (Izrailev 2024), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018)."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#sesion-info",
    "href": "blog/2025-10-15-analysis/index.html#sesion-info",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: internal\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] plyr_1.8.9        abind_1.4-8       lubridate_1.9.4   forcats_1.0.0    \n [5] stringr_1.5.2     dplyr_1.1.4       purrr_1.1.0       readr_2.1.5      \n [9] tidyr_1.3.1       tibble_3.2.1      ggplot2_4.0.0     tidyverse_2.0.0  \n[13] spOccupancy_0.8.0 camtrapR_3.0.0    snowfall_1.84-6.3 snow_0.4-4       \n[17] beepr_2.0         coda_0.19-4.1     MCMCvis_0.16.3    tictoc_1.2.1     \n[21] bayesplot_1.14.0  elevatr_0.99.0    terra_1.8-70      tmap_4.2         \n[25] maps_3.4.3        mapview_2.11.4    sf_1.0-21         DT_0.34.0        \n[29] readxl_1.4.3      grateful_0.3.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3      tensorA_0.36.2.1        rstudioapi_0.17.1      \n  [4] audio_0.1-11            jsonlite_2.0.0          wk_0.9.4               \n  [7] magrittr_2.0.3          farver_2.1.2            nloptr_2.1.1           \n [10] rmarkdown_2.30          vctrs_0.6.5             minqa_1.2.8            \n [13] base64enc_0.1-3         RcppNumerical_0.6-0     progress_1.2.3         \n [16] htmltools_0.5.8.1       leafsync_0.1.0          distributional_0.5.0   \n [19] curl_7.0.0              raster_3.6-32           cellranger_1.1.0       \n [22] s2_1.1.9                sass_0.4.10             bslib_0.9.0            \n [25] slippymath_0.3.1        KernSmooth_2.23-24      htmlwidgets_1.6.4      \n [28] cachem_1.1.0            stars_0.6-8             uuid_1.2-1             \n [31] mime_0.13               lifecycle_1.0.4         iterators_1.0.14       \n [34] pkgconfig_2.0.3         cols4all_0.8-1          Matrix_1.7-1           \n [37] R6_2.6.1                fastmap_1.2.0           shiny_1.9.1            \n [40] digest_0.6.37           colorspace_2.1-1        leafem_0.2.4           \n [43] crosstalk_1.2.1         labeling_0.4.3          lwgeom_0.2-14          \n [46] progressr_0.15.0        spacesXYZ_1.6-0         timechange_0.3.0       \n [49] httr_1.4.7              mgcv_1.9-1              compiler_4.4.2         \n [52] microbenchmark_1.5.0    proxy_0.4-27            withr_3.0.2            \n [55] doParallel_1.0.17       backports_1.5.0         brew_1.0-10            \n [58] S7_0.2.0                DBI_1.2.3               logger_0.4.0           \n [61] MASS_7.3-61             maptiles_0.10.0         tmaptools_3.3          \n [64] leaflet_2.2.3           classInt_0.4-11         tools_4.4.2            \n [67] units_0.8-7             leaflegend_1.2.1        httpuv_1.6.16          \n [70] glue_1.8.0              satellite_1.0.5         nlme_3.1-166           \n [73] promises_1.3.3          grid_4.4.2              checkmate_2.3.2        \n [76] reshape2_1.4.4          generics_0.1.3          leaflet.providers_2.0.0\n [79] gtable_0.3.6            tzdb_0.4.0              shinyBS_0.61.1         \n [82] class_7.3-22            data.table_1.17.8       hms_1.1.3              \n [85] sp_2.2-0                RANN_2.6.2              foreach_1.5.2          \n [88] pillar_1.11.1           posterior_1.6.1         later_1.4.2            \n [91] splines_4.4.2           lattice_0.22-6          tidyselect_1.2.1       \n [94] knitr_1.50              svglite_2.1.3           stats4_4.4.2           \n [97] xfun_0.52               shinydashboard_0.7.3    leafpop_0.1.0          \n[100] stringi_1.8.4           rematch_2.0.0           yaml_2.3.10            \n[103] boot_1.3-31             evaluate_1.0.4          codetools_0.2-20       \n[106] cli_3.6.5               RcppParallel_5.1.9      systemfonts_1.1.0      \n[109] xtable_1.8-4            jquerylib_0.1.4         secr_5.1.0             \n[112] dichromat_2.0-0.1       Rcpp_1.1.0              spAbundance_0.2.1      \n[115] png_0.1-8               XML_3.99-0.18           parallel_4.4.2         \n[118] prettyunits_1.2.0       lme4_1.1-35.5           mvtnorm_1.3-2          \n[121] scales_1.4.0            e1071_1.7-16            crayon_1.5.3           \n[124] rlang_1.1.6"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#single-species-occupancy-models",
    "href": "blog/2025-10-15-analysis/index.html#single-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-models",
    "href": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Multi-species occupancy models",
    "text": "Multi-species occupancy models\nMulti-species occupancy models for estimating the effects of environmental covariates on several species occurrences while accounting for imperfect detection were build on the principle of the Single-species occupancy model, and developed more than 20 years ago.\nMulti-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#objective",
    "href": "blog/2025-10-15-analysis/index.html#objective",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Objective",
    "text": "Objective\nWe want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\nCodelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis) # Tools to Visualize, Manipulate, and Summarize MCMC Output\nlibrary(coda) # Output Analysis and Diagnostics for MCMC\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR) # Camera Trap Data Management and Preparation \nlibrary(spOccupancy) # Single-Species, Multi-Species, and Integrated Spatial Occupancy\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'"
  }
]