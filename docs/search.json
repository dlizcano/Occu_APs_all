[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Occupancy in Protected Areas",
    "section": "",
    "text": "text…\n\nCode1 + 1\n\n[1] 2\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe problem\n\n\n\nmodel\n\n\n\n\nMay 20, 2025\n\n\n\n\n\n\n\n\n\n\n\n\nFitting a Spatial Factor Multi-Species Occupancy Model\n\n\n\nmodel\n\ncode\n\nanalysis\n\n\n\n\nMay 16, 2025\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html",
    "href": "blog/2025-10-10-the-model/index.html",
    "title": "The problem",
    "section": "",
    "text": "Codelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\nlibrary(unmarked) # Models for Data from Unmarked Animals\nlibrary(ubms) # Bayesian Models for Data from Unmarked Animals using 'Stan'\n\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'\nWe want to Asses the role of Protected Areas (PA) in the conservation of vertebrates using on the ground data.\nEvaluating whether PA are working is essential as they are perhaps the primary strategy for averting biodiversity loss. Its been suggested that some do no work, paper parks Its crucial to continue working on best methods to evaluate their impact.\nOver a decade ago researchers started evaluating this. Mostly focused on the effects of PA in reducing threats (fires, deforestation) and focused on forest cover.\nEven if we are effective in protecting forests, and the forest is in very good condition, PA could have “empty forests” and loosed biodiversity (hunting, diseases or even their sizes). So when we say a PA is effective, are we looking at this?\nWe want to compare apples with apples and control for covariates related with occupancy and abundance of species, like elevation, human pressures, ecosystem type, etc.\nOccupancy is a cost effective method for evaluation a population, it is a state variable, representing the proportion of the area occupied by the species, solving the problem of imperfect detection.\nWe compiled deployments-studies that have intentionally sampled inside and outside PAS, in a quasi-experimental design, using camera traps.\nEach case each camera is adequately matched, in a similar fashion as the remote sensing approaches.\nWe used a multispecies occupancy model, and a variation incorporating spatial autocorrelation, to compare occupancy inside and outside the PA and also as a distance to the protected area border."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#package-citation",
    "href": "blog/2025-10-10-the-model/index.html#package-citation",
    "title": "The problem",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), terra v. 1.8.60 (Hijmans 2025), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018), ubms v. 1.2.7 (Kellner et al. 2021), unmarked v. 1.5.0 (Fiske and Chandler 2011; Kellner et al. 2023)."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#sesion-info",
    "href": "blog/2025-10-10-the-model/index.html#sesion-info",
    "title": "The problem",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] lubridate_1.9.4 forcats_1.0.0   stringr_1.5.2   dplyr_1.1.4    \n [5] purrr_1.1.0     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n [9] ggplot2_4.0.0   tidyverse_2.0.0 ubms_1.2.7      unmarked_1.5.0 \n[13] elevatr_0.99.0  terra_1.8-60    tmap_4.2        maps_3.4.3     \n[17] mapview_2.11.4  sf_1.0-21       DT_0.34.0       readxl_1.4.3   \n[21] grateful_0.3.0 \n\nloaded via a namespace (and not attached):\n [1] DBI_1.2.3            pbapply_1.7-2        gridExtra_2.3       \n [4] tmaptools_3.3        s2_1.1.9             inline_0.3.20       \n [7] logger_0.4.0         rlang_1.1.6          magrittr_2.0.3      \n[10] matrixStats_1.5.0    e1071_1.7-16         compiler_4.4.2      \n[13] loo_2.8.0            png_0.1-8            vctrs_0.6.5         \n[16] pkgconfig_2.0.3      wk_0.9.4             fastmap_1.2.0       \n[19] lwgeom_0.2-14        leafem_0.2.4         rmarkdown_2.29      \n[22] tzdb_0.4.0           spacesXYZ_1.6-0      xfun_0.52           \n[25] satellite_1.0.5      jsonlite_2.0.0       parallel_4.4.2      \n[28] R6_2.6.1             stringi_1.8.4        RColorBrewer_1.1-3  \n[31] StanHeaders_2.32.10  cellranger_1.1.0     stars_0.6-8         \n[34] Rcpp_1.1.0           rstan_2.32.6         knitr_1.50          \n[37] base64enc_0.1-3      timechange_0.3.0     Matrix_1.7-1        \n[40] tidyselect_1.2.1     rstudioapi_0.17.1    dichromat_2.0-0.1   \n[43] abind_1.4-8          yaml_2.3.10          maptiles_0.10.0     \n[46] codetools_0.2-20     curl_7.0.0           pkgbuild_1.4.8      \n[49] lattice_0.22-6       leafsync_0.1.0       withr_3.0.2         \n[52] S7_0.2.0             evaluate_1.0.4       units_0.8-7         \n[55] proxy_0.4-27         RcppParallel_5.1.9   pillar_1.11.1       \n[58] KernSmooth_2.23-24   stats4_4.4.2         generics_0.1.3      \n[61] sp_2.2-0             hms_1.1.3            rstantools_2.4.0    \n[64] scales_1.4.0         class_7.3-22         glue_1.8.0          \n[67] tools_4.4.2          leaflegend_1.2.1     data.table_1.17.8   \n[70] RSpectra_0.16-2      XML_3.99-0.18        grid_4.4.2          \n[73] QuickJSR_1.4.0       crosstalk_1.2.1      colorspace_2.1-1    \n[76] cols4all_0.8-1       raster_3.6-32        cli_3.6.5           \n[79] V8_6.0.0             gtable_0.3.6         digest_0.6.37       \n[82] progressr_0.15.0     classInt_0.4-11      htmlwidgets_1.6.4   \n[85] farver_2.1.2         htmltools_0.5.8.1    lifecycle_1.0.4     \n[88] leaflet_2.2.3        microbenchmark_1.5.0 MASS_7.3-61"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html",
    "href": "blog/2025-10-15-analysis/index.html",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Multi-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables.\n\nCodelibrary(grateful)\nlibrary(readxl)\nlibrary(DT)\nlibrary(sf)\nlibrary(mapview)\nlibrary(maps)\nlibrary(tmap)\nlibrary(terra)\nlibrary(elevatr)\n#library(spOccupancy)\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis)\nlibrary(coda)\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR)\nlibrary(spOccupancy)\nlibrary(tidyverse)"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "href": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Multi-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables.\n\nCodelibrary(grateful)\nlibrary(readxl)\nlibrary(DT)\nlibrary(sf)\nlibrary(mapview)\nlibrary(maps)\nlibrary(tmap)\nlibrary(terra)\nlibrary(elevatr)\n#library(spOccupancy)\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis)\nlibrary(coda)\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR)\nlibrary(spOccupancy)\nlibrary(tidyverse)"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "href": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Fitting a Multi-Species Spatial Occupancy Model",
    "text": "Fitting a Multi-Species Spatial Occupancy Model\nWe use a more computationally efficient approach for fitting spatial multi-species occupancy models. Doser, Finley, and Banerjee (2023) call this alternative approach a “spatial factor multi-species occupancy model”, and we describe this in depth in Doser, Finley, and Banerjee (2023). This newer approach also accounts for residual species correlations (i.e., it is a joint species distribution model with imperfect detection). Our simulation results from Doser, Finley, and Banerjee (2023) show that this alternative approach outperforms, or performs equally, while being substantially faster than using spMsPGOcc().\nTamshiyacu Tahuayo data\nHere we use the tables PER-003_BD_ACRCTT_T0.xlsx\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Pacaya &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PacayaSamiria/WDPA_WDOECM_Jun2025_Public_249_shp-polygons.shp\")\n\nAP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\nPer_Tahuayo_piloto &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-002_BD_ACRTT-PILOTO.xlsx\")\n\n50 cameras in Cameras. \n 50 cameras in Deployment. \n 50 deployments in Deployment. \n 50 points in Deployment. \n 50 cameras in Images. \n 50 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCode Per_Tahuayo &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n85 cameras in Cameras. \n 84 cameras in Deployment. \n 84 deployments in Deployment. \n 84 points in Deployment. \n 84 cameras in Images. \n 84 points in Images. \n\n\nJoining with `by = join_by(Camera_Id)`\n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCode# get sites\n# Per_Pacaya_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n# get sites\nPer_Tahuayo_sites1 &lt;- Per_Tahuayo |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_sites &lt;- sf::st_as_sf(Per_Tahuayo_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_sites) &lt;- 4326\n\n\n\n# get Pacaya sites\nPer_Tahuayo_piloto_sites1 &lt;- Per_Tahuayo_piloto |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_piloto_sites &lt;- sf::st_as_sf(Per_Tahuayo_piloto_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_piloto_sites) &lt;- 4326\n\n\n\n\n# get elevation map\nelevation_17 &lt;- rast(get_elev_raster(Per_Tahuayo_sites, z = 10)) #z =1-14\n\nMosaicing & Projecting\nNote: Elevation units are in meters.\n\nCode# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_sites &lt;- cbind(Per_Tahuayo_sites, terra::extract(elevation_17, Per_Tahuayo_sites))\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_piloto_sites &lt;- cbind(Per_Tahuayo_piloto_sites, terra::extract(elevation_17, Per_Tahuayo_piloto_sites))\n\n# covs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_17, Ecu_17_sites))\n# covs_Ecu_18_sites &lt;- cbind(Ecu_18_sites, terra::extract(elevation_17, Ecu_18_sites))\n# covs_Ecu_20_sites &lt;- cbind(Ecu_20_sites, terra::extract(elevation_17, Ecu_20_sites))\n# covs_Ecu_21_sites &lt;- cbind(Ecu_21_sites, terra::extract(elevation_17, Ecu_21_sites))\n# covs_Ecu_22_sites &lt;- cbind(Ecu_22_sites, terra::extract(elevation_17, Ecu_22_sites))\n\n# get which are in and out\ncovs_Per_Tahuayo_sites$in_AP = st_intersects(covs_Per_Tahuayo_sites, AP_Tahuayo, sparse = FALSE)\n\ncovs_Per_Tahuayo_piloto_sites$in_AP = st_intersects(covs_Per_Tahuayo_piloto_sites, AP_Tahuayo, sparse = FALSE)\n# covs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Machalilla, sparse = FALSE)\n# covs_Ecu_18_sites$in_AP = st_intersects(covs_Ecu_18_sites, AP_Machalilla, sparse = FALSE)\n# covs_Ecu_20_sites$in_AP = st_intersects(covs_Ecu_20_sites, AP_Machalilla, sparse = FALSE)\n# covs_Ecu_21_sites$in_AP = st_intersects(covs_Ecu_21_sites, AP_Machalilla, sparse = FALSE)\n# covs_Ecu_22_sites$in_AP = st_intersects(covs_Ecu_22_sites, AP_Machalilla, sparse = FALSE)\n\n# covs_Ecu_16_sites$in_AP = st_intersects(covs_Ecu_16_sites, AP_Llanganates, sparse = FALSE)\n\n\n\n# make a map\nmapview (elevation_17, alpha=0.5) + \n  mapview (AP_Pacaya, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Per_Tahuayo_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +   \n  mapview (covs_Per_Tahuayo_piloto_sites, \n           zcol = \"in_AP\", \n           col.regions =c(\"blue\"), \n           burst = TRUE) \n\nNumber of pixels is above 5e+05.Only about 5e+05 pixels will be shown.\nYou can increase the value of `maxpixels` to 523775 to avoid this.\n\n\n\n\n\nCode  # mapview (covs_Ecu_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_18_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_20_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_21_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  # mapview (covs_Ecu_22_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"blue\") ) #+\n  # mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\nCamera trap operation data and detection history\n\nCode# Join 3 tables\n# fix count in ECU 18, 20,\n# Ecu_18$Count &lt;- as.numeric(Ecu_18$Count)\nPer_Tahuayo_piloto$Longitude &lt;- as.numeric(Per_Tahuayo_piloto$Longitude)\nPer_Tahuayo_piloto$Latitude &lt;- as.numeric(Per_Tahuayo_piloto$Latitude)\n\n\nPer_full &lt;- Per_Tahuayo|&gt; \n  full_join(Per_Tahuayo_piloto) #|&gt; \n\nJoining with `by = join_by(`Project Id`, Camera_Id, Make, Model, `Serial\nNumber`, Year_Purchased, Deployment_ID, Point.x, Longitude, Latitude,\nstart_date, end_date, `Bait Type`, `Bait Description`, `Feature Type`, `Feature\nType methodology`, `Camera Type`, `Quiet Period Setting`, `Restriction on\nAccess`, `Camera Failure Details`, season, rio_playa, arroyo, camino,\nsenda_animal, senda_gente, salitral, pozo_agua, bosque, sabana, intermedio,\nintervalo_trigger, locationID, `Image Id`, `Photo Type`, `Photo Type Identified\nby`, Point.y, scientificName, Date_Time_Captured, `Independent event`, Age,\nSex, `Individual ID`, Count, Jaguar_Design, year)`\n\nCode                      # full_join(Ecu_18) |&gt; \n                      # full_join(Ecu_20) |&gt; \n                      # full_join(Ecu_21) |&gt; \n                      # full_join(Ecu_22)\n\n# fix date format\n# \n# Formatting a Date object\nPer_full$start_date &lt;- as.Date(Per_full$\"start_date\", \"%Y/%m/%d\")\nPer_full$start_date &lt;- format(Per_full$start_date, \"%Y-%m-%d\")\n\nPer_full$end_date &lt;- as.Date(Per_full$\"end_date\", \"%Y/%m/%d\")\nPer_full$end_date &lt;- format(Per_full$end_date, \"%Y-%m-%d\")\n\nPer_full$eventDate &lt;- as.Date(Per_full$\"Date_Time_Captured\", \"%Y/%m/%d\")\n\nWarning in as.POSIXlt.POSIXct(x, tz = tz): unknown timezone '%Y/%m/%d'\n\nCodePer_full$eventDate &lt;- format(Per_full$eventDate, \"%Y-%m-%d\")\n\n# Per_full$eventDateTime &lt;- ymd_hms(paste(Per_full$\"photo_date\", Per_full$\"photo_time\", sep=\" \"))\nPer_full$eventDateTime &lt;- ymd_hms(Per_full$\"Date_Time_Captured\")\n\n# rename camera id\nPer_full$camid &lt;- Per_full$`Camera_Id`\n\n\n# filter 2021 and make uniques\nCToperation  &lt;- Per_full |&gt; dplyr::group_by(camid) |&gt; #(array_locID) |&gt; \n                           mutate(minStart=start_date, maxEnd=end_date) |&gt; distinct(Longitude, Latitude, minStart, maxEnd) |&gt; dplyr::ungroup()\n# remove one duplicated\n# View(CToperation)\n# CToperation &lt;- CToperation[-15,]\n\n\n# Generamos la matríz de operación de las cámaras\n\ncamop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operación\n                         stationCol= \"camid\", # Columna que define la estación\n                         setupCol= \"minStart\", #Columna fecha de colocación\n                         retrievalCol= \"maxEnd\", #Columna fecha de retiro\n                         #hasProblems= T, # Hubo fallos de cámaras\n                         dateFormat= \"%Y-%m-%d\")#, #, # Formato de las fechas\n                         #cameraCol=\"Camera_Id\")\n                         # sessionCol= \"Year\")\n\n# Generar las historias de detección ---------------------------------------\n## remove plroblem species\n\n# Per_full$scientificName &lt;- paste(Per_full$genus, Per_full$species, sep=\" \")\n\n#### remove stups\n# ind &lt;- which(Per_full$scientificName==\"NA NA\")\n# Per_full &lt;- Per_full[-ind,]\n\n# ind &lt;- which(Per_full$scientificName==\"Set up\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Blank\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Unidentifiable\")\n# Per_full &lt;- Per_full[-ind,]\n\n\n\n\nDetHist_list &lt;- lapply(unique(Per_full$scientificName), FUN = function(x) {\n  detectionHistory(\n    recordTable         = Per_full, # abla de registros\n    camOp                = camop, # Matriz de operación de cámaras\n    stationCol           = \"camid\",\n    speciesCol           = \"scientificName\",\n    recordDateTimeCol    = \"eventDateTime\",\n    recordDateTimeFormat  = \"%Y-%m-%d %H:%M:%S\",\n    species              = x,     # la función reemplaza x por cada una de las especies\n    occasionLength       = 7, # Colapso de las historias a 10 ías\n    day1                 = \"station\", # \"survey\" a specific date, \"station\", #inicie en la fecha de cada survey\n    datesAsOccasionNames = FALSE,\n    includeEffort        = TRUE,\n    scaleEffort          = FALSE,\n    #unmarkedMultFrameInput=TRUE\n    timeZone             = \"America/Bogota\" \n    )\n  }\n)\n\nWarning: \nAt 1 stations there were records before camera operation date range:  PER-003-C0071\n\n\nWarning: \nAt 1 stations there were records after camera operation date range:  PER-002-C0036\n\n\nWarning: 5 records (out of 1357) were removed because they were taken before day1 (if a date was specified),  within the buffer period, or before occasionStartTime on the 1st day, e.g.:\nPER-003-C0071: 2016-08-28 16:28:21\nPER-003-C0071: 2016-08-28 16:28:22\nPER-003-C0071: 2016-08-28 16:28:23\nPER-003-C0071: 2016-08-28 16:28:24\nPER-003-C0071: 2016-08-28 16:28:25\n\n\nWarning: \n\n1 records (out of 1357) were removed because they were taken after the end of the last occasion, e.g.:\nPER-002-C0036: 2015-05-25 13:38:49\n\n\nWarning: \nAt 1 stations there were records after camera operation date range:  PER-003-C0070\n\n\nWarning: \n\n5 records (out of 2861) were removed because they were taken after the end of the last occasion, e.g.:\nPER-003-C0070: 2016-11-03 11:56:53\nPER-003-C0070: 2016-11-03 11:56:54\nPER-003-C0070: 2016-11-03 11:56:55\nPER-003-C0070: 2016-11-03 11:56:56\nPER-003-C0070: 2016-11-03 11:56:57\n\nCode# names\nnames(DetHist_list) &lt;- unique(Per_full$scientificName)\n\n# Finalmente creamos una lista nueva donde estén solo las historias de detección\nylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)\n# otra lista con effort scaled\nefort &lt;- lapply(DetHist_list, FUN = function(x) x$effort)\n\n# number of observetions per sp, collapsed to 7 days\n# lapply(ylist, sum, na.rm = TRUE)\n\n\nArrange spatial covariates\n\nCode# make sf()\nPer_full_sf &lt;- CToperation |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"), \n              crs = 4326)\n\n# extract elev\nPer_full_sf$elev &lt;- terra::extract(elevation_17, Per_full_sf)[,2]\nstr(Per_full_sf$elev)\n\n num [1:134] 127 105 106 109 109 102 106 97 106 107 ...\n\nCode# extract in AP\nPer_full_sf$in_AP = as.factor(st_intersects(Per_full_sf, AP_Tahuayo, sparse = FALSE))\n\nin_AP &lt;- as.numeric((st_drop_geometry(Per_full_sf$in_AP)))\n\n# mapview(full_sites_14_15_16_sf, zcol = \"in_AP\", burst = TRUE)\n\n# Transform coord to UTM Z17 Ecuador EPSG:32717 WGS 84 / UTM zone 17S\nPer_full_sf_UTM &lt;- st_transform(Per_full_sf, \"EPSG:32717\")\n\ncoords &lt;- st_coordinates(Per_full_sf_UTM)\n#str(coords)\n\n# make Ecu_14_15_16 an sf object\n#    cam_sf &lt;- st_as_sf(Ecu_14_15_16, coords = c(\"lon\",\"lat\"))   #crs=\"EPSG:4326\")\n    #--- set CRS ---#\n#    st_crs(cam_sf) &lt;- 4326\n\n#transform coord data to UTM\nAP_Tahuayo_UTM &lt;- st_transform(AP_Tahuayo, \"EPSG:32717\")\n# Convert to LINESTRING\nAP_Tahuayo_UTM_line &lt;- st_cast(AP_Tahuayo_UTM,\"MULTILINESTRING\")# \"LINESTRING\")\n\n# Calculate the distance\n#multiplic &lt;- full_sites_14_15_16_sf_UTM |&gt; mutate(multiplic= as.numeric(in_AP)) \nmultiplic=ifelse(Per_full_sf_UTM$in_AP==\"TRUE\",-1,1)\nPer_full_sf_UTM$border_dist &lt;- as.numeric(st_distance(Per_full_sf_UTM, AP_Tahuayo_UTM_line) * multiplic )\n# print(border_dist)\n\n# convert true false to inside outside\nPer_full_sf_UTM &lt;- Per_full_sf_UTM |&gt; \n  mutate(in_AP = case_when(\n    str_detect(in_AP, \"TRUE\") ~ \"inside_AP\",\n    str_detect(in_AP, \"FALSE\") ~ \"outside_AP\"\n  )) |&gt; mutate(in_AP=as.factor(in_AP))\n\n\nhist(Per_full_sf_UTM$border_dist)\n\n\n\n\n\n\n\nPrepare the model\nThe function sfMsPGOcc\nFits multi-species spatial occupancy models with species correlations (i.e., a spatially-explicit joint species distribution model with imperfect detection). We use Polya-Gamma latent variables and a spatial factor modeling approach. Currently, models are implemented using a Nearest Neighbor Gaussian Process.\n\nCode# Detection-nondetection data ---------\n# Species of interest, can select individually\n# curr.sp &lt;- sort(unique(Ecu_14_15_16$.id))# c('BAWW', 'BLJA', 'GCFL')\n# sort(names(DetHist_list))\nselected.sp &lt;-  c(\n  \"Atelocynus microtis\" ,\n  \"Coendou prehensilis\" ,\n \"Cuniculus paca\",           \n# \"Dasyprocta fuliginosa.\",      \n\"Dasypus sp.\" ,    \n\"Didelphis marsupialis\",    \n\"Eira barbara\",             \n\"Leopardus pardalis\",       \n\"Leopardus wiedii\",         \n\"Mazama americana\",\n\"Mazama nemorivaga\",\n#\"Mitu tuberosum\" ,\n\"Myoprocta pratti\",\n\"Myrmecophaga tridactyla\",\n\"Nasua nasua\" ,\n# \"Mazama americana\",         \n# \"Myotis myotis\",           \n# \"Nasua narica\",             \n# \"Odocoileus virginianus\",   \n\"Panthera onca\" ,\n# \"Procyon cancrivorus\" ,\n\"Pecari tajacu\",    \n#\"Penelope jacquacu\" ,\n\"Priodontes maximus\" ,\n\"Procyon cancrivorous\",      \n# \"Psophia leucoptera\",\n\"Puma concolor\" ,\n\"Puma yagouaroundi\",        \n# \"Rattus rattus\" ,\n# \"Roedor sp.\",\n# \"Sciurus sp.\",       \n# \"Sus scrofa\",               \n# \"Sylvilagus brasiliensis\",  \n\"Tamandua tetradactyla\",   \n\"Tapirus terrestris\",\n\"Tayassu pecari\"\n#\"Tinamus major\"            \n              )\n\n# y.msom &lt;- y[which(sp.codes %in% selected.sp), , ]\n# str(y.msom)\n\n# Use selection\ny.selected &lt;- ylist[selected.sp]   \n\n#### three-dimensional array with dimensions corresponding to species, sites, and replicates\n\n# 1. Load the abind library to make arrays easily \nlibrary(abind)\nmy_array_abind &lt;- abind(y.selected, # start from list\n                        along = 3, # 3D array\n                        use.first.dimnames=TRUE) # keep names\n\n# Transpose the array to have:\n# species, sites, and sampling occasions in that order\n# The new order is (3rd dim, 1st dim, 2nd dim)\ntransposed_array &lt;- aperm(my_array_abind, c(3, 1, 2))\n\n#### site covs\nsitecovs &lt;- as.data.frame(st_drop_geometry(\n                    Per_full_sf_UTM[,5:7]))\n sitecovs[, 1] &lt;- as.vector((sitecovs[,1]))   # scale numeric covariates\n sitecovs[, 3] &lt;- as.vector((sitecovs[,3]))   # scale numeric covariates\n # sitecovs$fact &lt;- factor(c(\"A\", \"A\", \"B\"))    # categorical covariate\n\nnames(sitecovs) &lt;- c(\"elev\", \"in_AP\", \"border_dist\")\n\n# check consistancy equal number of spatial covariates and rows in data\n# identical(nrow(ylist[[1]]), nrow(covars)) \n\n# Base de datos para los análisis -----------------------------------------\n\n# match the names to \"y\"  \"occ.covs\" \"det.covs\" \"coords\" \ndata_list &lt;- list(y = transposed_array, # Historias de detección\n                  occ.covs = sitecovs, #covs de sitio\n                  det.covs  = list(effort = DetHist_list[[1]]$effort),\n                  coords = st_coordinates(Per_full_sf_UTM)\n                  )  # agregamos el esfuerzo de muestreo como covariable de observación\n\n\nRunning the model\nWe let spOccupancy set the initial values by default based on the prior distributions.\n\nCode# Running the model\n\n# 3. 1 Modelo multi-especie  -----------------------------------------\n\n# 2. Model fitting --------------------------------------------------------\n# Fit a non-spatial, single-species occupancy model. \nout &lt;- msPGOcc(occ.formula = ~ scale(elev) + scale(border_dist) , \n               det.formula = ~ scale(effort) , # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.samples = 6000, \n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 134 sites and 22 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 1 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist), det.formula = ~scale(effort), \n    data = data_list, n.samples = 6000, n.report = 1000, n.burn = 1000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 3.2653\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%  97.5%   Rhat ESS\n(Intercept)        -0.3769 0.3508 -1.1177 -0.3627 0.2528 1.1534 119\nscale(elev)         0.3781 0.2930 -0.2600  0.3808 0.9267 1.0320 714\nscale(border_dist)  0.1862 0.2426 -0.2740  0.1831 0.6957 1.0121 652\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        0.9581 0.6742 0.1901 0.7844 2.7671 1.0991 120\nscale(elev)        1.2960 1.0290 0.3540 1.0309 4.0215 1.1027  95\nscale(border_dist) 0.7534 0.5592 0.1990 0.5880 2.3946 1.0213 160\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)   -3.2228 0.3630 -3.9465 -3.2305 -2.4773 1.0495 380\nscale(effort)  0.3681 0.0983  0.1912  0.3615  0.5785 1.0486 647\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)   2.5419 0.9849 1.1999 2.3458 4.8710 1.0606 396\nscale(effort) 0.0604 0.0398 0.0179 0.0494 0.1595 1.0239 821\n\nCode# Fit a spatial, single-species occupancy model using \n# latent factors.\ntictoc::tic()\n  out.sp &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) + scale(border_dist) , \n                      det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,             \n                      data = data_list, \n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 3,\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 100);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 134 sites and 22 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 3 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 1 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 100 of 600, 16.67%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     68.0        1.80399\n    2       phi     68.0        1.47698\n    3       phi     32.0        2.48432\n-------------------------------------------------\nBatch: 200 of 600, 33.33%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     4.0     2.91538\n    2       phi     36.0        2.91538\n    3       phi     48.0        3.03436\n-------------------------------------------------\nBatch: 300 of 600, 50.00%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     32.0        3.35348\n    2       phi     40.0        3.35348\n    3       phi     48.0        1.99372\n-------------------------------------------------\nBatch: 400 of 600, 66.67%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     52.0        2.58571\n    2       phi     60.0        3.15819\n    3       phi     48.0        3.49034\n-------------------------------------------------\nBatch: 500 of 600, 83.33%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     32.0        3.70617\n    2       phi     52.0        2.74560\n    3       phi     48.0        3.49034\n-------------------------------------------------\nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 100 of 600, 16.67%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     60.0        3.15819\n    2       phi     36.0        3.56085\n    3       phi     12.0        3.28708\n-------------------------------------------------\nBatch: 200 of 600, 33.33%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     44.0        3.22199\n    2       phi     56.0        3.28708\n    3       phi     32.0        3.42123\n-------------------------------------------------\nBatch: 300 of 600, 50.00%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     8.0     3.09566\n    2       phi     56.0        3.28708\n    3       phi     44.0        3.22199\n-------------------------------------------------\nBatch: 400 of 600, 66.67%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     48.0        3.35348\n    2       phi     8.0     2.63794\n    3       phi     64.0        3.56085\n-------------------------------------------------\nBatch: 500 of 600, 83.33%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     44.0        3.03436\n    2       phi     48.0        3.15819\n    3       phi     36.0        3.28708\n-------------------------------------------------\nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 100 of 600, 16.67%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     40.0        2.97427\n    2       phi     48.0        3.42123\n    3       phi     44.0        3.35348\n-------------------------------------------------\nBatch: 200 of 600, 33.33%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     0.0     3.03436\n    2       phi     52.0        3.63279\n    3       phi     40.0        3.56085\n-------------------------------------------------\nBatch: 300 of 600, 50.00%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     48.0        3.56085\n    2       phi     48.0        2.53451\n    3       phi     56.0        3.22199\n-------------------------------------------------\nBatch: 400 of 600, 66.67%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     4.0     3.09566\n    2       phi     44.0        3.28708\n    3       phi     56.0        3.70617\n-------------------------------------------------\nBatch: 500 of 600, 83.33%\n    Latent Factor   Parameter   Acceptance  Tuning\n    1       phi     48.0        2.15977\n    2       phi     56.0        3.28708\n    3       phi     44.0        3.85743\n-------------------------------------------------\nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n942.1 sec elapsed\n\nCode#########################\n# tictoc::tic()\n#   out.sp.gaus &lt;- sfMsPGOcc(occ.formula = ~ scale(border_dist) , \n#                            det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,              \n#                            data = data_list, \n#                            n.batch = 400, \n#                            batch.length = 25,\n#                            n.thin = 5, \n#                            n.burn = 5000, \n#                            n.chains = 1,\n#                            NNGP = TRUE,\n#                            n.factors = 5,\n#                            n.neighbors = 15,\n#                            cov.model = 'gaussian',\n#                            n.report = 100);beep(sound = 4)\n# tictoc::toc()\n\n# save the results to not run again\nsave(out, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/result_2.R\") # guardamos los resultados para no correr de nuevo\n# save the results to not run again\nsave(out.sp, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n\n# load(\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\")\n# summary(fit.commu)\n\n\n###Model validation\nWe next perform a posterior predictive check using the Freeman-Tukey statistic grouping the data by sites. We summarize the posterior predictive check with the summary() function, which reports a Bayesian p-value. A Bayesian p-value that hovers around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well (Hobbs and Hooten 2015). As always with a simulation-based analysis using MCMC, you will get numerically slightly different values.\n\nCode# 3. Model validation -----------------------------------------------------\n# Perform a posterior predictive check to assess model fit. \nppc.out &lt;- ppcOcc(out, fit.stat = 'freeman-tukey', group = 1)\n\nCurrently on species 1 out of 22\n\n\nCurrently on species 2 out of 22\n\n\nCurrently on species 3 out of 22\n\n\nCurrently on species 4 out of 22\n\n\nCurrently on species 5 out of 22\n\n\nCurrently on species 6 out of 22\n\n\nCurrently on species 7 out of 22\n\n\nCurrently on species 8 out of 22\n\n\nCurrently on species 9 out of 22\n\n\nCurrently on species 10 out of 22\n\n\nCurrently on species 11 out of 22\n\n\nCurrently on species 12 out of 22\n\n\nCurrently on species 13 out of 22\n\n\nCurrently on species 14 out of 22\n\n\nCurrently on species 15 out of 22\n\n\nCurrently on species 16 out of 22\n\n\nCurrently on species 17 out of 22\n\n\nCurrently on species 18 out of 22\n\n\nCurrently on species 19 out of 22\n\n\nCurrently on species 20 out of 22\n\n\nCurrently on species 21 out of 22\n\n\nCurrently on species 22 out of 22\n\nCodeppc.out.sp &lt;- ppcOcc(out.sp, fit.stat = 'freeman-tukey', group = 1)\n\nCurrently on species 1 out of 22\n\n\nCurrently on species 2 out of 22\n\n\nCurrently on species 3 out of 22\n\n\nCurrently on species 4 out of 22\n\n\nCurrently on species 5 out of 22\n\n\nCurrently on species 6 out of 22\n\n\nCurrently on species 7 out of 22\n\n\nCurrently on species 8 out of 22\n\n\nCurrently on species 9 out of 22\n\n\nCurrently on species 10 out of 22\n\n\nCurrently on species 11 out of 22\n\n\nCurrently on species 12 out of 22\n\n\nCurrently on species 13 out of 22\n\n\nCurrently on species 14 out of 22\n\n\nCurrently on species 15 out of 22\n\n\nCurrently on species 16 out of 22\n\n\nCurrently on species 17 out of 22\n\n\nCurrently on species 18 out of 22\n\n\nCurrently on species 19 out of 22\n\n\nCurrently on species 20 out of 22\n\n\nCurrently on species 21 out of 22\n\n\nCurrently on species 22 out of 22\n\nCode# Calculate a Bayesian p-value as a simple measure of Goodness of Fit.\n# Bayesian p-values between 0.1 and 0.9 indicate adequate model fit. \nsummary(ppc.out)\n\n\nCall:\nppcOcc(object = out, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3605 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.506\nCoendou prehensilis Bayesian p-value: 0.7227\nCuniculus paca Bayesian p-value: 0.018\nDasypus sp. Bayesian p-value: 0.182\nDidelphis marsupialis Bayesian p-value: 0.1367\nEira barbara Bayesian p-value: 0.5587\nLeopardus pardalis Bayesian p-value: 0.2067\nLeopardus wiedii Bayesian p-value: 0.5073\nMazama americana Bayesian p-value: 0.0253\nMazama nemorivaga Bayesian p-value: 0.396\nMyoprocta pratti Bayesian p-value: 0.578\nMyrmecophaga tridactyla Bayesian p-value: 0.2113\nNasua nasua Bayesian p-value: 0.5053\nPanthera onca Bayesian p-value: 0.2713\nPecari tajacu Bayesian p-value: 0.3287\nPriodontes maximus Bayesian p-value: 0.5513\nProcyon cancrivorous Bayesian p-value: 0.362\nPuma concolor Bayesian p-value: 0.538\nPuma yagouaroundi Bayesian p-value: 0.512\nTamandua tetradactyla Bayesian p-value: 0.5233\nTapirus terrestris Bayesian p-value: 0.0753\nTayassu pecari Bayesian p-value: 0.216\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.sp)\n\n\nCall:\nppcOcc(object = out.sp, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3733 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.5293\nCoendou prehensilis Bayesian p-value: 0.716\nCuniculus paca Bayesian p-value: 0.0167\nDasypus sp. Bayesian p-value: 0.175\nDidelphis marsupialis Bayesian p-value: 0.168\nEira barbara Bayesian p-value: 0.5847\nLeopardus pardalis Bayesian p-value: 0.1777\nLeopardus wiedii Bayesian p-value: 0.5227\nMazama americana Bayesian p-value: 0.0483\nMazama nemorivaga Bayesian p-value: 0.5167\nMyoprocta pratti Bayesian p-value: 0.5627\nMyrmecophaga tridactyla Bayesian p-value: 0.187\nNasua nasua Bayesian p-value: 0.478\nPanthera onca Bayesian p-value: 0.26\nPecari tajacu Bayesian p-value: 0.34\nPriodontes maximus Bayesian p-value: 0.5713\nProcyon cancrivorous Bayesian p-value: 0.388\nPuma concolor Bayesian p-value: 0.553\nPuma yagouaroundi Bayesian p-value: 0.531\nTamandua tetradactyla Bayesian p-value: 0.5107\nTapirus terrestris Bayesian p-value: 0.066\nTayassu pecari Bayesian p-value: 0.3093\nFit statistic:  freeman-tukey \n\nCode#### fit plot\nppc.df &lt;- data.frame(fit = ppc.out.sp$fit.y, \n                     fit.rep = ppc.out.sp$fit.y.rep, \n                     color = 'lightskyblue1')\n\nppc.df$color[ppc.df$fit.rep.1 &gt; ppc.df$fit.1] &lt;- 'lightsalmon'\nplot(ppc.df$fit.1, ppc.df$fit.rep.1, bg = ppc.df$color, pch = 21, \n     ylab = 'Fit', xlab = 'True')\nlines(ppc.df$fit.1, ppc.df$fit.1, col = 'black')\n\n\n\n\n\n\n\n###Model comparison\n\nCode# 4. Model comparison -----------------------------------------------------\n# Compute Widely Applicable Information Criterion (WAIC)\n# Lower values indicate better model fit. \nwaicOcc(out)\n\n       elpd          pD        WAIC \n-3269.81858    70.23226  6680.10168 \n\nCodewaicOcc(out.sp)\n\n      elpd         pD       WAIC \n-3098.5888   217.7881  6632.7538 \n\n\nResults as table\n\nCode# Here we summarize the spatial factor loadings\n# summary(out.sp$lambda.samples)\n\n# Resultados --------------------------------------------------------------\n# Extraemos lo tabla de valores estimados\nmodresult &lt;- cbind(as.data.frame(waicOcc(out)),\n                  as.data.frame(waicOcc(out.sp))#,\n                  #as.data.frame(waicOcc(out.sp.gaus))\n                  )\n# View(modresult)\nDT::datatable(t(modresult))\n\n\n\n\n\nLower values indicate better model fit.\n### Posterior summary\n\nCode# 5. Posterior summaries --------------------------------------------------\n# Concise summary of main parameter estimates\nsummary(out.sp, level = 'community')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist), det.formula = ~scale(effort), \n    data = data_list, cov.model = \"exponential\", NNGP = TRUE, \n    n.neighbors = 15, n.factors = 3, n.batch = 600, batch.length = 25, \n    n.report = 100, n.burn = 5000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 15.7012\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%  97.5%   Rhat ESS\n(Intercept)        -0.5986 0.4396 -1.4811 -0.5931 0.2720 1.0023 216\nscale(elev)         0.4410 0.3642 -0.3151  0.4560 1.1427 1.0074 868\nscale(border_dist)  0.2473 0.3049 -0.3499  0.2429 0.8729 1.0005 927\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        1.7132 0.9992 0.4362 1.5149 4.1790 1.0143 324\nscale(elev)        2.0834 1.5233 0.5882 1.7135 5.7258 1.0531 171\nscale(border_dist) 1.1587 0.7896 0.2822 0.9641 3.2363 1.0114 489\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -3.1838 0.3609 -3.9134 -3.1771 -2.4825 1.0078  695\nscale(effort)  0.3580 0.0954  0.1889  0.3521  0.5656 1.0048 1458\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%   50%  97.5%   Rhat  ESS\n(Intercept)   2.4829 0.9910 1.1675 2.285 5.0777 1.0042  830\nscale(effort) 0.0598 0.0376 0.0189 0.050 0.1608 1.0044 1540\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n        Mean     SD  2.5%    50%  97.5%   Rhat ESS\nphi-1 0.0141 0.0106 4e-04 0.0130 0.0326 0.9999 282\nphi-2 0.0139 0.0106 4e-04 0.0129 0.0329 1.0038 274\nphi-3 0.0153 0.0103 6e-04 0.0149 0.0329 1.0319 435\n\nCodesummary(out.sp, level = 'species')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist), det.formula = ~scale(effort), \n    data = data_list, cov.model = \"exponential\", NNGP = TRUE, \n    n.neighbors = 15, n.factors = 3, n.batch = 600, batch.length = 25, \n    n.report = 100, n.burn = 5000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 15.7012\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                              Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis            -1.3283 1.3164 -3.8228 -1.3574\n(Intercept)-Coendou prehensilis            -1.3845 1.4559 -4.3295 -1.3296\n(Intercept)-Cuniculus paca                  1.0370 0.3586  0.3890  1.0223\n(Intercept)-Dasypus sp.                     0.0638 0.3508 -0.6252  0.0645\n(Intercept)-Didelphis marsupialis          -2.1036 1.1774 -4.1573 -2.2172\n(Intercept)-Eira barbara                   -0.4971 0.7806 -1.8999 -0.5478\n(Intercept)-Leopardus pardalis             -0.2554 0.9269 -1.7533 -0.3606\n(Intercept)-Leopardus wiedii               -1.0781 1.2522 -3.4275 -1.0732\n(Intercept)-Mazama americana               -1.2196 0.4269 -2.1451 -1.1918\n(Intercept)-Mazama nemorivaga              -0.9292 0.5204 -1.9673 -0.9342\n(Intercept)-Myoprocta pratti               -0.9375 1.2094 -3.2578 -0.9480\n(Intercept)-Myrmecophaga tridactyla        -1.2758 1.0093 -3.1282 -1.3295\n(Intercept)-Nasua nasua                     0.0918 0.9474 -1.4947  0.0165\n(Intercept)-Panthera onca                  -0.7995 0.9200 -2.4250 -0.8305\n(Intercept)-Pecari tajacu                   1.1882 0.4532  0.4286  1.1376\n(Intercept)-Priodontes maximus             -0.4932 1.2705 -2.8470 -0.5427\n(Intercept)-Procyon cancrivorous           -0.9901 1.2734 -3.4610 -1.0334\n(Intercept)-Puma concolor                  -0.0802 1.1964 -2.3561 -0.0886\n(Intercept)-Puma yagouaroundi              -1.0772 1.3256 -3.6719 -1.0718\n(Intercept)-Tamandua tetradactyla          -1.2868 1.3266 -3.8296 -1.2673\n(Intercept)-Tapirus terrestris              0.1428 0.3381 -0.5418  0.1457\n(Intercept)-Tayassu pecari                 -0.4541 0.9059 -1.9944 -0.5390\nscale(elev)-Atelocynus microtis             0.4322 1.1612 -2.0980  0.4340\nscale(elev)-Coendou prehensilis             0.9409 1.2104 -1.2001  0.8566\nscale(elev)-Cuniculus paca                  1.8523 0.4181  1.1252  1.8260\nscale(elev)-Dasypus sp.                     1.5503 0.4567  0.7657  1.5241\nscale(elev)-Didelphis marsupialis          -1.0423 1.0001 -3.4710 -0.8759\nscale(elev)-Eira barbara                    0.7323 0.6324 -0.5051  0.7224\nscale(elev)-Leopardus pardalis              0.3783 0.6571 -0.8725  0.3557\nscale(elev)-Leopardus wiedii               -1.3355 1.2531 -4.1461 -1.2118\nscale(elev)-Mazama americana                0.9937 0.4484  0.1610  0.9738\nscale(elev)-Mazama nemorivaga               1.9941 0.6560  0.9084  1.9187\nscale(elev)-Myoprocta pratti                1.4119 1.1132 -0.4376  1.3019\nscale(elev)-Myrmecophaga tridactyla        -0.5982 0.8454 -2.5506 -0.4879\nscale(elev)-Nasua nasua                    -0.8927 0.7309 -2.4164 -0.8469\nscale(elev)-Panthera onca                   0.6948 0.6943 -0.5960  0.6643\nscale(elev)-Pecari tajacu                   1.8177 0.4840  1.0320  1.7648\nscale(elev)-Priodontes maximus              0.6455 1.4224 -2.3485  0.6983\nscale(elev)-Procyon cancrivorous           -0.8324 0.9238 -3.0274 -0.7357\nscale(elev)-Puma concolor                   0.1694 0.9348 -1.7689  0.1728\nscale(elev)-Puma yagouaroundi               0.9163 1.1708 -1.1791  0.8192\nscale(elev)-Tamandua tetradactyla          -1.2920 1.1548 -3.8160 -1.1857\nscale(elev)-Tapirus terrestris              0.0261 0.3430 -0.6562  0.0267\nscale(elev)-Tayassu pecari                  1.3981 0.7345  0.1614  1.3291\nscale(border_dist)-Atelocynus microtis      1.3385 0.8153 -0.0941  1.2905\nscale(border_dist)-Coendou prehensilis     -0.0550 1.0580 -2.2851 -0.0180\nscale(border_dist)-Cuniculus paca           0.5518 0.3839 -0.1902  0.5438\nscale(border_dist)-Dasypus sp.              1.3815 0.4294  0.6094  1.3509\nscale(border_dist)-Didelphis marsupialis    0.4780 0.7909 -0.9097  0.4270\nscale(border_dist)-Eira barbara             1.3768 0.6078  0.3036  1.3326\nscale(border_dist)-Leopardus pardalis      -0.3364 0.5874 -1.6207 -0.3046\nscale(border_dist)-Leopardus wiedii         0.0866 0.9220 -1.8252  0.0774\nscale(border_dist)-Mazama americana        -0.9033 0.4909 -2.0185 -0.8481\nscale(border_dist)-Mazama nemorivaga       -0.2656 0.5096 -1.3294 -0.2508\nscale(border_dist)-Myoprocta pratti        -0.5401 0.8778 -2.5028 -0.4539\nscale(border_dist)-Myrmecophaga tridactyla  1.2443 0.7076  0.0866  1.1752\nscale(border_dist)-Nasua nasua              0.0647 0.6381 -1.1599  0.0446\nscale(border_dist)-Panthera onca           -0.5753 0.7118 -2.1132 -0.5274\nscale(border_dist)-Pecari tajacu           -0.8969 0.4568 -1.8410 -0.8716\nscale(border_dist)-Priodontes maximus       0.6569 0.9866 -1.2356  0.6167\nscale(border_dist)-Procyon cancrivorous     0.7837 0.9431 -0.8084  0.7078\nscale(border_dist)-Puma concolor            0.1636 0.8268 -1.5388  0.1897\nscale(border_dist)-Puma yagouaroundi        0.7902 1.0262 -1.1618  0.7421\nscale(border_dist)-Tamandua tetradactyla    0.0621 0.9719 -1.8513  0.0638\nscale(border_dist)-Tapirus terrestris      -0.1939 0.3413 -0.8884 -0.1874\nscale(border_dist)-Tayassu pecari           0.3898 0.5419 -0.7280  0.3995\n                                             97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis             1.3669 1.0044  196\n(Intercept)-Coendou prehensilis             1.4189 1.0186  227\n(Intercept)-Cuniculus paca                  1.7895 1.0149 1343\n(Intercept)-Dasypus sp.                     0.7748 1.0004 1456\n(Intercept)-Didelphis marsupialis           0.3057 1.0249  220\n(Intercept)-Eira barbara                    1.1754 1.0225  677\n(Intercept)-Leopardus pardalis              1.9184 1.0114  360\n(Intercept)-Leopardus wiedii                1.4436 1.0166  278\n(Intercept)-Mazama americana               -0.4802 1.0106  834\n(Intercept)-Mazama nemorivaga               0.0697 1.0053 1068\n(Intercept)-Myoprocta pratti                1.5439 1.0030  311\n(Intercept)-Myrmecophaga tridactyla         0.8613 1.0223  295\n(Intercept)-Nasua nasua                     2.2366 1.0535  329\n(Intercept)-Panthera onca                   1.1570 1.0086  449\n(Intercept)-Pecari tajacu                   2.2378 1.0045 1212\n(Intercept)-Priodontes maximus              2.2256 1.0018  284\n(Intercept)-Procyon cancrivorous            1.5828 1.0177  254\n(Intercept)-Puma concolor                   2.4171 1.0263  323\n(Intercept)-Puma yagouaroundi               1.5030 1.0321  272\n(Intercept)-Tamandua tetradactyla           1.3467 1.0154  258\n(Intercept)-Tapirus terrestris              0.8055 1.0018 1511\n(Intercept)-Tayassu pecari                  1.6004 1.0262  367\nscale(elev)-Atelocynus microtis             2.7302 1.0301  328\nscale(elev)-Coendou prehensilis             3.4920 1.0127  428\nscale(elev)-Cuniculus paca                  2.7664 1.0073  999\nscale(elev)-Dasypus sp.                     2.5467 1.0037 1345\nscale(elev)-Didelphis marsupialis           0.4326 1.0121  396\nscale(elev)-Eira barbara                    2.0001 1.0038 1396\nscale(elev)-Leopardus pardalis              1.7916 1.0140 1031\nscale(elev)-Leopardus wiedii                0.7530 1.0153  318\nscale(elev)-Mazama americana                1.9423 1.0055 1144\nscale(elev)-Mazama nemorivaga               3.5104 1.0266 1231\nscale(elev)-Myoprocta pratti                3.8841 1.0108  380\nscale(elev)-Myrmecophaga tridactyla         0.7489 1.0125  574\nscale(elev)-Nasua nasua                     0.4318 1.0090  888\nscale(elev)-Panthera onca                   2.2180 1.0035  976\nscale(elev)-Pecari tajacu                   2.9335 1.0173 1081\nscale(elev)-Priodontes maximus              3.4000 1.0864  235\nscale(elev)-Procyon cancrivorous            0.7483 1.0012  593\nscale(elev)-Puma concolor                   2.0211 1.0012  669\nscale(elev)-Puma yagouaroundi               3.5587 1.0199  428\nscale(elev)-Tamandua tetradactyla           0.7644 1.0163  360\nscale(elev)-Tapirus terrestris              0.7142 1.0052 1182\nscale(elev)-Tayassu pecari                  3.0820 1.0236  600\nscale(border_dist)-Atelocynus microtis      3.0681 1.0103  665\nscale(border_dist)-Coendou prehensilis      2.0094 1.0067  563\nscale(border_dist)-Cuniculus paca           1.3450 1.0070 2337\nscale(border_dist)-Dasypus sp.              2.3422 1.0014 1317\nscale(border_dist)-Didelphis marsupialis    2.2177 1.0050  969\nscale(border_dist)-Eira barbara             2.7146 1.0122 1363\nscale(border_dist)-Leopardus pardalis       0.7584 1.0024 1306\nscale(border_dist)-Leopardus wiedii         1.8606 1.0008  739\nscale(border_dist)-Mazama americana        -0.0718 1.0023 1236\nscale(border_dist)-Mazama nemorivaga        0.7192 1.0003 1705\nscale(border_dist)-Myoprocta pratti         1.0111 1.0031  750\nscale(border_dist)-Myrmecophaga tridactyla  2.8465 1.0072  667\nscale(border_dist)-Nasua nasua              1.3448 1.0034 1414\nscale(border_dist)-Panthera onca            0.6329 1.0087  976\nscale(border_dist)-Pecari tajacu           -0.0550 1.0043 1905\nscale(border_dist)-Priodontes maximus       2.6849 1.0028  723\nscale(border_dist)-Procyon cancrivorous     2.8954 1.0001  652\nscale(border_dist)-Puma concolor            1.7680 1.0044  885\nscale(border_dist)-Puma yagouaroundi        3.0235 1.0274  599\nscale(border_dist)-Tamandua tetradactyla    1.9983 1.0002  686\nscale(border_dist)-Tapirus terrestris       0.4686 1.0045 1936\nscale(border_dist)-Tayassu pecari           1.4780 1.0073 1515\n\nDetection (logit scale): \n                                         Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis       -4.4405 0.7588 -5.8104 -4.4824 -2.8686\n(Intercept)-Coendou prehensilis       -5.3802 0.9849 -7.3969 -5.3953 -3.3256\n(Intercept)-Cuniculus paca            -0.9533 0.0834 -1.1174 -0.9532 -0.7919\n(Intercept)-Dasypus sp.               -1.4662 0.1159 -1.7022 -1.4638 -1.2512\n(Intercept)-Didelphis marsupialis     -3.3439 0.8025 -4.7672 -3.3687 -1.8015\n(Intercept)-Eira barbara              -3.0833 0.3186 -3.7196 -3.0825 -2.4567\n(Intercept)-Leopardus pardalis        -2.9917 0.3579 -3.6902 -2.9966 -2.2959\n(Intercept)-Leopardus wiedii          -4.6174 0.6645 -5.9137 -4.6304 -3.2216\n(Intercept)-Mazama americana          -1.0923 0.1306 -1.3675 -1.0909 -0.8395\n(Intercept)-Mazama nemorivaga         -2.0416 0.1910 -2.4353 -2.0350 -1.6825\n(Intercept)-Myoprocta pratti          -4.5149 0.6162 -5.6305 -4.5668 -3.1764\n(Intercept)-Myrmecophaga tridactyla   -3.3530 0.5333 -4.3170 -3.3747 -2.2722\n(Intercept)-Nasua nasua               -3.3912 0.3491 -4.0484 -3.3981 -2.6981\n(Intercept)-Panthera onca             -3.2311 0.4154 -4.0103 -3.2544 -2.3770\n(Intercept)-Pecari tajacu             -1.4673 0.1016 -1.6608 -1.4642 -1.2727\n(Intercept)-Priodontes maximus        -4.7984 0.6383 -5.9880 -4.8118 -3.4824\n(Intercept)-Procyon cancrivorous      -4.2562 0.6753 -5.4595 -4.2891 -2.7992\n(Intercept)-Puma concolor             -4.4588 0.5167 -5.4253 -4.4832 -3.3623\n(Intercept)-Puma yagouaroundi         -4.8513 0.7546 -6.2570 -4.8935 -3.2299\n(Intercept)-Tamandua tetradactyla     -4.7505 0.7363 -6.1718 -4.7560 -3.2967\n(Intercept)-Tapirus terrestris        -1.2153 0.1086 -1.4386 -1.2130 -1.0112\n(Intercept)-Tayassu pecari            -3.0010 0.3520 -3.6675 -3.0110 -2.3059\nscale(effort)-Atelocynus microtis      0.3731 0.2426 -0.0704  0.3601  0.9107\nscale(effort)-Coendou prehensilis      0.3603 0.2513 -0.1010  0.3521  0.8671\nscale(effort)-Cuniculus paca           0.2255 0.0870  0.0625  0.2226  0.3991\nscale(effort)-Dasypus sp.              0.4005 0.1344  0.1537  0.3950  0.6858\nscale(effort)-Didelphis marsupialis    0.4038 0.2453 -0.0465  0.3881  0.9297\nscale(effort)-Eira barbara             0.4528 0.2206  0.0720  0.4317  0.9413\nscale(effort)-Leopardus pardalis       0.2803 0.1901 -0.0647  0.2685  0.6892\nscale(effort)-Leopardus wiedii         0.3644 0.2474 -0.0896  0.3513  0.9007\nscale(effort)-Mazama americana         0.4210 0.1502  0.1618  0.4076  0.7508\nscale(effort)-Mazama nemorivaga        0.2397 0.1474 -0.0326  0.2341  0.5370\nscale(effort)-Myoprocta pratti         0.3417 0.2390 -0.0950  0.3381  0.8359\nscale(effort)-Myrmecophaga tridactyla  0.4486 0.2451  0.0354  0.4294  0.9885\nscale(effort)-Nasua nasua              0.3807 0.2170 -0.0189  0.3692  0.8461\nscale(effort)-Panthera onca            0.2924 0.2036 -0.0790  0.2832  0.7351\nscale(effort)-Pecari tajacu            0.2255 0.1018  0.0357  0.2223  0.4328\nscale(effort)-Priodontes maximus       0.3645 0.2432 -0.1063  0.3582  0.8731\nscale(effort)-Procyon cancrivorous     0.4057 0.2486 -0.0462  0.3863  0.9549\nscale(effort)-Puma concolor            0.3883 0.2435 -0.0541  0.3723  0.9081\nscale(effort)-Puma yagouaroundi        0.3739 0.2455 -0.0850  0.3602  0.8997\nscale(effort)-Tamandua tetradactyla    0.3524 0.2484 -0.0974  0.3404  0.8888\nscale(effort)-Tapirus terrestris       0.3285 0.1199  0.1130  0.3220  0.5793\nscale(effort)-Tayassu pecari           0.4919 0.2305  0.1009  0.4678  1.0302\n                                        Rhat  ESS\n(Intercept)-Atelocynus microtis       1.0044  267\n(Intercept)-Coendou prehensilis       1.0069  309\n(Intercept)-Cuniculus paca            1.0010 2574\n(Intercept)-Dasypus sp.               1.0099 3000\n(Intercept)-Didelphis marsupialis     1.0332  227\n(Intercept)-Eira barbara              1.0126  840\n(Intercept)-Leopardus pardalis        1.0130  533\n(Intercept)-Leopardus wiedii          1.0143  500\n(Intercept)-Mazama americana          1.0020 2671\n(Intercept)-Mazama nemorivaga         1.0096 1461\n(Intercept)-Myoprocta pratti          1.0033  448\n(Intercept)-Myrmecophaga tridactyla   1.0064  320\n(Intercept)-Nasua nasua               1.0223  643\n(Intercept)-Panthera onca             1.0134  535\n(Intercept)-Pecari tajacu             1.0005 3000\n(Intercept)-Priodontes maximus        1.0003  434\n(Intercept)-Procyon cancrivorous      1.0190  311\n(Intercept)-Puma concolor             1.0036  395\n(Intercept)-Puma yagouaroundi         1.0288  346\n(Intercept)-Tamandua tetradactyla     1.0098  402\n(Intercept)-Tapirus terrestris        0.9998 2795\n(Intercept)-Tayassu pecari            1.0262  438\nscale(effort)-Atelocynus microtis     1.0016 2602\nscale(effort)-Coendou prehensilis     1.0020 2155\nscale(effort)-Cuniculus paca          1.0029 3000\nscale(effort)-Dasypus sp.             1.0006 3000\nscale(effort)-Didelphis marsupialis   1.0002 2294\nscale(effort)-Eira barbara            1.0011 2109\nscale(effort)-Leopardus pardalis      1.0044 2676\nscale(effort)-Leopardus wiedii        1.0094 2266\nscale(effort)-Mazama americana        1.0013 2500\nscale(effort)-Mazama nemorivaga       1.0022 3000\nscale(effort)-Myoprocta pratti        1.0012 2406\nscale(effort)-Myrmecophaga tridactyla 1.0033 2010\nscale(effort)-Nasua nasua             1.0010 2456\nscale(effort)-Panthera onca           1.0020 2681\nscale(effort)-Pecari tajacu           1.0017 3000\nscale(effort)-Priodontes maximus      1.0013 2356\nscale(effort)-Procyon cancrivorous    1.0031 2254\nscale(effort)-Puma concolor           1.0049 2282\nscale(effort)-Puma yagouaroundi       1.0017 2521\nscale(effort)-Tamandua tetradactyla   1.0005 2243\nscale(effort)-Tapirus terrestris      1.0043 2002\nscale(effort)-Tayassu pecari          1.0012 2026\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n        Mean     SD  2.5%    50%  97.5%   Rhat ESS\nphi-1 0.0141 0.0106 4e-04 0.0130 0.0326 0.9999 282\nphi-2 0.0139 0.0106 4e-04 0.0129 0.0329 1.0038 274\nphi-3 0.0153 0.0103 6e-04 0.0149 0.0329 1.0319 435\n\nCodesummary(out.sp, level = 'both')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist), det.formula = ~scale(effort), \n    data = data_list, cov.model = \"exponential\", NNGP = TRUE, \n    n.neighbors = 15, n.factors = 3, n.batch = 600, batch.length = 25, \n    n.report = 100, n.burn = 5000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 15.7012\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%  97.5%   Rhat ESS\n(Intercept)        -0.5986 0.4396 -1.4811 -0.5931 0.2720 1.0023 216\nscale(elev)         0.4410 0.3642 -0.3151  0.4560 1.1427 1.0074 868\nscale(border_dist)  0.2473 0.3049 -0.3499  0.2429 0.8729 1.0005 927\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        1.7132 0.9992 0.4362 1.5149 4.1790 1.0143 324\nscale(elev)        2.0834 1.5233 0.5882 1.7135 5.7258 1.0531 171\nscale(border_dist) 1.1587 0.7896 0.2822 0.9641 3.2363 1.0114 489\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -3.1838 0.3609 -3.9134 -3.1771 -2.4825 1.0078  695\nscale(effort)  0.3580 0.0954  0.1889  0.3521  0.5656 1.0048 1458\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%   50%  97.5%   Rhat  ESS\n(Intercept)   2.4829 0.9910 1.1675 2.285 5.0777 1.0042  830\nscale(effort) 0.0598 0.0376 0.0189 0.050 0.1608 1.0044 1540\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                              Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis            -1.3283 1.3164 -3.8228 -1.3574\n(Intercept)-Coendou prehensilis            -1.3845 1.4559 -4.3295 -1.3296\n(Intercept)-Cuniculus paca                  1.0370 0.3586  0.3890  1.0223\n(Intercept)-Dasypus sp.                     0.0638 0.3508 -0.6252  0.0645\n(Intercept)-Didelphis marsupialis          -2.1036 1.1774 -4.1573 -2.2172\n(Intercept)-Eira barbara                   -0.4971 0.7806 -1.8999 -0.5478\n(Intercept)-Leopardus pardalis             -0.2554 0.9269 -1.7533 -0.3606\n(Intercept)-Leopardus wiedii               -1.0781 1.2522 -3.4275 -1.0732\n(Intercept)-Mazama americana               -1.2196 0.4269 -2.1451 -1.1918\n(Intercept)-Mazama nemorivaga              -0.9292 0.5204 -1.9673 -0.9342\n(Intercept)-Myoprocta pratti               -0.9375 1.2094 -3.2578 -0.9480\n(Intercept)-Myrmecophaga tridactyla        -1.2758 1.0093 -3.1282 -1.3295\n(Intercept)-Nasua nasua                     0.0918 0.9474 -1.4947  0.0165\n(Intercept)-Panthera onca                  -0.7995 0.9200 -2.4250 -0.8305\n(Intercept)-Pecari tajacu                   1.1882 0.4532  0.4286  1.1376\n(Intercept)-Priodontes maximus             -0.4932 1.2705 -2.8470 -0.5427\n(Intercept)-Procyon cancrivorous           -0.9901 1.2734 -3.4610 -1.0334\n(Intercept)-Puma concolor                  -0.0802 1.1964 -2.3561 -0.0886\n(Intercept)-Puma yagouaroundi              -1.0772 1.3256 -3.6719 -1.0718\n(Intercept)-Tamandua tetradactyla          -1.2868 1.3266 -3.8296 -1.2673\n(Intercept)-Tapirus terrestris              0.1428 0.3381 -0.5418  0.1457\n(Intercept)-Tayassu pecari                 -0.4541 0.9059 -1.9944 -0.5390\nscale(elev)-Atelocynus microtis             0.4322 1.1612 -2.0980  0.4340\nscale(elev)-Coendou prehensilis             0.9409 1.2104 -1.2001  0.8566\nscale(elev)-Cuniculus paca                  1.8523 0.4181  1.1252  1.8260\nscale(elev)-Dasypus sp.                     1.5503 0.4567  0.7657  1.5241\nscale(elev)-Didelphis marsupialis          -1.0423 1.0001 -3.4710 -0.8759\nscale(elev)-Eira barbara                    0.7323 0.6324 -0.5051  0.7224\nscale(elev)-Leopardus pardalis              0.3783 0.6571 -0.8725  0.3557\nscale(elev)-Leopardus wiedii               -1.3355 1.2531 -4.1461 -1.2118\nscale(elev)-Mazama americana                0.9937 0.4484  0.1610  0.9738\nscale(elev)-Mazama nemorivaga               1.9941 0.6560  0.9084  1.9187\nscale(elev)-Myoprocta pratti                1.4119 1.1132 -0.4376  1.3019\nscale(elev)-Myrmecophaga tridactyla        -0.5982 0.8454 -2.5506 -0.4879\nscale(elev)-Nasua nasua                    -0.8927 0.7309 -2.4164 -0.8469\nscale(elev)-Panthera onca                   0.6948 0.6943 -0.5960  0.6643\nscale(elev)-Pecari tajacu                   1.8177 0.4840  1.0320  1.7648\nscale(elev)-Priodontes maximus              0.6455 1.4224 -2.3485  0.6983\nscale(elev)-Procyon cancrivorous           -0.8324 0.9238 -3.0274 -0.7357\nscale(elev)-Puma concolor                   0.1694 0.9348 -1.7689  0.1728\nscale(elev)-Puma yagouaroundi               0.9163 1.1708 -1.1791  0.8192\nscale(elev)-Tamandua tetradactyla          -1.2920 1.1548 -3.8160 -1.1857\nscale(elev)-Tapirus terrestris              0.0261 0.3430 -0.6562  0.0267\nscale(elev)-Tayassu pecari                  1.3981 0.7345  0.1614  1.3291\nscale(border_dist)-Atelocynus microtis      1.3385 0.8153 -0.0941  1.2905\nscale(border_dist)-Coendou prehensilis     -0.0550 1.0580 -2.2851 -0.0180\nscale(border_dist)-Cuniculus paca           0.5518 0.3839 -0.1902  0.5438\nscale(border_dist)-Dasypus sp.              1.3815 0.4294  0.6094  1.3509\nscale(border_dist)-Didelphis marsupialis    0.4780 0.7909 -0.9097  0.4270\nscale(border_dist)-Eira barbara             1.3768 0.6078  0.3036  1.3326\nscale(border_dist)-Leopardus pardalis      -0.3364 0.5874 -1.6207 -0.3046\nscale(border_dist)-Leopardus wiedii         0.0866 0.9220 -1.8252  0.0774\nscale(border_dist)-Mazama americana        -0.9033 0.4909 -2.0185 -0.8481\nscale(border_dist)-Mazama nemorivaga       -0.2656 0.5096 -1.3294 -0.2508\nscale(border_dist)-Myoprocta pratti        -0.5401 0.8778 -2.5028 -0.4539\nscale(border_dist)-Myrmecophaga tridactyla  1.2443 0.7076  0.0866  1.1752\nscale(border_dist)-Nasua nasua              0.0647 0.6381 -1.1599  0.0446\nscale(border_dist)-Panthera onca           -0.5753 0.7118 -2.1132 -0.5274\nscale(border_dist)-Pecari tajacu           -0.8969 0.4568 -1.8410 -0.8716\nscale(border_dist)-Priodontes maximus       0.6569 0.9866 -1.2356  0.6167\nscale(border_dist)-Procyon cancrivorous     0.7837 0.9431 -0.8084  0.7078\nscale(border_dist)-Puma concolor            0.1636 0.8268 -1.5388  0.1897\nscale(border_dist)-Puma yagouaroundi        0.7902 1.0262 -1.1618  0.7421\nscale(border_dist)-Tamandua tetradactyla    0.0621 0.9719 -1.8513  0.0638\nscale(border_dist)-Tapirus terrestris      -0.1939 0.3413 -0.8884 -0.1874\nscale(border_dist)-Tayassu pecari           0.3898 0.5419 -0.7280  0.3995\n                                             97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis             1.3669 1.0044  196\n(Intercept)-Coendou prehensilis             1.4189 1.0186  227\n(Intercept)-Cuniculus paca                  1.7895 1.0149 1343\n(Intercept)-Dasypus sp.                     0.7748 1.0004 1456\n(Intercept)-Didelphis marsupialis           0.3057 1.0249  220\n(Intercept)-Eira barbara                    1.1754 1.0225  677\n(Intercept)-Leopardus pardalis              1.9184 1.0114  360\n(Intercept)-Leopardus wiedii                1.4436 1.0166  278\n(Intercept)-Mazama americana               -0.4802 1.0106  834\n(Intercept)-Mazama nemorivaga               0.0697 1.0053 1068\n(Intercept)-Myoprocta pratti                1.5439 1.0030  311\n(Intercept)-Myrmecophaga tridactyla         0.8613 1.0223  295\n(Intercept)-Nasua nasua                     2.2366 1.0535  329\n(Intercept)-Panthera onca                   1.1570 1.0086  449\n(Intercept)-Pecari tajacu                   2.2378 1.0045 1212\n(Intercept)-Priodontes maximus              2.2256 1.0018  284\n(Intercept)-Procyon cancrivorous            1.5828 1.0177  254\n(Intercept)-Puma concolor                   2.4171 1.0263  323\n(Intercept)-Puma yagouaroundi               1.5030 1.0321  272\n(Intercept)-Tamandua tetradactyla           1.3467 1.0154  258\n(Intercept)-Tapirus terrestris              0.8055 1.0018 1511\n(Intercept)-Tayassu pecari                  1.6004 1.0262  367\nscale(elev)-Atelocynus microtis             2.7302 1.0301  328\nscale(elev)-Coendou prehensilis             3.4920 1.0127  428\nscale(elev)-Cuniculus paca                  2.7664 1.0073  999\nscale(elev)-Dasypus sp.                     2.5467 1.0037 1345\nscale(elev)-Didelphis marsupialis           0.4326 1.0121  396\nscale(elev)-Eira barbara                    2.0001 1.0038 1396\nscale(elev)-Leopardus pardalis              1.7916 1.0140 1031\nscale(elev)-Leopardus wiedii                0.7530 1.0153  318\nscale(elev)-Mazama americana                1.9423 1.0055 1144\nscale(elev)-Mazama nemorivaga               3.5104 1.0266 1231\nscale(elev)-Myoprocta pratti                3.8841 1.0108  380\nscale(elev)-Myrmecophaga tridactyla         0.7489 1.0125  574\nscale(elev)-Nasua nasua                     0.4318 1.0090  888\nscale(elev)-Panthera onca                   2.2180 1.0035  976\nscale(elev)-Pecari tajacu                   2.9335 1.0173 1081\nscale(elev)-Priodontes maximus              3.4000 1.0864  235\nscale(elev)-Procyon cancrivorous            0.7483 1.0012  593\nscale(elev)-Puma concolor                   2.0211 1.0012  669\nscale(elev)-Puma yagouaroundi               3.5587 1.0199  428\nscale(elev)-Tamandua tetradactyla           0.7644 1.0163  360\nscale(elev)-Tapirus terrestris              0.7142 1.0052 1182\nscale(elev)-Tayassu pecari                  3.0820 1.0236  600\nscale(border_dist)-Atelocynus microtis      3.0681 1.0103  665\nscale(border_dist)-Coendou prehensilis      2.0094 1.0067  563\nscale(border_dist)-Cuniculus paca           1.3450 1.0070 2337\nscale(border_dist)-Dasypus sp.              2.3422 1.0014 1317\nscale(border_dist)-Didelphis marsupialis    2.2177 1.0050  969\nscale(border_dist)-Eira barbara             2.7146 1.0122 1363\nscale(border_dist)-Leopardus pardalis       0.7584 1.0024 1306\nscale(border_dist)-Leopardus wiedii         1.8606 1.0008  739\nscale(border_dist)-Mazama americana        -0.0718 1.0023 1236\nscale(border_dist)-Mazama nemorivaga        0.7192 1.0003 1705\nscale(border_dist)-Myoprocta pratti         1.0111 1.0031  750\nscale(border_dist)-Myrmecophaga tridactyla  2.8465 1.0072  667\nscale(border_dist)-Nasua nasua              1.3448 1.0034 1414\nscale(border_dist)-Panthera onca            0.6329 1.0087  976\nscale(border_dist)-Pecari tajacu           -0.0550 1.0043 1905\nscale(border_dist)-Priodontes maximus       2.6849 1.0028  723\nscale(border_dist)-Procyon cancrivorous     2.8954 1.0001  652\nscale(border_dist)-Puma concolor            1.7680 1.0044  885\nscale(border_dist)-Puma yagouaroundi        3.0235 1.0274  599\nscale(border_dist)-Tamandua tetradactyla    1.9983 1.0002  686\nscale(border_dist)-Tapirus terrestris       0.4686 1.0045 1936\nscale(border_dist)-Tayassu pecari           1.4780 1.0073 1515\n\nDetection (logit scale): \n                                         Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis       -4.4405 0.7588 -5.8104 -4.4824 -2.8686\n(Intercept)-Coendou prehensilis       -5.3802 0.9849 -7.3969 -5.3953 -3.3256\n(Intercept)-Cuniculus paca            -0.9533 0.0834 -1.1174 -0.9532 -0.7919\n(Intercept)-Dasypus sp.               -1.4662 0.1159 -1.7022 -1.4638 -1.2512\n(Intercept)-Didelphis marsupialis     -3.3439 0.8025 -4.7672 -3.3687 -1.8015\n(Intercept)-Eira barbara              -3.0833 0.3186 -3.7196 -3.0825 -2.4567\n(Intercept)-Leopardus pardalis        -2.9917 0.3579 -3.6902 -2.9966 -2.2959\n(Intercept)-Leopardus wiedii          -4.6174 0.6645 -5.9137 -4.6304 -3.2216\n(Intercept)-Mazama americana          -1.0923 0.1306 -1.3675 -1.0909 -0.8395\n(Intercept)-Mazama nemorivaga         -2.0416 0.1910 -2.4353 -2.0350 -1.6825\n(Intercept)-Myoprocta pratti          -4.5149 0.6162 -5.6305 -4.5668 -3.1764\n(Intercept)-Myrmecophaga tridactyla   -3.3530 0.5333 -4.3170 -3.3747 -2.2722\n(Intercept)-Nasua nasua               -3.3912 0.3491 -4.0484 -3.3981 -2.6981\n(Intercept)-Panthera onca             -3.2311 0.4154 -4.0103 -3.2544 -2.3770\n(Intercept)-Pecari tajacu             -1.4673 0.1016 -1.6608 -1.4642 -1.2727\n(Intercept)-Priodontes maximus        -4.7984 0.6383 -5.9880 -4.8118 -3.4824\n(Intercept)-Procyon cancrivorous      -4.2562 0.6753 -5.4595 -4.2891 -2.7992\n(Intercept)-Puma concolor             -4.4588 0.5167 -5.4253 -4.4832 -3.3623\n(Intercept)-Puma yagouaroundi         -4.8513 0.7546 -6.2570 -4.8935 -3.2299\n(Intercept)-Tamandua tetradactyla     -4.7505 0.7363 -6.1718 -4.7560 -3.2967\n(Intercept)-Tapirus terrestris        -1.2153 0.1086 -1.4386 -1.2130 -1.0112\n(Intercept)-Tayassu pecari            -3.0010 0.3520 -3.6675 -3.0110 -2.3059\nscale(effort)-Atelocynus microtis      0.3731 0.2426 -0.0704  0.3601  0.9107\nscale(effort)-Coendou prehensilis      0.3603 0.2513 -0.1010  0.3521  0.8671\nscale(effort)-Cuniculus paca           0.2255 0.0870  0.0625  0.2226  0.3991\nscale(effort)-Dasypus sp.              0.4005 0.1344  0.1537  0.3950  0.6858\nscale(effort)-Didelphis marsupialis    0.4038 0.2453 -0.0465  0.3881  0.9297\nscale(effort)-Eira barbara             0.4528 0.2206  0.0720  0.4317  0.9413\nscale(effort)-Leopardus pardalis       0.2803 0.1901 -0.0647  0.2685  0.6892\nscale(effort)-Leopardus wiedii         0.3644 0.2474 -0.0896  0.3513  0.9007\nscale(effort)-Mazama americana         0.4210 0.1502  0.1618  0.4076  0.7508\nscale(effort)-Mazama nemorivaga        0.2397 0.1474 -0.0326  0.2341  0.5370\nscale(effort)-Myoprocta pratti         0.3417 0.2390 -0.0950  0.3381  0.8359\nscale(effort)-Myrmecophaga tridactyla  0.4486 0.2451  0.0354  0.4294  0.9885\nscale(effort)-Nasua nasua              0.3807 0.2170 -0.0189  0.3692  0.8461\nscale(effort)-Panthera onca            0.2924 0.2036 -0.0790  0.2832  0.7351\nscale(effort)-Pecari tajacu            0.2255 0.1018  0.0357  0.2223  0.4328\nscale(effort)-Priodontes maximus       0.3645 0.2432 -0.1063  0.3582  0.8731\nscale(effort)-Procyon cancrivorous     0.4057 0.2486 -0.0462  0.3863  0.9549\nscale(effort)-Puma concolor            0.3883 0.2435 -0.0541  0.3723  0.9081\nscale(effort)-Puma yagouaroundi        0.3739 0.2455 -0.0850  0.3602  0.8997\nscale(effort)-Tamandua tetradactyla    0.3524 0.2484 -0.0974  0.3404  0.8888\nscale(effort)-Tapirus terrestris       0.3285 0.1199  0.1130  0.3220  0.5793\nscale(effort)-Tayassu pecari           0.4919 0.2305  0.1009  0.4678  1.0302\n                                        Rhat  ESS\n(Intercept)-Atelocynus microtis       1.0044  267\n(Intercept)-Coendou prehensilis       1.0069  309\n(Intercept)-Cuniculus paca            1.0010 2574\n(Intercept)-Dasypus sp.               1.0099 3000\n(Intercept)-Didelphis marsupialis     1.0332  227\n(Intercept)-Eira barbara              1.0126  840\n(Intercept)-Leopardus pardalis        1.0130  533\n(Intercept)-Leopardus wiedii          1.0143  500\n(Intercept)-Mazama americana          1.0020 2671\n(Intercept)-Mazama nemorivaga         1.0096 1461\n(Intercept)-Myoprocta pratti          1.0033  448\n(Intercept)-Myrmecophaga tridactyla   1.0064  320\n(Intercept)-Nasua nasua               1.0223  643\n(Intercept)-Panthera onca             1.0134  535\n(Intercept)-Pecari tajacu             1.0005 3000\n(Intercept)-Priodontes maximus        1.0003  434\n(Intercept)-Procyon cancrivorous      1.0190  311\n(Intercept)-Puma concolor             1.0036  395\n(Intercept)-Puma yagouaroundi         1.0288  346\n(Intercept)-Tamandua tetradactyla     1.0098  402\n(Intercept)-Tapirus terrestris        0.9998 2795\n(Intercept)-Tayassu pecari            1.0262  438\nscale(effort)-Atelocynus microtis     1.0016 2602\nscale(effort)-Coendou prehensilis     1.0020 2155\nscale(effort)-Cuniculus paca          1.0029 3000\nscale(effort)-Dasypus sp.             1.0006 3000\nscale(effort)-Didelphis marsupialis   1.0002 2294\nscale(effort)-Eira barbara            1.0011 2109\nscale(effort)-Leopardus pardalis      1.0044 2676\nscale(effort)-Leopardus wiedii        1.0094 2266\nscale(effort)-Mazama americana        1.0013 2500\nscale(effort)-Mazama nemorivaga       1.0022 3000\nscale(effort)-Myoprocta pratti        1.0012 2406\nscale(effort)-Myrmecophaga tridactyla 1.0033 2010\nscale(effort)-Nasua nasua             1.0010 2456\nscale(effort)-Panthera onca           1.0020 2681\nscale(effort)-Pecari tajacu           1.0017 3000\nscale(effort)-Priodontes maximus      1.0013 2356\nscale(effort)-Procyon cancrivorous    1.0031 2254\nscale(effort)-Puma concolor           1.0049 2282\nscale(effort)-Puma yagouaroundi       1.0017 2521\nscale(effort)-Tamandua tetradactyla   1.0005 2243\nscale(effort)-Tapirus terrestris      1.0043 2002\nscale(effort)-Tayassu pecari          1.0012 2026\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n        Mean     SD  2.5%    50%  97.5%   Rhat ESS\nphi-1 0.0141 0.0106 4e-04 0.0130 0.0326 0.9999 282\nphi-2 0.0139 0.0106 4e-04 0.0129 0.0329 1.0038 274\nphi-3 0.0153 0.0103 6e-04 0.0149 0.0329 1.0319 435\n\nCode# Create simple plot summaries using MCMCvis package.\n# Detection covariate effects --------- \nMCMCplot(out.sp$alpha.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\nCode# Occupancy community-level effects \nMCMCplot(out.sp$beta.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\nCode# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,23:44], ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\nCode# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,45:66], ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\nBayesian p-values can be inspected to check for lack of fit (overall or by species). Lack of fit at significance level = 0.05 is indicated by Bayesian p-values below 0.025 or greater than 0.975. The overall Bayesian p-value (Bpvalue) indicates no problems with lack of fit. Likewise, species-level Bayesian p-values (Bpvalue_species) indicate no lack of fit for any species.\nDiagnostics\n\nCode# Extract posterior draws for later use\nposterior1 &lt;- as.array(out.sp)\n\n# Trace plots to check chain mixing. Extract posterior samples and bind in a single matrix.\nPOSTERIOR.MATRIX &lt;- cbind(out.sp$alpha.comm.samples, \n                          out.sp$beta.comm.samples,  \n                          out.sp$alpha.samples, \n                          out.sp$beta.samples)\n\n# Matrix output is all chains combined, split into 3 chains.\nCHAIN.1 &lt;- as.mcmc(POSTERIOR.MATRIX[1:1000,])\nCHAIN.2 &lt;- as.mcmc(POSTERIOR.MATRIX[1001:2000,])\nCHAIN.3 &lt;- as.mcmc(POSTERIOR.MATRIX[2001:3000,])\n# CHAIN.4 &lt;- as.mcmc(POSTERIOR.MATRIX[8001:10000,])\n\n# Bind four chains as coda mcmc.list object.\nPOSTERIOR.CHAINS &lt;- mcmc.list(CHAIN.1, CHAIN.2, CHAIN.3)#, CHAIN.4)\n\n# Create an empty folder.\n# dir.create (\"Beetle_plots\")\n\n# Plot chain mixing of each parameter to a multi-panel plot and save to the new folder. ART 5 mins\nMCMCtrace(POSTERIOR.CHAINS, params = \"all\", Rhat = TRUE, n.eff = TRUE)#, pdf = TRUE, filename = \"Beetle_240909_traceplots.pdf\", wd = \"Beetle_plots\")\n\n\n\n#mcmc_trace(fit.commu, parms = c(\"beta.ranef.cont.border_dist.mean\"))\n\n#posterior2 &lt;- extract(fit.commu, inc_warmup = TRUE, permuted = FALSE)\n\n#color_scheme_set(\"mix-blue-pink\")\n#p &lt;- mcmc_trace(posterior1,  pars = c(\"mu\", \"tau\"), n_warmup = 300,\n#                facet_args = list(nrow = 2, labeller = label_parsed))\n#p + facet_text(size = 15)\n\n\n\n#outMCMC &lt;- fit.commu #Convert output to MCMC object\n#diagnostics chains \n\n# all as pdf\n# MCMCtrace(outMCMC)\n\n# MCMCtrace(outMCMC, params = c(\"alpha0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(out.sp, params = c(\"beta.ranef.cont.border_dist.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n\n### density\n# MCMCtrace(outMCMC, params = c(\"Nspecies\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n#MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n#coda::gelman.diag(outMCMC,  multivariate = FALSE, transform=FALSE)\n                    \n# coda::gelman.plot(outMCMC,  multivariate = FALSE)\n\n\nlibrary(bayesplot)\n#mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n# mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n\nmcmc_intervals(out.sp$beta.samples[,23:44] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,45:66] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\nCode# \n# mcmc_intervals(outMCMC, pars = c(\"Nspecies_in_AP[1]\",\n#                                  \"Nspecies_in_AP[2]\"),\n#                point_est = \"mean\",\n#                prob = 0.75, prob_outer = 0.95) +\n#   ggtitle(\"Number of species\") + \n#   scale_y_discrete(labels = c(\"Nspecies_in_AP[1]\"=levels(sitecovs$in_AP)[1],\n#              \"Nspecies_in_AP[2]\"=levels(sitecovs$in_AP)[2]))\n# \n# #Continuous\n# p &lt;- mcmc_intervals(outMCMC, \n#                pars = c(\"beta.ranef.cont.border_dist.mean\",\n#                          #\"beta.ranef.cont.elev.mean\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"))\n# \n# # relabel parameters\n# p + scale_y_discrete(\n#   labels = c(\"beta.ranef.cont.border_dist.mean\"=\"Dist_border\",\n#                          #\"beta.ranef.cont.elev.mean\"=\"Elevation\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"=\"in_AP\")\n# ) +\n#   ggtitle(\"Treatment effect on all species\")\n# \n\n\n\nGelman and Rubin’s convergence diagnostic: Approximate convergence is diagnosed when the upper limit is close to 1.\n\nConvergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable. The gelman.diag diagnostic is applied to a single variable from the chain. It is based a comparison of within-chain and between-chain variances, and is similar to a classical analysis of variance.\nValues substantially above 1 indicate lack of convergence.\nPrediction as graph\nThis prediction uses ther non spatial model\n\nCode# 6. Prediction -----------------------------------------------------------\n# Predict occupancy along a gradient of elev   \n# Create a set of values across the range of observed elev values\nelev.pred.vals &lt;- seq(min(data_list$occ.covs$elev), \n                              max(data_list$occ.covs$elev), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nelev.pred.vals.scale &lt;- (elev.pred.vals - mean(data_list$occ.covs$elev)) / \n                             sd(data_list$occ.covs$elev)\n# Create a set of values across the range of observed elev values\nborder_dist.pred.vals &lt;- seq(min(data_list$occ.covs$border_dist), \n                              max(data_list$occ.covs$border_dist), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nborder_dist.pred.vals.scale &lt;- (border_dist.pred.vals -\n                                  mean(data_list$occ.covs$border_dist)) /\n                                  sd(data_list$occ.covs$border_dist)\n\n# Predict occupancy across elev  values at mean values of all other variables\npred.df1 &lt;- as.matrix(data.frame(intercept = 1, elev = elev.pred.vals.scale, \n                         border_dist = 0 ))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df2 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = border_dist.pred.vals.scale ))#, catchment = 0, density = 0, \n                         # slope = 0))\n\nout.pred1 &lt;- predict(out, pred.df1) # using non spatial\nstr(out.pred1)\npsi.0.quants &lt;- apply(out.pred1$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           elev = elev.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(elev.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = elev, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'elevation (m)', y = 'Occupancy Probability') \n\n\nout.pred2 &lt;- predict(out, pred.df2) # using non spatial\nstr(out.pred2)\npsi.0.quants &lt;- apply(out.pred2$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           border_dist = border_dist.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(border_dist.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = border_dist, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'border_dist (m)', y = 'Occupancy Probability') \n\n\nSpatial Prediction\n\nCode#aggregate  resolution to (factor = 3)\nelevation_17.aggregate &lt;- aggregate(elevation_17, fact=10)\nres(elevation_17.aggregate)\n\n# Convert the SpatRaster to a data frame with coordinates\ndf_coords &lt;- as.data.frame(elevation_17.aggregate, xy = TRUE)\nnames(df_coords) &lt;-c(\"X\",\"Y\",\"elev\")\n\nelev.pred &lt;- (df_coords$elev - mean(data_list$occ.covs$elev)) / sd(data_list$occ.covs$elev)\n\nX.0 &lt;- cbind(1, 1, elev.pred)#, elev.pred^2)\n# coords.0 &lt;- as.matrix(hbefElev[, c('Easting', 'Northing')])\nout.sp.ms.pred &lt;- predict(out.sp, X.0, df_coords[,1:2])\n\n\n\n\n# Producing an SDM for all (posterior mean)\nplot.dat &lt;- data.frame(x = df_coords$X, \n                       y = df_coords$Y, \n                       mean.psi = apply(out.sp.ms.pred$psi.0.samples, c(2,3), mean)[1:5202], \n                       sd.psi = apply(out.sp.ms.pred$psi.0.samples, c(2,3), sd)[1:5202])\n\nlibrary(stars)\ndat.stars &lt;- st_as_stars(plot.dat, dims = c('x', 'y'))\nggplot() + \n  geom_stars(data = dat.stars, aes(x = x, y = y, fill = mean.psi)) +\n  scale_fill_viridis_c(na.value = 'transparent') + \n  labs(x = 'Easting', y = 'Northing', fill = '', \n       title = 'Mean OVEN occurrence probability using intPGOcc') +\n  theme_bw()"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#package-citation",
    "href": "blog/2025-10-15-analysis/index.html#package-citation",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: abind v. 1.4.8 (Plate and Heiberger 2024), bayesplot v. 1.11.1 (Gabry et al. 2019; Gabry and Mahr 2024), beepr v. 2.0 (Bååth 2024), camtrapR v. 2.3.1 (Niedballa et al. 2016), coda v. 0.19.4.1 (Plummer et al. 2006), DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), MCMCvis v. 0.16.3 (Youngflesh 2018), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), snow v. 0.4.4 (Tierney et al. 2021), snowfall v. 1.84.6.3 (Knaus 2023), spOccupancy v. 0.8.0 (Doser et al. 2022, 2024; Doser, Finley, and Banerjee 2023), terra v. 1.8.60 (Hijmans 2025), tictoc v. 1.2.1 (Izrailev 2024), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018)."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#sesion-info",
    "href": "blog/2025-10-15-analysis/index.html#sesion-info",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: internal\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] abind_1.4-8       lubridate_1.9.4   forcats_1.0.0     stringr_1.5.2    \n [5] dplyr_1.1.4       purrr_1.1.0       readr_2.1.5       tidyr_1.3.1      \n [9] tibble_3.2.1      ggplot2_4.0.0     tidyverse_2.0.0   spOccupancy_0.8.0\n[13] camtrapR_2.3.1    snowfall_1.84-6.3 snow_0.4-4        beepr_2.0        \n[17] coda_0.19-4.1     MCMCvis_0.16.3    tictoc_1.2.1      bayesplot_1.11.1 \n[21] elevatr_0.99.0    terra_1.8-60      tmap_4.2          maps_3.4.3       \n[25] mapview_2.11.4    sf_1.0-21         DT_0.34.0         readxl_1.4.3     \n[29] grateful_0.3.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3      tensorA_0.36.2.1        rstudioapi_0.17.1      \n  [4] audio_0.1-11            jsonlite_2.0.0          wk_0.9.4               \n  [7] magrittr_2.0.3          farver_2.1.2            nloptr_2.1.1           \n [10] rmarkdown_2.29          vctrs_0.6.5             minqa_1.2.8            \n [13] base64enc_0.1-3         RcppNumerical_0.6-0     htmltools_0.5.8.1      \n [16] leafsync_0.1.0          progress_1.2.3          distributional_0.5.0   \n [19] curl_7.0.0              raster_3.6-32           cellranger_1.1.0       \n [22] s2_1.1.9                sass_0.4.10             bslib_0.9.0            \n [25] slippymath_0.3.1        KernSmooth_2.23-24      htmlwidgets_1.6.4      \n [28] plyr_1.8.9              cachem_1.1.0            stars_0.6-8            \n [31] uuid_1.2-1              lifecycle_1.0.4         iterators_1.0.14       \n [34] pkgconfig_2.0.3         cols4all_0.8-1          Matrix_1.7-1           \n [37] R6_2.6.1                fastmap_1.2.0           digest_0.6.37          \n [40] colorspace_2.1-1        leafem_0.2.4            crosstalk_1.2.1        \n [43] labeling_0.4.3          lwgeom_0.2-14           progressr_0.15.0       \n [46] spacesXYZ_1.6-0         timechange_0.3.0        httr_1.4.7             \n [49] mgcv_1.9-1              compiler_4.4.2          microbenchmark_1.5.0   \n [52] proxy_0.4-27            withr_3.0.2             doParallel_1.0.17      \n [55] backports_1.5.0         brew_1.0-10             S7_0.2.0               \n [58] DBI_1.2.3               logger_0.4.0            MASS_7.3-61            \n [61] maptiles_0.10.0         tmaptools_3.3           leaflet_2.2.3          \n [64] classInt_0.4-11         tools_4.4.2             units_0.8-7            \n [67] leaflegend_1.2.1        glue_1.8.0              satellite_1.0.5        \n [70] nlme_3.1-166            grid_4.4.2              checkmate_2.3.2        \n [73] reshape2_1.4.4          generics_0.1.3          leaflet.providers_2.0.0\n [76] gtable_0.3.6            tzdb_0.4.0              class_7.3-22           \n [79] data.table_1.17.8       hms_1.1.3               sp_2.2-0               \n [82] RANN_2.6.2              foreach_1.5.2           pillar_1.11.1          \n [85] posterior_1.6.1         splines_4.4.2           lattice_0.22-6         \n [88] tidyselect_1.2.1        knitr_1.50              svglite_2.1.3          \n [91] stats4_4.4.2            xfun_0.52               leafpop_0.1.0          \n [94] stringi_1.8.4           rematch_2.0.0           yaml_2.3.10            \n [97] boot_1.3-31             evaluate_1.0.4          codetools_0.2-20       \n[100] cli_3.6.5               RcppParallel_5.1.9      systemfonts_1.1.0      \n[103] jquerylib_0.1.4         secr_5.1.0              dichromat_2.0-0.1      \n[106] Rcpp_1.1.0              spAbundance_0.2.1       png_0.1-8              \n[109] XML_3.99-0.18           parallel_4.4.2          prettyunits_1.2.0      \n[112] lme4_1.1-35.5           mvtnorm_1.3-2           scales_1.4.0           \n[115] e1071_1.7-16            crayon_1.5.3            rlang_1.1.6"
  }
]