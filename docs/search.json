[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Occupancy in Protected Areas",
    "section": "",
    "text": "We want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border. We used a multispecies occupancy model incorporating spatial autocorrelation, to asses occupancy as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index (FLII) as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe problem we want to asses\n\n\n\nmodel\n\n\n\n\nAug 20, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nFitting a Spatial Factor Multi-Species Occupancy Model\n\n\n\nmodel\n\ncode\n\nanalysis\n\n\n\n\nAug 16, 2025\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html",
    "href": "blog/2025-10-10-the-model/index.html",
    "title": "The problem we want to asses",
    "section": "",
    "text": "Codelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\nlibrary(unmarked) # Models for Data from Unmarked Animals\nlibrary(ubms) # Bayesian Models for Data from Unmarked Animals using 'Stan'\n\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'\nWe want to Asses the role of Protected Areas (PA) in the conservation of vertebrates using on the ground data.\nEvaluating whether PA are working is essential as they are perhaps the primary strategy for averting biodiversity loss. Its been suggested that some do no work, paper parks Its crucial to continue working on best methods to evaluate their impact.\nOver a decade ago researchers started evaluating role of PA, mostly focused on the effects of PA in reducing threats (fires, deforestation) and focused on forest cover. However assessments of PA on species comparing inside vs outside is not a common practice.\nEven if we are effective in protecting forests, and the forest is in very good condition, PA could have “empty forests” and loosed biodiversity (by hunting-poaching, diseases or introduced species). So when we say a PA is effective, are we looking at this?\nWe want to compare apples with apples and control for covariates related with occupancy and abundance of species, like elevation, human pressures, ecosystem type, etc.\nOccupancy is a cost effective method for evaluation a population, it is a state variable, representing the proportion of the area occupied by the species, solving the problem of imperfect detection.\nWe compiled camera trap deployment data sets that have intentionally sampled inside and outside PAS, in a quasi-experimental design, using camera traps.\nEach case each camera is adequately matched, in a similar fashion as the remote sensing approaches.\nWe used a multispecies occupancy model, and a variation incorporating spatial autocorrelation, to compare occupancy inside and outside the PA and also as a distance to the protected area border."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#package-citation",
    "href": "blog/2025-10-10-the-model/index.html#package-citation",
    "title": "The problem we want to asses",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), terra v. 1.8.70 (Hijmans 2025), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018), ubms v. 1.2.8 (Kellner et al. 2021), unmarked v. 1.5.1 (Fiske and Chandler 2011; Kellner et al. 2023)."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#sesion-info",
    "href": "blog/2025-10-10-the-model/index.html#sesion-info",
    "title": "The problem we want to asses",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] lubridate_1.9.4 forcats_1.0.0   stringr_1.5.2   dplyr_1.1.4    \n [5] purrr_1.1.0     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n [9] ggplot2_4.0.0   tidyverse_2.0.0 ubms_1.2.8      unmarked_1.5.1 \n[13] elevatr_0.99.0  terra_1.8-70    tmap_4.2        maps_3.4.3     \n[17] mapview_2.11.4  sf_1.0-21       DT_0.34.0       readxl_1.4.3   \n[21] grateful_0.3.0 \n\nloaded via a namespace (and not attached):\n [1] DBI_1.2.3            pbapply_1.7-2        gridExtra_2.3       \n [4] tmaptools_3.3        s2_1.1.9             inline_0.3.20       \n [7] logger_0.4.0         rlang_1.1.6          magrittr_2.0.3      \n[10] matrixStats_1.5.0    e1071_1.7-16         compiler_4.4.2      \n[13] loo_2.8.0            png_0.1-8            vctrs_0.6.5         \n[16] pkgconfig_2.0.3      wk_0.9.4             fastmap_1.2.0       \n[19] lwgeom_0.2-14        leafem_0.2.4         rmarkdown_2.30      \n[22] tzdb_0.4.0           spacesXYZ_1.6-0      xfun_0.52           \n[25] satellite_1.0.5      jsonlite_2.0.0       parallel_4.4.2      \n[28] R6_2.6.1             stringi_1.8.4        RColorBrewer_1.1-3  \n[31] StanHeaders_2.32.10  cellranger_1.1.0     stars_0.6-8         \n[34] Rcpp_1.1.0           rstan_2.32.7         knitr_1.50          \n[37] base64enc_0.1-3      timechange_0.3.0     Matrix_1.7-1        \n[40] tidyselect_1.2.1     rstudioapi_0.17.1    dichromat_2.0-0.1   \n[43] abind_1.4-8          yaml_2.3.10          maptiles_0.10.0     \n[46] codetools_0.2-20     curl_7.0.0           pkgbuild_1.4.8      \n[49] lattice_0.22-6       leafsync_0.1.0       withr_3.0.2         \n[52] S7_0.2.0             evaluate_1.0.4       units_0.8-7         \n[55] proxy_0.4-27         RcppParallel_5.1.9   pillar_1.11.1       \n[58] KernSmooth_2.23-24   stats4_4.4.2         generics_0.1.3      \n[61] sp_2.2-0             hms_1.1.3            rstantools_2.5.0    \n[64] scales_1.4.0         class_7.3-22         glue_1.8.0          \n[67] tools_4.4.2          leaflegend_1.2.1     data.table_1.17.8   \n[70] RSpectra_0.16-2      XML_3.99-0.18        grid_4.4.2          \n[73] QuickJSR_1.4.0       crosstalk_1.2.1      colorspace_2.1-1    \n[76] cols4all_0.8-1       raster_3.6-32        cli_3.6.5           \n[79] V8_6.0.0             gtable_0.3.6         digest_0.6.37       \n[82] progressr_0.15.0     classInt_0.4-11      htmlwidgets_1.6.4   \n[85] farver_2.1.2         htmltools_0.5.8.1    lifecycle_1.0.4     \n[88] leaflet_2.2.3        microbenchmark_1.5.0 MASS_7.3-61"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html",
    "href": "blog/2025-10-15-analysis/index.html",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "href": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Multi-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables.\n\nCodelibrary(grateful)\nlibrary(readxl)\nlibrary(DT)\nlibrary(sf)\nlibrary(mapview)\nlibrary(maps)\nlibrary(tmap)\nlibrary(terra)\nlibrary(elevatr)\n#library(spOccupancy)\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis)\nlibrary(coda)\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR)\nlibrary(spOccupancy)\nlibrary(tidyverse)"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "href": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Fitting a Multi-Species Spatial Occupancy Model",
    "text": "Fitting a Multi-Species Spatial Occupancy Model\nWe use a more computationally efficient approach for fitting spatial multi-species occupancy models. This alternative approach is called a “spatial factor multi-species occupancy model”, and is described in depth in Doser, Finley, and Banerjee (2023). This newer approach also accounts for residual species correlations (i.e., it is a joint species distribution model with imperfect detection). The simulation results from Doser, Finley, and Banerjee (2023) show that this new alternative approach outperforms, or performs equally to spMsPGOcc(), while being substantially faster.\nThe Latent factor multi-species occupancy model is described in detail here\nData from Plantas Medicinales Putumayo\nHere we use the table: - COL-18-Putumayo2023\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_PlantasMed &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PlantasMedicinales/WDPA_WDOECM_May2025_Public_555511938_shp-polygons.shp\")\n\n### Ecu 17, Ecu 18, ECU 20, Ecu 22  \n\n# load data and make array_locID column\nCol_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\") |&gt; mutate(array_locID=paste(\"Col_18\", locationID, sep=\"_\"))\n\n60 cameras in Cameras. \n 60 cameras in Deployment. \n 60 deployments in Deployment. \n 60 points in Deployment. \n 51 cameras in Images. \n 51 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2024 \n Jaguar_Design: no year: 2023 \n Jaguar_Design: no \n\nCode# get sites\nCol_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\")\n\n\n\n# get elevation map\nelevation_18 &lt;- rast(get_elev_raster(Col_18_sites, z = 10)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Col_18_sites &lt;- cbind(Col_18_sites, terra::extract(elevation_18, Col_18_sites))\n# covs_Col_17_sites &lt;- cbind(Col_17_sites, terra::extract(elevation_17, Col_17_sites))\n\n\n# get which are in and out\ncovs_Col_18_sites$in_AP = st_intersects(covs_Col_18_sites, AP_PlantasMed, sparse = FALSE)\n# covs_Col_17_sites$in_AP = st_intersects(covs_Col_17_sites, AP_Yasuni, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_18, alpha=0.5) + \n  mapview (AP_PlantasMed, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Col_18_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) \n\n\n\n\nCode  # mapview (covs_Col_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n\n\nData fom Bajo Madidi and Heath\nHere we use the tables: - BOL-008a - BOL-008b - BOL14a - BOL14b\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nArea_Madidi &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Area_Madidi/WDPA_WDOECM_Jul2025_Public_303894_shp-polygons.shp\")\n\nMadidi_NP &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Madidi_NP/WDPA_WDOECM_Jul2025_Public_98183_shp-polygons.shp\")\n#AP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\n#Bol_Pacaya &lt;- read_excel(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\", sheet = \"Image\")\n\n\nBol_Madidi_1 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-008a.xlsx\") |&gt; mutate(Point.x=as.character(paste(\"M1\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M1\",Point.y, sep = \"-\")))\n\n65 cameras in Cameras. \n 61 cameras in Deployment. \n 61 deployments in Deployment. \n 31 points in Deployment. \n 61 cameras in Images. \n 31 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2005 \n Jaguar_Design: yes \n\nCodeBol_Madidi_2 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-008b.xlsx\") |&gt; mutate(Point.x=as.character(paste(\"M2\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M2\",Point.y, sep = \"-\")))\n\n60 cameras in Cameras. \n 52 cameras in Deployment. \n 52 deployments in Deployment. \n 30 points in Deployment. \n 51 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2005 \n Jaguar_Design: yes \n\nCodeBol_Madidi_3 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-014a.xlsx\")|&gt; mutate(Point.x=as.character(paste(\"M3\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M3\",Point.y, sep = \"-\")))\n\n47 cameras in Cameras. \n 44 cameras in Deployment. \n 44 deployments in Deployment. \n 26 points in Deployment. \n 44 cameras in Images. \n 26 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2009 \n Jaguar_Design: yes \n\nCodeBol_Madidi_4 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-014b.xlsx\")|&gt; mutate(Point.x=as.character(paste(\"M4\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M1\",Point.y, sep = \"-\")))\n\n29 cameras in Cameras. \n 22 cameras in Deployment. \n 22 deployments in Deployment. \n 15 points in Deployment. \n 22 cameras in Images. \n 15 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2009 \n Jaguar_Design: yes \n\nCode# get sites\nBol_Madidi_sites1 &lt;-  Bol_Madidi_1 |&gt; \n   dplyr::bind_rows(Bol_Madidi_2) |&gt; \n   dplyr::bind_rows(Bol_Madidi_3) |&gt; \n   dplyr::bind_rows(Bol_Madidi_4) |&gt; \n  select(\"Latitude\", \"Longitude\", \"Point.x\" \n) |&gt; dplyr::distinct( )  \n\nBol_Madidi_sites &lt;- sf::st_as_sf(Bol_Madidi_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Bol_Madidi_sites) &lt;- 4326\n\n\n# get elevation map\nelevation_17 &lt;- rast(get_elev_raster(Bol_Madidi_sites, z = 9)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n# extract covs using points and add to _sites\ncovs_Bol_Madidi_sites &lt;- cbind(Bol_Madidi_sites, terra::extract(elevation_17, Bol_Madidi_sites))\n# covs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_17, Ecu_17_sites))\n\n\n# get which are in and out\ncovs_Bol_Madidi_sites$in_AP = st_intersects(covs_Bol_Madidi_sites, Madidi_NP, sparse = FALSE)\n# covs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Machalilla, sparse = FALSE)\n\n\n# make a map\nmapview (elevation_17, alpha=0.7) + \n  mapview (Madidi_NP, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (Area_Madidi, color = \"yellow\", col.regions = \"yellow\", alpha = 0.5) +\n  #mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Bol_Madidi_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) \n\n\n\n\n\nTamshiyacu Tahuayo data\nHere we use the tables: - PER-003_BD_ACRCTT_T0.xlsx - PER-002_BD_ACRTT-PILOTO.xlsx\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Pacaya &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PacayaSamiria/WDPA_WDOECM_Jun2025_Public_249_shp-polygons.shp\")\n\nAP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\nPer_Tahuayo_piloto &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-002_BD_ACRTT-PILOTO.xlsx\")\n\n50 cameras in Cameras. \n 50 cameras in Deployment. \n 50 deployments in Deployment. \n 50 points in Deployment. \n 50 cameras in Images. \n 50 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodePer_Tahuayo &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n85 cameras in Cameras. \n 84 cameras in Deployment. \n 84 deployments in Deployment. \n 84 points in Deployment. \n 84 cameras in Images. \n 84 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeFLII2016 &lt;- rast(\"C:/CodigoR/WCS_2024/FLI/raster/FLII_final/FLII_2016.tif\")\n\n# get sites\n# Per_Pacaya_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n# get sites\nPer_Tahuayo_sites1 &lt;- Per_Tahuayo |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_sites &lt;- sf::st_as_sf(Per_Tahuayo_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_sites) &lt;- 4326\n\n\n\n# get Pacaya sites\nPer_Tahuayo_piloto_sites1 &lt;- Per_Tahuayo_piloto |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_piloto_sites &lt;- sf::st_as_sf(Per_Tahuayo_piloto_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_piloto_sites) &lt;- 4326\n\n\n\n\n# get elevation map\nelevation_PE &lt;- rast(get_elev_raster(Per_Tahuayo_sites, z = 10)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_sites &lt;- cbind(Per_Tahuayo_sites,\n                                terra::extract(elevation_PE,\n                                               Per_Tahuayo_sites)\n                                )\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_piloto_sites &lt;- cbind(Per_Tahuayo_piloto_sites, terra::extract(elevation_PE, Per_Tahuayo_piloto_sites))\n\n\n\n# get which are in and out\ncovs_Per_Tahuayo_sites$in_AP = st_intersects(covs_Per_Tahuayo_sites, AP_Tahuayo, sparse = FALSE)\n\ncovs_Per_Tahuayo_piloto_sites$in_AP = st_intersects(covs_Per_Tahuayo_piloto_sites, AP_Tahuayo, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_PE, alpha=0.5) + \n  mapview (AP_Pacaya, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Per_Tahuayo_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +   \n  mapview (covs_Per_Tahuayo_piloto_sites, \n           zcol = \"in_AP\", \n           col.regions =c(\"blue\"), \n           burst = TRUE) \n\n\n\n\n\nYasuni data\nHere we use the tables Ecu-13, Ecu-17, Ecu-18 y Ecu-20\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Yasuni &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Yasuni/WDPA_WDOECM_May2025_Public_186_shp-polygons.shp\")\n\n### Ecu 17, Ecu 18, ECU 20, Ecu 22  \n\n# load data and make array_locID column\nEcu_13 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_13\", locationID, sep=\"_\"))\n\n28 cameras in Cameras. \n 28 cameras in Deployment. \n 28 deployments in Deployment. \n 28 points in Deployment. \n 28 cameras in Images. \n 28 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_17 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_17\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_18\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeEcu_20 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_20\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 25 cameras in Deployment. \n 25 deployments in Deployment. \n 25 points in Deployment. \n 25 cameras in Images. \n 25 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# Ecu_21 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_14\", locationID, sep=\"_\"))\nEcu_22 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_22\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# get sites\nEcu_13_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\")\nEcu_17_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\")\nEcu_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")\nEcu_20_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")\n# Ecu_21_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\")\nEcu_22_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")\n\n\n\n\n# get elevation map\nelevation_EC &lt;- rast(get_elev_raster(Ecu_17_sites, z = 7)) #z =1-14\nbb &lt;-  st_as_sfc(st_bbox(elevation_EC)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Ecu_13_sites &lt;- cbind(Ecu_13_sites, terra::extract(elevation_EC, Ecu_13_sites))\ncovs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_EC, Ecu_17_sites))\ncovs_Ecu_18_sites &lt;- cbind(Ecu_18_sites, terra::extract(elevation_EC, Ecu_18_sites))\ncovs_Ecu_20_sites &lt;- cbind(Ecu_20_sites, terra::extract(elevation_EC, Ecu_20_sites))\n#covs_Ecu_21_sites &lt;- cbind(Ecu_21_sites, terra::extract(elevation_17, Ecu_21_sites))\ncovs_Ecu_22_sites &lt;- cbind(Ecu_22_sites, terra::extract(elevation_EC, Ecu_22_sites))\n\n# get which are in and out\ncovs_Ecu_13_sites$in_AP = st_intersects(covs_Ecu_13_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_18_sites$in_AP = st_intersects(covs_Ecu_18_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_20_sites$in_AP = st_intersects(covs_Ecu_20_sites, AP_Yasuni, sparse = FALSE)\n#covs_Ecu_21_sites$in_AP = st_intersects(covs_Ecu_21_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_22_sites$in_AP = st_intersects(covs_Ecu_22_sites, AP_Yasuni, sparse = FALSE)\n\n# covs_Ecu_16_sites$in_AP = st_intersects(covs_Ecu_16_sites, AP_Llanganates, sparse = FALSE)\n\n\n\n# make a map\nmapview (elevation_EC, alpha=0.5) + \n  mapview (AP_Yasuni, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Ecu_13_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  mapview (covs_Ecu_18_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_20_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n#  mapview (covs_Ecu_21_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_22_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"red\") ) #+\n\n\n\n\nCode  # mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\nCamera trap operation data and detection history\n\nCode# Join 3 tables\n# fix count in ECU 13, 17, 22,\nEcu_13$Count &lt;- as.character(Ecu_13$Count)\nEcu_17$Count &lt;- as.character(Ecu_17$Count)\nEcu_22$Count &lt;- as.character(Ecu_22$Count)\n\nEcu_full &lt;- Ecu_13 |&gt; full_join(Ecu_17) |&gt; \n                      full_join(Ecu_18) |&gt; \n                      full_join(Ecu_20) |&gt; \n#                      full_join(Ecu_21) |&gt; \n                      full_join(Ecu_22)\n\n###### Bolivia\n\nBol_full &lt;- Bol_Madidi_1  |&gt; \n   full_join(Bol_Madidi_2) |&gt; \n   full_join(Bol_Madidi_3) |&gt; \n   full_join(Bol_Madidi_4) \n# change camera Id by point. two cameras in one\nBol_full &lt;- Bol_full |&gt; mutate(Camera_Id=Point.x)\n\n\n# Ecu_18$Count &lt;- as.numeric(Ecu_18$Count)\nPer_Tahuayo_piloto$Longitude &lt;- as.numeric(Per_Tahuayo_piloto$Longitude)\nPer_Tahuayo_piloto$Latitude &lt;- as.numeric(Per_Tahuayo_piloto$Latitude)\n\n\nPer_full &lt;- Per_Tahuayo|&gt; \n  full_join(Per_Tahuayo_piloto) #|&gt; \n                      # full_join(Ecu_18) |&gt; \n                      # full_join(Ecu_20) |&gt; \n                      # full_join(Ecu_21) |&gt; \n                      # full_join(Ecu_22)\n\n# rename camera id\n# Per_full$camid &lt;- Per_full$`Camera_Id`\n\nEcu_full$Count &lt;- as.numeric(Ecu_full$Count)\nPer_full$Count &lt;- as.numeric(Per_full$Count)\n\nEcu_full &lt;- Ecu_full[,-47]\nCol_18 &lt;- Col_18[,-47]\n##################################\ndata_full &lt;- rbind(Ecu_full, \n                   Per_full,\n                   Bol_full,\n                   Col_18)\n\n\n# fix date format\n# \n# Formatting a Date object\ndata_full$start_date &lt;- as.Date(data_full$\"start_date\", \"%Y/%m/%d\")\ndata_full$start_date &lt;- format(data_full$start_date, \"%Y-%m-%d\")\n\ndata_full$end_date &lt;- as.Date(data_full$\"end_date\", \"%Y/%m/%d\")\ndata_full$end_date &lt;- format(data_full$end_date, \"%Y-%m-%d\")\n\ndata_full$eventDate &lt;- as.Date(data_full$\"Date_Time_Captured\", \"%Y/%m/%d\")\ndata_full$eventDate &lt;- format(data_full$eventDate, \"%Y-%m-%d\")\n\n# Per_full$eventDateTime &lt;- ymd_hms(paste(Per_full$\"photo_date\", Per_full$\"photo_time\", sep=\" \"))\ndata_full$eventDateTime &lt;- ymd_hms(data_full$\"Date_Time_Captured\")\n\n###############################\n# remove duplicated cameras\n################################\nind1 &lt;- which(data_full$Camera_Id==\"ECU-020-C0027\")\nind2 &lt;- which(data_full$Camera_Id==\"ECU-020-C0006\")\ndata_full &lt;- data_full[-ind1,]\ndata_full &lt;- data_full[-ind2,]\n\n\n# filter 2021 and make uniques\nCToperation  &lt;- data_full |&gt; dplyr::group_by(Camera_Id) |&gt; #(array_locID) |&gt; \n                           mutate(minStart=start_date, maxEnd=end_date) |&gt; distinct(Longitude, Latitude, minStart, maxEnd) |&gt; dplyr::ungroup()\n# remove one duplicated\n# View(CToperation)\n# CToperation &lt;- CToperation[-15,]\n\n# M3-19: M3-21: M4-10: M4-12: M4-18:  From Madidi\nCToperation &lt;- CToperation[-c(379, 373, 365, 362, 357),]\n\n\nCToperation[231,3] &lt;- \"-4.482831\" #Latitude\nCToperation[93,3] &lt;- \"-0.5548211\" #Latitude\nCToperation[93,2] &lt;- \"-76.48333\"\n\n### remove duplicated\n# View(as.data.frame(table(CToperation$Latitude)))\n# View(as.data.frame(table(CToperation$Longitude)))\n# CToperation &lt;- CToperation[-c(90,94),]\n# Latitude -4.48283\n# Latitude -0.554820969700813\n# Longitude -76.4833290316164\n\n# Generamos la matríz de operación de las cámaras\n\ncamop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operación\n                         stationCol= \"Camera_Id\", # Columna que define la estación\n                         setupCol= \"minStart\", #Columna fecha de colocación\n                         retrievalCol= \"maxEnd\", #Columna fecha de retiro\n                         #hasProblems= T, # Hubo fallos de cámaras\n                         dateFormat= \"%Y-%m-%d\")#, #, # Formato de las fechas\n                         #cameraCol=\"Camera_Id\")\n                         # sessionCol= \"Year\")\n\n# Generar las historias de detección ---------------------------------------\n## remove plroblem species\n\n# Per_full$scientificName &lt;- paste(Per_full$genus, Per_full$species, sep=\" \")\n\n#### remove NAs and setups\nind &lt;- which(is.na(data_full$scientificName))\ndata_full &lt;- data_full[-ind,]\n# ind &lt;- which(Per_full$scientificName==\"NA NA\")\n# Per_full &lt;- Per_full[-ind,]\n\n# ind &lt;- which(Per_full$scientificName==\"Set up\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Blank\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Unidentifiable\")\n# Per_full &lt;- Per_full[-ind,]\n\n\nDetHist_list &lt;- lapply(unique(data_full$scientificName), FUN = function(x) {\n  detectionHistory(\n    recordTable         = data_full, # abla de registros\n    camOp                = camop, # Matriz de operación de cámaras\n    stationCol           = \"Camera_Id\",\n    speciesCol           = \"scientificName\",\n    recordDateTimeCol    = \"eventDateTime\",\n    recordDateTimeFormat  = \"%Y-%m-%d %H:%M:%S\",\n    species              = x,     # la función reemplaza x por cada una de las especies\n    occasionLength       = 7, # Colapso de las historias a 10 ías\n    day1                 = \"station\", # \"survey\" a specific date, \"station\", #inicie en la fecha de cada survey\n    datesAsOccasionNames = FALSE,\n    includeEffort        = TRUE,\n    scaleEffort          = FALSE,\n    #unmarkedMultFrameInput=TRUE\n    timeZone             = \"America/Bogota\" \n    )\n  }\n)\n\n# names\nnames(DetHist_list) &lt;- unique(data_full$scientificName)\n\n# Finalmente creamos una lista nueva donde estén solo las historias de detección\nylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)\n# otra lista con effort scaled\nefort &lt;- lapply(DetHist_list, FUN = function(x) x$effort)\n\n# number of observetions per sp, collapsed to 7 days\n# lapply(ylist, sum, na.rm = TRUE)\n\n\nArrange spatial covariates\nThe standard EPSG code for a Lambert Azimuthal Equal-Area projection for South America is EPSG:10603 (WGS 84 / GLANCE South America). This projection is specifically designed for the continent and has its center located around the central meridian for the region. The units are meters.\nFLII scores range from 0 (lowest integrity) to 10 (highest). Grantham discretized this range to define three broad illustrative categories: low (≤6.0); medium (&gt;6.0 and &lt;9.6); and high integrity (≥9.6).\n\nCode#transform coord data to Lambert Azimuthal Equal-Area\nAP_Tahuayo_UTM &lt;- st_transform(AP_Tahuayo, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Tahuayo_UTM_line &lt;- st_cast(AP_Tahuayo_UTM,\"MULTILINESTRING\")# \"LINESTRING\")\n#transform Yasuni to Lambert Azimuthal Equal-Area\nAP_Yasuni_UTM &lt;- st_transform(AP_Yasuni, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Yasuni_UTM_line &lt;- st_cast(AP_Yasuni_UTM, \"MULTILINESTRING\")\n\n#transform Yasuni to Lambert Azimuthal Equal-Area\nAP_Madidi_UTM &lt;- st_transform(Madidi_NP, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Madidi_UTM_line &lt;- st_cast(AP_Madidi_UTM, \"MULTILINESTRING\")\n\nAP_PlantasMed_UTM &lt;- st_transform(AP_PlantasMed, \"EPSG:10603\")\n\n\n############## sf AP Union \nAP_merged_sf_UTM &lt;- st_union(AP_Tahuayo_UTM, \n                             AP_Yasuni_UTM,\n                             AP_Madidi_UTM,\n                             AP_PlantasMed_UTM)\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\nCodeAP_merged_line &lt;- st_cast(AP_merged_sf_UTM, to=\"MULTILINESTRING\")\n\n\n# make sf() from data table\ndata_full_sf &lt;- CToperation |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"), \n              crs = 4326)\n\n# gete elevation proint from AWS\nelev_data &lt;- elevatr::get_elev_point(locations = data_full_sf, src = \"aws\")\n\nMosaicing & Projecting\n\n\nNote: Elevation units are in meters\n\nCode# extract elev and paste to table\ndata_full_sf$elev &lt;- elev_data$elevation\nstr(data_full_sf$elev)\n\n num [1:428] 443 387 592 543 498 396 521 498 451 498 ...\n\nCode# extract in AP\ndata_full_sf$in_AP = as.factor(st_intersects(data_full_sf, AP_Tahuayo, sparse = FALSE))\n\nin_AP &lt;- as.numeric((st_drop_geometry(data_full_sf$in_AP)))\n\n# extract FLII\ndata_full_sf$FLII &lt;- terra::extract(FLII2016, data_full_sf)[,2]\nstr(data_full_sf$FLII)\n\n num [1:428] 9.57 9.65 9.69 9.66 9.92 ...\n\nCode# Replace all NAs with min flii in a numeric column\ndata_full_sf$FLII[is.na(data_full_sf$FLII)] &lt;- min(data_full_sf$FLII, na.rm = TRUE)\n\n# mapview(full_sites_14_15_16_sf, zcol = \"in_AP\", burst = TRUE)\n\n# Transform coord to Lambert Azimuthal Equal-Area\ndata_full_sf_UTM &lt;- st_transform(data_full_sf, \"EPSG:10603\")\n\n\ncoords &lt;- st_coordinates(data_full_sf_UTM)\n#str(coords)\n\n#### fix duplicated coord\n# -1840583.53296873  en x\n# -1842515.36969736  en x\n# 1547741.44311964  en y\n# 1541202.24796904 en y\n\n# which(coords[,1]==\"-1840583.53296873\")\n# which(coords[,1]==\"-1842515.36969736\")\n# which(coords[,2]==\"1547741.44311964\")\n# which(coords[,2]==\"1541202.24796904\")\n\n# make Ecu_14_15_16 an sf object\n#    cam_sf &lt;- st_as_sf(Ecu_14_15_16, coords = c(\"lon\",\"lat\"))   #crs=\"EPSG:4326\")\n    #--- set CRS ---#\n#    st_crs(cam_sf) &lt;- 4326\n\n\n\n\n# Calculate the distance\n#multiplic &lt;- full_sites_14_15_16_sf_UTM |&gt; mutate(multiplic= as.numeric(in_AP)) \nmultiplic=ifelse(data_full_sf_UTM$in_AP==\"TRUE\",-1,1)\ndata_full_sf_UTM$border_dist &lt;- as.numeric(st_distance(data_full_sf_UTM, AP_Tahuayo_UTM_line) * multiplic )\n# print(border_dist)\n\n# convert true false to inside 1, outside 0\ndata_full_sf_UTM &lt;- data_full_sf_UTM |&gt;\n  mutate(in_AP = case_when(\n    str_detect(in_AP, \"TRUE\") ~ 1, # \"inside_AP\",\n    str_detect(in_AP, \"FALSE\") ~ 0 #\"outside_AP\"\n  )) |&gt; mutate(in_AP=as.factor(in_AP))\n\n\nhist(data_full_sf_UTM$border_dist)\n\n\n\n\n\n\n\nPrepare the model\n\n\n\n\n\n\nTipData in a 3D array\n\n\n\nThe data must be placed in a three-dimensional array with dimensions corresponding to species, sites, and replicates in that order.\n\n\nThe function sfMsPGOcc\nFits multi-species spatial occupancy models with species correlations (i.e., a spatially-explicit joint species distribution model with imperfect detection). We use Polya-Gamma latent variables and a spatial factor modeling approach. Currently, models are implemented using a Nearest Neighbor Gaussian Process.\n\nCode# Detection-nondetection data ---------\n# Species of interest, can select individually\n# curr.sp &lt;- sort(unique(Ecu_14_15_16$.id))# c('BAWW', 'BLJA', 'GCFL')\n# sort(names(DetHist_list))\nselected.sp &lt;-  c(\n\"Atelocynus microtis\" ,\n\"Coendou prehensilis\" ,\n\"Cuniculus paca\",           \n\"Dasyprocta fuliginosa\",      \n\"Dasypus sp.\" ,    \n\"Didelphis marsupialis\",    \n\"Eira barbara\",  \n\"Herpailurus yagouaroundi\",\n\"Leopardus pardalis\",    \n\"Leopardus tigrinus\" ,\n\"Leopardus wiedii\",         \n\"Mazama americana\",\n\"Mazama nemorivaga\",\n#\"Mitu tuberosum\" ,\n\"Myoprocta pratti\",\n\"Myrmecophaga tridactyla\",\n\"Nasua nasua\" ,\n# \"Mazama americana\",         \n# \"Myotis myotis\",           \n# \"Nasua narica\",             \n# \"Odocoileus virginianus\",   \n\"Panthera onca\" ,\n# \"Procyon cancrivorus\" ,\n\"Pecari tajacu\",    \n#\"Penelope jacquacu\" ,\n\"Priodontes maximus\" ,\n\"Procyon cancrivorous\",      \n# \"Psophia leucoptera\",\n\"Puma concolor\" ,\n\"Puma yagouaroundi\",        \n# \"Rattus rattus\" ,\n# \"Roedor sp.\",\n# \"Sciurus sp.\",       \n# \"Sus scrofa\",               \n# \"Sylvilagus brasiliensis\",  \n\"Tamandua tetradactyla\",   \n\"Tapirus terrestris\",\n\"Tayassu pecari\"\n#\"Tinamus major\"            \n              )\n\n# y.msom &lt;- y[which(sp.codes %in% selected.sp), , ]\n# str(y.msom)\n\n# Use selection\ny.selected &lt;- ylist[selected.sp]   \n\n#### three-dimensional array with dimensions corresponding to species, sites, and replicates\n\n# 1. Load the abind library to make arrays easily \nlibrary(abind)\nmy_array_abind &lt;- abind(y.selected, # start from list\n                        along = 3, # 3D array\n                        use.first.dimnames=TRUE) # keep names\n\n# Transpose the array to have:\n# species, sites, and sampling occasions in that order\n# The new order is (3rd dim, 1st dim, 2nd dim)\ntransposed_array &lt;- aperm(my_array_abind, c(3, 1, 2))\n\n#### site covs\nsitecovs &lt;- as.data.frame(st_drop_geometry(\n                    data_full_sf_UTM[,5:8]))\n\n sitecovs[, 1] &lt;- as.vector((sitecovs[,1]))   # scale numeric covariates\n sitecovs[, 1] &lt;- as.numeric((sitecovs[,2]))   # scale numeric covariates\n sitecovs[, 3] &lt;- as.vector((sitecovs[,3]))   # scale numeric covariates\n sitecovs[, 4] &lt;- as.vector((sitecovs[,4]))   # scale numeric covariates\n # sitecovs$fact &lt;- factor(c(\"A\", \"A\", \"B\"))    # categorical covariate\n\nnames(sitecovs) &lt;- c(\"elev\", \"in_AP\", \"FLII\", \"border_dist\")\n\n# check consistancy equal number of spatial covariates and rows in data\n# identical(nrow(ylist[[1]]), nrow(covars)) \n\n# Base de datos para los análisis -----------------------------------------\n\n# match the names to \"y\"  \"occ.covs\" \"det.covs\" \"coords\" \ndata_list &lt;- list(y = transposed_array, # Historias de detección\n                  occ.covs = sitecovs, # covs de sitio\n                  det.covs  = list(effort = DetHist_list[[1]]$effort),\n                  coords = st_coordinates(data_full_sf_UTM)\n                  )  # agregamos el esfuerzo de muestreo como covariable de observación\n\n\nRunning the model\nWe let spOccupancy set the initial values by default based on the prior distributions.\n\nCode# Running the model\n\n# 3. 1 Modelo multi-especie  -----------------------------------------\n\n# 2. Model fitting --------------------------------------------------------\n# Fit a non-spatial, multi-species occupancy model. \nout &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort) , # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.samples = 6000, \n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 428 sites and 25 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 1 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCode# Fit a non-spatial, Latent Factor Multi-Species Occupancy Model. \n  out.lfMs &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.omp.threads = 6,\n                 n.samples = 6000, \n                 n.factors = 5, # balance of rare sp. and run time\n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nWarning in msPGOcc(occ.formula = ~scale(elev) + scale(border_dist) +\nscale(FLII), : 'n.factors' is not an argument\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 428 sites and 25 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.report = 1000, n.burn = 1000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 7.194\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)        -1.9989 0.3610 -2.7013 -2.0081 -1.2564 1.0327  394\nscale(elev)        -0.1799 0.1238 -0.4193 -0.1780  0.0734 0.9994  934\nscale(border_dist) -0.3663 0.2178 -0.7892 -0.3635  0.0553 1.0005 1047\nscale(FLII)         0.4476 0.1907  0.0894  0.4425  0.8499 1.0038  745\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        2.7795 1.0549 1.3005 2.5494 5.3226 1.0588 161\nscale(elev)        0.2559 0.1191 0.1071 0.2294 0.5436 1.0145 991\nscale(border_dist) 1.0008 0.4134 0.4484 0.9310 2.0193 1.0306 537\nscale(FLII)        0.5658 0.2902 0.2031 0.5049 1.2841 1.0161 443\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.2353 0.2703 -2.8274 -2.2257 -1.7444 1.0426  502\nscale(effort)  0.3975 0.0667  0.2619  0.3944  0.5320 0.9995 1178\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.4161 0.6351 0.6087 1.2964 2.9403 1.0614  139\nscale(effort) 0.0480 0.0278 0.0175 0.0410 0.1191 1.0062 1195\n\nCode# Fit a Spatial Factor Multi-Species Occupancy Model\n# latent spatial factors.\ntictoc::tic()\n  out.sp &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 428 sites and 25 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n1800.95 sec elapsed\n\nCode#########################\ntictoc::tic()\n  out.sp.fac &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               factor(in_AP) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 428 sites and 25 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n1795.69 sec elapsed\n\nCode# tictoc::tic()\n#   out.sp.gaus &lt;- sfMsPGOcc(occ.formula = ~ scale(border_dist) , \n#                            det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,              \n#                            data = data_list, \n#                            n.batch = 400, \n#                            batch.length = 25,\n#                            n.thin = 5, \n#                            n.burn = 5000, \n#                            n.chains = 1,\n#                            NNGP = TRUE,\n#                            n.factors = 5,\n#                            n.neighbors = 15,\n#                            cov.model = 'gaussian',\n#                            n.report = 100);beep(sound = 4)\n# tictoc::toc()\n\n# save the results to not run again\n# save(out, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/result_2.R\") # guardamos los resultados para no correr de nuevo\n# save the results to not run again\n# save(out.sp, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n# save(out.lfMs, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/lfms_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n\n# load(\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\")\n# summary(fit.commu)\n\n\nModel validation\nWe next perform a posterior predictive check using the Freeman-Tukey statistic grouping the data by sites. We summarize the posterior predictive check with the summary() function, which reports a Bayesian p-value. A Bayesian p-value that hovers around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well (Hobbs and Hooten 2015). As always with a simulation-based analysis using MCMC, you will get numerically slightly different values.\n\nCode# 3. Model validation -----------------------------------------------------\n# Perform a posterior predictive check to assess model fit. \nppc.out &lt;- ppcOcc(out, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.lfMs &lt;- ppcOcc(out.lfMs, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.sp &lt;- ppcOcc(out.sp, fit.stat = 'freeman-tukey',\n                     group = 1)\n\n# Calculate a Bayesian p-value as a simple measure of Goodness of Fit.\n# Bayesian p-values between 0.1 and 0.9 indicate adequate model fit. \nsummary(ppc.out)\n\n\nCall:\nppcOcc(object = out, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3685 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.3367\nCoendou prehensilis Bayesian p-value: 0.6347\nCuniculus paca Bayesian p-value: 0\nDasyprocta fuliginosa Bayesian p-value: 0.0013\nDasypus sp. Bayesian p-value: 0.1493\nDidelphis marsupialis Bayesian p-value: 0.4647\nEira barbara Bayesian p-value: 0.9207\nHerpailurus yagouaroundi Bayesian p-value: 0.5413\nLeopardus pardalis Bayesian p-value: 0.3447\nLeopardus tigrinus Bayesian p-value: 0.2013\nLeopardus wiedii Bayesian p-value: 0.364\nMazama americana Bayesian p-value: 0.058\nMazama nemorivaga Bayesian p-value: 0.5067\nMyoprocta pratti Bayesian p-value: 0.1467\nMyrmecophaga tridactyla Bayesian p-value: 0.3953\nNasua nasua Bayesian p-value: 0.5153\nPanthera onca Bayesian p-value: 0.3847\nPecari tajacu Bayesian p-value: 0.1713\nPriodontes maximus Bayesian p-value: 0.516\nProcyon cancrivorous Bayesian p-value: 0.5193\nPuma concolor Bayesian p-value: 0.386\nPuma yagouaroundi Bayesian p-value: 0.678\nTamandua tetradactyla Bayesian p-value: 0.676\nTapirus terrestris Bayesian p-value: 0.0693\nTayassu pecari Bayesian p-value: 0.232\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.lfMs)\n\n\nCall:\nppcOcc(object = out.lfMs, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3661 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.312\nCoendou prehensilis Bayesian p-value: 0.66\nCuniculus paca Bayesian p-value: 0\nDasyprocta fuliginosa Bayesian p-value: 0.002\nDasypus sp. Bayesian p-value: 0.1653\nDidelphis marsupialis Bayesian p-value: 0.4587\nEira barbara Bayesian p-value: 0.9127\nHerpailurus yagouaroundi Bayesian p-value: 0.53\nLeopardus pardalis Bayesian p-value: 0.336\nLeopardus tigrinus Bayesian p-value: 0.2227\nLeopardus wiedii Bayesian p-value: 0.3587\nMazama americana Bayesian p-value: 0.08\nMazama nemorivaga Bayesian p-value: 0.4813\nMyoprocta pratti Bayesian p-value: 0.1393\nMyrmecophaga tridactyla Bayesian p-value: 0.3587\nNasua nasua Bayesian p-value: 0.5507\nPanthera onca Bayesian p-value: 0.3833\nPecari tajacu Bayesian p-value: 0.1727\nPriodontes maximus Bayesian p-value: 0.498\nProcyon cancrivorous Bayesian p-value: 0.5233\nPuma concolor Bayesian p-value: 0.3867\nPuma yagouaroundi Bayesian p-value: 0.6753\nTamandua tetradactyla Bayesian p-value: 0.644\nTapirus terrestris Bayesian p-value: 0.078\nTayassu pecari Bayesian p-value: 0.224\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.sp)\n\n\nCall:\nppcOcc(object = out.sp, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3537 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.33\nCoendou prehensilis Bayesian p-value: 0.631\nCuniculus paca Bayesian p-value: 0\nDasyprocta fuliginosa Bayesian p-value: 0.0027\nDasypus sp. Bayesian p-value: 0.158\nDidelphis marsupialis Bayesian p-value: 0.418\nEira barbara Bayesian p-value: 0.9497\nHerpailurus yagouaroundi Bayesian p-value: 0.569\nLeopardus pardalis Bayesian p-value: 0.2787\nLeopardus tigrinus Bayesian p-value: 0.2447\nLeopardus wiedii Bayesian p-value: 0.3077\nMazama americana Bayesian p-value: 0.0463\nMazama nemorivaga Bayesian p-value: 0.6223\nMyoprocta pratti Bayesian p-value: 0.1463\nMyrmecophaga tridactyla Bayesian p-value: 0.1767\nNasua nasua Bayesian p-value: 0.4403\nPanthera onca Bayesian p-value: 0.4193\nPecari tajacu Bayesian p-value: 0.1733\nPriodontes maximus Bayesian p-value: 0.5257\nProcyon cancrivorous Bayesian p-value: 0.4837\nPuma concolor Bayesian p-value: 0.351\nPuma yagouaroundi Bayesian p-value: 0.688\nTamandua tetradactyla Bayesian p-value: 0.62\nTapirus terrestris Bayesian p-value: 0.0527\nTayassu pecari Bayesian p-value: 0.2087\nFit statistic:  freeman-tukey \n\n\n\n\n\n\n\n\nImportant\n\n\n\nA Bayesian p-value that around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well.\n\n\nFit plot\n\nCode#### fit plot\nppc.df &lt;- data.frame(fit = ppc.out.sp$fit.y, \n                     fit.rep = ppc.out.sp$fit.y.rep, \n                     color = 'lightskyblue1')\n\nppc.df$color[ppc.df$fit.rep.1 &gt; ppc.df$fit.1] &lt;- 'lightsalmon'\nplot(ppc.df$fit.1, ppc.df$fit.rep.1, bg = ppc.df$color, pch = 21, \n     ylab = 'Fit', xlab = 'True')\nlines(ppc.df$fit.1, ppc.df$fit.1, col = 'black')\n\n\n\nThe most symmetrical, better fit!\n\n\n\nModel comparison\n\nCode# 4. Model comparison -----------------------------------------------------\n# Compute Widely Applicable Information Criterion (WAIC)\n# Lower values indicate better model fit. \nwaicOcc(out)\n\n     elpd        pD      WAIC \n-8225.109   118.086 16686.389 \n\nCodewaicOcc(out.lfMs)\n\n      elpd         pD       WAIC \n-8224.7917   118.5652 16686.7138 \n\nCodewaicOcc(out.sp)\n\n      elpd         pD       WAIC \n-7280.6104   739.5953 16040.4113 \n\nCodewaicOcc(out.sp.fac)\n\n      elpd         pD       WAIC \n-7333.4507   712.2107 16091.3228 \n\n\nModel comparison as table\n\nCode# Here we summarize the spatial factor loadings\n# summary(out.sp$lambda.samples)\n\n# Resultados --------------------------------------------------------------\n# Extraemos lo tabla de valores estimados\nmodresult &lt;- cbind(as.data.frame(waicOcc(out)),\n                  as.data.frame(waicOcc(out.sp)),\n                  as.data.frame(waicOcc(out.lfMs)),\n                  as.data.frame(waicOcc(out.sp.fac))\n                  #as.data.frame(waicOcc(out.sp.gaus))\n                  )\n# View(modresult)\nmodresult_sorted &lt;- as.data.frame(t(modresult)) |&gt; \n  arrange(WAIC) # sort by\n  \nDT::datatable(modresult_sorted)\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\nLower values in WAIC indicate better model fit.\n\n\nWAIC is the Widely Applicable Information Criterion (Watanabe 2010).\nPosterior Summary\n\nCode# 5. Posterior summaries --------------------------------------------------\n# Concise summary of main parameter estimates\nsummary(out.sp, level = 'community')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 30.0153\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -2.7611 0.4954 -3.7565 -2.7599 -1.7782 1.0807 277\nscale(elev)        -0.0372 0.1944 -0.4196 -0.0382  0.3414 1.1540 850\nscale(border_dist) -0.4589 0.3319 -1.1346 -0.4491  0.1698 1.0799 895\nscale(FLII)         0.5170 0.2460  0.0567  0.5049  1.0430 1.0122 885\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat  ESS\n(Intercept)        5.1766 2.1408 2.2988 4.7363 10.7314 1.1570  346\nscale(elev)        0.4771 0.2324 0.1718 0.4252  1.0559 1.0385 1145\nscale(border_dist) 2.0565 0.8866 0.8445 1.8913  4.2675 1.0374  438\nscale(FLII)        0.9112 0.4685 0.3170 0.8046  2.0406 1.0008  496\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.2605 0.2700 -2.8176 -2.2461 -1.7495 1.1593  329\nscale(effort)  0.3955 0.0653  0.2704  0.3935  0.5316 1.0033 2257\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.5039 0.6865 0.6342 1.3541 3.2076 1.2673  106\nscale(effort) 0.0454 0.0261 0.0160 0.0392 0.1110 1.0008 2566\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  8.9235 9.0901 0.0000  6.4319 26.4508 4.0224    8\nphi-2 13.2789 7.9866 0.4498 13.0502 26.7775 1.0019 3000\nphi-3  4.7494 8.0864 0.0000  0.0000 26.0644 9.1416    3\nphi-4 13.5261 7.9445 0.6362 13.4657 26.8778 1.0001 2677\nphi-5 13.6591 8.0601 0.6792 13.3846 26.8695 1.0007 3000\n\nCodesummary(out.sp, level = 'species')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 30.0153\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis             -2.5173 1.0719 -3.9337 -2.7944\n(Intercept)-Coendou prehensilis             -5.4512 1.7234 -8.7614 -5.5698\n(Intercept)-Cuniculus paca                   0.1873 0.4071 -0.5579  0.1865\n(Intercept)-Dasyprocta fuliginosa           -1.3041 1.1359 -3.5264 -1.2099\n(Intercept)-Dasypus sp.                     -5.2100 0.9039 -7.1616 -5.1349\n(Intercept)-Didelphis marsupialis           -3.9183 0.8388 -5.6388 -3.8827\n(Intercept)-Eira barbara                    -1.9932 0.7638 -3.5520 -1.9924\n(Intercept)-Herpailurus yagouaroundi        -4.2024 1.4525 -7.0260 -4.2391\n(Intercept)-Leopardus pardalis              -1.5218 0.3763 -2.3396 -1.4991\n(Intercept)-Leopardus tigrinus              -6.9693 1.1498 -9.3426 -6.9447\n(Intercept)-Leopardus wiedii                -3.2074 1.0814 -5.2825 -3.2580\n(Intercept)-Mazama americana                -2.6124 0.5827 -3.9639 -2.5256\n(Intercept)-Mazama nemorivaga               -5.6219 0.9905 -7.7977 -5.5421\n(Intercept)-Myoprocta pratti                -4.7108 0.8809 -6.6393 -4.6596\n(Intercept)-Myrmecophaga tridactyla         -1.7860 0.9374 -3.5221 -1.8715\n(Intercept)-Nasua nasua                     -1.9922 0.9136 -3.8450 -1.9965\n(Intercept)-Panthera onca                   -1.9128 0.6800 -3.3508 -1.8930\n(Intercept)-Pecari tajacu                    0.4194 0.7086 -1.0669  0.4871\n(Intercept)-Priodontes maximus              -1.6390 1.1842 -3.7822 -1.7003\n(Intercept)-Procyon cancrivorous            -4.9635 1.4579 -7.8134 -4.9880\n(Intercept)-Puma concolor                   -2.9256 0.6688 -4.4458 -2.8550\n(Intercept)-Puma yagouaroundi               -5.0322 1.6389 -8.0014 -5.1341\n(Intercept)-Tamandua tetradactyla           -3.3869 1.1391 -5.6753 -3.4186\n(Intercept)-Tapirus terrestris              -0.3091 0.4660 -1.2972 -0.2661\n(Intercept)-Tayassu pecari                  -1.5618 0.5460 -2.7912 -1.5187\nscale(elev)-Atelocynus microtis             -0.6795 0.4607 -1.6793 -0.6568\nscale(elev)-Coendou prehensilis              0.2016 0.6051 -0.9566  0.1761\nscale(elev)-Cuniculus paca                  -0.1456 0.2690 -0.6826 -0.1429\nscale(elev)-Dasyprocta fuliginosa            0.8599 0.4573 -0.1191  0.8688\nscale(elev)-Dasypus sp.                     -0.2859 0.2911 -0.8687 -0.2831\nscale(elev)-Didelphis marsupialis            0.1060 0.4523 -0.7272  0.0949\nscale(elev)-Eira barbara                    -0.9852 0.4773 -2.0155 -0.9490\nscale(elev)-Herpailurus yagouaroundi        -0.4436 0.6313 -1.7201 -0.4200\nscale(elev)-Leopardus pardalis               0.3041 0.3235 -0.3392  0.3005\nscale(elev)-Leopardus tigrinus              -0.2349 0.6160 -1.4665 -0.2163\nscale(elev)-Leopardus wiedii                -0.1222 0.4773 -1.0382 -0.1275\nscale(elev)-Mazama americana                 1.2261 0.3805  0.5285  1.2061\nscale(elev)-Mazama nemorivaga                0.5441 0.3884 -0.1647  0.5344\nscale(elev)-Myoprocta pratti                 0.0385 0.4762 -0.8527  0.0181\nscale(elev)-Myrmecophaga tridactyla         -0.4303 0.4509 -1.3868 -0.4068\nscale(elev)-Nasua nasua                     -0.2548 0.4632 -1.1907 -0.2454\nscale(elev)-Panthera onca                    0.1494 0.4052 -0.6333  0.1401\nscale(elev)-Pecari tajacu                    0.6037 0.3436 -0.0837  0.5997\nscale(elev)-Priodontes maximus              -0.2231 0.5187 -1.2885 -0.2090\nscale(elev)-Procyon cancrivorous            -0.1784 0.5066 -1.1401 -0.1878\nscale(elev)-Puma concolor                   -0.3868 0.3827 -1.1346 -0.3870\nscale(elev)-Puma yagouaroundi               -0.3696 0.5411 -1.4343 -0.3815\nscale(elev)-Tamandua tetradactyla           -0.0505 0.5550 -1.2236 -0.0482\nscale(elev)-Tapirus terrestris               0.2339 0.2977 -0.3225  0.2220\nscale(elev)-Tayassu pecari                  -0.4401 0.3188 -1.0760 -0.4358\nscale(border_dist)-Atelocynus microtis      -0.1040 0.4601 -0.9701 -0.1124\nscale(border_dist)-Coendou prehensilis      -0.6611 0.9902 -2.7998 -0.5842\nscale(border_dist)-Cuniculus paca           -1.2495 0.3798 -2.0256 -1.2391\nscale(border_dist)-Dasyprocta fuliginosa    -0.5637 0.7374 -1.8886 -0.6360\nscale(border_dist)-Dasypus sp.              -4.0608 0.8583 -5.8878 -4.0247\nscale(border_dist)-Didelphis marsupialis     1.2427 0.5531  0.1607  1.2166\nscale(border_dist)-Eira barbara             -1.6165 0.6216 -2.9293 -1.5937\nscale(border_dist)-Herpailurus yagouaroundi  0.0974 0.9840 -1.8233  0.0702\nscale(border_dist)-Leopardus pardalis        1.1100 0.3651  0.4592  1.0941\nscale(border_dist)-Leopardus tigrinus       -0.0452 0.8988 -1.8211 -0.0628\nscale(border_dist)-Leopardus wiedii          0.4129 0.5755 -0.6960  0.3801\nscale(border_dist)-Mazama americana          0.7601 0.3915 -0.0159  0.7666\nscale(border_dist)-Mazama nemorivaga        -3.1633 0.8865 -5.0055 -3.1105\nscale(border_dist)-Myoprocta pratti         -0.2613 0.6597 -1.5601 -0.2578\nscale(border_dist)-Myrmecophaga tridactyla  -0.3333 0.5332 -1.5022 -0.3107\nscale(border_dist)-Nasua nasua              -0.7209 0.6225 -2.0352 -0.7064\nscale(border_dist)-Panthera onca             0.5991 0.5032 -0.3344  0.5795\nscale(border_dist)-Pecari tajacu            -0.4068 0.4605 -1.2674 -0.4185\nscale(border_dist)-Priodontes maximus        0.2239 0.7064 -1.1391  0.1874\nscale(border_dist)-Procyon cancrivorous     -1.7161 0.9004 -3.6384 -1.6456\nscale(border_dist)-Puma concolor            -0.0506 0.4652 -0.9202 -0.0691\nscale(border_dist)-Puma yagouaroundi        -1.3313 0.8941 -3.2487 -1.2827\nscale(border_dist)-Tamandua tetradactyla    -0.1388 0.7359 -1.5393 -0.1511\nscale(border_dist)-Tapirus terrestris       -0.2207 0.3598 -0.9291 -0.2216\nscale(border_dist)-Tayassu pecari            0.2105 0.3731 -0.4775  0.1936\nscale(FLII)-Atelocynus microtis              0.2162 0.4043 -0.5393  0.1876\nscale(FLII)-Coendou prehensilis              0.5833 0.8316 -0.9115  0.5376\nscale(FLII)-Cuniculus paca                  -0.3398 0.2082 -0.7608 -0.3320\nscale(FLII)-Dasyprocta fuliginosa           -1.0294 0.3186 -1.6546 -1.0241\nscale(FLII)-Dasypus sp.                      0.5703 0.6903 -0.6869  0.5438\nscale(FLII)-Didelphis marsupialis            1.1550 0.5256  0.2919  1.0959\nscale(FLII)-Eira barbara                    -0.4560 0.4952 -1.4884 -0.4208\nscale(FLII)-Herpailurus yagouaroundi         0.4745 0.7454 -0.9289  0.4466\nscale(FLII)-Leopardus pardalis               1.1397 0.3771  0.4929  1.1076\nscale(FLII)-Leopardus tigrinus               0.7411 0.8301 -0.6506  0.6506\nscale(FLII)-Leopardus wiedii                 0.9992 0.6638 -0.1296  0.9479\nscale(FLII)-Mazama americana                 0.4242 0.2891 -0.0963  0.4028\nscale(FLII)-Mazama nemorivaga                0.8028 0.7990 -0.5547  0.7441\nscale(FLII)-Myoprocta pratti                 0.7582 0.5834 -0.2595  0.7023\nscale(FLII)-Myrmecophaga tridactyla          0.3715 0.4431 -0.4923  0.3575\nscale(FLII)-Nasua nasua                     -0.5512 0.5117 -1.7382 -0.4974\nscale(FLII)-Panthera onca                    1.4655 0.6269  0.3808  1.4191\nscale(FLII)-Pecari tajacu                    0.5874 0.2874  0.0654  0.5701\nscale(FLII)-Priodontes maximus               0.2011 0.5526 -0.9146  0.2042\nscale(FLII)-Procyon cancrivorous             0.8248 0.8854 -0.8008  0.7860\nscale(FLII)-Puma concolor                    1.3410 0.6105  0.3110  1.2911\nscale(FLII)-Puma yagouaroundi                0.6554 0.8666 -0.9249  0.5852\nscale(FLII)-Tamandua tetradactyla           -0.6893 0.5788 -1.9848 -0.6390\nscale(FLII)-Tapirus terrestris               1.0290 0.3384  0.4447  0.9974\nscale(FLII)-Tayassu pecari                   1.7948 0.5805  0.8339  1.7362\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis              0.1630 3.4943   77\n(Intercept)-Coendou prehensilis             -1.6162 1.3372  115\n(Intercept)-Cuniculus paca                   0.9270 4.4260    7\n(Intercept)-Dasyprocta fuliginosa            0.6509 5.2340    7\n(Intercept)-Dasypus sp.                     -3.6647 1.0256  366\n(Intercept)-Didelphis marsupialis           -2.3853 1.9953   61\n(Intercept)-Eira barbara                    -0.5427 1.3295  201\n(Intercept)-Herpailurus yagouaroundi        -1.1533 1.2503  116\n(Intercept)-Leopardus pardalis              -0.8511 1.0177  474\n(Intercept)-Leopardus tigrinus              -4.8671 1.0263  314\n(Intercept)-Leopardus wiedii                -0.9601 1.4396  152\n(Intercept)-Mazama americana                -1.7187 1.4813  202\n(Intercept)-Mazama nemorivaga               -3.9009 1.1896  396\n(Intercept)-Myoprocta pratti                -3.1450 2.0065  118\n(Intercept)-Myrmecophaga tridactyla          0.2959 1.0422  187\n(Intercept)-Nasua nasua                     -0.1634 1.6135  130\n(Intercept)-Panthera onca                   -0.6570 1.4455  197\n(Intercept)-Pecari tajacu                    1.6999 4.2850    9\n(Intercept)-Priodontes maximus               0.8206 1.2089  105\n(Intercept)-Procyon cancrivorous            -2.0570 1.2222  101\n(Intercept)-Puma concolor                   -1.7845 1.8071   57\n(Intercept)-Puma yagouaroundi               -1.5904 1.0926  108\n(Intercept)-Tamandua tetradactyla           -1.0210 1.1089  145\n(Intercept)-Tapirus terrestris               0.5633 3.7843    8\n(Intercept)-Tayassu pecari                  -0.6291 2.9047   15\nscale(elev)-Atelocynus microtis              0.1768 1.0828 1135\nscale(elev)-Coendou prehensilis              1.4312 1.0489 1254\nscale(elev)-Cuniculus paca                   0.3539 1.0833  321\nscale(elev)-Dasyprocta fuliginosa            1.7494 1.4850  102\nscale(elev)-Dasypus sp.                      0.2698 1.0106 2104\nscale(elev)-Didelphis marsupialis            1.0594 1.0311 1230\nscale(elev)-Eira barbara                    -0.1166 1.0133 1030\nscale(elev)-Herpailurus yagouaroundi         0.7641 1.0631 1340\nscale(elev)-Leopardus pardalis               0.9502 1.0323 1124\nscale(elev)-Leopardus tigrinus               0.9440 1.0123 1918\nscale(elev)-Leopardus wiedii                 0.8115 1.0315 1815\nscale(elev)-Mazama americana                 2.0137 1.1087  603\nscale(elev)-Mazama nemorivaga                1.3553 1.0433 1111\nscale(elev)-Myoprocta pratti                 1.0252 1.1106  462\nscale(elev)-Myrmecophaga tridactyla          0.4233 1.0858 1038\nscale(elev)-Nasua nasua                      0.6588 1.0470 1403\nscale(elev)-Panthera onca                    0.9567 1.0482  880\nscale(elev)-Pecari tajacu                    1.2818 1.2664  239\nscale(elev)-Priodontes maximus               0.7682 1.0431 1348\nscale(elev)-Procyon cancrivorous             0.8498 1.0006  825\nscale(elev)-Puma concolor                    0.3668 1.1162  604\nscale(elev)-Puma yagouaroundi                0.7427 1.0175 1006\nscale(elev)-Tamandua tetradactyla            1.0254 1.0131 1412\nscale(elev)-Tapirus terrestris               0.8563 1.2274  432\nscale(elev)-Tayassu pecari                   0.1469 1.2317  257\nscale(border_dist)-Atelocynus microtis       0.8099 1.1152  715\nscale(border_dist)-Coendou prehensilis       1.1582 1.0117  318\nscale(border_dist)-Cuniculus paca           -0.5146 1.5205   54\nscale(border_dist)-Dasyprocta fuliginosa     1.0604 2.0477   33\nscale(border_dist)-Dasypus sp.              -2.5126 1.0497  383\nscale(border_dist)-Didelphis marsupialis     2.3785 1.2809  133\nscale(border_dist)-Eira barbara             -0.4721 1.0355  665\nscale(border_dist)-Herpailurus yagouaroundi  2.1216 1.0534  369\nscale(border_dist)-Leopardus pardalis        1.8740 1.0002 1813\nscale(border_dist)-Leopardus tigrinus        1.7372 1.0238  861\nscale(border_dist)-Leopardus wiedii          1.5794 1.0611  694\nscale(border_dist)-Mazama americana          1.5115 1.0763  325\nscale(border_dist)-Mazama nemorivaga        -1.5573 1.1611  413\nscale(border_dist)-Myoprocta pratti          1.0760 1.2949  137\nscale(border_dist)-Myrmecophaga tridactyla   0.6404 1.0078  767\nscale(border_dist)-Nasua nasua               0.4468 1.2030  335\nscale(border_dist)-Panthera onca             1.6249 1.0939  848\nscale(border_dist)-Pecari tajacu             0.5492 1.6689   39\nscale(border_dist)-Priodontes maximus        1.6807 1.1737  384\nscale(border_dist)-Procyon cancrivorous     -0.1425 1.0299  419\nscale(border_dist)-Puma concolor             0.9134 1.2439  126\nscale(border_dist)-Puma yagouaroundi         0.3016 1.0288  406\nscale(border_dist)-Tamandua tetradactyla     1.3166 1.0413  741\nscale(border_dist)-Tapirus terrestris        0.4983 1.2439  146\nscale(border_dist)-Tayassu pecari            0.9672 1.3912  123\nscale(FLII)-Atelocynus microtis              1.0503 1.1043  802\nscale(FLII)-Coendou prehensilis              2.3472 1.0023  775\nscale(FLII)-Cuniculus paca                   0.0495 1.0041 1565\nscale(FLII)-Dasyprocta fuliginosa           -0.4221 1.0228  428\nscale(FLII)-Dasypus sp.                      1.9990 1.0017 1259\nscale(FLII)-Didelphis marsupialis            2.3503 1.0243  783\nscale(FLII)-Eira barbara                     0.4375 1.0083  729\nscale(FLII)-Herpailurus yagouaroundi         2.0757 1.0171  807\nscale(FLII)-Leopardus pardalis               1.9778 1.0104 1202\nscale(FLII)-Leopardus tigrinus               2.5449 1.0108  885\nscale(FLII)-Leopardus wiedii                 2.3924 1.0072  685\nscale(FLII)-Mazama americana                 1.0472 1.1076  672\nscale(FLII)-Mazama nemorivaga                2.5582 1.0187  986\nscale(FLII)-Myoprocta pratti                 2.0611 1.0038 1105\nscale(FLII)-Myrmecophaga tridactyla          1.2919 1.0151 1022\nscale(FLII)-Nasua nasua                      0.2977 1.1048  331\nscale(FLII)-Panthera onca                    2.8124 1.0077  773\nscale(FLII)-Pecari tajacu                    1.2021 1.0521  423\nscale(FLII)-Priodontes maximus               1.3048 1.0220  703\nscale(FLII)-Procyon cancrivorous             2.6493 1.0065  561\nscale(FLII)-Puma concolor                    2.6847 1.0248  797\nscale(FLII)-Puma yagouaroundi                2.5027 1.0045  679\nscale(FLII)-Tamandua tetradactyla            0.3112 1.0159  562\nscale(FLII)-Tapirus terrestris               1.7777 1.0181  896\nscale(FLII)-Tayassu pecari                   3.1378 1.0019  964\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -3.0201 0.8089 -4.7187 -2.8665 -1.7653\n(Intercept)-Coendou prehensilis        -3.7274 1.2270 -6.3725 -3.6024 -1.6674\n(Intercept)-Cuniculus paca             -0.7034 0.0588 -0.8191 -0.7035 -0.5914\n(Intercept)-Dasyprocta fuliginosa      -0.4486 0.0685 -0.5890 -0.4480 -0.3146\n(Intercept)-Dasypus sp.                -1.5297 0.1277 -1.7825 -1.5291 -1.2816\n(Intercept)-Didelphis marsupialis      -2.2225 0.3585 -2.9726 -2.2016 -1.5703\n(Intercept)-Eira barbara               -3.0061 0.2288 -3.4562 -3.0043 -2.5640\n(Intercept)-Herpailurus yagouaroundi   -3.6227 0.8534 -5.2392 -3.6211 -2.0292\n(Intercept)-Leopardus pardalis         -1.7960 0.1609 -2.1121 -1.7923 -1.4875\n(Intercept)-Leopardus tigrinus         -1.2974 0.9703 -3.3709 -1.2317  0.4554\n(Intercept)-Leopardus wiedii           -3.2309 0.6724 -4.5121 -3.2208 -1.9812\n(Intercept)-Mazama americana           -1.1923 0.1145 -1.4242 -1.1893 -0.9702\n(Intercept)-Mazama nemorivaga          -2.0094 0.1825 -2.3611 -2.0102 -1.6529\n(Intercept)-Myoprocta pratti           -1.3795 0.2433 -1.8825 -1.3702 -0.9100\n(Intercept)-Myrmecophaga tridactyla    -3.0316 0.4590 -3.9425 -3.0033 -2.1732\n(Intercept)-Nasua nasua                -3.0199 0.2886 -3.5948 -3.0179 -2.4751\n(Intercept)-Panthera onca              -2.4552 0.2404 -2.9369 -2.4485 -1.9991\n(Intercept)-Pecari tajacu              -1.2419 0.0737 -1.3870 -1.2414 -1.1001\n(Intercept)-Priodontes maximus         -3.5773 0.4800 -4.4927 -3.5784 -2.6447\n(Intercept)-Procyon cancrivorous       -3.6308 0.8324 -5.3690 -3.5858 -2.1633\n(Intercept)-Puma concolor              -1.7334 0.2056 -2.1609 -1.7266 -1.3528\n(Intercept)-Puma yagouaroundi          -3.7902 0.9880 -5.7765 -3.7237 -2.0481\n(Intercept)-Tamandua tetradactyla      -3.4662 0.5853 -4.6464 -3.4358 -2.3856\n(Intercept)-Tapirus terrestris         -1.1063 0.0773 -1.2595 -1.1051 -0.9584\n(Intercept)-Tayassu pecari             -1.6780 0.1457 -1.9735 -1.6751 -1.3953\nscale(effort)-Atelocynus microtis       0.3415 0.1828 -0.0082  0.3371  0.7149\nscale(effort)-Coendou prehensilis       0.3957 0.2171 -0.0271  0.3906  0.8344\nscale(effort)-Cuniculus paca            0.3395 0.0689  0.2064  0.3390  0.4786\nscale(effort)-Dasyprocta fuliginosa     0.4121 0.0878  0.2441  0.4110  0.5868\nscale(effort)-Dasypus sp.               0.4412 0.1350  0.1980  0.4351  0.7216\nscale(effort)-Didelphis marsupialis     0.5480 0.1950  0.2086  0.5335  0.9748\nscale(effort)-Eira barbara              0.5033 0.1823  0.1712  0.4921  0.8985\nscale(effort)-Herpailurus yagouaroundi  0.2705 0.2097 -0.1570  0.2766  0.6637\nscale(effort)-Leopardus pardalis        0.4150 0.1203  0.1924  0.4105  0.6712\nscale(effort)-Leopardus tigrinus        0.4375 0.2185  0.0179  0.4318  0.9001\nscale(effort)-Leopardus wiedii          0.4474 0.2043  0.0718  0.4374  0.8667\nscale(effort)-Mazama americana          0.5246 0.1384  0.2784  0.5159  0.8180\nscale(effort)-Mazama nemorivaga         0.2845 0.1489 -0.0016  0.2822  0.5880\nscale(effort)-Myoprocta pratti          0.3487 0.1752  0.0044  0.3503  0.6903\nscale(effort)-Myrmecophaga tridactyla   0.3854 0.1720  0.0649  0.3807  0.7334\nscale(effort)-Nasua nasua               0.5000 0.1883  0.1735  0.4866  0.9150\nscale(effort)-Panthera onca             0.3084 0.1399  0.0511  0.3042  0.5927\nscale(effort)-Pecari tajacu             0.3535 0.0792  0.2010  0.3510  0.5135\nscale(effort)-Priodontes maximus        0.2302 0.1712 -0.1158  0.2342  0.5585\nscale(effort)-Procyon cancrivorous      0.4267 0.2114  0.0164  0.4232  0.8711\nscale(effort)-Puma concolor             0.3910 0.1459  0.1150  0.3864  0.6919\nscale(effort)-Puma yagouaroundi         0.3999 0.2152 -0.0226  0.3906  0.8372\nscale(effort)-Tamandua tetradactyla     0.2815 0.1951 -0.1207  0.2870  0.6659\nscale(effort)-Tapirus terrestris        0.3858 0.0818  0.2291  0.3842  0.5543\nscale(effort)-Tayassu pecari            0.5449 0.1330  0.3087  0.5333  0.8264\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        3.4286   34\n(Intercept)-Coendou prehensilis        1.3341  106\n(Intercept)-Cuniculus paca             1.0034 3000\n(Intercept)-Dasyprocta fuliginosa      1.0095 3000\n(Intercept)-Dasypus sp.                1.0040 2972\n(Intercept)-Didelphis marsupialis      1.0229  830\n(Intercept)-Eira barbara               1.0168  671\n(Intercept)-Herpailurus yagouaroundi   1.2309  164\n(Intercept)-Leopardus pardalis         1.0017 1934\n(Intercept)-Leopardus tigrinus         1.0050 1211\n(Intercept)-Leopardus wiedii           1.1798  196\n(Intercept)-Mazama americana           1.0041 3000\n(Intercept)-Mazama nemorivaga          1.0025 2389\n(Intercept)-Myoprocta pratti           1.0024 2808\n(Intercept)-Myrmecophaga tridactyla    1.0396  232\n(Intercept)-Nasua nasua                1.1009  432\n(Intercept)-Panthera onca              1.0169  490\n(Intercept)-Pecari tajacu              1.0515 2207\n(Intercept)-Priodontes maximus         1.1538  164\n(Intercept)-Procyon cancrivorous       1.0350  101\n(Intercept)-Puma concolor              1.0227 1394\n(Intercept)-Puma yagouaroundi          1.0985  102\n(Intercept)-Tamandua tetradactyla      1.0793  203\n(Intercept)-Tapirus terrestris         1.0000 2853\n(Intercept)-Tayassu pecari             1.0003 1810\nscale(effort)-Atelocynus microtis      1.0074 2629\nscale(effort)-Coendou prehensilis      1.0015 3000\nscale(effort)-Cuniculus paca           1.0008 3000\nscale(effort)-Dasyprocta fuliginosa    1.0001 2970\nscale(effort)-Dasypus sp.              1.0035 3000\nscale(effort)-Didelphis marsupialis    1.0007 2736\nscale(effort)-Eira barbara             1.0032 2334\nscale(effort)-Herpailurus yagouaroundi 1.0007 3000\nscale(effort)-Leopardus pardalis       1.0005 2795\nscale(effort)-Leopardus tigrinus       1.0028 2801\nscale(effort)-Leopardus wiedii         1.0044 2529\nscale(effort)-Mazama americana         1.0018 2760\nscale(effort)-Mazama nemorivaga        1.0018 3000\nscale(effort)-Myoprocta pratti         1.0069 3000\nscale(effort)-Myrmecophaga tridactyla  0.9997 2372\nscale(effort)-Nasua nasua              1.0027 2352\nscale(effort)-Panthera onca            1.0071 2795\nscale(effort)-Pecari tajacu            1.0007 3000\nscale(effort)-Priodontes maximus       1.0016 2658\nscale(effort)-Procyon cancrivorous     1.0025 3000\nscale(effort)-Puma concolor            1.0014 3000\nscale(effort)-Puma yagouaroundi        1.0032 3000\nscale(effort)-Tamandua tetradactyla    1.0007 3000\nscale(effort)-Tapirus terrestris       1.0012 2848\nscale(effort)-Tayassu pecari           1.0016 3000\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  8.9235 9.0901 0.0000  6.4319 26.4508 4.0224    8\nphi-2 13.2789 7.9866 0.4498 13.0502 26.7775 1.0019 3000\nphi-3  4.7494 8.0864 0.0000  0.0000 26.0644 9.1416    3\nphi-4 13.5261 7.9445 0.6362 13.4657 26.8778 1.0001 2677\nphi-5 13.6591 8.0601 0.6792 13.3846 26.8695 1.0007 3000\n\nCodesummary(out.sp, level = 'both')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 30.0153\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -2.7611 0.4954 -3.7565 -2.7599 -1.7782 1.0807 277\nscale(elev)        -0.0372 0.1944 -0.4196 -0.0382  0.3414 1.1540 850\nscale(border_dist) -0.4589 0.3319 -1.1346 -0.4491  0.1698 1.0799 895\nscale(FLII)         0.5170 0.2460  0.0567  0.5049  1.0430 1.0122 885\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat  ESS\n(Intercept)        5.1766 2.1408 2.2988 4.7363 10.7314 1.1570  346\nscale(elev)        0.4771 0.2324 0.1718 0.4252  1.0559 1.0385 1145\nscale(border_dist) 2.0565 0.8866 0.8445 1.8913  4.2675 1.0374  438\nscale(FLII)        0.9112 0.4685 0.3170 0.8046  2.0406 1.0008  496\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.2605 0.2700 -2.8176 -2.2461 -1.7495 1.1593  329\nscale(effort)  0.3955 0.0653  0.2704  0.3935  0.5316 1.0033 2257\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.5039 0.6865 0.6342 1.3541 3.2076 1.2673  106\nscale(effort) 0.0454 0.0261 0.0160 0.0392 0.1110 1.0008 2566\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis             -2.5173 1.0719 -3.9337 -2.7944\n(Intercept)-Coendou prehensilis             -5.4512 1.7234 -8.7614 -5.5698\n(Intercept)-Cuniculus paca                   0.1873 0.4071 -0.5579  0.1865\n(Intercept)-Dasyprocta fuliginosa           -1.3041 1.1359 -3.5264 -1.2099\n(Intercept)-Dasypus sp.                     -5.2100 0.9039 -7.1616 -5.1349\n(Intercept)-Didelphis marsupialis           -3.9183 0.8388 -5.6388 -3.8827\n(Intercept)-Eira barbara                    -1.9932 0.7638 -3.5520 -1.9924\n(Intercept)-Herpailurus yagouaroundi        -4.2024 1.4525 -7.0260 -4.2391\n(Intercept)-Leopardus pardalis              -1.5218 0.3763 -2.3396 -1.4991\n(Intercept)-Leopardus tigrinus              -6.9693 1.1498 -9.3426 -6.9447\n(Intercept)-Leopardus wiedii                -3.2074 1.0814 -5.2825 -3.2580\n(Intercept)-Mazama americana                -2.6124 0.5827 -3.9639 -2.5256\n(Intercept)-Mazama nemorivaga               -5.6219 0.9905 -7.7977 -5.5421\n(Intercept)-Myoprocta pratti                -4.7108 0.8809 -6.6393 -4.6596\n(Intercept)-Myrmecophaga tridactyla         -1.7860 0.9374 -3.5221 -1.8715\n(Intercept)-Nasua nasua                     -1.9922 0.9136 -3.8450 -1.9965\n(Intercept)-Panthera onca                   -1.9128 0.6800 -3.3508 -1.8930\n(Intercept)-Pecari tajacu                    0.4194 0.7086 -1.0669  0.4871\n(Intercept)-Priodontes maximus              -1.6390 1.1842 -3.7822 -1.7003\n(Intercept)-Procyon cancrivorous            -4.9635 1.4579 -7.8134 -4.9880\n(Intercept)-Puma concolor                   -2.9256 0.6688 -4.4458 -2.8550\n(Intercept)-Puma yagouaroundi               -5.0322 1.6389 -8.0014 -5.1341\n(Intercept)-Tamandua tetradactyla           -3.3869 1.1391 -5.6753 -3.4186\n(Intercept)-Tapirus terrestris              -0.3091 0.4660 -1.2972 -0.2661\n(Intercept)-Tayassu pecari                  -1.5618 0.5460 -2.7912 -1.5187\nscale(elev)-Atelocynus microtis             -0.6795 0.4607 -1.6793 -0.6568\nscale(elev)-Coendou prehensilis              0.2016 0.6051 -0.9566  0.1761\nscale(elev)-Cuniculus paca                  -0.1456 0.2690 -0.6826 -0.1429\nscale(elev)-Dasyprocta fuliginosa            0.8599 0.4573 -0.1191  0.8688\nscale(elev)-Dasypus sp.                     -0.2859 0.2911 -0.8687 -0.2831\nscale(elev)-Didelphis marsupialis            0.1060 0.4523 -0.7272  0.0949\nscale(elev)-Eira barbara                    -0.9852 0.4773 -2.0155 -0.9490\nscale(elev)-Herpailurus yagouaroundi        -0.4436 0.6313 -1.7201 -0.4200\nscale(elev)-Leopardus pardalis               0.3041 0.3235 -0.3392  0.3005\nscale(elev)-Leopardus tigrinus              -0.2349 0.6160 -1.4665 -0.2163\nscale(elev)-Leopardus wiedii                -0.1222 0.4773 -1.0382 -0.1275\nscale(elev)-Mazama americana                 1.2261 0.3805  0.5285  1.2061\nscale(elev)-Mazama nemorivaga                0.5441 0.3884 -0.1647  0.5344\nscale(elev)-Myoprocta pratti                 0.0385 0.4762 -0.8527  0.0181\nscale(elev)-Myrmecophaga tridactyla         -0.4303 0.4509 -1.3868 -0.4068\nscale(elev)-Nasua nasua                     -0.2548 0.4632 -1.1907 -0.2454\nscale(elev)-Panthera onca                    0.1494 0.4052 -0.6333  0.1401\nscale(elev)-Pecari tajacu                    0.6037 0.3436 -0.0837  0.5997\nscale(elev)-Priodontes maximus              -0.2231 0.5187 -1.2885 -0.2090\nscale(elev)-Procyon cancrivorous            -0.1784 0.5066 -1.1401 -0.1878\nscale(elev)-Puma concolor                   -0.3868 0.3827 -1.1346 -0.3870\nscale(elev)-Puma yagouaroundi               -0.3696 0.5411 -1.4343 -0.3815\nscale(elev)-Tamandua tetradactyla           -0.0505 0.5550 -1.2236 -0.0482\nscale(elev)-Tapirus terrestris               0.2339 0.2977 -0.3225  0.2220\nscale(elev)-Tayassu pecari                  -0.4401 0.3188 -1.0760 -0.4358\nscale(border_dist)-Atelocynus microtis      -0.1040 0.4601 -0.9701 -0.1124\nscale(border_dist)-Coendou prehensilis      -0.6611 0.9902 -2.7998 -0.5842\nscale(border_dist)-Cuniculus paca           -1.2495 0.3798 -2.0256 -1.2391\nscale(border_dist)-Dasyprocta fuliginosa    -0.5637 0.7374 -1.8886 -0.6360\nscale(border_dist)-Dasypus sp.              -4.0608 0.8583 -5.8878 -4.0247\nscale(border_dist)-Didelphis marsupialis     1.2427 0.5531  0.1607  1.2166\nscale(border_dist)-Eira barbara             -1.6165 0.6216 -2.9293 -1.5937\nscale(border_dist)-Herpailurus yagouaroundi  0.0974 0.9840 -1.8233  0.0702\nscale(border_dist)-Leopardus pardalis        1.1100 0.3651  0.4592  1.0941\nscale(border_dist)-Leopardus tigrinus       -0.0452 0.8988 -1.8211 -0.0628\nscale(border_dist)-Leopardus wiedii          0.4129 0.5755 -0.6960  0.3801\nscale(border_dist)-Mazama americana          0.7601 0.3915 -0.0159  0.7666\nscale(border_dist)-Mazama nemorivaga        -3.1633 0.8865 -5.0055 -3.1105\nscale(border_dist)-Myoprocta pratti         -0.2613 0.6597 -1.5601 -0.2578\nscale(border_dist)-Myrmecophaga tridactyla  -0.3333 0.5332 -1.5022 -0.3107\nscale(border_dist)-Nasua nasua              -0.7209 0.6225 -2.0352 -0.7064\nscale(border_dist)-Panthera onca             0.5991 0.5032 -0.3344  0.5795\nscale(border_dist)-Pecari tajacu            -0.4068 0.4605 -1.2674 -0.4185\nscale(border_dist)-Priodontes maximus        0.2239 0.7064 -1.1391  0.1874\nscale(border_dist)-Procyon cancrivorous     -1.7161 0.9004 -3.6384 -1.6456\nscale(border_dist)-Puma concolor            -0.0506 0.4652 -0.9202 -0.0691\nscale(border_dist)-Puma yagouaroundi        -1.3313 0.8941 -3.2487 -1.2827\nscale(border_dist)-Tamandua tetradactyla    -0.1388 0.7359 -1.5393 -0.1511\nscale(border_dist)-Tapirus terrestris       -0.2207 0.3598 -0.9291 -0.2216\nscale(border_dist)-Tayassu pecari            0.2105 0.3731 -0.4775  0.1936\nscale(FLII)-Atelocynus microtis              0.2162 0.4043 -0.5393  0.1876\nscale(FLII)-Coendou prehensilis              0.5833 0.8316 -0.9115  0.5376\nscale(FLII)-Cuniculus paca                  -0.3398 0.2082 -0.7608 -0.3320\nscale(FLII)-Dasyprocta fuliginosa           -1.0294 0.3186 -1.6546 -1.0241\nscale(FLII)-Dasypus sp.                      0.5703 0.6903 -0.6869  0.5438\nscale(FLII)-Didelphis marsupialis            1.1550 0.5256  0.2919  1.0959\nscale(FLII)-Eira barbara                    -0.4560 0.4952 -1.4884 -0.4208\nscale(FLII)-Herpailurus yagouaroundi         0.4745 0.7454 -0.9289  0.4466\nscale(FLII)-Leopardus pardalis               1.1397 0.3771  0.4929  1.1076\nscale(FLII)-Leopardus tigrinus               0.7411 0.8301 -0.6506  0.6506\nscale(FLII)-Leopardus wiedii                 0.9992 0.6638 -0.1296  0.9479\nscale(FLII)-Mazama americana                 0.4242 0.2891 -0.0963  0.4028\nscale(FLII)-Mazama nemorivaga                0.8028 0.7990 -0.5547  0.7441\nscale(FLII)-Myoprocta pratti                 0.7582 0.5834 -0.2595  0.7023\nscale(FLII)-Myrmecophaga tridactyla          0.3715 0.4431 -0.4923  0.3575\nscale(FLII)-Nasua nasua                     -0.5512 0.5117 -1.7382 -0.4974\nscale(FLII)-Panthera onca                    1.4655 0.6269  0.3808  1.4191\nscale(FLII)-Pecari tajacu                    0.5874 0.2874  0.0654  0.5701\nscale(FLII)-Priodontes maximus               0.2011 0.5526 -0.9146  0.2042\nscale(FLII)-Procyon cancrivorous             0.8248 0.8854 -0.8008  0.7860\nscale(FLII)-Puma concolor                    1.3410 0.6105  0.3110  1.2911\nscale(FLII)-Puma yagouaroundi                0.6554 0.8666 -0.9249  0.5852\nscale(FLII)-Tamandua tetradactyla           -0.6893 0.5788 -1.9848 -0.6390\nscale(FLII)-Tapirus terrestris               1.0290 0.3384  0.4447  0.9974\nscale(FLII)-Tayassu pecari                   1.7948 0.5805  0.8339  1.7362\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis              0.1630 3.4943   77\n(Intercept)-Coendou prehensilis             -1.6162 1.3372  115\n(Intercept)-Cuniculus paca                   0.9270 4.4260    7\n(Intercept)-Dasyprocta fuliginosa            0.6509 5.2340    7\n(Intercept)-Dasypus sp.                     -3.6647 1.0256  366\n(Intercept)-Didelphis marsupialis           -2.3853 1.9953   61\n(Intercept)-Eira barbara                    -0.5427 1.3295  201\n(Intercept)-Herpailurus yagouaroundi        -1.1533 1.2503  116\n(Intercept)-Leopardus pardalis              -0.8511 1.0177  474\n(Intercept)-Leopardus tigrinus              -4.8671 1.0263  314\n(Intercept)-Leopardus wiedii                -0.9601 1.4396  152\n(Intercept)-Mazama americana                -1.7187 1.4813  202\n(Intercept)-Mazama nemorivaga               -3.9009 1.1896  396\n(Intercept)-Myoprocta pratti                -3.1450 2.0065  118\n(Intercept)-Myrmecophaga tridactyla          0.2959 1.0422  187\n(Intercept)-Nasua nasua                     -0.1634 1.6135  130\n(Intercept)-Panthera onca                   -0.6570 1.4455  197\n(Intercept)-Pecari tajacu                    1.6999 4.2850    9\n(Intercept)-Priodontes maximus               0.8206 1.2089  105\n(Intercept)-Procyon cancrivorous            -2.0570 1.2222  101\n(Intercept)-Puma concolor                   -1.7845 1.8071   57\n(Intercept)-Puma yagouaroundi               -1.5904 1.0926  108\n(Intercept)-Tamandua tetradactyla           -1.0210 1.1089  145\n(Intercept)-Tapirus terrestris               0.5633 3.7843    8\n(Intercept)-Tayassu pecari                  -0.6291 2.9047   15\nscale(elev)-Atelocynus microtis              0.1768 1.0828 1135\nscale(elev)-Coendou prehensilis              1.4312 1.0489 1254\nscale(elev)-Cuniculus paca                   0.3539 1.0833  321\nscale(elev)-Dasyprocta fuliginosa            1.7494 1.4850  102\nscale(elev)-Dasypus sp.                      0.2698 1.0106 2104\nscale(elev)-Didelphis marsupialis            1.0594 1.0311 1230\nscale(elev)-Eira barbara                    -0.1166 1.0133 1030\nscale(elev)-Herpailurus yagouaroundi         0.7641 1.0631 1340\nscale(elev)-Leopardus pardalis               0.9502 1.0323 1124\nscale(elev)-Leopardus tigrinus               0.9440 1.0123 1918\nscale(elev)-Leopardus wiedii                 0.8115 1.0315 1815\nscale(elev)-Mazama americana                 2.0137 1.1087  603\nscale(elev)-Mazama nemorivaga                1.3553 1.0433 1111\nscale(elev)-Myoprocta pratti                 1.0252 1.1106  462\nscale(elev)-Myrmecophaga tridactyla          0.4233 1.0858 1038\nscale(elev)-Nasua nasua                      0.6588 1.0470 1403\nscale(elev)-Panthera onca                    0.9567 1.0482  880\nscale(elev)-Pecari tajacu                    1.2818 1.2664  239\nscale(elev)-Priodontes maximus               0.7682 1.0431 1348\nscale(elev)-Procyon cancrivorous             0.8498 1.0006  825\nscale(elev)-Puma concolor                    0.3668 1.1162  604\nscale(elev)-Puma yagouaroundi                0.7427 1.0175 1006\nscale(elev)-Tamandua tetradactyla            1.0254 1.0131 1412\nscale(elev)-Tapirus terrestris               0.8563 1.2274  432\nscale(elev)-Tayassu pecari                   0.1469 1.2317  257\nscale(border_dist)-Atelocynus microtis       0.8099 1.1152  715\nscale(border_dist)-Coendou prehensilis       1.1582 1.0117  318\nscale(border_dist)-Cuniculus paca           -0.5146 1.5205   54\nscale(border_dist)-Dasyprocta fuliginosa     1.0604 2.0477   33\nscale(border_dist)-Dasypus sp.              -2.5126 1.0497  383\nscale(border_dist)-Didelphis marsupialis     2.3785 1.2809  133\nscale(border_dist)-Eira barbara             -0.4721 1.0355  665\nscale(border_dist)-Herpailurus yagouaroundi  2.1216 1.0534  369\nscale(border_dist)-Leopardus pardalis        1.8740 1.0002 1813\nscale(border_dist)-Leopardus tigrinus        1.7372 1.0238  861\nscale(border_dist)-Leopardus wiedii          1.5794 1.0611  694\nscale(border_dist)-Mazama americana          1.5115 1.0763  325\nscale(border_dist)-Mazama nemorivaga        -1.5573 1.1611  413\nscale(border_dist)-Myoprocta pratti          1.0760 1.2949  137\nscale(border_dist)-Myrmecophaga tridactyla   0.6404 1.0078  767\nscale(border_dist)-Nasua nasua               0.4468 1.2030  335\nscale(border_dist)-Panthera onca             1.6249 1.0939  848\nscale(border_dist)-Pecari tajacu             0.5492 1.6689   39\nscale(border_dist)-Priodontes maximus        1.6807 1.1737  384\nscale(border_dist)-Procyon cancrivorous     -0.1425 1.0299  419\nscale(border_dist)-Puma concolor             0.9134 1.2439  126\nscale(border_dist)-Puma yagouaroundi         0.3016 1.0288  406\nscale(border_dist)-Tamandua tetradactyla     1.3166 1.0413  741\nscale(border_dist)-Tapirus terrestris        0.4983 1.2439  146\nscale(border_dist)-Tayassu pecari            0.9672 1.3912  123\nscale(FLII)-Atelocynus microtis              1.0503 1.1043  802\nscale(FLII)-Coendou prehensilis              2.3472 1.0023  775\nscale(FLII)-Cuniculus paca                   0.0495 1.0041 1565\nscale(FLII)-Dasyprocta fuliginosa           -0.4221 1.0228  428\nscale(FLII)-Dasypus sp.                      1.9990 1.0017 1259\nscale(FLII)-Didelphis marsupialis            2.3503 1.0243  783\nscale(FLII)-Eira barbara                     0.4375 1.0083  729\nscale(FLII)-Herpailurus yagouaroundi         2.0757 1.0171  807\nscale(FLII)-Leopardus pardalis               1.9778 1.0104 1202\nscale(FLII)-Leopardus tigrinus               2.5449 1.0108  885\nscale(FLII)-Leopardus wiedii                 2.3924 1.0072  685\nscale(FLII)-Mazama americana                 1.0472 1.1076  672\nscale(FLII)-Mazama nemorivaga                2.5582 1.0187  986\nscale(FLII)-Myoprocta pratti                 2.0611 1.0038 1105\nscale(FLII)-Myrmecophaga tridactyla          1.2919 1.0151 1022\nscale(FLII)-Nasua nasua                      0.2977 1.1048  331\nscale(FLII)-Panthera onca                    2.8124 1.0077  773\nscale(FLII)-Pecari tajacu                    1.2021 1.0521  423\nscale(FLII)-Priodontes maximus               1.3048 1.0220  703\nscale(FLII)-Procyon cancrivorous             2.6493 1.0065  561\nscale(FLII)-Puma concolor                    2.6847 1.0248  797\nscale(FLII)-Puma yagouaroundi                2.5027 1.0045  679\nscale(FLII)-Tamandua tetradactyla            0.3112 1.0159  562\nscale(FLII)-Tapirus terrestris               1.7777 1.0181  896\nscale(FLII)-Tayassu pecari                   3.1378 1.0019  964\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -3.0201 0.8089 -4.7187 -2.8665 -1.7653\n(Intercept)-Coendou prehensilis        -3.7274 1.2270 -6.3725 -3.6024 -1.6674\n(Intercept)-Cuniculus paca             -0.7034 0.0588 -0.8191 -0.7035 -0.5914\n(Intercept)-Dasyprocta fuliginosa      -0.4486 0.0685 -0.5890 -0.4480 -0.3146\n(Intercept)-Dasypus sp.                -1.5297 0.1277 -1.7825 -1.5291 -1.2816\n(Intercept)-Didelphis marsupialis      -2.2225 0.3585 -2.9726 -2.2016 -1.5703\n(Intercept)-Eira barbara               -3.0061 0.2288 -3.4562 -3.0043 -2.5640\n(Intercept)-Herpailurus yagouaroundi   -3.6227 0.8534 -5.2392 -3.6211 -2.0292\n(Intercept)-Leopardus pardalis         -1.7960 0.1609 -2.1121 -1.7923 -1.4875\n(Intercept)-Leopardus tigrinus         -1.2974 0.9703 -3.3709 -1.2317  0.4554\n(Intercept)-Leopardus wiedii           -3.2309 0.6724 -4.5121 -3.2208 -1.9812\n(Intercept)-Mazama americana           -1.1923 0.1145 -1.4242 -1.1893 -0.9702\n(Intercept)-Mazama nemorivaga          -2.0094 0.1825 -2.3611 -2.0102 -1.6529\n(Intercept)-Myoprocta pratti           -1.3795 0.2433 -1.8825 -1.3702 -0.9100\n(Intercept)-Myrmecophaga tridactyla    -3.0316 0.4590 -3.9425 -3.0033 -2.1732\n(Intercept)-Nasua nasua                -3.0199 0.2886 -3.5948 -3.0179 -2.4751\n(Intercept)-Panthera onca              -2.4552 0.2404 -2.9369 -2.4485 -1.9991\n(Intercept)-Pecari tajacu              -1.2419 0.0737 -1.3870 -1.2414 -1.1001\n(Intercept)-Priodontes maximus         -3.5773 0.4800 -4.4927 -3.5784 -2.6447\n(Intercept)-Procyon cancrivorous       -3.6308 0.8324 -5.3690 -3.5858 -2.1633\n(Intercept)-Puma concolor              -1.7334 0.2056 -2.1609 -1.7266 -1.3528\n(Intercept)-Puma yagouaroundi          -3.7902 0.9880 -5.7765 -3.7237 -2.0481\n(Intercept)-Tamandua tetradactyla      -3.4662 0.5853 -4.6464 -3.4358 -2.3856\n(Intercept)-Tapirus terrestris         -1.1063 0.0773 -1.2595 -1.1051 -0.9584\n(Intercept)-Tayassu pecari             -1.6780 0.1457 -1.9735 -1.6751 -1.3953\nscale(effort)-Atelocynus microtis       0.3415 0.1828 -0.0082  0.3371  0.7149\nscale(effort)-Coendou prehensilis       0.3957 0.2171 -0.0271  0.3906  0.8344\nscale(effort)-Cuniculus paca            0.3395 0.0689  0.2064  0.3390  0.4786\nscale(effort)-Dasyprocta fuliginosa     0.4121 0.0878  0.2441  0.4110  0.5868\nscale(effort)-Dasypus sp.               0.4412 0.1350  0.1980  0.4351  0.7216\nscale(effort)-Didelphis marsupialis     0.5480 0.1950  0.2086  0.5335  0.9748\nscale(effort)-Eira barbara              0.5033 0.1823  0.1712  0.4921  0.8985\nscale(effort)-Herpailurus yagouaroundi  0.2705 0.2097 -0.1570  0.2766  0.6637\nscale(effort)-Leopardus pardalis        0.4150 0.1203  0.1924  0.4105  0.6712\nscale(effort)-Leopardus tigrinus        0.4375 0.2185  0.0179  0.4318  0.9001\nscale(effort)-Leopardus wiedii          0.4474 0.2043  0.0718  0.4374  0.8667\nscale(effort)-Mazama americana          0.5246 0.1384  0.2784  0.5159  0.8180\nscale(effort)-Mazama nemorivaga         0.2845 0.1489 -0.0016  0.2822  0.5880\nscale(effort)-Myoprocta pratti          0.3487 0.1752  0.0044  0.3503  0.6903\nscale(effort)-Myrmecophaga tridactyla   0.3854 0.1720  0.0649  0.3807  0.7334\nscale(effort)-Nasua nasua               0.5000 0.1883  0.1735  0.4866  0.9150\nscale(effort)-Panthera onca             0.3084 0.1399  0.0511  0.3042  0.5927\nscale(effort)-Pecari tajacu             0.3535 0.0792  0.2010  0.3510  0.5135\nscale(effort)-Priodontes maximus        0.2302 0.1712 -0.1158  0.2342  0.5585\nscale(effort)-Procyon cancrivorous      0.4267 0.2114  0.0164  0.4232  0.8711\nscale(effort)-Puma concolor             0.3910 0.1459  0.1150  0.3864  0.6919\nscale(effort)-Puma yagouaroundi         0.3999 0.2152 -0.0226  0.3906  0.8372\nscale(effort)-Tamandua tetradactyla     0.2815 0.1951 -0.1207  0.2870  0.6659\nscale(effort)-Tapirus terrestris        0.3858 0.0818  0.2291  0.3842  0.5543\nscale(effort)-Tayassu pecari            0.5449 0.1330  0.3087  0.5333  0.8264\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        3.4286   34\n(Intercept)-Coendou prehensilis        1.3341  106\n(Intercept)-Cuniculus paca             1.0034 3000\n(Intercept)-Dasyprocta fuliginosa      1.0095 3000\n(Intercept)-Dasypus sp.                1.0040 2972\n(Intercept)-Didelphis marsupialis      1.0229  830\n(Intercept)-Eira barbara               1.0168  671\n(Intercept)-Herpailurus yagouaroundi   1.2309  164\n(Intercept)-Leopardus pardalis         1.0017 1934\n(Intercept)-Leopardus tigrinus         1.0050 1211\n(Intercept)-Leopardus wiedii           1.1798  196\n(Intercept)-Mazama americana           1.0041 3000\n(Intercept)-Mazama nemorivaga          1.0025 2389\n(Intercept)-Myoprocta pratti           1.0024 2808\n(Intercept)-Myrmecophaga tridactyla    1.0396  232\n(Intercept)-Nasua nasua                1.1009  432\n(Intercept)-Panthera onca              1.0169  490\n(Intercept)-Pecari tajacu              1.0515 2207\n(Intercept)-Priodontes maximus         1.1538  164\n(Intercept)-Procyon cancrivorous       1.0350  101\n(Intercept)-Puma concolor              1.0227 1394\n(Intercept)-Puma yagouaroundi          1.0985  102\n(Intercept)-Tamandua tetradactyla      1.0793  203\n(Intercept)-Tapirus terrestris         1.0000 2853\n(Intercept)-Tayassu pecari             1.0003 1810\nscale(effort)-Atelocynus microtis      1.0074 2629\nscale(effort)-Coendou prehensilis      1.0015 3000\nscale(effort)-Cuniculus paca           1.0008 3000\nscale(effort)-Dasyprocta fuliginosa    1.0001 2970\nscale(effort)-Dasypus sp.              1.0035 3000\nscale(effort)-Didelphis marsupialis    1.0007 2736\nscale(effort)-Eira barbara             1.0032 2334\nscale(effort)-Herpailurus yagouaroundi 1.0007 3000\nscale(effort)-Leopardus pardalis       1.0005 2795\nscale(effort)-Leopardus tigrinus       1.0028 2801\nscale(effort)-Leopardus wiedii         1.0044 2529\nscale(effort)-Mazama americana         1.0018 2760\nscale(effort)-Mazama nemorivaga        1.0018 3000\nscale(effort)-Myoprocta pratti         1.0069 3000\nscale(effort)-Myrmecophaga tridactyla  0.9997 2372\nscale(effort)-Nasua nasua              1.0027 2352\nscale(effort)-Panthera onca            1.0071 2795\nscale(effort)-Pecari tajacu            1.0007 3000\nscale(effort)-Priodontes maximus       1.0016 2658\nscale(effort)-Procyon cancrivorous     1.0025 3000\nscale(effort)-Puma concolor            1.0014 3000\nscale(effort)-Puma yagouaroundi        1.0032 3000\nscale(effort)-Tamandua tetradactyla    1.0007 3000\nscale(effort)-Tapirus terrestris       1.0012 2848\nscale(effort)-Tayassu pecari           1.0016 3000\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  8.9235 9.0901 0.0000  6.4319 26.4508 4.0224    8\nphi-2 13.2789 7.9866 0.4498 13.0502 26.7775 1.0019 3000\nphi-3  4.7494 8.0864 0.0000  0.0000 26.0644 9.1416    3\nphi-4 13.5261 7.9445 0.6362 13.4657 26.8778 1.0001 2677\nphi-5 13.6591 8.0601 0.6792 13.3846 26.8695 1.0007 3000\n\n\nBayesian p-values can be inspected to check for lack of fit (overall or by species). Lack of fit at significance level = 0.05 is indicated by Bayesian p-values below 0.025 or greater than 0.975. The overall Bayesian p-value (Bpvalue) indicates no problems with lack of fit. Likewise, species-level Bayesian p-values (Bpvalue_species) indicate no lack of fit for any species.\n\nGelman and Rubin’s convergence diagnostic: Approximate convergence is diagnosed when the upper limit is close to 1.\n\nConvergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable. The gelman.diag diagnostic is applied to a single variable from the chain. It is based a comparison of within-chain and between-chain variances, and is similar to a classical analysis of variance.\nValues substantially above 1 indicate lack of convergence.\nModel Diagnostics\n\nCode#| eval: true\n#| echo: true\n#| code-fold: true\n#| warning: false\n#| message: false\n# Extract posterior draws for later use\nposterior1 &lt;- as.array(out.sp)\n\n# Trace plots to check chain mixing. Extract posterior samples and bind in a single matrix.\nPOSTERIOR.MATRIX &lt;- cbind(out.sp$alpha.comm.samples, \n                          out.sp$beta.comm.samples,  \n                          out.sp$alpha.samples, \n                          out.sp$beta.samples)\n\n# Matrix output is all chains combined, split into 3 chains.\nCHAIN.1 &lt;- as.mcmc(POSTERIOR.MATRIX[1:1000,])\nCHAIN.2 &lt;- as.mcmc(POSTERIOR.MATRIX[1001:2000,])\nCHAIN.3 &lt;- as.mcmc(POSTERIOR.MATRIX[2001:3000,])\n# CHAIN.4 &lt;- as.mcmc(POSTERIOR.MATRIX[8001:10000,])\n\n# Bind four chains as coda mcmc.list object.\nPOSTERIOR.CHAINS &lt;- mcmc.list(CHAIN.1, CHAIN.2, CHAIN.3)#, CHAIN.4)\n\n# Create an empty folder.\n# dir.create (\"Beetle_plots\")\n\n# Plot chain mixing of each parameter to a multi-panel plot and save to the new folder. ART 5 mins\n\n######################################\n#### SAVE Diagnostics at PDF\n# MCMCtrace(POSTERIOR.CHAINS, params = \"all\", Rhat = TRUE, n.eff = TRUE)#, pdf = TRUE, filename = \"Beetle_240909_traceplots.pdf\", wd = \"Beetle_plots\")\n\n\n\n#mcmc_trace(fit.commu, parms = c(\"beta.ranef.cont.border_dist.mean\"))\n\n#posterior2 &lt;- extract(fit.commu, inc_warmup = TRUE, permuted = FALSE)\n\n#color_scheme_set(\"mix-blue-pink\")\n#p &lt;- mcmc_trace(posterior1,  pars = c(\"mu\", \"tau\"), n_warmup = 300,\n#                facet_args = list(nrow = 2, labeller = label_parsed))\n#p + facet_text(size = 15)\n\n\n\n#outMCMC &lt;- fit.commu #Convert output to MCMC object\n#diagnostics chains \n\n# all as pdf\n# MCMCtrace(outMCMC)\n\n# MCMCtrace(outMCMC, params = c(\"alpha0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(out.sp, params = c(\"beta.ranef.cont.border_dist.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n\n### density\n# MCMCtrace(outMCMC, params = c(\"Nspecies\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n#MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n#coda::gelman.diag(outMCMC,  multivariate = FALSE, transform=FALSE)\n                    \n# coda::gelman.plot(outMCMC,  multivariate = FALSE)\n\n\n\n# \n# mcmc_intervals(outMCMC, pars = c(\"Nspecies_in_AP[1]\",\n#                                  \"Nspecies_in_AP[2]\"),\n#                point_est = \"mean\",\n#                prob = 0.75, prob_outer = 0.95) +\n#   ggtitle(\"Number of species\") + \n#   scale_y_discrete(labels = c(\"Nspecies_in_AP[1]\"=levels(sitecovs$in_AP)[1],\n#              \"Nspecies_in_AP[2]\"=levels(sitecovs$in_AP)[2]))\n# \n# #Continuous\n# p &lt;- mcmc_intervals(outMCMC, \n#                pars = c(\"beta.ranef.cont.border_dist.mean\",\n#                          #\"beta.ranef.cont.elev.mean\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"))\n# \n# # relabel parameters\n# p + scale_y_discrete(\n#   labels = c(\"beta.ranef.cont.border_dist.mean\"=\"Dist_border\",\n#                          #\"beta.ranef.cont.elev.mean\"=\"Elevation\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"=\"in_AP\")\n# ) +\n#   ggtitle(\"Treatment effect on all species\")\n# \n\n\nPosterior Summary (effect)\nCommunity effects\nCode# Create simple plot summaries using MCMCvis package.\n# Detection covariate effects --------- \nMCMCplot(out.sp$alpha.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n# Occupancy community-level effects \nMCMCplot(out.sp$beta.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) Detection\n\n\n\n\n\n\n\n\n\n(b) Occupancy\n\n\n\n\n\n\nFigure 1: Community effects\n\n\nSpecies effects\nCode# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,26:50], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,51:75], ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) elevation\n\n\n\n\n\n\n\n\n\n(b) distance border\n\n\n\n\n\n\nFigure 2: Species effects\n\n\nSpecies effects using bayesplot\n\n\nCodelibrary(bayesplot)\n#mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n# mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n\nmcmc_intervals(out.sp$beta.samples[,26:50] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,51:75] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,76:100] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\n\nPrediction as graph\nThis prediction uses the non spatial model\n\nCode# 6. Prediction -----------------------------------------------------------\n# Predict occupancy along a gradient of elev   \n# Create a set of values across the range of observed elev values\nelev.pred.vals &lt;- seq(min(data_list$occ.covs$elev), \n                              max(data_list$occ.covs$elev), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nelev.pred.vals.scale &lt;- (elev.pred.vals - mean(data_list$occ.covs$elev)) / \n                             sd(data_list$occ.covs$elev)\n# Create a set of values across the range of observed elev values\nborder_dist.pred.vals &lt;- seq(min(data_list$occ.covs$border_dist), \n                              max(data_list$occ.covs$border_dist), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nborder_dist.pred.vals.scale &lt;- (border_dist.pred.vals -\n                                  mean(data_list$occ.covs$border_dist)) /\n                                  sd(data_list$occ.covs$border_dist)\n\n# Create a set of values across the range of observed FLII values\nFLII.pred.vals &lt;- seq(min(data_list$occ.covs$FLII), \n                              max(data_list$occ.covs$FLII), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nFLII.pred.vals.scale &lt;- (FLII.pred.vals -\n                                  mean(data_list$occ.covs$FLII)) /\n                                  sd(data_list$occ.covs$FLII)\n\n# Predict occupancy across elev  values at mean values of all other variables\npred.df1 &lt;- as.matrix(data.frame(intercept = 1, \n                                 elev = elev.pred.vals.scale, \n                                 border_dist = 0,\n                                 FLII=0))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df2 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = border_dist.pred.vals.scale,\n                         FLII= 0 ))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df3 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = 0,\n                         FLII= FLII.pred.vals.scale ))#, catchment = 0, density = 0, \n                         # slope = 0))\n\nout.pred1 &lt;- predict(out, pred.df1) # using non spatial\nstr(out.pred1)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.0664 0.1062 0.1333 0.1399 0.1003 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 0 0 0 1 1 0 0 1 0 ...\n $ call         : language predict.msPGOcc(object = out, X.0 = pred.df1)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred1$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           elev = elev.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(elev.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = elev, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'elevation (m)', y = 'Occupancy Probability') \n\n\n\n\n\n\nCodeout.pred2 &lt;- predict(out, pred.df2) # using non spatial\nstr(out.pred2)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.0726 0.1975 0.15 0.1059 0.0332 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 1 0 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out, X.0 = pred.df2)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred2$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           border_dist = border_dist.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(border_dist.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = border_dist/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'border_dist (Km)', y = 'Occupancy Probability') \n\n\n\n\n\n\nCodeout.pred3 &lt;- predict(out, pred.df3) # using non spatial\nstr(out.pred3)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.0348 0.14116 0.09034 0.01307 0.00479 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 0 0 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out, X.0 = pred.df3)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred3$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           FLII = FLII.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(FLII.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = FLII/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'FLII', y = 'Occupancy Probability') \n\n\n\n\n\n\n\nSpatial Prediction in elevation_EC\n\nCode#aggregate  resolution to (factor = 3)\n#transform coord data to UTM\nelevation_UTM &lt;- project(elevation_EC, \"EPSG:10603\")\nelevation_17.aggregate &lt;- aggregate(elevation_UTM, fact=10)\nres(elevation_17.aggregate)\n\n[1] 5984.313 5984.313\n\nCode# Convert the SpatRaster to a data frame with coordinates\ndf_coords &lt;- as.data.frame(elevation_17.aggregate, xy = TRUE)\nnames(df_coords) &lt;-c(\"X\",\"Y\",\"elev\")\n\nelev.pred &lt;- (df_coords$elev - mean(data_list$occ.covs$elev)) / sd(data_list$occ.covs$elev)\n\n\n############### Predict new data ############### \n# we predict at one covariate varing and others at mean value = 0\n# intercept = 1, elev = 0, border_dist = 0, FLII= 0\n# in that order\n################ ################ ################ \npredict_data &lt;- cbind(1, elev.pred, 0, 0)\ncolnames(predict_data) &lt;- c(\"intercept\",\n                            \"elev\",\n                            \"border_dist\",\n                            \"FLII\" )\n\n# X.0 &lt;- cbind(1, 1, elev.pred)#, elev.pred^2)\n\n# coords.0 &lt;- as.matrix(hbefElev[, c('Easting', 'Northing')])\nout.sp.ms.pred &lt;- predict(out.sp, \n                          X.0=predict_data, \n                          df_coords[,1:2],\n                          threads=4) #Warning :'threads' is not an argument\n\nWarning in predict.sfMsPGOcc(out.sp, X.0 = predict_data, df_coords[, 1:2], :\n'threads' is not an argument\n\n\n----------------------------------------\n    Prediction description\n----------------------------------------\nSpatial Factor NNGP Multispecies Occupancy model with Polya-Gamma latent\nvariable fit with 428 observations.\n\nNumber of covariates 4 (including intercept if specified).\n\nUsing the exponential spatial correlation model.\n\nUsing 15 nearest neighbors.\nUsing 5 latent spatial factors.\n\nNumber of MCMC samples 3000.\n\nPredicting at 2618 non-sampled locations.\n\n\nSource compiled with OpenMP support and model fit using 1 threads.\n-------------------------------------------------\n        Predicting\n-------------------------------------------------\nLocation: 100 of 2618, 3.82%\nLocation: 200 of 2618, 7.64%\nLocation: 300 of 2618, 11.46%\nLocation: 400 of 2618, 15.28%\nLocation: 500 of 2618, 19.10%\nLocation: 600 of 2618, 22.92%\nLocation: 700 of 2618, 26.74%\nLocation: 800 of 2618, 30.56%\nLocation: 900 of 2618, 34.38%\nLocation: 1000 of 2618, 38.20%\nLocation: 1100 of 2618, 42.02%\nLocation: 1200 of 2618, 45.84%\nLocation: 1300 of 2618, 49.66%\nLocation: 1400 of 2618, 53.48%\nLocation: 1500 of 2618, 57.30%\nLocation: 1600 of 2618, 61.12%\nLocation: 1700 of 2618, 64.94%\nLocation: 1800 of 2618, 68.75%\nLocation: 1900 of 2618, 72.57%\nLocation: 2000 of 2618, 76.39%\nLocation: 2100 of 2618, 80.21%\nLocation: 2200 of 2618, 84.03%\nLocation: 2300 of 2618, 87.85%\nLocation: 2400 of 2618, 91.67%\nLocation: 2500 of 2618, 95.49%\nLocation: 2600 of 2618, 99.31%\nLocation: 2618 of 2618, 100.00%\nGenerating latent occupancy state\n\nCode# extract the array of interest= occupancy\npredicted_array &lt;- out.sp.ms.pred$psi.0.samples\n\n\n\ndim(predicted_array)\n\n[1] 3000   25 2618\n\nCode# df_plot &lt;- NA # empty column\npredicted_raster_list &lt;- list() # rast(nrows = 52, ncols = 103,\n                         #ext(elevation_17.aggregate), \n                         # crs = \"EPSG:32717\")\n\n###################################################\n# simpler way to make mean in the array by species\n# array order: itera=3000, sp=22, pixels=5202\n# we wan to keep index 2 and 3\nlibrary(plyr)\n\n------------------------------------------------------------------------------\n\n\nYou have loaded plyr after dplyr - this is likely to cause problems.\nIf you need functions from both plyr and dplyr, please load plyr first, then dplyr:\nlibrary(plyr); library(dplyr)\n\n\n------------------------------------------------------------------------------\n\n\n\nAdjuntando el paquete: 'plyr'\n\n\nThe following objects are masked from 'package:dplyr':\n\n    arrange, count, desc, failwith, id, mutate, rename, summarise,\n    summarize\n\n\nThe following object is masked from 'package:purrr':\n\n    compact\n\n\nThe following object is masked from 'package:maps':\n\n    ozone\n\nCodearesult = (plyr::aaply(predicted_array, # mean fo all iterations\n                       c(2,3), \n                       mean))\n\n##############################################\n#### Loop to make rasters and put in a list\n# array order: itera=3000, sp=22, pixels=5202\nfor (i in 1:dim(predicted_array)[2]){\n # Convert array slice to data frame\n # df_plot[i] &lt;- as.data.frame(predicted_array[1, i, ]) # sp_i\n # df_plot[i] &lt;- as.vector(aresult[i,]) # Extract sp\n # Producing an SDM for all (posterior mean)\n plot.dat &lt;- data.frame(x = df_coords$X, \n                        y = df_coords$Y, \n                        psi.sp = as.vector(aresult[i,]))\n pred_rast &lt;- rast(plot.dat, \n                   type = \"xyz\", \n                   crs = \"EPSG:10603\") # Replace EPSG:4326 with your CRS\n predicted_raster_list[[i]] &lt;- pred_rast\n}\n\n# Convert the list to a SpatRaster stack\npredictad_raster_stack &lt;- rast(predicted_raster_list)\n# put species names\nnames(predictad_raster_stack) &lt;- selected.sp\n\nplot(predictad_raster_stack)\n\n\n\n\n\n\nCode# get the mean\npredicted_mean &lt;- mean(predictad_raster_stack)\n\nplot(predicted_mean, main=\"mean occupancy\")\n\n\n\n\n\n\nCodemapview(predicted_mean) + mapview(AP_Yasuni_UTM_line)\n\n\n\n\nCode#"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#package-citation",
    "href": "blog/2025-10-15-analysis/index.html#package-citation",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: abind v. 1.4.8 (Plate and Heiberger 2024), bayesplot v. 1.14.0 (Gabry et al. 2019; Gabry and Mahr 2025), beepr v. 2.0 (Bååth 2024), camtrapR v. 3.0.0 (Niedballa et al. 2016), coda v. 0.19.4.1 (Plummer et al. 2006), DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), MCMCvis v. 0.16.3 (Youngflesh 2018), plyr v. 1.8.9 (Wickham 2011), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), snow v. 0.4.4 (Tierney et al. 2021), snowfall v. 1.84.6.3 (Knaus 2023), spOccupancy v. 0.8.0 (Doser et al. 2022, 2024; Doser, Finley, and Banerjee 2023), terra v. 1.8.70 (Hijmans 2025), tictoc v. 1.2.1 (Izrailev 2024), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018)."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#sesion-info",
    "href": "blog/2025-10-15-analysis/index.html#sesion-info",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: internal\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] plyr_1.8.9        abind_1.4-8       lubridate_1.9.4   forcats_1.0.0    \n [5] stringr_1.5.2     dplyr_1.1.4       purrr_1.1.0       readr_2.1.5      \n [9] tidyr_1.3.1       tibble_3.2.1      ggplot2_4.0.0     tidyverse_2.0.0  \n[13] spOccupancy_0.8.0 camtrapR_3.0.0    snowfall_1.84-6.3 snow_0.4-4       \n[17] beepr_2.0         coda_0.19-4.1     MCMCvis_0.16.3    tictoc_1.2.1     \n[21] bayesplot_1.14.0  elevatr_0.99.0    terra_1.8-70      tmap_4.2         \n[25] maps_3.4.3        mapview_2.11.4    sf_1.0-21         DT_0.34.0        \n[29] readxl_1.4.3      grateful_0.3.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3      tensorA_0.36.2.1        rstudioapi_0.17.1      \n  [4] audio_0.1-11            jsonlite_2.0.0          wk_0.9.4               \n  [7] magrittr_2.0.3          farver_2.1.2            nloptr_2.1.1           \n [10] rmarkdown_2.30          vctrs_0.6.5             minqa_1.2.8            \n [13] base64enc_0.1-3         RcppNumerical_0.6-0     progress_1.2.3         \n [16] htmltools_0.5.8.1       leafsync_0.1.0          distributional_0.5.0   \n [19] curl_7.0.0              raster_3.6-32           cellranger_1.1.0       \n [22] s2_1.1.9                sass_0.4.10             bslib_0.9.0            \n [25] slippymath_0.3.1        KernSmooth_2.23-24      htmlwidgets_1.6.4      \n [28] cachem_1.1.0            stars_0.6-8             uuid_1.2-1             \n [31] mime_0.13               lifecycle_1.0.4         iterators_1.0.14       \n [34] pkgconfig_2.0.3         cols4all_0.8-1          Matrix_1.7-1           \n [37] R6_2.6.1                fastmap_1.2.0           shiny_1.9.1            \n [40] digest_0.6.37           colorspace_2.1-1        leafem_0.2.4           \n [43] crosstalk_1.2.1         labeling_0.4.3          lwgeom_0.2-14          \n [46] progressr_0.15.0        spacesXYZ_1.6-0         timechange_0.3.0       \n [49] httr_1.4.7              mgcv_1.9-1              compiler_4.4.2         \n [52] microbenchmark_1.5.0    proxy_0.4-27            withr_3.0.2            \n [55] doParallel_1.0.17       backports_1.5.0         brew_1.0-10            \n [58] S7_0.2.0                DBI_1.2.3               logger_0.4.0           \n [61] MASS_7.3-61             maptiles_0.10.0         tmaptools_3.3          \n [64] leaflet_2.2.3           classInt_0.4-11         tools_4.4.2            \n [67] units_0.8-7             leaflegend_1.2.1        httpuv_1.6.16          \n [70] glue_1.8.0              satellite_1.0.5         nlme_3.1-166           \n [73] promises_1.3.3          grid_4.4.2              checkmate_2.3.2        \n [76] reshape2_1.4.4          generics_0.1.3          leaflet.providers_2.0.0\n [79] gtable_0.3.6            tzdb_0.4.0              shinyBS_0.61.1         \n [82] class_7.3-22            data.table_1.17.8       hms_1.1.3              \n [85] sp_2.2-0                RANN_2.6.2              foreach_1.5.2          \n [88] pillar_1.11.1           posterior_1.6.1         later_1.4.2            \n [91] splines_4.4.2           lattice_0.22-6          tidyselect_1.2.1       \n [94] knitr_1.50              svglite_2.1.3           stats4_4.4.2           \n [97] xfun_0.52               shinydashboard_0.7.3    leafpop_0.1.0          \n[100] stringi_1.8.4           rematch_2.0.0           yaml_2.3.10            \n[103] boot_1.3-31             evaluate_1.0.4          codetools_0.2-20       \n[106] cli_3.6.5               RcppParallel_5.1.9      systemfonts_1.1.0      \n[109] xtable_1.8-4            jquerylib_0.1.4         secr_5.1.0             \n[112] dichromat_2.0-0.1       Rcpp_1.1.0              spAbundance_0.2.1      \n[115] png_0.1-8               XML_3.99-0.18           parallel_4.4.2         \n[118] prettyunits_1.2.0       lme4_1.1-35.5           mvtnorm_1.3-2          \n[121] scales_1.4.0            e1071_1.7-16            crayon_1.5.3           \n[124] rlang_1.1.6"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#single-species-occupancy-models",
    "href": "blog/2025-10-15-analysis/index.html#single-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-models",
    "href": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Multi-species occupancy models",
    "text": "Multi-species occupancy models\nMulti-species occupancy models for estimating the effects of environmental covariates on several species occurrences while accounting for imperfect detection were build on the principle of the Single-species occupancy model, and developed more than 20 years ago.\nMulti-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#objective",
    "href": "blog/2025-10-15-analysis/index.html#objective",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Objective",
    "text": "Objective\nWe want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\nCodelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis) # Tools to Visualize, Manipulate, and Summarize MCMC Output\nlibrary(coda) # Output Analysis and Diagnostics for MCMC\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR) # Camera Trap Data Management and Preparation \nlibrary(spOccupancy) # Single-Species, Multi-Species, and Integrated Spatial Occupancy\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'"
  }
]