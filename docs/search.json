[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Occupancy in Protected Areas",
    "section": "",
    "text": "We want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border. We used a multispecies occupancy model incorporating spatial autocorrelation, to asses occupancy as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index (FLII) as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe problem we want to asses\n\n\n\nmodel\n\n\n\n\nAug 20, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nFitting a Spatial Factor Multi-Species Occupancy Model\n\n\n\nmodel\n\ncode\n\nanalysis\n\n\n\n\nAug 16, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nFitting a Spatial Factor Multi-Species Occupancy Model\n\n\n\nmodel\n\ncode\n\nanalysis\n\n\n\n\nAug 16, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nFitting a Spatial Factor Multi-Species Occupancy Model\n\n\n\nmodel\n\ncode\n\nanalysis\n\n\n\n\nAug 16, 2025\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html",
    "href": "blog/2025-10-10-the-model/index.html",
    "title": "The problem we want to asses",
    "section": "",
    "text": "Codelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\nlibrary(unmarked) # Models for Data from Unmarked Animals\nlibrary(ubms) # Bayesian Models for Data from Unmarked Animals using 'Stan'\n\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'\nWe want to Asses the role of Protected Areas (PA) in the conservation of vertebrates using on the ground data.\nEvaluating whether PA are working is essential as they are perhaps the primary strategy for averting biodiversity loss. Its been suggested that some do no work, paper parks Its crucial to continue working on best methods to evaluate their impact.\nOver a decade ago researchers started evaluating role of PA, mostly focused on the effects of PA in reducing threats (fires, deforestation) and focused on forest cover. However assessments of PA on species comparing inside vs outside is not a common practice.\nEven if we are effective in protecting forests, and the forest is in very good condition, PA could have “empty forests” and loosed biodiversity (by hunting-poaching, diseases or introduced species). So when we say a PA is effective, are we looking at this?\nWe want to compare apples with apples and control for covariates related with occupancy and abundance of species, like elevation, human pressures, ecosystem type, etc.\nOccupancy is a cost effective method for evaluation a population, it is a state variable, representing the proportion of the area occupied by the species, solving the problem of imperfect detection.\nWe compiled camera trap deployment data sets that have intentionally sampled inside and outside PAS, in a quasi-experimental design, using camera traps.\nEach case each camera is adequately matched, in a similar fashion as the remote sensing approaches.\nWe used a multispecies occupancy model, and a variation incorporating spatial autocorrelation, to compare occupancy inside and outside the PA and also as a distance to the protected area border."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#package-citation",
    "href": "blog/2025-10-10-the-model/index.html#package-citation",
    "title": "The problem we want to asses",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), terra v. 1.8.70 (Hijmans 2025), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018), ubms v. 1.2.8 (Kellner et al. 2021), unmarked v. 1.5.1 (Fiske and Chandler 2011; Kellner et al. 2023)."
  },
  {
    "objectID": "blog/2025-10-10-the-model/index.html#sesion-info",
    "href": "blog/2025-10-10-the-model/index.html#sesion-info",
    "title": "The problem we want to asses",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] lubridate_1.9.4 forcats_1.0.0   stringr_1.5.2   dplyr_1.1.4    \n [5] purrr_1.1.0     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n [9] ggplot2_4.0.0   tidyverse_2.0.0 ubms_1.2.8      unmarked_1.5.1 \n[13] elevatr_0.99.0  terra_1.8-70    tmap_4.2        maps_3.4.3     \n[17] mapview_2.11.4  sf_1.0-21       DT_0.34.0       readxl_1.4.3   \n[21] grateful_0.3.0 \n\nloaded via a namespace (and not attached):\n [1] DBI_1.2.3            pbapply_1.7-2        gridExtra_2.3       \n [4] tmaptools_3.3        s2_1.1.9             inline_0.3.20       \n [7] logger_0.4.0         rlang_1.1.6          magrittr_2.0.3      \n[10] matrixStats_1.5.0    e1071_1.7-16         compiler_4.4.2      \n[13] loo_2.8.0            png_0.1-8            vctrs_0.6.5         \n[16] pkgconfig_2.0.3      wk_0.9.4             fastmap_1.2.0       \n[19] lwgeom_0.2-14        leafem_0.2.4         rmarkdown_2.30      \n[22] tzdb_0.4.0           spacesXYZ_1.6-0      xfun_0.52           \n[25] satellite_1.0.5      jsonlite_2.0.0       parallel_4.4.2      \n[28] R6_2.6.1             stringi_1.8.4        RColorBrewer_1.1-3  \n[31] StanHeaders_2.32.10  cellranger_1.1.0     stars_0.6-8         \n[34] Rcpp_1.1.0           rstan_2.32.7         knitr_1.50          \n[37] base64enc_0.1-3      timechange_0.3.0     Matrix_1.7-1        \n[40] tidyselect_1.2.1     rstudioapi_0.17.1    dichromat_2.0-0.1   \n[43] abind_1.4-8          yaml_2.3.10          maptiles_0.10.0     \n[46] codetools_0.2-20     curl_7.0.0           pkgbuild_1.4.8      \n[49] lattice_0.22-6       leafsync_0.1.0       withr_3.0.2         \n[52] S7_0.2.0             evaluate_1.0.4       units_0.8-7         \n[55] proxy_0.4-27         RcppParallel_5.1.9   pillar_1.11.1       \n[58] KernSmooth_2.23-24   stats4_4.4.2         generics_0.1.3      \n[61] sp_2.2-0             hms_1.1.3            rstantools_2.5.0    \n[64] scales_1.4.0         class_7.3-22         glue_1.8.0          \n[67] tools_4.4.2          leaflegend_1.2.1     data.table_1.17.8   \n[70] RSpectra_0.16-2      XML_3.99-0.18        grid_4.4.2          \n[73] QuickJSR_1.4.0       crosstalk_1.2.1      colorspace_2.1-1    \n[76] cols4all_0.8-1       raster_3.6-32        cli_3.6.5           \n[79] V8_6.0.0             gtable_0.3.6         digest_0.6.37       \n[82] progressr_0.15.0     classInt_0.4-11      htmlwidgets_1.6.4   \n[85] farver_2.1.2         htmltools_0.5.8.1    lifecycle_1.0.4     \n[88] leaflet_2.2.3        microbenchmark_1.5.0 MASS_7.3-61"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html",
    "href": "blog/2025-10-15-analysis/index.html",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "href": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-model-using-spoccupancy",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Multi-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables.\n\nCodelibrary(grateful)\nlibrary(readxl)\nlibrary(DT)\nlibrary(sf)\nlibrary(mapview)\nlibrary(maps)\nlibrary(tmap)\nlibrary(terra)\nlibrary(elevatr)\n#library(spOccupancy)\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis)\nlibrary(coda)\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR)\nlibrary(spOccupancy)\nlibrary(tidyverse)"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "href": "blog/2025-10-15-analysis/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Fitting a Multi-Species Spatial Occupancy Model",
    "text": "Fitting a Multi-Species Spatial Occupancy Model\nWe use a more computationally efficient approach for fitting spatial multi-species occupancy models. This alternative approach is called a “spatial factor multi-species occupancy model”, and is described in depth in Doser, Finley, and Banerjee (2023). This newer approach also accounts for residual species correlations (i.e., it is a joint species distribution model with imperfect detection). The simulation results from Doser, Finley, and Banerjee (2023) show that this new alternative approach outperforms, or performs equally to spMsPGOcc(), while being substantially faster.\nThe Latent factor multi-species occupancy model is described in detail here\nData from Plantas Medicinales Putumayo\nHere we use the table: - COL-18-Putumayo2023\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_PlantasMed &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PlantasMedicinales/WDPA_WDOECM_May2025_Public_555511938_shp-polygons.shp\")\n\n### Ecu 17, Ecu 18, ECU 20, Ecu 22  \n\n# load data and make array_locID column\nCol_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\") |&gt; mutate(array_locID=paste(\"Col_18\", locationID, sep=\"_\"))\n\n60 cameras in Cameras. \n 60 cameras in Deployment. \n 60 deployments in Deployment. \n 60 points in Deployment. \n 51 cameras in Images. \n 51 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2024 \n Jaguar_Design: no year: 2023 \n Jaguar_Design: no \n\nCode# get sites\nCol_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\")\n\n\n\n# get elevation map\nelevation_18 &lt;- rast(get_elev_raster(Col_18_sites, z = 10)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Col_18_sites &lt;- cbind(Col_18_sites, terra::extract(elevation_18, Col_18_sites))\n# covs_Col_17_sites &lt;- cbind(Col_17_sites, terra::extract(elevation_17, Col_17_sites))\n\n\n# get which are in and out\ncovs_Col_18_sites$in_AP = st_intersects(covs_Col_18_sites, AP_PlantasMed, sparse = FALSE)\n# covs_Col_17_sites$in_AP = st_intersects(covs_Col_17_sites, AP_Yasuni, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_18, alpha=0.5) + \n  mapview (AP_PlantasMed, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Col_18_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) \n\n\n\n\nCode  # mapview (covs_Col_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n\n\nData fom Bajo Madidi and Heath\nHere we use the tables: - BOL-008a - BOL-008b - BOL14a - BOL14b\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nArea_Madidi &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Area_Madidi/WDPA_WDOECM_Jul2025_Public_303894_shp-polygons.shp\")\n\nMadidi_NP &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Madidi_NP/WDPA_WDOECM_Jul2025_Public_98183_shp-polygons.shp\")\n#AP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\n#Bol_Pacaya &lt;- read_excel(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\", sheet = \"Image\")\n\n\nBol_Madidi_1 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-008a.xlsx\") |&gt; mutate(Point.x=as.character(paste(\"M1\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M1\",Point.y, sep = \"-\")))\n\n65 cameras in Cameras. \n 61 cameras in Deployment. \n 61 deployments in Deployment. \n 31 points in Deployment. \n 61 cameras in Images. \n 31 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2005 \n Jaguar_Design: yes \n\nCodeBol_Madidi_2 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-008b.xlsx\") |&gt; mutate(Point.x=as.character(paste(\"M2\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M2\",Point.y, sep = \"-\")))\n\n60 cameras in Cameras. \n 52 cameras in Deployment. \n 52 deployments in Deployment. \n 30 points in Deployment. \n 51 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2005 \n Jaguar_Design: yes \n\nCodeBol_Madidi_3 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-014a.xlsx\")|&gt; mutate(Point.x=as.character(paste(\"M3\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M3\",Point.y, sep = \"-\")))\n\n47 cameras in Cameras. \n 44 cameras in Deployment. \n 44 deployments in Deployment. \n 26 points in Deployment. \n 44 cameras in Images. \n 26 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2009 \n Jaguar_Design: yes \n\nCodeBol_Madidi_4 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-014b.xlsx\")|&gt; mutate(Point.x=as.character(paste(\"M4\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M1\",Point.y, sep = \"-\")))\n\n29 cameras in Cameras. \n 22 cameras in Deployment. \n 22 deployments in Deployment. \n 15 points in Deployment. \n 22 cameras in Images. \n 15 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2009 \n Jaguar_Design: yes \n\nCode# get sites\nBol_Madidi_sites1 &lt;-  Bol_Madidi_1 |&gt; \n   dplyr::bind_rows(Bol_Madidi_2) |&gt; \n   dplyr::bind_rows(Bol_Madidi_3) |&gt; \n   dplyr::bind_rows(Bol_Madidi_4) |&gt; \n  select(\"Latitude\", \"Longitude\", \"Point.x\" \n) |&gt; dplyr::distinct( )  \n\nBol_Madidi_sites &lt;- sf::st_as_sf(Bol_Madidi_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Bol_Madidi_sites) &lt;- 4326\n\n\n# get elevation map\nelevation_17 &lt;- rast(get_elev_raster(Bol_Madidi_sites, z = 9)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n# extract covs using points and add to _sites\ncovs_Bol_Madidi_sites &lt;- cbind(Bol_Madidi_sites, terra::extract(elevation_17, Bol_Madidi_sites))\n# covs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_17, Ecu_17_sites))\n\n\n# get which are in and out\ncovs_Bol_Madidi_sites$in_AP = st_intersects(covs_Bol_Madidi_sites, Madidi_NP, sparse = FALSE)\n# covs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Machalilla, sparse = FALSE)\n\n\n# make a map\nmapview (elevation_17, alpha=0.7) + \n  mapview (Madidi_NP, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (Area_Madidi, color = \"yellow\", col.regions = \"yellow\", alpha = 0.5) +\n  #mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Bol_Madidi_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) \n\n\n\n\n\nTamshiyacu Tahuayo data\nHere we use the tables: - PER-003_BD_ACRCTT_T0.xlsx - PER-002_BD_ACRTT-PILOTO.xlsx\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Pacaya &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PacayaSamiria/WDPA_WDOECM_Jun2025_Public_249_shp-polygons.shp\")\n\nAP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\nPer_Tahuayo_piloto &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-002_BD_ACRTT-PILOTO.xlsx\")\n\n50 cameras in Cameras. \n 50 cameras in Deployment. \n 50 deployments in Deployment. \n 50 points in Deployment. \n 50 cameras in Images. \n 50 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodePer_Tahuayo &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n85 cameras in Cameras. \n 84 cameras in Deployment. \n 84 deployments in Deployment. \n 84 points in Deployment. \n 84 cameras in Images. \n 84 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeFLII2016 &lt;- rast(\"C:/CodigoR/WCS_2024/FLI/raster/FLII_final/FLII_2016.tif\")\n\n# get sites\n# Per_Pacaya_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n# get sites\nPer_Tahuayo_sites1 &lt;- Per_Tahuayo |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_sites &lt;- sf::st_as_sf(Per_Tahuayo_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_sites) &lt;- 4326\n\n\n\n# get Pacaya sites\nPer_Tahuayo_piloto_sites1 &lt;- Per_Tahuayo_piloto |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_piloto_sites &lt;- sf::st_as_sf(Per_Tahuayo_piloto_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_piloto_sites) &lt;- 4326\n\n\n\n\n# get elevation map\nelevation_PE &lt;- rast(get_elev_raster(Per_Tahuayo_sites, z = 10)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_sites &lt;- cbind(Per_Tahuayo_sites,\n                                terra::extract(elevation_PE,\n                                               Per_Tahuayo_sites)\n                                )\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_piloto_sites &lt;- cbind(Per_Tahuayo_piloto_sites, terra::extract(elevation_PE, Per_Tahuayo_piloto_sites))\n\n\n\n# get which are in and out\ncovs_Per_Tahuayo_sites$in_AP = st_intersects(covs_Per_Tahuayo_sites, AP_Tahuayo, sparse = FALSE)\n\ncovs_Per_Tahuayo_piloto_sites$in_AP = st_intersects(covs_Per_Tahuayo_piloto_sites, AP_Tahuayo, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_PE, alpha=0.5) + \n  mapview (AP_Pacaya, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Per_Tahuayo_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +   \n  mapview (covs_Per_Tahuayo_piloto_sites, \n           zcol = \"in_AP\", \n           col.regions =c(\"blue\"), \n           burst = TRUE) \n\n\n\n\n\nYasuni data\nHere we use the tables Ecu-13, Ecu-17, Ecu-18 y Ecu-20\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Yasuni &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Yasuni/WDPA_WDOECM_May2025_Public_186_shp-polygons.shp\")\n\n### Ecu 17, Ecu 18, ECU 20, Ecu 22  \n\n# load data and make array_locID column\nEcu_13 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_13\", locationID, sep=\"_\"))\n\n28 cameras in Cameras. \n 28 cameras in Deployment. \n 28 deployments in Deployment. \n 28 points in Deployment. \n 28 cameras in Images. \n 28 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_17 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_17\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_18\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeEcu_20 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_20\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 25 cameras in Deployment. \n 25 deployments in Deployment. \n 25 points in Deployment. \n 25 cameras in Images. \n 25 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# Ecu_21 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_14\", locationID, sep=\"_\"))\nEcu_22 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_22\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# get sites\nEcu_13_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\")\nEcu_17_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\")\nEcu_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")\nEcu_20_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")\n# Ecu_21_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\")\nEcu_22_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")\n\n\n\n\n# get elevation map\nelevation_EC &lt;- rast(get_elev_raster(Ecu_17_sites, z = 7)) #z =1-14\nbb &lt;-  st_as_sfc(st_bbox(elevation_EC)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Ecu_13_sites &lt;- cbind(Ecu_13_sites, terra::extract(elevation_EC, Ecu_13_sites))\ncovs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_EC, Ecu_17_sites))\ncovs_Ecu_18_sites &lt;- cbind(Ecu_18_sites, terra::extract(elevation_EC, Ecu_18_sites))\ncovs_Ecu_20_sites &lt;- cbind(Ecu_20_sites, terra::extract(elevation_EC, Ecu_20_sites))\n#covs_Ecu_21_sites &lt;- cbind(Ecu_21_sites, terra::extract(elevation_17, Ecu_21_sites))\ncovs_Ecu_22_sites &lt;- cbind(Ecu_22_sites, terra::extract(elevation_EC, Ecu_22_sites))\n\n# get which are in and out\ncovs_Ecu_13_sites$in_AP = st_intersects(covs_Ecu_13_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_18_sites$in_AP = st_intersects(covs_Ecu_18_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_20_sites$in_AP = st_intersects(covs_Ecu_20_sites, AP_Yasuni, sparse = FALSE)\n#covs_Ecu_21_sites$in_AP = st_intersects(covs_Ecu_21_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_22_sites$in_AP = st_intersects(covs_Ecu_22_sites, AP_Yasuni, sparse = FALSE)\n\n# covs_Ecu_16_sites$in_AP = st_intersects(covs_Ecu_16_sites, AP_Llanganates, sparse = FALSE)\n\n\n\n# make a map\nmapview (elevation_EC, alpha=0.5) + \n  mapview (AP_Yasuni, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Ecu_13_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  mapview (covs_Ecu_18_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_20_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n#  mapview (covs_Ecu_21_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_22_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"red\") ) #+\n\n\n\n\nCode  # mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\nLlanganates data\nHere we use the tables Ecu-14, Ecu-15 y Ecu-16.\n\nCodeAP_Llanganates &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Llanganates/WDPA_WDOECM_May2025_Public_97512_shp-polygons.shp\")\n\n### Ecu 14, Ecu 15  y Ecu 16\n\n# load data and make array_locID column\nEcu_14 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-014.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_14\", locationID, sep=\"_\"))\n\n29 cameras in Cameras. \n 29 cameras in Deployment. \n 29 deployments in Deployment. \n 29 points in Deployment. \n 29 cameras in Images. \n 29 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_15 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-015.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_15\", locationID, sep=\"_\"))\n\n29 cameras in Cameras. \n 29 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeEcu_16 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-016.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_16\", locationID, sep=\"_\"))\n\n29 cameras in Cameras. \n 28 cameras in Deployment. \n 28 deployments in Deployment. \n 28 points in Deployment. \n 28 cameras in Images. \n 28 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCode# get sites\nEcu_14_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-014.xlsx\")\nEcu_15_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-015.xlsx\")\nEcu_16_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-016.xlsx\")\n\n\n\n\n# get elevation map\nelevation_14 &lt;- rast(get_elev_raster(Ecu_14_sites, z = 7)) #z =1-14\nbb &lt;-  st_as_sfc(st_bbox(elevation_14)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Ecu_14_sites &lt;- cbind(Ecu_14_sites, terra::extract(elevation_14, Ecu_14_sites))\n\ncovs_Ecu_15_sites &lt;- cbind(Ecu_15_sites, terra::extract(elevation_14, Ecu_15_sites))\n\ncovs_Ecu_16_sites &lt;- cbind(Ecu_16_sites, terra::extract(elevation_14, Ecu_16_sites))\n\n# get which are in and out\ncovs_Ecu_14_sites$in_AP = st_intersects(covs_Ecu_14_sites, AP_Llanganates, sparse = FALSE)\n\ncovs_Ecu_15_sites$in_AP = st_intersects(covs_Ecu_15_sites, AP_Llanganates, sparse = FALSE)\n\ncovs_Ecu_16_sites$in_AP = st_intersects(covs_Ecu_16_sites, AP_Llanganates, sparse = FALSE)\n\n\n\n# make a map\nmapview (elevation_14, alpha=0.7) + \n  mapview (AP_Llanganates, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Ecu_14_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  mapview (covs_Ecu_15_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"blue\") )+\n  mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\n\n\n\nPacoche 2014 data\nHere we use the tables Pacoche_DL_CT-RVP-2014\nCamera trap operation data and detection history\n\nCode# Join 3 tables\n# fix count in ECU 13, 17, 22,\nEcu_13$Count &lt;- as.character(Ecu_13$Count)\nEcu_17$Count &lt;- as.character(Ecu_17$Count)\nEcu_22$Count &lt;- as.character(Ecu_22$Count)\n\nEcu_full &lt;- Ecu_13 |&gt; full_join(Ecu_17) |&gt; \n                      full_join(Ecu_18) |&gt; \n                      full_join(Ecu_20) |&gt; \n#                      full_join(Ecu_21) |&gt; \n                      full_join(Ecu_22)\n\n###### Bolivia\n\nBol_full &lt;- Bol_Madidi_1  |&gt; \n   full_join(Bol_Madidi_2) |&gt; \n   full_join(Bol_Madidi_3) |&gt; \n   full_join(Bol_Madidi_4) \n# change camera Id by point. two cameras in one\nBol_full &lt;- Bol_full |&gt; mutate(Camera_Id=Point.x)\n\n\n# Ecu_18$Count &lt;- as.numeric(Ecu_18$Count)\nPer_Tahuayo_piloto$Longitude &lt;- as.numeric(Per_Tahuayo_piloto$Longitude)\nPer_Tahuayo_piloto$Latitude &lt;- as.numeric(Per_Tahuayo_piloto$Latitude)\n\n\nPer_full &lt;- Per_Tahuayo|&gt; \n  full_join(Per_Tahuayo_piloto) #|&gt; \n                      # full_join(Ecu_18) |&gt; \n                      # full_join(Ecu_20) |&gt; \n                      # full_join(Ecu_21) |&gt; \n                      # full_join(Ecu_22)\n\n# rename camera id\n# Per_full$camid &lt;- Per_full$`Camera_Id`\n\nEcu_full$Count &lt;- as.numeric(Ecu_full$Count)\nPer_full$Count &lt;- as.numeric(Per_full$Count)\n\n\n#################### Ecuador Llanganates\n\n# Join 3 tables\nEcu_Llanganates &lt;- Ecu_14 |&gt; full_join(Ecu_15) |&gt; full_join(Ecu_16)\n\n\n# make columns equal to 46\nEcu_full &lt;- Ecu_full[,-47]\nCol_18 &lt;- Col_18[,-47]\nEcu_Llanganates &lt;- Ecu_Llanganates[,-c(50,49,48,47)]\n\n##################################\ndata_full &lt;- rbind(Ecu_full, \n                   Per_full,\n                   Bol_full,\n                   Col_18,\n                   Ecu_Llanganates)\n\n\n# fix date format\n# \n# Formatting a Date object\ndata_full$start_date &lt;- as.Date(data_full$\"start_date\", \"%Y/%m/%d\")\ndata_full$start_date &lt;- format(data_full$start_date, \"%Y-%m-%d\")\n\ndata_full$end_date &lt;- as.Date(data_full$\"end_date\", \"%Y/%m/%d\")\ndata_full$end_date &lt;- format(data_full$end_date, \"%Y-%m-%d\")\n\ndata_full$eventDate &lt;- as.Date(data_full$\"Date_Time_Captured\", \"%Y/%m/%d\")\ndata_full$eventDate &lt;- format(data_full$eventDate, \"%Y-%m-%d\")\n\n# Per_full$eventDateTime &lt;- ymd_hms(paste(Per_full$\"photo_date\", Per_full$\"photo_time\", sep=\" \"))\ndata_full$eventDateTime &lt;- ymd_hms(data_full$\"Date_Time_Captured\")\n\n###############################\n# remove duplicated cameras\n################################\nind1 &lt;- which(data_full$Camera_Id==\"ECU-020-C0027\")\nind2 &lt;- which(data_full$Camera_Id==\"ECU-020-C0006\")\ndata_full &lt;- data_full[-ind1,]\ndata_full &lt;- data_full[-ind2,]\n\n\n# filter 2021 and make uniques\nCToperation  &lt;- data_full |&gt; dplyr::group_by(Camera_Id) |&gt; #(array_locID) |&gt; \n                           mutate(minStart=start_date, maxEnd=end_date) |&gt; distinct(Longitude, Latitude, minStart, maxEnd) |&gt; dplyr::ungroup()\n# remove one duplicated\n# View(CToperation)\n# CToperation &lt;- CToperation[-15,]\n\n# M3-19: M3-21: M4-10: M4-12: M4-18:  From Madidi\nCToperation &lt;- CToperation[-c(379, 373, 365, 362, 357),]\n\nCToperation[231,3] &lt;- \"-4.482831\" #Latitude\nCToperation[93,3] &lt;- \"-0.5548211\" #Latitude\nCToperation[93,2] &lt;- \"-76.48333\"\n\n# duplicated in llanganates\nCToperation &lt;- CToperation[-464,] \n\n### Check duplicated\n# View(as.data.frame(sort(table(CToperation$Latitude))))\n# View(as.data.frame(sort(table(CToperation$Longitude))))\n# View(as.data.frame(table(CToperation$Camera_Id)))\n\n# CToperation &lt;- CToperation[-c(90,94),]\n# Latitude -4.48283\n# Latitude -0.554820969700813\n# Longitude -76.4833290316164\n\n# Generamos la matríz de operación de las cámaras\n\ncamop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operación\n                         stationCol= \"Camera_Id\", # Columna que define la estación\n                         setupCol= \"minStart\", #Columna fecha de colocación\n                         retrievalCol= \"maxEnd\", #Columna fecha de retiro\n                         #hasProblems= T, # Hubo fallos de cámaras\n                         dateFormat= \"%Y-%m-%d\")#, #, # Formato de las fechas\n                         #cameraCol=\"Camera_Id\")\n                         # sessionCol= \"Year\")\n\n# Generar las historias de detección ---------------------------------------\n## remove plroblem species\n\n# Per_full$scientificName &lt;- paste(Per_full$genus, Per_full$species, sep=\" \")\n\n#### remove NAs and setups\nind &lt;- which(is.na(data_full$scientificName))\ndata_full &lt;- data_full[-ind,]\n# ind &lt;- which(Per_full$scientificName==\"NA NA\")\n# Per_full &lt;- Per_full[-ind,]\n\n# ind &lt;- which(Per_full$scientificName==\"Set up\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Blank\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Unidentifiable\")\n# Per_full &lt;- Per_full[-ind,]\n\n\nDetHist_list &lt;- lapply(unique(data_full$scientificName), FUN = function(x) {\n  detectionHistory(\n    recordTable         = data_full, # abla de registros\n    camOp                = camop, # Matriz de operación de cámaras\n    stationCol           = \"Camera_Id\",\n    speciesCol           = \"scientificName\",\n    recordDateTimeCol    = \"eventDateTime\",\n    recordDateTimeFormat  = \"%Y-%m-%d %H:%M:%S\",\n    species              = x,     # la función reemplaza x por cada una de las especies\n    occasionLength       = 7, # Colapso de las historias a 10 ías\n    day1                 = \"station\", # \"survey\" a specific date, \"station\", #inicie en la fecha de cada survey\n    datesAsOccasionNames = FALSE,\n    includeEffort        = TRUE,\n    scaleEffort          = FALSE,\n    #unmarkedMultFrameInput=TRUE\n    timeZone             = \"America/Bogota\" \n    )\n  }\n)\n\n# names\nnames(DetHist_list) &lt;- unique(data_full$scientificName)\n\n# Finalmente creamos una lista nueva donde estén solo las historias de detección\nylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)\n# otra lista con effort scaled\nefort &lt;- lapply(DetHist_list, FUN = function(x) x$effort)\n\n# number of observetions per sp, collapsed to 7 days\n# lapply(ylist, sum, na.rm = TRUE)\n\n\nArrange spatial covariates\nThe standard EPSG code for a Lambert Azimuthal Equal-Area projection for South America is EPSG:10603 (WGS 84 / GLANCE South America). This projection is specifically designed for the continent and has its center located around the central meridian for the region. The units are meters.\nFLII scores range from 0 (lowest integrity) to 10 (highest). Grantham discretized this range to define three broad illustrative categories: low (≤6.0); medium (&gt;6.0 and &lt;9.6); and high integrity (≥9.6).\n\nCode#transform coord data to Lambert Azimuthal Equal-Area\nAP_Tahuayo_UTM &lt;- st_transform(AP_Tahuayo, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Tahuayo_UTM_line &lt;- st_cast(AP_Tahuayo_UTM,\"MULTILINESTRING\")# \"LINESTRING\")\n#transform Yasuni to Lambert Azimuthal Equal-Area\nAP_Yasuni_UTM &lt;- st_transform(AP_Yasuni, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Yasuni_UTM_line &lt;- st_cast(AP_Yasuni_UTM, \"MULTILINESTRING\")\n\n#transform Yasuni to Lambert Azimuthal Equal-Area\nAP_Madidi_UTM &lt;- st_transform(Madidi_NP, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Madidi_UTM_line &lt;- st_cast(AP_Madidi_UTM, \"MULTILINESTRING\")\n\n# Plantas\nAP_PlantasMed_UTM &lt;- st_transform(AP_PlantasMed, \"EPSG:10603\")\n\n#Llanganates\nAP_Llanganates_UTM &lt;- st_transform(AP_Llanganates, \"EPSG:10603\")\n\n\n############## sf AP Union \nAP_merged_sf_UTM &lt;- st_union(\n                             AP_Yasuni_UTM,\n                             AP_Tahuayo_UTM,\n                             AP_Madidi_UTM,\n                             AP_PlantasMed_UTM,\n                             AP_Llanganates_UTM\n                             )\n\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n\nCodeAP_merged_line &lt;- st_cast(AP_merged_sf_UTM, to=\"MULTILINESTRING\")\n\n\n# make sf() from data table\ndata_full_sf &lt;- CToperation |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"), \n              crs = 4326)\n\n# get the elevation point from AWS\nelev_data &lt;- elevatr::get_elev_point(locations = data_full_sf, src = \"aws\")\n\nMosaicing & Projecting\n\n\nNote: Elevation units are in meters\n\nCode# extract elev and paste to table\ndata_full_sf$elev &lt;- elev_data$elevation\nstr(data_full_sf$elev)\n\n num [1:514] 443 387 592 543 498 396 521 498 451 498 ...\n\nCode# extract in AP\ndata_full_sf$in_AP = as.factor(st_intersects(data_full_sf, AP_Tahuayo, sparse = FALSE))\n\nin_AP &lt;- as.numeric((st_drop_geometry(data_full_sf$in_AP)))\n\n# extract FLII\ndata_full_sf$FLII &lt;- terra::extract(FLII2016, data_full_sf)[,2]\nstr(data_full_sf$FLII)\n\n num [1:514] 9.57 9.65 9.69 9.66 9.92 ...\n\nCode# Replace all NAs with min flii in a numeric column\ndata_full_sf$FLII[is.na(data_full_sf$FLII)] &lt;- min(data_full_sf$FLII, na.rm = TRUE)\n\n# mapview(full_sites_14_15_16_sf, zcol = \"in_AP\", burst = TRUE)\n\n# Transform coord to Lambert Azimuthal Equal-Area\ndata_full_sf_UTM &lt;- st_transform(data_full_sf, \"EPSG:10603\")\n\n\ncoords &lt;- st_coordinates(data_full_sf_UTM)\n#str(coords)\n\n#### fix duplicated coord\n# -1840583.53296873  en x\n# -1842515.36969736  en x\n# 1547741.44311964  en y\n# 1541202.24796904 en y\n\n# which(coords[,1]==\"-1840583.53296873\")\n# which(coords[,1]==\"-1842515.36969736\")\n# which(coords[,2]==\"1547741.44311964\")\n# which(coords[,2]==\"1541202.24796904\")\n\n# make Ecu_14_15_16 an sf object\n#    cam_sf &lt;- st_as_sf(Ecu_14_15_16, coords = c(\"lon\",\"lat\"))   #crs=\"EPSG:4326\")\n    #--- set CRS ---#\n#    st_crs(cam_sf) &lt;- 4326\n\n\n\n\n# Calculate the distance\n#multiplic &lt;- full_sites_14_15_16_sf_UTM |&gt; mutate(multiplic= as.numeric(in_AP)) \nmultiplic=ifelse(data_full_sf_UTM$in_AP==\"TRUE\",-1,1)\ndata_full_sf_UTM$border_dist &lt;- as.numeric(st_distance(data_full_sf_UTM, AP_Tahuayo_UTM_line) * multiplic )\n# print(border_dist)\n\n# convert true false to inside 1, outside 0\ndata_full_sf_UTM &lt;- data_full_sf_UTM |&gt;\n  mutate(in_AP = case_when(\n    str_detect(in_AP, \"TRUE\") ~ 1, # \"inside_AP\",\n    str_detect(in_AP, \"FALSE\") ~ 0 #\"outside_AP\"\n  )) |&gt; mutate(in_AP=as.factor(in_AP))\n\n\nhist(data_full_sf_UTM$border_dist)\n\n\n\n\n\n\nCodehist(data_full_sf_UTM$elev)\n\n\n\n\n\n\n\nPrepare the model\n\n\n\n\n\n\nTipData in a 3D array\n\n\n\nThe data must be placed in a three-dimensional array with dimensions corresponding to species, sites, and replicates in that order.\n\n\nThe function sfMsPGOcc\nFits multi-species spatial occupancy models with species correlations (i.e., a spatially-explicit joint species distribution model with imperfect detection). We use Polya-Gamma latent variables and a spatial factor modeling approach. Currently, models are implemented using a Nearest Neighbor Gaussian Process.\n\nCode# Detection-nondetection data ---------\n# Species of interest, can select individually\n# curr.sp &lt;- sort(unique(Ecu_14_15_16$.id))# c('BAWW', 'BLJA', 'GCFL')\n# sort(names(DetHist_list))\nselected.sp &lt;-  c(\n\"Atelocynus microtis\" ,\n\"Coendou prehensilis\" ,\n\"Cuniculus paca\",           \n\"Dasyprocta fuliginosa\",      \n\"Dasypus sp.\" ,    \n\"Didelphis marsupialis\",    \n\"Eira barbara\",  \n\"Herpailurus yagouaroundi\",\n\"Leopardus pardalis\",    \n\"Leopardus tigrinus\" ,\n\"Leopardus wiedii\",         \n\"Mazama americana\",\n\"Mazama nemorivaga\",\n#\"Mitu tuberosum\" ,\n\"Myoprocta pratti\",\n\"Myrmecophaga tridactyla\",\n\"Nasua nasua\" ,\n# \"Mazama americana\",         \n# \"Myotis myotis\",           \n# \"Nasua narica\",             \n# \"Odocoileus virginianus\",   \n\"Panthera onca\" ,\n# \"Procyon cancrivorus\" ,\n\"Pecari tajacu\",    \n#\"Penelope jacquacu\" ,\n\"Priodontes maximus\" ,\n\"Procyon cancrivorous\",      \n# \"Psophia leucoptera\",\n\"Puma concolor\" ,\n\"Puma yagouaroundi\",        \n# \"Rattus rattus\" ,\n# \"Roedor sp.\",\n# \"Sciurus sp.\",       \n# \"Sus scrofa\",               \n# \"Sylvilagus brasiliensis\",  \n\"Tamandua tetradactyla\",   \n\"Tapirus pinchaque\" ,\n\"Tapirus terrestris\",\n\"Tayassu pecari\"\n#\"Tinamus major\"            \n              )\n\n# y.msom &lt;- y[which(sp.codes %in% selected.sp), , ]\n# str(y.msom)\n\n# Use selection\ny.selected &lt;- ylist[selected.sp]   \n\n#####################################\n#### three-dimensional array with dimensions corresponding to:\n#### species, sites, and replicates\n#####################################\n\n# 1. Load the abind library to make arrays easily \nlibrary(abind)\nmy_array_abind &lt;- abind(y.selected, # start from list\n                        along = 3, # 3D array\n                        use.first.dimnames=TRUE) # keep names\n\n# Transpose the array to have:\n# species, sites, and sampling occasions in that order\n# The new order is (3rd dim, 1st dim, 2nd dim)\ntransposed_array &lt;- aperm(my_array_abind, c(3, 1, 2))\n\n#### site covs\nsitecovs &lt;- as.data.frame(st_drop_geometry(\n                    data_full_sf_UTM[,5:8]))\n\n sitecovs[, 1] &lt;- as.vector((sitecovs[,1]))   # scale numeric covariates\n sitecovs[, 1] &lt;- as.numeric((sitecovs[,2]))   # scale numeric covariates\n sitecovs[, 3] &lt;- as.vector((sitecovs[,3]))   # scale numeric covariates\n sitecovs[, 4] &lt;- as.vector((sitecovs[,4]))   # scale numeric covariates\n # sitecovs$fact &lt;- factor(c(\"A\", \"A\", \"B\"))    # categorical covariate\n\nnames(sitecovs) &lt;- c(\"elev\", \"in_AP\", \"FLII\", \"border_dist\")\n\n# check consistancy equal number of spatial covariates and rows in data\n# identical(nrow(ylist[[1]]), nrow(covars)) \n\n# Base de datos para los análisis -----------------------------------------\n\n# match the names to \"y\"  \"occ.covs\" \"det.covs\" \"coords\" \ndata_list &lt;- list(y = transposed_array, # Historias de detección\n                  occ.covs = sitecovs, # covs de sitio\n                  det.covs  = list(effort = DetHist_list[[1]]$effort),\n                  coords = st_coordinates(data_full_sf_UTM)\n                  )  # agregamos el esfuerzo de muestreo como covariable de observación\n\n\nRunning the model\nWe let spOccupancy set the initial values by default based on the prior distributions.\n\nCode# Running the model\n\n# 3. 1 Modelo multi-especie  -----------------------------------------\n\n# 2. Model fitting --------------------------------------------------------\n# Fit a non-spatial, multi-species occupancy model. \nout.null &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort) , # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.samples = 6000, \n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 514 sites and 26 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 1 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out.null, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.report = 1000, n.burn = 1000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 8.0132\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)        -2.2596 0.3276 -2.8779 -2.2661 -1.6074 1.0130  466\nscale(elev)        -0.1377 0.1258 -0.3947 -0.1316  0.1005 1.0003 1119\nscale(border_dist) -0.3171 0.2006 -0.7093 -0.3166  0.0903 0.9997 1108\nscale(FLII)         0.5788 0.1486  0.3138  0.5704  0.8834 1.0000  798\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        2.3858 0.9118 1.1155 2.2242 4.5899 1.0137 365\nscale(elev)        0.2647 0.1250 0.1061 0.2383 0.5825 1.0095 852\nscale(border_dist) 0.9089 0.3700 0.4169 0.8401 1.8540 1.0059 404\nscale(FLII)        0.3373 0.1719 0.1159 0.3000 0.7606 1.0242 599\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.2066 0.2451 -2.7153 -2.1947 -1.7512 1.0244  391\nscale(effort)  0.3968 0.0618  0.2790  0.3962  0.5237 1.0083 1043\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.2408 0.5145 0.5317 1.1353 2.5814 1.0159  114\nscale(effort) 0.0438 0.0231 0.0167 0.0386 0.1077 1.0009 1265\n\nCode# Fit a non-spatial, Latent Factor Multi-Species Occupancy Model. \n  out.lfMs &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.omp.threads = 6,\n                 n.samples = 6000, \n                 n.factors = 5, # balance of rare sp. and run time\n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nWarning in msPGOcc(occ.formula = ~scale(elev) + scale(border_dist) +\nscale(FLII), : 'n.factors' is not an argument\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 514 sites and 26 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out.lfMs, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.omp.threads = 6, n.report = 1000, n.burn = 1000, n.thin = 10, \n    n.chains = 3, n.factors = 5)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 8.0493\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)        -2.2145 0.3258 -2.8672 -2.2070 -1.6044 1.0080  277\nscale(elev)        -0.1452 0.1262 -0.3880 -0.1422  0.0951 1.0028 1166\nscale(border_dist) -0.2996 0.1987 -0.7043 -0.3019  0.0874 1.0050  932\nscale(FLII)         0.5892 0.1446  0.3137  0.5857  0.8809 1.0262  783\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)        2.2033 0.7936 1.0753 2.0716 4.1523 1.0029  288\nscale(elev)        0.2625 0.1223 0.1007 0.2388 0.5752 1.0115 1052\nscale(border_dist) 0.8658 0.3467 0.3951 0.7970 1.7400 1.0121  668\nscale(FLII)        0.3336 0.1603 0.1146 0.2980 0.6974 1.0017  820\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.2273 0.2644 -2.8186 -2.2186 -1.7652 1.0113  229\nscale(effort)  0.3946 0.0632  0.2735  0.3946  0.5236 1.0002 1225\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.4133 0.6534 0.5698 1.2546 3.0496 1.0315   81\nscale(effort) 0.0451 0.0256 0.0163 0.0389 0.1130 1.0256 1207\n\nCode# Fit a Spatial Factor Multi-Species Occupancy Model\n# latent spatial factors.\ntictoc::tic()\n  out.sp &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 514 sites and 26 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n2026.45 sec elapsed\n\nCode#########################\ntictoc::tic()\n  out.sp.cat &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               factor(in_AP) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 514 sites and 26 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n2165.27 sec elapsed\n\nCode# tictoc::tic()\n#   out.sp.gaus &lt;- sfMsPGOcc(occ.formula = ~ scale(border_dist) , \n#                            det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,              \n#                            data = data_list, \n#                            n.batch = 400, \n#                            batch.length = 25,\n#                            n.thin = 5, \n#                            n.burn = 5000, \n#                            n.chains = 1,\n#                            NNGP = TRUE,\n#                            n.factors = 5,\n#                            n.neighbors = 15,\n#                            cov.model = 'gaussian',\n#                            n.report = 100);beep(sound = 4)\n# tictoc::toc()\n\n# save the results to not run again\n# save(out, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/result_2.R\") # guardamos los resultados para no correr de nuevo\n# save the results to not run again\n# save(out.sp, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n# save(out.lfMs, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/lfms_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n\n# load(\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\")\n# summary(fit.commu)\n\n\nModel validation\nWe next perform a posterior predictive check using the Freeman-Tukey statistic grouping the data by sites. We summarize the posterior predictive check with the summary() function, which reports a Bayesian p-value. A Bayesian p-value that hovers around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well (Hobbs and Hooten 2015). As always with a simulation-based analysis using MCMC, you will get numerically slightly different values.\n\nCode# 3. Model validation -----------------------------------------------------\n# Perform a posterior predictive check to assess model fit. \nppc.out &lt;- ppcOcc(out.null, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.lfMs &lt;- ppcOcc(out.lfMs, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.sp &lt;- ppcOcc(out.sp, fit.stat = 'freeman-tukey',\n                     group = 1)\n\n# Calculate a Bayesian p-value as a simple measure of Goodness of Fit.\n# Bayesian p-values between 0.1 and 0.9 indicate adequate model fit. \nsummary(ppc.out)\n\n\nCall:\nppcOcc(object = out.null, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3503 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.3393\nCoendou prehensilis Bayesian p-value: 0.5927\nCuniculus paca Bayesian p-value: 0\nDasyprocta fuliginosa Bayesian p-value: 0.004\nDasypus sp. Bayesian p-value: 0.1447\nDidelphis marsupialis Bayesian p-value: 0.4413\nEira barbara Bayesian p-value: 0.83\nHerpailurus yagouaroundi Bayesian p-value: 0.484\nLeopardus pardalis Bayesian p-value: 0.3373\nLeopardus tigrinus Bayesian p-value: 0.1767\nLeopardus wiedii Bayesian p-value: 0.3773\nMazama americana Bayesian p-value: 0.0667\nMazama nemorivaga Bayesian p-value: 0.508\nMyoprocta pratti Bayesian p-value: 0.1567\nMyrmecophaga tridactyla Bayesian p-value: 0.36\nNasua nasua Bayesian p-value: 0.4233\nPanthera onca Bayesian p-value: 0.4273\nPecari tajacu Bayesian p-value: 0.1787\nPriodontes maximus Bayesian p-value: 0.4893\nProcyon cancrivorous Bayesian p-value: 0.5093\nPuma concolor Bayesian p-value: 0.3\nPuma yagouaroundi Bayesian p-value: 0.6573\nTamandua tetradactyla Bayesian p-value: 0.6213\nTapirus pinchaque Bayesian p-value: 0.326\nTapirus terrestris Bayesian p-value: 0.0773\nTayassu pecari Bayesian p-value: 0.278\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.lfMs)\n\n\nCall:\nppcOcc(object = out.lfMs, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3578 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.3407\nCoendou prehensilis Bayesian p-value: 0.654\nCuniculus paca Bayesian p-value: 7e-04\nDasyprocta fuliginosa Bayesian p-value: 0.0033\nDasypus sp. Bayesian p-value: 0.1667\nDidelphis marsupialis Bayesian p-value: 0.4733\nEira barbara Bayesian p-value: 0.8233\nHerpailurus yagouaroundi Bayesian p-value: 0.5153\nLeopardus pardalis Bayesian p-value: 0.3613\nLeopardus tigrinus Bayesian p-value: 0.1807\nLeopardus wiedii Bayesian p-value: 0.3487\nMazama americana Bayesian p-value: 0.0607\nMazama nemorivaga Bayesian p-value: 0.4507\nMyoprocta pratti Bayesian p-value: 0.1567\nMyrmecophaga tridactyla Bayesian p-value: 0.346\nNasua nasua Bayesian p-value: 0.4873\nPanthera onca Bayesian p-value: 0.4173\nPecari tajacu Bayesian p-value: 0.1773\nPriodontes maximus Bayesian p-value: 0.4773\nProcyon cancrivorous Bayesian p-value: 0.5133\nPuma concolor Bayesian p-value: 0.32\nPuma yagouaroundi Bayesian p-value: 0.6973\nTamandua tetradactyla Bayesian p-value: 0.6353\nTapirus pinchaque Bayesian p-value: 0.332\nTapirus terrestris Bayesian p-value: 0.0847\nTayassu pecari Bayesian p-value: 0.2787\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.sp)\n\n\nCall:\nppcOcc(object = out.sp, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3551 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.3693\nCoendou prehensilis Bayesian p-value: 0.606\nCuniculus paca Bayesian p-value: 3e-04\nDasyprocta fuliginosa Bayesian p-value: 0.004\nDasypus sp. Bayesian p-value: 0.1583\nDidelphis marsupialis Bayesian p-value: 0.4627\nEira barbara Bayesian p-value: 0.9203\nHerpailurus yagouaroundi Bayesian p-value: 0.5553\nLeopardus pardalis Bayesian p-value: 0.2847\nLeopardus tigrinus Bayesian p-value: 0.211\nLeopardus wiedii Bayesian p-value: 0.3317\nMazama americana Bayesian p-value: 0.056\nMazama nemorivaga Bayesian p-value: 0.6297\nMyoprocta pratti Bayesian p-value: 0.1477\nMyrmecophaga tridactyla Bayesian p-value: 0.2463\nNasua nasua Bayesian p-value: 0.4297\nPanthera onca Bayesian p-value: 0.43\nPecari tajacu Bayesian p-value: 0.1147\nPriodontes maximus Bayesian p-value: 0.5587\nProcyon cancrivorous Bayesian p-value: 0.4907\nPuma concolor Bayesian p-value: 0.2887\nPuma yagouaroundi Bayesian p-value: 0.6723\nTamandua tetradactyla Bayesian p-value: 0.54\nTapirus pinchaque Bayesian p-value: 0.3977\nTapirus terrestris Bayesian p-value: 0.052\nTayassu pecari Bayesian p-value: 0.2737\nFit statistic:  freeman-tukey \n\n\n\n\n\n\n\n\nImportant\n\n\n\nA Bayesian p-value that around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well.\n\n\nFit plot\n\nCode#### fit plot\nppc.df &lt;- data.frame(fit = ppc.out.sp$fit.y, \n                     fit.rep = ppc.out.sp$fit.y.rep, \n                     color = 'lightskyblue1')\n\nppc.df$color[ppc.df$fit.rep.1 &gt; ppc.df$fit.1] &lt;- 'lightsalmon'\nplot(ppc.df$fit.1, ppc.df$fit.rep.1, bg = ppc.df$color, pch = 21, \n     ylab = 'Fit', xlab = 'True')\nlines(ppc.df$fit.1, ppc.df$fit.1, col = 'black')\n\n\n\nThe most symmetrical, better fit!\n\n\n\nModel comparison\n\nCode# 4. Model comparison -----------------------------------------------------\n# Compute Widely Applicable Information Criterion (WAIC)\n# Lower values indicate better model fit. \nwaicOcc(out.null)\n\n      elpd         pD       WAIC \n-8844.8371   121.7868 17933.2478 \n\nCodewaicOcc(out.lfMs)\n\n      elpd         pD       WAIC \n-8845.1613   121.8714 17934.0653 \n\nCodewaicOcc(out.sp)\n\n      elpd         pD       WAIC \n-7730.6252   762.8295 16986.9094 \n\nCodewaicOcc(out.sp.cat)\n\n      elpd         pD       WAIC \n-7829.5783   685.8486 17030.8539 \n\n\nModel comparison as table\n\nCode# Here we summarize the spatial factor loadings\n# summary(out.sp$lambda.samples)\n\n# Resultados --------------------------------------------------------------\n# Extraemos lo tabla de valores estimados\nmodresult &lt;- cbind(as.data.frame(waicOcc(out.null)),\n                  as.data.frame(waicOcc(out.sp)),\n                  as.data.frame(waicOcc(out.lfMs)),\n                  as.data.frame(waicOcc(out.sp.cat))\n                  #as.data.frame(waicOcc(out.sp.gaus))\n                  )\n# View(modresult)\nmodresult_sorted &lt;- as.data.frame(t(modresult)) |&gt; \n  arrange(WAIC) # sort by\n  \nDT::datatable(modresult_sorted)\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\nLower values in WAIC indicate better model fit.\n\n\nWAIC is the Widely Applicable Information Criterion (Watanabe 2010).\nPosterior Summary\n\nCode# 5. Posterior summaries --------------------------------------------------\n# Concise summary of main parameter estimates\nsummary(out.sp, level = 'community')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 33.773\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -3.3512 0.5172 -4.3451 -3.3633 -2.2810 1.3609 108\nscale(elev)         0.0410 0.1946 -0.3539  0.0423  0.4210 1.0034 916\nscale(border_dist) -0.4007 0.3306 -1.0530 -0.3989  0.2415 1.0241 162\nscale(FLII)         0.5362 0.1954  0.1900  0.5189  0.9595 1.0970 378\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        4.8073 2.0122 2.0616 4.4592 9.8684 1.1503 198\nscale(elev)        0.4687 0.2148 0.1806 0.4279 0.9848 1.0168 896\nscale(border_dist) 1.7411 0.7518 0.6891 1.6120 3.5528 1.2501 355\nscale(FLII)        0.3741 0.2958 0.0556 0.2882 1.1499 1.4718  41\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.1962 0.2459 -2.7175 -2.1767 -1.7465 1.0463  667\nscale(effort)  0.3951 0.0644  0.2744  0.3940  0.5308 1.0083 2492\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.2338 0.5259 0.5379 1.1232 2.5106 1.1066  241\nscale(effort) 0.0442 0.0242 0.0161 0.0384 0.1058 0.9998 2352\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  0.0000 0.0000 0.0000  0.0000  0.0001 3.0865   60\nphi-2 10.6668 9.0147 0.0000  9.6311 26.4623 1.7523   18\nphi-3  8.8243 9.0798 0.0000  6.1605 26.2962 3.9425   11\nphi-4 11.9030 8.6764 0.0001 11.6079 26.7145 1.2123   45\nphi-5 13.4894 7.9590 0.6382 13.2441 26.7722 0.9996 3000\n\nCodesummary(out.sp, level = 'species')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 33.773\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis             -3.1224 0.6922 -4.3749 -3.1507\n(Intercept)-Coendou prehensilis             -5.9645 1.3670 -8.7370 -5.9546\n(Intercept)-Cuniculus paca                  -0.4578 0.5211 -1.5274 -0.4610\n(Intercept)-Dasyprocta fuliginosa           -2.6906 1.2639 -5.2474 -2.7481\n(Intercept)-Dasypus sp.                     -5.8874 0.8777 -7.7805 -5.8116\n(Intercept)-Didelphis marsupialis           -4.0029 0.7408 -5.6355 -3.9374\n(Intercept)-Eira barbara                    -2.3124 0.8357 -4.0634 -2.2874\n(Intercept)-Herpailurus yagouaroundi        -4.6705 1.2642 -7.0490 -4.7278\n(Intercept)-Leopardus pardalis              -1.9768 0.4807 -3.0594 -1.9370\n(Intercept)-Leopardus tigrinus              -6.3087 1.1012 -8.5639 -6.2238\n(Intercept)-Leopardus wiedii                -3.0943 1.0284 -4.9278 -3.2085\n(Intercept)-Mazama americana                -2.6261 0.4552 -3.6355 -2.5728\n(Intercept)-Mazama nemorivaga               -6.2566 1.0489 -8.4092 -6.1878\n(Intercept)-Myoprocta pratti                -5.1482 0.8499 -7.0050 -5.0795\n(Intercept)-Myrmecophaga tridactyla         -2.4573 0.8884 -4.2124 -2.4449\n(Intercept)-Nasua nasua                     -2.5429 0.8068 -4.0873 -2.5389\n(Intercept)-Panthera onca                   -2.2762 0.7404 -3.8574 -2.2552\n(Intercept)-Pecari tajacu                   -0.3718 0.6422 -1.6504 -0.3484\n(Intercept)-Priodontes maximus              -2.4892 1.0435 -4.5226 -2.4935\n(Intercept)-Procyon cancrivorous            -5.4237 1.3006 -8.2205 -5.3741\n(Intercept)-Puma concolor                   -2.7531 0.5703 -4.0769 -2.6831\n(Intercept)-Puma yagouaroundi               -5.7444 1.3849 -8.5177 -5.7111\n(Intercept)-Tamandua tetradactyla           -3.6848 1.0723 -5.7856 -3.6928\n(Intercept)-Tapirus pinchaque               -7.1762 1.1847 -9.8897 -7.0382\n(Intercept)-Tapirus terrestris              -1.1661 0.5363 -2.3521 -1.1284\n(Intercept)-Tayassu pecari                  -2.4582 0.6856 -3.9193 -2.4290\nscale(elev)-Atelocynus microtis             -0.5564 0.4149 -1.4134 -0.5423\nscale(elev)-Coendou prehensilis              0.2855 0.5778 -0.7933  0.2673\nscale(elev)-Cuniculus paca                  -0.0738 0.2363 -0.5616 -0.0701\nscale(elev)-Dasyprocta fuliginosa            0.7140 0.4642 -0.1291  0.6958\nscale(elev)-Dasypus sp.                     -0.1471 0.2998 -0.7491 -0.1501\nscale(elev)-Didelphis marsupialis            0.6066 0.4794 -0.2962  0.5834\nscale(elev)-Eira barbara                    -0.7174 0.4163 -1.5339 -0.7157\nscale(elev)-Herpailurus yagouaroundi        -0.4606 0.5831 -1.7054 -0.4430\nscale(elev)-Leopardus pardalis               0.4050 0.3471 -0.2714  0.4094\nscale(elev)-Leopardus tigrinus              -0.3221 0.5845 -1.5229 -0.3104\nscale(elev)-Leopardus wiedii                -0.0066 0.4528 -0.8992 -0.0026\nscale(elev)-Mazama americana                 1.5632 0.3916  0.8203  1.5540\nscale(elev)-Mazama nemorivaga                0.5685 0.3515 -0.0963  0.5530\nscale(elev)-Myoprocta pratti                 0.0664 0.4472 -0.7949  0.0579\nscale(elev)-Myrmecophaga tridactyla         -0.2445 0.4049 -1.0493 -0.2318\nscale(elev)-Nasua nasua                      0.1789 0.4107 -0.6151  0.1675\nscale(elev)-Panthera onca                    0.1856 0.3843 -0.5617  0.1747\nscale(elev)-Pecari tajacu                    0.3793 0.2838 -0.1525  0.3731\nscale(elev)-Priodontes maximus              -0.2099 0.4867 -1.1726 -0.2040\nscale(elev)-Procyon cancrivorous            -0.0894 0.4626 -0.9529 -0.0923\nscale(elev)-Puma concolor                   -0.5919 0.3418 -1.2996 -0.5885\nscale(elev)-Puma yagouaroundi               -0.2841 0.5268 -1.3176 -0.2929\nscale(elev)-Tamandua tetradactyla            0.2440 0.5265 -0.7298  0.2193\nscale(elev)-Tapirus pinchaque               -0.3083 0.5875 -1.5192 -0.2989\nscale(elev)-Tapirus terrestris               0.2795 0.2804 -0.2686  0.2704\nscale(elev)-Tayassu pecari                  -0.3228 0.3199 -0.9632 -0.3226\nscale(border_dist)-Atelocynus microtis      -0.0981 0.4527 -1.0023 -0.1028\nscale(border_dist)-Coendou prehensilis      -0.5568 0.8924 -2.4253 -0.5356\nscale(border_dist)-Cuniculus paca           -1.0348 0.3750 -1.7539 -1.0445\nscale(border_dist)-Dasyprocta fuliginosa    -0.5908 0.8906 -2.2001 -0.6371\nscale(border_dist)-Dasypus sp.              -3.5458 0.9084 -5.2100 -3.5868\nscale(border_dist)-Didelphis marsupialis     1.3850 0.5009  0.4035  1.3670\nscale(border_dist)-Eira barbara             -1.6871 0.6177 -2.9735 -1.6600\nscale(border_dist)-Herpailurus yagouaroundi  0.1441 0.8302 -1.4892  0.1297\nscale(border_dist)-Leopardus pardalis        1.0440 0.4175  0.2367  1.0371\nscale(border_dist)-Leopardus tigrinus        0.1620 0.7481 -1.2877  0.1473\nscale(border_dist)-Leopardus wiedii          0.3998 0.5489 -0.6433  0.3751\nscale(border_dist)-Mazama americana          1.0248 0.3850  0.2981  1.0130\nscale(border_dist)-Mazama nemorivaga        -2.7072 0.8772 -4.4897 -2.6860\nscale(border_dist)-Myoprocta pratti         -0.3178 0.6893 -1.7554 -0.2916\nscale(border_dist)-Myrmecophaga tridactyla  -0.2840 0.5169 -1.3428 -0.2763\nscale(border_dist)-Nasua nasua              -0.7887 0.5165 -1.8555 -0.7652\nscale(border_dist)-Panthera onca             0.4966 0.4984 -0.4425  0.4828\nscale(border_dist)-Pecari tajacu            -0.4161 0.4474 -1.2948 -0.4315\nscale(border_dist)-Priodontes maximus        0.1113 0.6053 -1.0314  0.0889\nscale(border_dist)-Procyon cancrivorous     -1.6218 0.8301 -3.4501 -1.5676\nscale(border_dist)-Puma concolor            -0.2378 0.3538 -0.9538 -0.2297\nscale(border_dist)-Puma yagouaroundi        -1.3519 0.8421 -3.1627 -1.3209\nscale(border_dist)-Tamandua tetradactyla    -0.3045 0.7773 -1.9238 -0.2739\nscale(border_dist)-Tapirus pinchaque         0.3632 0.7821 -1.0721  0.3296\nscale(border_dist)-Tapirus terrestris       -0.2910 0.3828 -1.0873 -0.2775\nscale(border_dist)-Tayassu pecari            0.1189 0.4761 -0.8840  0.1258\nscale(FLII)-Atelocynus microtis              0.3916 0.4223 -0.3833  0.3629\nscale(FLII)-Coendou prehensilis              0.5401 0.5958 -0.5664  0.5303\nscale(FLII)-Cuniculus paca                   0.0542 0.2559 -0.4534  0.0600\nscale(FLII)-Dasyprocta fuliginosa           -0.2974 0.4576 -1.2175 -0.2820\nscale(FLII)-Dasypus sp.                      0.5669 0.5674 -0.4885  0.5357\nscale(FLII)-Didelphis marsupialis            0.9931 0.4843  0.1980  0.9348\nscale(FLII)-Eira barbara                     0.3092 0.4290 -0.6333  0.3279\nscale(FLII)-Herpailurus yagouaroundi         0.2748 0.5286 -0.8199  0.2836\nscale(FLII)-Leopardus pardalis               0.9934 0.4253  0.3043  0.9435\nscale(FLII)-Leopardus tigrinus               0.1776 0.3515 -0.5396  0.1928\nscale(FLII)-Leopardus wiedii                 0.9454 0.5521  0.0747  0.8535\nscale(FLII)-Mazama americana                 0.4822 0.2767 -0.0281  0.4685\nscale(FLII)-Mazama nemorivaga                0.5906 0.6020 -0.5097  0.5439\nscale(FLII)-Myoprocta pratti                 0.8182 0.5138 -0.0733  0.7699\nscale(FLII)-Myrmecophaga tridactyla          0.4890 0.4125 -0.2583  0.4596\nscale(FLII)-Nasua nasua                      0.4043 0.4111 -0.3997  0.4149\nscale(FLII)-Panthera onca                    0.9606 0.4990  0.1358  0.9081\nscale(FLII)-Pecari tajacu                    0.5261 0.3348 -0.0716  0.5047\nscale(FLII)-Priodontes maximus               0.3564 0.4539 -0.5174  0.3443\nscale(FLII)-Procyon cancrivorous             0.6709 0.5869 -0.3926  0.6113\nscale(FLII)-Puma concolor                    0.1144 0.2552 -0.3812  0.1121\nscale(FLII)-Puma yagouaroundi                0.6249 0.5932 -0.4335  0.5855\nscale(FLII)-Tamandua tetradactyla            0.2364 0.4835 -0.7689  0.2500\nscale(FLII)-Tapirus pinchaque                0.5021 0.2890 -0.0274  0.4932\nscale(FLII)-Tapirus terrestris               1.0050 0.4376  0.2710  0.9565\nscale(FLII)-Tayassu pecari                   1.3216 0.6688  0.3084  1.2092\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis             -1.7199 1.3528  137\n(Intercept)-Coendou prehensilis             -3.2626 1.1786  149\n(Intercept)-Cuniculus paca                   0.4903 2.5439   15\n(Intercept)-Dasyprocta fuliginosa           -0.4438 2.7416   13\n(Intercept)-Dasypus sp.                     -4.3966 1.0653  335\n(Intercept)-Didelphis marsupialis           -2.7655 1.2800  273\n(Intercept)-Eira barbara                    -0.6952 1.4478  140\n(Intercept)-Herpailurus yagouaroundi        -2.2135 1.2906  135\n(Intercept)-Leopardus pardalis              -1.1788 1.1229   72\n(Intercept)-Leopardus tigrinus              -4.3454 1.1074  248\n(Intercept)-Leopardus wiedii                -0.8076 1.1006  140\n(Intercept)-Mazama americana                -1.9058 1.3716  103\n(Intercept)-Mazama nemorivaga               -4.4031 1.1048  255\n(Intercept)-Myoprocta pratti                -3.6921 1.3584  221\n(Intercept)-Myrmecophaga tridactyla         -0.7059 1.3169  130\n(Intercept)-Nasua nasua                     -0.9459 1.2726  118\n(Intercept)-Panthera onca                   -0.8763 1.5550  157\n(Intercept)-Pecari tajacu                    0.7561 2.0615   26\n(Intercept)-Priodontes maximus              -0.4945 1.3866  136\n(Intercept)-Procyon cancrivorous            -2.9945 1.0208  184\n(Intercept)-Puma concolor                   -1.8622 1.1143  271\n(Intercept)-Puma yagouaroundi               -2.8186 1.1437  168\n(Intercept)-Tamandua tetradactyla           -1.3725 1.0853  159\n(Intercept)-Tapirus pinchaque               -5.2220 1.1573  208\n(Intercept)-Tapirus terrestris              -0.2482 1.7238   29\n(Intercept)-Tayassu pecari                  -1.2741 1.6444   32\nscale(elev)-Atelocynus microtis              0.2182 1.0016 1236\nscale(elev)-Coendou prehensilis              1.5049 1.0019 1571\nscale(elev)-Cuniculus paca                   0.3750 1.0818  748\nscale(elev)-Dasyprocta fuliginosa            1.7025 2.0675   90\nscale(elev)-Dasypus sp.                      0.4364 1.2017  314\nscale(elev)-Didelphis marsupialis            1.5789 1.4518  118\nscale(elev)-Eira barbara                     0.0699 1.0953 1025\nscale(elev)-Herpailurus yagouaroundi         0.6054 1.0595 1244\nscale(elev)-Leopardus pardalis               1.1038 1.7394   73\nscale(elev)-Leopardus tigrinus               0.8052 1.0113 1387\nscale(elev)-Leopardus wiedii                 0.8912 1.0307 1134\nscale(elev)-Mazama americana                 2.3514 1.3444   92\nscale(elev)-Mazama nemorivaga                1.3052 1.0536  870\nscale(elev)-Myoprocta pratti                 0.9749 1.2384  311\nscale(elev)-Myrmecophaga tridactyla          0.5254 1.0622  686\nscale(elev)-Nasua nasua                      0.9994 1.0218 1021\nscale(elev)-Panthera onca                    0.9556 1.0019 1776\nscale(elev)-Pecari tajacu                    0.9483 1.0301  656\nscale(elev)-Priodontes maximus               0.7639 1.0003 1213\nscale(elev)-Procyon cancrivorous             0.8553 1.0080 1148\nscale(elev)-Puma concolor                    0.0822 1.1761  305\nscale(elev)-Puma yagouaroundi                0.7227 1.0068 1067\nscale(elev)-Tamandua tetradactyla            1.3146 1.0947  985\nscale(elev)-Tapirus pinchaque                0.8336 1.0007 1492\nscale(elev)-Tapirus terrestris               0.8561 1.0669  454\nscale(elev)-Tayassu pecari                   0.3148 1.1647  334\nscale(border_dist)-Atelocynus microtis       0.7986 1.0338  231\nscale(border_dist)-Coendou prehensilis       1.1526 1.0226  503\nscale(border_dist)-Cuniculus paca           -0.2531 1.2348   90\nscale(border_dist)-Dasyprocta fuliginosa     1.3486 1.6343   30\nscale(border_dist)-Dasypus sp.              -1.5847 2.0607   52\nscale(border_dist)-Didelphis marsupialis     2.4354 1.1362  166\nscale(border_dist)-Eira barbara             -0.5639 1.1818  355\nscale(border_dist)-Herpailurus yagouaroundi  1.7841 1.1048  499\nscale(border_dist)-Leopardus pardalis        1.8996 1.0025  145\nscale(border_dist)-Leopardus tigrinus        1.6803 0.9998  942\nscale(border_dist)-Leopardus wiedii          1.5584 1.0186  630\nscale(border_dist)-Mazama americana          1.8116 1.2145  142\nscale(border_dist)-Mazama nemorivaga        -1.1508 1.3271  157\nscale(border_dist)-Myoprocta pratti          1.0141 1.3205  131\nscale(border_dist)-Myrmecophaga tridactyla   0.7678 1.1902  380\nscale(border_dist)-Nasua nasua               0.1900 1.0490  283\nscale(border_dist)-Panthera onca             1.5728 1.0336  230\nscale(border_dist)-Pecari tajacu             0.4681 1.0723   88\nscale(border_dist)-Priodontes maximus        1.3517 1.0123  523\nscale(border_dist)-Procyon cancrivorous     -0.1098 1.1439  456\nscale(border_dist)-Puma concolor             0.4592 1.0319 1320\nscale(border_dist)-Puma yagouaroundi         0.2582 1.0541  475\nscale(border_dist)-Tamandua tetradactyla     1.1124 1.3059  214\nscale(border_dist)-Tapirus pinchaque         2.0346 1.0205  530\nscale(border_dist)-Tapirus terrestris        0.4346 1.0311  118\nscale(border_dist)-Tayassu pecari            1.0006 1.0180   76\nscale(FLII)-Atelocynus microtis              1.3069 1.0771 1254\nscale(FLII)-Coendou prehensilis              1.8239 1.0268 1018\nscale(FLII)-Cuniculus paca                   0.5549 1.2770  264\nscale(FLII)-Dasyprocta fuliginosa            0.5011 1.2473   69\nscale(FLII)-Dasypus sp.                      1.7944 1.0159 1141\nscale(FLII)-Didelphis marsupialis            2.1123 1.2544  110\nscale(FLII)-Eira barbara                     1.1005 1.1460  188\nscale(FLII)-Herpailurus yagouaroundi         1.3561 1.0131  916\nscale(FLII)-Leopardus pardalis               1.9818 1.2514   81\nscale(FLII)-Leopardus tigrinus               0.8264 1.0177 1240\nscale(FLII)-Leopardus wiedii                 2.2901 1.3234  131\nscale(FLII)-Mazama americana                 1.0602 1.0076 1192\nscale(FLII)-Mazama nemorivaga                1.9055 1.0753  945\nscale(FLII)-Myoprocta pratti                 1.9615 1.0569  923\nscale(FLII)-Myrmecophaga tridactyla          1.3906 1.0483  527\nscale(FLII)-Nasua nasua                      1.2033 1.1621  103\nscale(FLII)-Panthera onca                    2.0743 1.1265  260\nscale(FLII)-Pecari tajacu                    1.2627 1.1698   58\nscale(FLII)-Priodontes maximus               1.2866 1.0122  995\nscale(FLII)-Procyon cancrivorous             2.0067 1.0391  884\nscale(FLII)-Puma concolor                    0.6216 1.0033 1500\nscale(FLII)-Puma yagouaroundi                1.9642 1.0430 1033\nscale(FLII)-Tamandua tetradactyla            1.2126 1.1560  372\nscale(FLII)-Tapirus pinchaque                1.0941 1.0380 1559\nscale(FLII)-Tapirus terrestris               1.9714 1.2558  101\nscale(FLII)-Tayassu pecari                   2.8633 1.4218   40\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -2.6743 0.5351 -3.8252 -2.6408 -1.7359\n(Intercept)-Coendou prehensilis        -3.3453 1.0281 -5.7531 -3.2444 -1.5835\n(Intercept)-Cuniculus paca             -0.6952 0.0580 -0.8076 -0.6960 -0.5826\n(Intercept)-Dasyprocta fuliginosa      -0.4522 0.0688 -0.5889 -0.4532 -0.3149\n(Intercept)-Dasypus sp.                -1.5173 0.1218 -1.7562 -1.5168 -1.2895\n(Intercept)-Didelphis marsupialis      -2.1330 0.3416 -2.8277 -2.1198 -1.5107\n(Intercept)-Eira barbara               -3.0251 0.2515 -3.5451 -3.0252 -2.5365\n(Intercept)-Herpailurus yagouaroundi   -3.3452 0.7829 -4.8981 -3.3333 -1.8451\n(Intercept)-Leopardus pardalis         -1.7805 0.1560 -2.1023 -1.7764 -1.4843\n(Intercept)-Leopardus tigrinus         -2.1083 0.5758 -3.3441 -2.0668 -1.0822\n(Intercept)-Leopardus wiedii           -3.1792 0.6916 -4.6135 -3.1100 -1.9689\n(Intercept)-Mazama americana           -1.1770 0.1128 -1.4049 -1.1755 -0.9618\n(Intercept)-Mazama nemorivaga          -2.0047 0.1828 -2.3783 -2.0024 -1.6531\n(Intercept)-Myoprocta pratti           -1.3673 0.2396 -1.8578 -1.3634 -0.9139\n(Intercept)-Myrmecophaga tridactyla    -2.9391 0.4432 -3.8466 -2.9102 -2.1469\n(Intercept)-Nasua nasua                -2.9475 0.2877 -3.5400 -2.9426 -2.4032\n(Intercept)-Panthera onca              -2.4681 0.2296 -2.9309 -2.4598 -2.0442\n(Intercept)-Pecari tajacu              -1.2017 0.0699 -1.3401 -1.2012 -1.0725\n(Intercept)-Priodontes maximus         -3.4626 0.4749 -4.3238 -3.4792 -2.5143\n(Intercept)-Procyon cancrivorous       -3.3776 0.7784 -4.9916 -3.3094 -2.0134\n(Intercept)-Puma concolor              -1.7118 0.1837 -2.0896 -1.7053 -1.3807\n(Intercept)-Puma yagouaroundi          -3.5405 0.8884 -5.4282 -3.4740 -1.9973\n(Intercept)-Tamandua tetradactyla      -3.4819 0.6150 -4.7506 -3.4647 -2.3539\n(Intercept)-Tapirus pinchaque          -1.4118 0.2778 -1.9989 -1.4059 -0.9052\n(Intercept)-Tapirus terrestris         -1.1007 0.0769 -1.2533 -1.0995 -0.9541\n(Intercept)-Tayassu pecari             -1.6461 0.1378 -1.9192 -1.6454 -1.3878\nscale(effort)-Atelocynus microtis       0.3384 0.1807 -0.0140  0.3358  0.7005\nscale(effort)-Coendou prehensilis       0.3942 0.2180 -0.0322  0.3938  0.8332\nscale(effort)-Cuniculus paca            0.3428 0.0667  0.2139  0.3418  0.4729\nscale(effort)-Dasyprocta fuliginosa     0.4115 0.0857  0.2559  0.4082  0.5918\nscale(effort)-Dasypus sp.               0.4312 0.1349  0.1806  0.4254  0.7158\nscale(effort)-Didelphis marsupialis     0.5339 0.1892  0.2046  0.5174  0.9594\nscale(effort)-Eira barbara              0.5083 0.1834  0.1830  0.4937  0.9130\nscale(effort)-Herpailurus yagouaroundi  0.2855 0.2009 -0.1345  0.2924  0.6699\nscale(effort)-Leopardus pardalis        0.4133 0.1161  0.2087  0.4082  0.6566\nscale(effort)-Leopardus tigrinus        0.4339 0.2037  0.0411  0.4278  0.8532\nscale(effort)-Leopardus wiedii          0.4482 0.1968  0.0934  0.4367  0.8690\nscale(effort)-Mazama americana          0.5129 0.1317  0.2774  0.5050  0.7873\nscale(effort)-Mazama nemorivaga         0.2820 0.1427  0.0129  0.2768  0.5722\nscale(effort)-Myoprocta pratti          0.3494 0.1784  0.0073  0.3435  0.7057\nscale(effort)-Myrmecophaga tridactyla   0.3838 0.1716  0.0576  0.3756  0.7478\nscale(effort)-Nasua nasua               0.4963 0.1852  0.1758  0.4821  0.8841\nscale(effort)-Panthera onca             0.3184 0.1366  0.0514  0.3143  0.5817\nscale(effort)-Pecari tajacu             0.3564 0.0765  0.2107  0.3544  0.5081\nscale(effort)-Priodontes maximus        0.2281 0.1679 -0.1010  0.2303  0.5517\nscale(effort)-Procyon cancrivorous      0.4190 0.2079  0.0391  0.4112  0.8528\nscale(effort)-Puma concolor             0.3127 0.1314  0.0683  0.3096  0.5739\nscale(effort)-Puma yagouaroundi         0.3995 0.2093 -0.0095  0.4002  0.8294\nscale(effort)-Tamandua tetradactyla     0.2691 0.1945 -0.1263  0.2682  0.6431\nscale(effort)-Tapirus pinchaque         0.4913 0.1941  0.1445  0.4792  0.9340\nscale(effort)-Tapirus terrestris        0.3786 0.0816  0.2220  0.3763  0.5438\nscale(effort)-Tayassu pecari            0.5475 0.1308  0.3128  0.5441  0.8162\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        1.0034  416\n(Intercept)-Coendou prehensilis        1.1180  230\n(Intercept)-Cuniculus paca             1.0073 2784\n(Intercept)-Dasyprocta fuliginosa      1.0010 3000\n(Intercept)-Dasypus sp.                1.0006 2743\n(Intercept)-Didelphis marsupialis      1.0050 1246\n(Intercept)-Eira barbara               1.0339  407\n(Intercept)-Herpailurus yagouaroundi   1.0257  290\n(Intercept)-Leopardus pardalis         1.0621 1576\n(Intercept)-Leopardus tigrinus         1.0038  950\n(Intercept)-Leopardus wiedii           1.1703  151\n(Intercept)-Mazama americana           1.0003 3000\n(Intercept)-Mazama nemorivaga          1.0003 2850\n(Intercept)-Myoprocta pratti           1.0027 2529\n(Intercept)-Myrmecophaga tridactyla    1.4129  190\n(Intercept)-Nasua nasua                1.1365  186\n(Intercept)-Panthera onca              1.0310  744\n(Intercept)-Pecari tajacu              1.0487 2196\n(Intercept)-Priodontes maximus         1.1517  186\n(Intercept)-Procyon cancrivorous       1.0180  259\n(Intercept)-Puma concolor              1.0004 2394\n(Intercept)-Puma yagouaroundi          1.1648  249\n(Intercept)-Tamandua tetradactyla      1.0191  180\n(Intercept)-Tapirus pinchaque          1.0011 2767\n(Intercept)-Tapirus terrestris         1.0005 3000\n(Intercept)-Tayassu pecari             1.0156 1698\nscale(effort)-Atelocynus microtis      0.9996 3000\nscale(effort)-Coendou prehensilis      1.0007 3000\nscale(effort)-Cuniculus paca           1.0027 3000\nscale(effort)-Dasyprocta fuliginosa    1.0011 2777\nscale(effort)-Dasypus sp.              1.0012 2851\nscale(effort)-Didelphis marsupialis    1.0032 2622\nscale(effort)-Eira barbara             1.0057 2601\nscale(effort)-Herpailurus yagouaroundi 1.0055 2763\nscale(effort)-Leopardus pardalis       1.0060 2712\nscale(effort)-Leopardus tigrinus       1.0024 3000\nscale(effort)-Leopardus wiedii         1.0038 2097\nscale(effort)-Mazama americana         1.0032 2758\nscale(effort)-Mazama nemorivaga        1.0012 3000\nscale(effort)-Myoprocta pratti         1.0023 3000\nscale(effort)-Myrmecophaga tridactyla  1.0009 3000\nscale(effort)-Nasua nasua              1.0056 2292\nscale(effort)-Panthera onca            1.0006 3000\nscale(effort)-Pecari tajacu            1.0035 2792\nscale(effort)-Priodontes maximus       1.0000 2640\nscale(effort)-Procyon cancrivorous     1.0007 2807\nscale(effort)-Puma concolor            1.0002 3000\nscale(effort)-Puma yagouaroundi        1.0003 3000\nscale(effort)-Tamandua tetradactyla    1.0029 2749\nscale(effort)-Tapirus pinchaque        1.0042 2713\nscale(effort)-Tapirus terrestris       0.9999 3000\nscale(effort)-Tayassu pecari           1.0036 2745\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  0.0000 0.0000 0.0000  0.0000  0.0001 3.0865   60\nphi-2 10.6668 9.0147 0.0000  9.6311 26.4623 1.7523   18\nphi-3  8.8243 9.0798 0.0000  6.1605 26.2962 3.9425   11\nphi-4 11.9030 8.6764 0.0001 11.6079 26.7145 1.2123   45\nphi-5 13.4894 7.9590 0.6382 13.2441 26.7722 0.9996 3000\n\nCodesummary(out.sp, level = 'both')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 33.773\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -3.3512 0.5172 -4.3451 -3.3633 -2.2810 1.3609 108\nscale(elev)         0.0410 0.1946 -0.3539  0.0423  0.4210 1.0034 916\nscale(border_dist) -0.4007 0.3306 -1.0530 -0.3989  0.2415 1.0241 162\nscale(FLII)         0.5362 0.1954  0.1900  0.5189  0.9595 1.0970 378\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)        4.8073 2.0122 2.0616 4.4592 9.8684 1.1503 198\nscale(elev)        0.4687 0.2148 0.1806 0.4279 0.9848 1.0168 896\nscale(border_dist) 1.7411 0.7518 0.6891 1.6120 3.5528 1.2501 355\nscale(FLII)        0.3741 0.2958 0.0556 0.2882 1.1499 1.4718  41\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.1962 0.2459 -2.7175 -2.1767 -1.7465 1.0463  667\nscale(effort)  0.3951 0.0644  0.2744  0.3940  0.5308 1.0083 2492\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.2338 0.5259 0.5379 1.1232 2.5106 1.1066  241\nscale(effort) 0.0442 0.0242 0.0161 0.0384 0.1058 0.9998 2352\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis             -3.1224 0.6922 -4.3749 -3.1507\n(Intercept)-Coendou prehensilis             -5.9645 1.3670 -8.7370 -5.9546\n(Intercept)-Cuniculus paca                  -0.4578 0.5211 -1.5274 -0.4610\n(Intercept)-Dasyprocta fuliginosa           -2.6906 1.2639 -5.2474 -2.7481\n(Intercept)-Dasypus sp.                     -5.8874 0.8777 -7.7805 -5.8116\n(Intercept)-Didelphis marsupialis           -4.0029 0.7408 -5.6355 -3.9374\n(Intercept)-Eira barbara                    -2.3124 0.8357 -4.0634 -2.2874\n(Intercept)-Herpailurus yagouaroundi        -4.6705 1.2642 -7.0490 -4.7278\n(Intercept)-Leopardus pardalis              -1.9768 0.4807 -3.0594 -1.9370\n(Intercept)-Leopardus tigrinus              -6.3087 1.1012 -8.5639 -6.2238\n(Intercept)-Leopardus wiedii                -3.0943 1.0284 -4.9278 -3.2085\n(Intercept)-Mazama americana                -2.6261 0.4552 -3.6355 -2.5728\n(Intercept)-Mazama nemorivaga               -6.2566 1.0489 -8.4092 -6.1878\n(Intercept)-Myoprocta pratti                -5.1482 0.8499 -7.0050 -5.0795\n(Intercept)-Myrmecophaga tridactyla         -2.4573 0.8884 -4.2124 -2.4449\n(Intercept)-Nasua nasua                     -2.5429 0.8068 -4.0873 -2.5389\n(Intercept)-Panthera onca                   -2.2762 0.7404 -3.8574 -2.2552\n(Intercept)-Pecari tajacu                   -0.3718 0.6422 -1.6504 -0.3484\n(Intercept)-Priodontes maximus              -2.4892 1.0435 -4.5226 -2.4935\n(Intercept)-Procyon cancrivorous            -5.4237 1.3006 -8.2205 -5.3741\n(Intercept)-Puma concolor                   -2.7531 0.5703 -4.0769 -2.6831\n(Intercept)-Puma yagouaroundi               -5.7444 1.3849 -8.5177 -5.7111\n(Intercept)-Tamandua tetradactyla           -3.6848 1.0723 -5.7856 -3.6928\n(Intercept)-Tapirus pinchaque               -7.1762 1.1847 -9.8897 -7.0382\n(Intercept)-Tapirus terrestris              -1.1661 0.5363 -2.3521 -1.1284\n(Intercept)-Tayassu pecari                  -2.4582 0.6856 -3.9193 -2.4290\nscale(elev)-Atelocynus microtis             -0.5564 0.4149 -1.4134 -0.5423\nscale(elev)-Coendou prehensilis              0.2855 0.5778 -0.7933  0.2673\nscale(elev)-Cuniculus paca                  -0.0738 0.2363 -0.5616 -0.0701\nscale(elev)-Dasyprocta fuliginosa            0.7140 0.4642 -0.1291  0.6958\nscale(elev)-Dasypus sp.                     -0.1471 0.2998 -0.7491 -0.1501\nscale(elev)-Didelphis marsupialis            0.6066 0.4794 -0.2962  0.5834\nscale(elev)-Eira barbara                    -0.7174 0.4163 -1.5339 -0.7157\nscale(elev)-Herpailurus yagouaroundi        -0.4606 0.5831 -1.7054 -0.4430\nscale(elev)-Leopardus pardalis               0.4050 0.3471 -0.2714  0.4094\nscale(elev)-Leopardus tigrinus              -0.3221 0.5845 -1.5229 -0.3104\nscale(elev)-Leopardus wiedii                -0.0066 0.4528 -0.8992 -0.0026\nscale(elev)-Mazama americana                 1.5632 0.3916  0.8203  1.5540\nscale(elev)-Mazama nemorivaga                0.5685 0.3515 -0.0963  0.5530\nscale(elev)-Myoprocta pratti                 0.0664 0.4472 -0.7949  0.0579\nscale(elev)-Myrmecophaga tridactyla         -0.2445 0.4049 -1.0493 -0.2318\nscale(elev)-Nasua nasua                      0.1789 0.4107 -0.6151  0.1675\nscale(elev)-Panthera onca                    0.1856 0.3843 -0.5617  0.1747\nscale(elev)-Pecari tajacu                    0.3793 0.2838 -0.1525  0.3731\nscale(elev)-Priodontes maximus              -0.2099 0.4867 -1.1726 -0.2040\nscale(elev)-Procyon cancrivorous            -0.0894 0.4626 -0.9529 -0.0923\nscale(elev)-Puma concolor                   -0.5919 0.3418 -1.2996 -0.5885\nscale(elev)-Puma yagouaroundi               -0.2841 0.5268 -1.3176 -0.2929\nscale(elev)-Tamandua tetradactyla            0.2440 0.5265 -0.7298  0.2193\nscale(elev)-Tapirus pinchaque               -0.3083 0.5875 -1.5192 -0.2989\nscale(elev)-Tapirus terrestris               0.2795 0.2804 -0.2686  0.2704\nscale(elev)-Tayassu pecari                  -0.3228 0.3199 -0.9632 -0.3226\nscale(border_dist)-Atelocynus microtis      -0.0981 0.4527 -1.0023 -0.1028\nscale(border_dist)-Coendou prehensilis      -0.5568 0.8924 -2.4253 -0.5356\nscale(border_dist)-Cuniculus paca           -1.0348 0.3750 -1.7539 -1.0445\nscale(border_dist)-Dasyprocta fuliginosa    -0.5908 0.8906 -2.2001 -0.6371\nscale(border_dist)-Dasypus sp.              -3.5458 0.9084 -5.2100 -3.5868\nscale(border_dist)-Didelphis marsupialis     1.3850 0.5009  0.4035  1.3670\nscale(border_dist)-Eira barbara             -1.6871 0.6177 -2.9735 -1.6600\nscale(border_dist)-Herpailurus yagouaroundi  0.1441 0.8302 -1.4892  0.1297\nscale(border_dist)-Leopardus pardalis        1.0440 0.4175  0.2367  1.0371\nscale(border_dist)-Leopardus tigrinus        0.1620 0.7481 -1.2877  0.1473\nscale(border_dist)-Leopardus wiedii          0.3998 0.5489 -0.6433  0.3751\nscale(border_dist)-Mazama americana          1.0248 0.3850  0.2981  1.0130\nscale(border_dist)-Mazama nemorivaga        -2.7072 0.8772 -4.4897 -2.6860\nscale(border_dist)-Myoprocta pratti         -0.3178 0.6893 -1.7554 -0.2916\nscale(border_dist)-Myrmecophaga tridactyla  -0.2840 0.5169 -1.3428 -0.2763\nscale(border_dist)-Nasua nasua              -0.7887 0.5165 -1.8555 -0.7652\nscale(border_dist)-Panthera onca             0.4966 0.4984 -0.4425  0.4828\nscale(border_dist)-Pecari tajacu            -0.4161 0.4474 -1.2948 -0.4315\nscale(border_dist)-Priodontes maximus        0.1113 0.6053 -1.0314  0.0889\nscale(border_dist)-Procyon cancrivorous     -1.6218 0.8301 -3.4501 -1.5676\nscale(border_dist)-Puma concolor            -0.2378 0.3538 -0.9538 -0.2297\nscale(border_dist)-Puma yagouaroundi        -1.3519 0.8421 -3.1627 -1.3209\nscale(border_dist)-Tamandua tetradactyla    -0.3045 0.7773 -1.9238 -0.2739\nscale(border_dist)-Tapirus pinchaque         0.3632 0.7821 -1.0721  0.3296\nscale(border_dist)-Tapirus terrestris       -0.2910 0.3828 -1.0873 -0.2775\nscale(border_dist)-Tayassu pecari            0.1189 0.4761 -0.8840  0.1258\nscale(FLII)-Atelocynus microtis              0.3916 0.4223 -0.3833  0.3629\nscale(FLII)-Coendou prehensilis              0.5401 0.5958 -0.5664  0.5303\nscale(FLII)-Cuniculus paca                   0.0542 0.2559 -0.4534  0.0600\nscale(FLII)-Dasyprocta fuliginosa           -0.2974 0.4576 -1.2175 -0.2820\nscale(FLII)-Dasypus sp.                      0.5669 0.5674 -0.4885  0.5357\nscale(FLII)-Didelphis marsupialis            0.9931 0.4843  0.1980  0.9348\nscale(FLII)-Eira barbara                     0.3092 0.4290 -0.6333  0.3279\nscale(FLII)-Herpailurus yagouaroundi         0.2748 0.5286 -0.8199  0.2836\nscale(FLII)-Leopardus pardalis               0.9934 0.4253  0.3043  0.9435\nscale(FLII)-Leopardus tigrinus               0.1776 0.3515 -0.5396  0.1928\nscale(FLII)-Leopardus wiedii                 0.9454 0.5521  0.0747  0.8535\nscale(FLII)-Mazama americana                 0.4822 0.2767 -0.0281  0.4685\nscale(FLII)-Mazama nemorivaga                0.5906 0.6020 -0.5097  0.5439\nscale(FLII)-Myoprocta pratti                 0.8182 0.5138 -0.0733  0.7699\nscale(FLII)-Myrmecophaga tridactyla          0.4890 0.4125 -0.2583  0.4596\nscale(FLII)-Nasua nasua                      0.4043 0.4111 -0.3997  0.4149\nscale(FLII)-Panthera onca                    0.9606 0.4990  0.1358  0.9081\nscale(FLII)-Pecari tajacu                    0.5261 0.3348 -0.0716  0.5047\nscale(FLII)-Priodontes maximus               0.3564 0.4539 -0.5174  0.3443\nscale(FLII)-Procyon cancrivorous             0.6709 0.5869 -0.3926  0.6113\nscale(FLII)-Puma concolor                    0.1144 0.2552 -0.3812  0.1121\nscale(FLII)-Puma yagouaroundi                0.6249 0.5932 -0.4335  0.5855\nscale(FLII)-Tamandua tetradactyla            0.2364 0.4835 -0.7689  0.2500\nscale(FLII)-Tapirus pinchaque                0.5021 0.2890 -0.0274  0.4932\nscale(FLII)-Tapirus terrestris               1.0050 0.4376  0.2710  0.9565\nscale(FLII)-Tayassu pecari                   1.3216 0.6688  0.3084  1.2092\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis             -1.7199 1.3528  137\n(Intercept)-Coendou prehensilis             -3.2626 1.1786  149\n(Intercept)-Cuniculus paca                   0.4903 2.5439   15\n(Intercept)-Dasyprocta fuliginosa           -0.4438 2.7416   13\n(Intercept)-Dasypus sp.                     -4.3966 1.0653  335\n(Intercept)-Didelphis marsupialis           -2.7655 1.2800  273\n(Intercept)-Eira barbara                    -0.6952 1.4478  140\n(Intercept)-Herpailurus yagouaroundi        -2.2135 1.2906  135\n(Intercept)-Leopardus pardalis              -1.1788 1.1229   72\n(Intercept)-Leopardus tigrinus              -4.3454 1.1074  248\n(Intercept)-Leopardus wiedii                -0.8076 1.1006  140\n(Intercept)-Mazama americana                -1.9058 1.3716  103\n(Intercept)-Mazama nemorivaga               -4.4031 1.1048  255\n(Intercept)-Myoprocta pratti                -3.6921 1.3584  221\n(Intercept)-Myrmecophaga tridactyla         -0.7059 1.3169  130\n(Intercept)-Nasua nasua                     -0.9459 1.2726  118\n(Intercept)-Panthera onca                   -0.8763 1.5550  157\n(Intercept)-Pecari tajacu                    0.7561 2.0615   26\n(Intercept)-Priodontes maximus              -0.4945 1.3866  136\n(Intercept)-Procyon cancrivorous            -2.9945 1.0208  184\n(Intercept)-Puma concolor                   -1.8622 1.1143  271\n(Intercept)-Puma yagouaroundi               -2.8186 1.1437  168\n(Intercept)-Tamandua tetradactyla           -1.3725 1.0853  159\n(Intercept)-Tapirus pinchaque               -5.2220 1.1573  208\n(Intercept)-Tapirus terrestris              -0.2482 1.7238   29\n(Intercept)-Tayassu pecari                  -1.2741 1.6444   32\nscale(elev)-Atelocynus microtis              0.2182 1.0016 1236\nscale(elev)-Coendou prehensilis              1.5049 1.0019 1571\nscale(elev)-Cuniculus paca                   0.3750 1.0818  748\nscale(elev)-Dasyprocta fuliginosa            1.7025 2.0675   90\nscale(elev)-Dasypus sp.                      0.4364 1.2017  314\nscale(elev)-Didelphis marsupialis            1.5789 1.4518  118\nscale(elev)-Eira barbara                     0.0699 1.0953 1025\nscale(elev)-Herpailurus yagouaroundi         0.6054 1.0595 1244\nscale(elev)-Leopardus pardalis               1.1038 1.7394   73\nscale(elev)-Leopardus tigrinus               0.8052 1.0113 1387\nscale(elev)-Leopardus wiedii                 0.8912 1.0307 1134\nscale(elev)-Mazama americana                 2.3514 1.3444   92\nscale(elev)-Mazama nemorivaga                1.3052 1.0536  870\nscale(elev)-Myoprocta pratti                 0.9749 1.2384  311\nscale(elev)-Myrmecophaga tridactyla          0.5254 1.0622  686\nscale(elev)-Nasua nasua                      0.9994 1.0218 1021\nscale(elev)-Panthera onca                    0.9556 1.0019 1776\nscale(elev)-Pecari tajacu                    0.9483 1.0301  656\nscale(elev)-Priodontes maximus               0.7639 1.0003 1213\nscale(elev)-Procyon cancrivorous             0.8553 1.0080 1148\nscale(elev)-Puma concolor                    0.0822 1.1761  305\nscale(elev)-Puma yagouaroundi                0.7227 1.0068 1067\nscale(elev)-Tamandua tetradactyla            1.3146 1.0947  985\nscale(elev)-Tapirus pinchaque                0.8336 1.0007 1492\nscale(elev)-Tapirus terrestris               0.8561 1.0669  454\nscale(elev)-Tayassu pecari                   0.3148 1.1647  334\nscale(border_dist)-Atelocynus microtis       0.7986 1.0338  231\nscale(border_dist)-Coendou prehensilis       1.1526 1.0226  503\nscale(border_dist)-Cuniculus paca           -0.2531 1.2348   90\nscale(border_dist)-Dasyprocta fuliginosa     1.3486 1.6343   30\nscale(border_dist)-Dasypus sp.              -1.5847 2.0607   52\nscale(border_dist)-Didelphis marsupialis     2.4354 1.1362  166\nscale(border_dist)-Eira barbara             -0.5639 1.1818  355\nscale(border_dist)-Herpailurus yagouaroundi  1.7841 1.1048  499\nscale(border_dist)-Leopardus pardalis        1.8996 1.0025  145\nscale(border_dist)-Leopardus tigrinus        1.6803 0.9998  942\nscale(border_dist)-Leopardus wiedii          1.5584 1.0186  630\nscale(border_dist)-Mazama americana          1.8116 1.2145  142\nscale(border_dist)-Mazama nemorivaga        -1.1508 1.3271  157\nscale(border_dist)-Myoprocta pratti          1.0141 1.3205  131\nscale(border_dist)-Myrmecophaga tridactyla   0.7678 1.1902  380\nscale(border_dist)-Nasua nasua               0.1900 1.0490  283\nscale(border_dist)-Panthera onca             1.5728 1.0336  230\nscale(border_dist)-Pecari tajacu             0.4681 1.0723   88\nscale(border_dist)-Priodontes maximus        1.3517 1.0123  523\nscale(border_dist)-Procyon cancrivorous     -0.1098 1.1439  456\nscale(border_dist)-Puma concolor             0.4592 1.0319 1320\nscale(border_dist)-Puma yagouaroundi         0.2582 1.0541  475\nscale(border_dist)-Tamandua tetradactyla     1.1124 1.3059  214\nscale(border_dist)-Tapirus pinchaque         2.0346 1.0205  530\nscale(border_dist)-Tapirus terrestris        0.4346 1.0311  118\nscale(border_dist)-Tayassu pecari            1.0006 1.0180   76\nscale(FLII)-Atelocynus microtis              1.3069 1.0771 1254\nscale(FLII)-Coendou prehensilis              1.8239 1.0268 1018\nscale(FLII)-Cuniculus paca                   0.5549 1.2770  264\nscale(FLII)-Dasyprocta fuliginosa            0.5011 1.2473   69\nscale(FLII)-Dasypus sp.                      1.7944 1.0159 1141\nscale(FLII)-Didelphis marsupialis            2.1123 1.2544  110\nscale(FLII)-Eira barbara                     1.1005 1.1460  188\nscale(FLII)-Herpailurus yagouaroundi         1.3561 1.0131  916\nscale(FLII)-Leopardus pardalis               1.9818 1.2514   81\nscale(FLII)-Leopardus tigrinus               0.8264 1.0177 1240\nscale(FLII)-Leopardus wiedii                 2.2901 1.3234  131\nscale(FLII)-Mazama americana                 1.0602 1.0076 1192\nscale(FLII)-Mazama nemorivaga                1.9055 1.0753  945\nscale(FLII)-Myoprocta pratti                 1.9615 1.0569  923\nscale(FLII)-Myrmecophaga tridactyla          1.3906 1.0483  527\nscale(FLII)-Nasua nasua                      1.2033 1.1621  103\nscale(FLII)-Panthera onca                    2.0743 1.1265  260\nscale(FLII)-Pecari tajacu                    1.2627 1.1698   58\nscale(FLII)-Priodontes maximus               1.2866 1.0122  995\nscale(FLII)-Procyon cancrivorous             2.0067 1.0391  884\nscale(FLII)-Puma concolor                    0.6216 1.0033 1500\nscale(FLII)-Puma yagouaroundi                1.9642 1.0430 1033\nscale(FLII)-Tamandua tetradactyla            1.2126 1.1560  372\nscale(FLII)-Tapirus pinchaque                1.0941 1.0380 1559\nscale(FLII)-Tapirus terrestris               1.9714 1.2558  101\nscale(FLII)-Tayassu pecari                   2.8633 1.4218   40\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -2.6743 0.5351 -3.8252 -2.6408 -1.7359\n(Intercept)-Coendou prehensilis        -3.3453 1.0281 -5.7531 -3.2444 -1.5835\n(Intercept)-Cuniculus paca             -0.6952 0.0580 -0.8076 -0.6960 -0.5826\n(Intercept)-Dasyprocta fuliginosa      -0.4522 0.0688 -0.5889 -0.4532 -0.3149\n(Intercept)-Dasypus sp.                -1.5173 0.1218 -1.7562 -1.5168 -1.2895\n(Intercept)-Didelphis marsupialis      -2.1330 0.3416 -2.8277 -2.1198 -1.5107\n(Intercept)-Eira barbara               -3.0251 0.2515 -3.5451 -3.0252 -2.5365\n(Intercept)-Herpailurus yagouaroundi   -3.3452 0.7829 -4.8981 -3.3333 -1.8451\n(Intercept)-Leopardus pardalis         -1.7805 0.1560 -2.1023 -1.7764 -1.4843\n(Intercept)-Leopardus tigrinus         -2.1083 0.5758 -3.3441 -2.0668 -1.0822\n(Intercept)-Leopardus wiedii           -3.1792 0.6916 -4.6135 -3.1100 -1.9689\n(Intercept)-Mazama americana           -1.1770 0.1128 -1.4049 -1.1755 -0.9618\n(Intercept)-Mazama nemorivaga          -2.0047 0.1828 -2.3783 -2.0024 -1.6531\n(Intercept)-Myoprocta pratti           -1.3673 0.2396 -1.8578 -1.3634 -0.9139\n(Intercept)-Myrmecophaga tridactyla    -2.9391 0.4432 -3.8466 -2.9102 -2.1469\n(Intercept)-Nasua nasua                -2.9475 0.2877 -3.5400 -2.9426 -2.4032\n(Intercept)-Panthera onca              -2.4681 0.2296 -2.9309 -2.4598 -2.0442\n(Intercept)-Pecari tajacu              -1.2017 0.0699 -1.3401 -1.2012 -1.0725\n(Intercept)-Priodontes maximus         -3.4626 0.4749 -4.3238 -3.4792 -2.5143\n(Intercept)-Procyon cancrivorous       -3.3776 0.7784 -4.9916 -3.3094 -2.0134\n(Intercept)-Puma concolor              -1.7118 0.1837 -2.0896 -1.7053 -1.3807\n(Intercept)-Puma yagouaroundi          -3.5405 0.8884 -5.4282 -3.4740 -1.9973\n(Intercept)-Tamandua tetradactyla      -3.4819 0.6150 -4.7506 -3.4647 -2.3539\n(Intercept)-Tapirus pinchaque          -1.4118 0.2778 -1.9989 -1.4059 -0.9052\n(Intercept)-Tapirus terrestris         -1.1007 0.0769 -1.2533 -1.0995 -0.9541\n(Intercept)-Tayassu pecari             -1.6461 0.1378 -1.9192 -1.6454 -1.3878\nscale(effort)-Atelocynus microtis       0.3384 0.1807 -0.0140  0.3358  0.7005\nscale(effort)-Coendou prehensilis       0.3942 0.2180 -0.0322  0.3938  0.8332\nscale(effort)-Cuniculus paca            0.3428 0.0667  0.2139  0.3418  0.4729\nscale(effort)-Dasyprocta fuliginosa     0.4115 0.0857  0.2559  0.4082  0.5918\nscale(effort)-Dasypus sp.               0.4312 0.1349  0.1806  0.4254  0.7158\nscale(effort)-Didelphis marsupialis     0.5339 0.1892  0.2046  0.5174  0.9594\nscale(effort)-Eira barbara              0.5083 0.1834  0.1830  0.4937  0.9130\nscale(effort)-Herpailurus yagouaroundi  0.2855 0.2009 -0.1345  0.2924  0.6699\nscale(effort)-Leopardus pardalis        0.4133 0.1161  0.2087  0.4082  0.6566\nscale(effort)-Leopardus tigrinus        0.4339 0.2037  0.0411  0.4278  0.8532\nscale(effort)-Leopardus wiedii          0.4482 0.1968  0.0934  0.4367  0.8690\nscale(effort)-Mazama americana          0.5129 0.1317  0.2774  0.5050  0.7873\nscale(effort)-Mazama nemorivaga         0.2820 0.1427  0.0129  0.2768  0.5722\nscale(effort)-Myoprocta pratti          0.3494 0.1784  0.0073  0.3435  0.7057\nscale(effort)-Myrmecophaga tridactyla   0.3838 0.1716  0.0576  0.3756  0.7478\nscale(effort)-Nasua nasua               0.4963 0.1852  0.1758  0.4821  0.8841\nscale(effort)-Panthera onca             0.3184 0.1366  0.0514  0.3143  0.5817\nscale(effort)-Pecari tajacu             0.3564 0.0765  0.2107  0.3544  0.5081\nscale(effort)-Priodontes maximus        0.2281 0.1679 -0.1010  0.2303  0.5517\nscale(effort)-Procyon cancrivorous      0.4190 0.2079  0.0391  0.4112  0.8528\nscale(effort)-Puma concolor             0.3127 0.1314  0.0683  0.3096  0.5739\nscale(effort)-Puma yagouaroundi         0.3995 0.2093 -0.0095  0.4002  0.8294\nscale(effort)-Tamandua tetradactyla     0.2691 0.1945 -0.1263  0.2682  0.6431\nscale(effort)-Tapirus pinchaque         0.4913 0.1941  0.1445  0.4792  0.9340\nscale(effort)-Tapirus terrestris        0.3786 0.0816  0.2220  0.3763  0.5438\nscale(effort)-Tayassu pecari            0.5475 0.1308  0.3128  0.5441  0.8162\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        1.0034  416\n(Intercept)-Coendou prehensilis        1.1180  230\n(Intercept)-Cuniculus paca             1.0073 2784\n(Intercept)-Dasyprocta fuliginosa      1.0010 3000\n(Intercept)-Dasypus sp.                1.0006 2743\n(Intercept)-Didelphis marsupialis      1.0050 1246\n(Intercept)-Eira barbara               1.0339  407\n(Intercept)-Herpailurus yagouaroundi   1.0257  290\n(Intercept)-Leopardus pardalis         1.0621 1576\n(Intercept)-Leopardus tigrinus         1.0038  950\n(Intercept)-Leopardus wiedii           1.1703  151\n(Intercept)-Mazama americana           1.0003 3000\n(Intercept)-Mazama nemorivaga          1.0003 2850\n(Intercept)-Myoprocta pratti           1.0027 2529\n(Intercept)-Myrmecophaga tridactyla    1.4129  190\n(Intercept)-Nasua nasua                1.1365  186\n(Intercept)-Panthera onca              1.0310  744\n(Intercept)-Pecari tajacu              1.0487 2196\n(Intercept)-Priodontes maximus         1.1517  186\n(Intercept)-Procyon cancrivorous       1.0180  259\n(Intercept)-Puma concolor              1.0004 2394\n(Intercept)-Puma yagouaroundi          1.1648  249\n(Intercept)-Tamandua tetradactyla      1.0191  180\n(Intercept)-Tapirus pinchaque          1.0011 2767\n(Intercept)-Tapirus terrestris         1.0005 3000\n(Intercept)-Tayassu pecari             1.0156 1698\nscale(effort)-Atelocynus microtis      0.9996 3000\nscale(effort)-Coendou prehensilis      1.0007 3000\nscale(effort)-Cuniculus paca           1.0027 3000\nscale(effort)-Dasyprocta fuliginosa    1.0011 2777\nscale(effort)-Dasypus sp.              1.0012 2851\nscale(effort)-Didelphis marsupialis    1.0032 2622\nscale(effort)-Eira barbara             1.0057 2601\nscale(effort)-Herpailurus yagouaroundi 1.0055 2763\nscale(effort)-Leopardus pardalis       1.0060 2712\nscale(effort)-Leopardus tigrinus       1.0024 3000\nscale(effort)-Leopardus wiedii         1.0038 2097\nscale(effort)-Mazama americana         1.0032 2758\nscale(effort)-Mazama nemorivaga        1.0012 3000\nscale(effort)-Myoprocta pratti         1.0023 3000\nscale(effort)-Myrmecophaga tridactyla  1.0009 3000\nscale(effort)-Nasua nasua              1.0056 2292\nscale(effort)-Panthera onca            1.0006 3000\nscale(effort)-Pecari tajacu            1.0035 2792\nscale(effort)-Priodontes maximus       1.0000 2640\nscale(effort)-Procyon cancrivorous     1.0007 2807\nscale(effort)-Puma concolor            1.0002 3000\nscale(effort)-Puma yagouaroundi        1.0003 3000\nscale(effort)-Tamandua tetradactyla    1.0029 2749\nscale(effort)-Tapirus pinchaque        1.0042 2713\nscale(effort)-Tapirus terrestris       0.9999 3000\nscale(effort)-Tayassu pecari           1.0036 2745\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1  0.0000 0.0000 0.0000  0.0000  0.0001 3.0865   60\nphi-2 10.6668 9.0147 0.0000  9.6311 26.4623 1.7523   18\nphi-3  8.8243 9.0798 0.0000  6.1605 26.2962 3.9425   11\nphi-4 11.9030 8.6764 0.0001 11.6079 26.7145 1.2123   45\nphi-5 13.4894 7.9590 0.6382 13.2441 26.7722 0.9996 3000\n\n\nBayesian p-values can be inspected to check for lack of fit (overall or by species). Lack of fit at significance level = 0.05 is indicated by Bayesian p-values below 0.025 or greater than 0.975. The overall Bayesian p-value (Bpvalue) indicates no problems with lack of fit. Likewise, species-level Bayesian p-values (Bpvalue_species) indicate no lack of fit for any species.\n\nGelman and Rubin’s convergence diagnostic: Approximate convergence is diagnosed when the upper limit is close to 1.\n\nConvergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable. The gelman.diag diagnostic is applied to a single variable from the chain. It is based a comparison of within-chain and between-chain variances, and is similar to a classical analysis of variance.\nValues substantially above 1 indicate lack of convergence.\nModel Diagnostics\n\nCode#| eval: true\n#| echo: true\n#| code-fold: true\n#| warning: false\n#| message: false\n# Extract posterior draws for later use\nposterior1 &lt;- as.array(out.sp)\n\n# Trace plots to check chain mixing. Extract posterior samples and bind in a single matrix.\nPOSTERIOR.MATRIX &lt;- cbind(out.sp$alpha.comm.samples, \n                          out.sp$beta.comm.samples,  \n                          out.sp$alpha.samples, \n                          out.sp$beta.samples)\n\n# Matrix output is all chains combined, split into 3 chains.\nCHAIN.1 &lt;- as.mcmc(POSTERIOR.MATRIX[1:1000,])\nCHAIN.2 &lt;- as.mcmc(POSTERIOR.MATRIX[1001:2000,])\nCHAIN.3 &lt;- as.mcmc(POSTERIOR.MATRIX[2001:3000,])\n# CHAIN.4 &lt;- as.mcmc(POSTERIOR.MATRIX[8001:10000,])\n\n# Bind four chains as coda mcmc.list object.\nPOSTERIOR.CHAINS &lt;- mcmc.list(CHAIN.1, CHAIN.2, CHAIN.3)#, CHAIN.4)\n\n# Create an empty folder.\n# dir.create (\"Beetle_plots\")\n\n# Plot chain mixing of each parameter to a multi-panel plot and save to the new folder. ART 5 mins\n\n######################################\n#### SAVE Diagnostics at PDF\n# MCMCtrace(POSTERIOR.CHAINS, params = \"all\", Rhat = TRUE, n.eff = TRUE)#, pdf = TRUE, filename = \"Beetle_240909_traceplots.pdf\", wd = \"Beetle_plots\")\n\n\n\n#mcmc_trace(fit.commu, parms = c(\"beta.ranef.cont.border_dist.mean\"))\n\n#posterior2 &lt;- extract(fit.commu, inc_warmup = TRUE, permuted = FALSE)\n\n#color_scheme_set(\"mix-blue-pink\")\n#p &lt;- mcmc_trace(posterior1,  pars = c(\"mu\", \"tau\"), n_warmup = 300,\n#                facet_args = list(nrow = 2, labeller = label_parsed))\n#p + facet_text(size = 15)\n\n\n\n#outMCMC &lt;- fit.commu #Convert output to MCMC object\n#diagnostics chains \n\n# all as pdf\n# MCMCtrace(outMCMC)\n\n# MCMCtrace(outMCMC, params = c(\"alpha0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(out.sp, params = c(\"beta.ranef.cont.border_dist.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n\n### density\n# MCMCtrace(outMCMC, params = c(\"Nspecies\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n#MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n#coda::gelman.diag(outMCMC,  multivariate = FALSE, transform=FALSE)\n                    \n# coda::gelman.plot(outMCMC,  multivariate = FALSE)\n\n\n\n# \n# mcmc_intervals(outMCMC, pars = c(\"Nspecies_in_AP[1]\",\n#                                  \"Nspecies_in_AP[2]\"),\n#                point_est = \"mean\",\n#                prob = 0.75, prob_outer = 0.95) +\n#   ggtitle(\"Number of species\") + \n#   scale_y_discrete(labels = c(\"Nspecies_in_AP[1]\"=levels(sitecovs$in_AP)[1],\n#              \"Nspecies_in_AP[2]\"=levels(sitecovs$in_AP)[2]))\n# \n# #Continuous\n# p &lt;- mcmc_intervals(outMCMC, \n#                pars = c(\"beta.ranef.cont.border_dist.mean\",\n#                          #\"beta.ranef.cont.elev.mean\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"))\n# \n# # relabel parameters\n# p + scale_y_discrete(\n#   labels = c(\"beta.ranef.cont.border_dist.mean\"=\"Dist_border\",\n#                          #\"beta.ranef.cont.elev.mean\"=\"Elevation\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"=\"in_AP\")\n# ) +\n#   ggtitle(\"Treatment effect on all species\")\n# \n\n\nPosterior Summary (effect)\nCommunity effects\nCode# Create simple plot summaries using MCMCvis package.\n# Detection covariate effects --------- \nMCMCplot(out.sp$alpha.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n# Occupancy community-level effects \nMCMCplot(out.sp$beta.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) Detection\n\n\n\n\n\n\n\n\n\n(b) Occupancy\n\n\n\n\n\n\nFigure 1: Community effects\n\n\nSpecies effects\nCode# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,27:52], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,53:78], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,79:104], ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) elevation\n\n\n\n\n\n\n\n\n\n(b) distance border\n\n\n\n\n\n\n\n\n\n\n\n(c) FLII\n\n\n\n\n\n\nFigure 2: Species effects\n\n\nSpecies effects using bayesplot\n\n\nCodelibrary(bayesplot)\n#mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n# mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n\nmcmc_intervals(out.sp$beta.samples[,27:52] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,53:78] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,79:104] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\n\nPrediction as graph\nThis prediction uses the non spatial model\n\nCode# 6. Prediction -----------------------------------------------------------\n# Predict occupancy along a gradient of elev   \n# Create a set of values across the range of observed elev values\nelev.pred.vals &lt;- seq(min(data_list$occ.covs$elev), \n                              max(data_list$occ.covs$elev), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nelev.pred.vals.scale &lt;- (elev.pred.vals - mean(data_list$occ.covs$elev)) / \n                             sd(data_list$occ.covs$elev)\n# Create a set of values across the range of observed elev values\nborder_dist.pred.vals &lt;- seq(min(data_list$occ.covs$border_dist), \n                              max(data_list$occ.covs$border_dist), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nborder_dist.pred.vals.scale &lt;- (border_dist.pred.vals -\n                                  mean(data_list$occ.covs$border_dist)) /\n                                  sd(data_list$occ.covs$border_dist)\n\n# Create a set of values across the range of observed FLII values\nFLII.pred.vals &lt;- seq(min(data_list$occ.covs$FLII), \n                              max(data_list$occ.covs$FLII), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nFLII.pred.vals.scale &lt;- (FLII.pred.vals -\n                                  mean(data_list$occ.covs$FLII)) /\n                                  sd(data_list$occ.covs$FLII)\n\n# Predict occupancy across elev  values at mean values of all other variables\npred.df1 &lt;- as.matrix(data.frame(intercept = 1, \n                                 elev = elev.pred.vals.scale, \n                                 border_dist = 0,\n                                 FLII=0))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df2 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = border_dist.pred.vals.scale,\n                         FLII= 0 ))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df3 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = 0,\n                         FLII= FLII.pred.vals.scale ))#, catchment = 0, density = 0, \n                         # slope = 0))\n\nout.pred1 &lt;- predict(out.null, pred.df1) # using non spatial\nstr(out.pred1)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:26, 1:100] 0.0331 0.0329 0.052 0.0469 0.0381 ...\n $ z.0.samples  : int [1:1500, 1:26, 1:100] 0 0 0 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out.null, X.0 = pred.df1)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred1$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           elev = elev.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(elev.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = elev, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'elevation (m)', y = 'Occupancy Probability') \n\n\n\n\n\n\nCodeout.pred2 &lt;- predict(out.null, pred.df2) # using non spatial\nstr(out.pred2)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:26, 1:100] 0.0271 0.0287 0.1033 0.0633 0.0257 ...\n $ z.0.samples  : int [1:1500, 1:26, 1:100] 0 0 0 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out.null, X.0 = pred.df2)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred2$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           border_dist = border_dist.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(border_dist.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = border_dist/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'border_dist (Km)', y = 'Occupancy Probability') \n\n\n\n\n\n\nCodeout.pred3 &lt;- predict(out.null, pred.df3) # using non spatial\nstr(out.pred3)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:26, 1:100] 0.00265 0.00346 0.00313 0.01032 0.00231 ...\n $ z.0.samples  : int [1:1500, 1:26, 1:100] 0 0 0 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out.null, X.0 = pred.df3)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred3$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           FLII = FLII.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(FLII.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = FLII/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'FLII', y = 'Occupancy Probability') \n\n\n\n\n\n\n\nSpatial Prediction in elevation_EC\n\nCode#aggregate  resolution to (factor = 3)\n#transform coord data to UTM\nelevation_UTM &lt;- project(elevation_EC, \"EPSG:10603\")\nelevation_17.aggregate &lt;- aggregate(elevation_UTM, fact=10)\nres(elevation_17.aggregate)\n\n[1] 5984.313 5984.313\n\nCode# Convert the SpatRaster to a data frame with coordinates\ndf_coords &lt;- as.data.frame(elevation_17.aggregate, xy = TRUE)\nnames(df_coords) &lt;-c(\"X\",\"Y\",\"elev\")\n\nelev.pred &lt;- (df_coords$elev - mean(data_list$occ.covs$elev)) / sd(data_list$occ.covs$elev)\n\n\n############### Predict new data ############### \n# we predict at one covariate varing and others at mean value = 0\n# intercept = 1, elev = 0, border_dist = 0, FLII= 0\n# in that order\n################ ################ ################ \npredict_data &lt;- cbind(1, elev.pred, 0, 0)\ncolnames(predict_data) &lt;- c(\"intercept\",\n                            \"elev\",\n                            \"border_dist\",\n                            \"FLII\" )\n\n# X.0 &lt;- cbind(1, 1, elev.pred)#, elev.pred^2)\n\n# coords.0 &lt;- as.matrix(hbefElev[, c('Easting', 'Northing')])\nout.sp.ms.pred &lt;- predict(out.sp, \n                          X.0=predict_data, \n                          df_coords[,1:2],\n                          threads=4) #Warning :'threads' is not an argument\n\nWarning in predict.sfMsPGOcc(out.sp, X.0 = predict_data, df_coords[, 1:2], :\n'threads' is not an argument\n\n\n----------------------------------------\n    Prediction description\n----------------------------------------\nSpatial Factor NNGP Multispecies Occupancy model with Polya-Gamma latent\nvariable fit with 514 observations.\n\nNumber of covariates 4 (including intercept if specified).\n\nUsing the exponential spatial correlation model.\n\nUsing 15 nearest neighbors.\nUsing 5 latent spatial factors.\n\nNumber of MCMC samples 3000.\n\nPredicting at 2618 non-sampled locations.\n\n\nSource compiled with OpenMP support and model fit using 1 threads.\n-------------------------------------------------\n        Predicting\n-------------------------------------------------\nLocation: 100 of 2618, 3.82%\nLocation: 200 of 2618, 7.64%\nLocation: 300 of 2618, 11.46%\nLocation: 400 of 2618, 15.28%\nLocation: 500 of 2618, 19.10%\nLocation: 600 of 2618, 22.92%\nLocation: 700 of 2618, 26.74%\nLocation: 800 of 2618, 30.56%\nLocation: 900 of 2618, 34.38%\nLocation: 1000 of 2618, 38.20%\nLocation: 1100 of 2618, 42.02%\nLocation: 1200 of 2618, 45.84%\nLocation: 1300 of 2618, 49.66%\nLocation: 1400 of 2618, 53.48%\nLocation: 1500 of 2618, 57.30%\nLocation: 1600 of 2618, 61.12%\nLocation: 1700 of 2618, 64.94%\nLocation: 1800 of 2618, 68.75%\nLocation: 1900 of 2618, 72.57%\nLocation: 2000 of 2618, 76.39%\nLocation: 2100 of 2618, 80.21%\nLocation: 2200 of 2618, 84.03%\nLocation: 2300 of 2618, 87.85%\nLocation: 2400 of 2618, 91.67%\nLocation: 2500 of 2618, 95.49%\nLocation: 2600 of 2618, 99.31%\nLocation: 2618 of 2618, 100.00%\nGenerating latent occupancy state\n\nCode# extract the array of interest= occupancy\npredicted_array &lt;- out.sp.ms.pred$psi.0.samples\n\n\n\ndim(predicted_array)\n\n[1] 3000   26 2618\n\nCode# df_plot &lt;- NA # empty column\npredicted_raster_list &lt;- list() # rast(nrows = 52, ncols = 103,\n                         #ext(elevation_17.aggregate), \n                         # crs = \"EPSG:32717\")\n\n###################################################\n# simpler way to make mean in the array by species\n# array order: itera=3000, sp=22, pixels=5202\n# we wan to keep index 2 and 3\nlibrary(plyr)\n\n------------------------------------------------------------------------------\n\n\nYou have loaded plyr after dplyr - this is likely to cause problems.\nIf you need functions from both plyr and dplyr, please load plyr first, then dplyr:\nlibrary(plyr); library(dplyr)\n\n\n------------------------------------------------------------------------------\n\n\n\nAdjuntando el paquete: 'plyr'\n\n\nThe following objects are masked from 'package:dplyr':\n\n    arrange, count, desc, failwith, id, mutate, rename, summarise,\n    summarize\n\n\nThe following object is masked from 'package:purrr':\n\n    compact\n\n\nThe following object is masked from 'package:maps':\n\n    ozone\n\nCodearesult = (plyr::aaply(predicted_array, # mean fo all iterations\n                       c(2,3), \n                       mean))\n\n##############################################\n#### Loop to make rasters and put in a list\n# array order: itera=3000, sp=22, pixels=5202\nfor (i in 1:dim(predicted_array)[2]){\n # Convert array slice to data frame\n # df_plot[i] &lt;- as.data.frame(predicted_array[1, i, ]) # sp_i\n # df_plot[i] &lt;- as.vector(aresult[i,]) # Extract sp\n # Producing an SDM for all (posterior mean)\n plot.dat &lt;- data.frame(x = df_coords$X, \n                        y = df_coords$Y, \n                        psi.sp = as.vector(aresult[i,]))\n pred_rast &lt;- rast(plot.dat, \n                   type = \"xyz\", \n                   crs = \"EPSG:10603\") # Replace EPSG:4326 with your CRS\n predicted_raster_list[[i]] &lt;- pred_rast\n}\n\n# Convert the list to a SpatRaster stack\npredictad_raster_stack &lt;- rast(predicted_raster_list)\n# put species names\nnames(predictad_raster_stack) &lt;- selected.sp\n\nplot(predictad_raster_stack)\n\n\n\n\n\n\nCode# get the mean\npredicted_mean &lt;- mean(predictad_raster_stack)\n\nplot(predicted_mean, main=\"mean occupancy\")\n\n\n\n\n\n\nCodemapview(predicted_mean) + mapview(AP_Yasuni_UTM_line)\n\n\n\n\nCode#"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#package-citation",
    "href": "blog/2025-10-15-analysis/index.html#package-citation",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: abind v. 1.4.8 (Plate and Heiberger 2024), bayesplot v. 1.14.0 (Gabry et al. 2019; Gabry and Mahr 2025), beepr v. 2.0 (Bååth 2024), camtrapR v. 3.0.0 (Niedballa et al. 2016), coda v. 0.19.4.1 (Plummer et al. 2006), DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), MCMCvis v. 0.16.3 (Youngflesh 2018), plyr v. 1.8.9 (Wickham 2011), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), snow v. 0.4.4 (Tierney et al. 2021), snowfall v. 1.84.6.3 (Knaus 2023), spOccupancy v. 0.8.0 (Doser et al. 2022, 2024; Doser, Finley, and Banerjee 2023), terra v. 1.8.70 (Hijmans 2025), tictoc v. 1.2.1 (Izrailev 2024), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018)."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#sesion-info",
    "href": "blog/2025-10-15-analysis/index.html#sesion-info",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: internal\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] plyr_1.8.9        abind_1.4-8       lubridate_1.9.4   forcats_1.0.0    \n [5] stringr_1.5.2     dplyr_1.1.4       purrr_1.1.0       readr_2.1.5      \n [9] tidyr_1.3.1       tibble_3.2.1      ggplot2_4.0.0     tidyverse_2.0.0  \n[13] spOccupancy_0.8.0 camtrapR_3.0.0    snowfall_1.84-6.3 snow_0.4-4       \n[17] beepr_2.0         coda_0.19-4.1     MCMCvis_0.16.3    tictoc_1.2.1     \n[21] bayesplot_1.14.0  elevatr_0.99.0    terra_1.8-70      tmap_4.2         \n[25] maps_3.4.3        mapview_2.11.4    sf_1.0-21         DT_0.34.0        \n[29] readxl_1.4.3      grateful_0.3.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3      tensorA_0.36.2.1        rstudioapi_0.17.1      \n  [4] audio_0.1-11            jsonlite_2.0.0          wk_0.9.4               \n  [7] magrittr_2.0.3          farver_2.1.2            nloptr_2.1.1           \n [10] rmarkdown_2.30          vctrs_0.6.5             minqa_1.2.8            \n [13] base64enc_0.1-3         RcppNumerical_0.6-0     progress_1.2.3         \n [16] htmltools_0.5.8.1       leafsync_0.1.0          distributional_0.5.0   \n [19] curl_7.0.0              raster_3.6-32           cellranger_1.1.0       \n [22] s2_1.1.9                sass_0.4.10             bslib_0.9.0            \n [25] slippymath_0.3.1        KernSmooth_2.23-24      htmlwidgets_1.6.4      \n [28] cachem_1.1.0            stars_0.6-8             uuid_1.2-1             \n [31] mime_0.13               lifecycle_1.0.4         iterators_1.0.14       \n [34] pkgconfig_2.0.3         cols4all_0.8-1          Matrix_1.7-1           \n [37] R6_2.6.1                fastmap_1.2.0           shiny_1.9.1            \n [40] digest_0.6.37           colorspace_2.1-1        leafem_0.2.4           \n [43] crosstalk_1.2.1         labeling_0.4.3          lwgeom_0.2-14          \n [46] progressr_0.15.0        spacesXYZ_1.6-0         timechange_0.3.0       \n [49] httr_1.4.7              mgcv_1.9-1              compiler_4.4.2         \n [52] microbenchmark_1.5.0    proxy_0.4-27            withr_3.0.2            \n [55] doParallel_1.0.17       backports_1.5.0         brew_1.0-10            \n [58] S7_0.2.0                DBI_1.2.3               logger_0.4.0           \n [61] MASS_7.3-61             maptiles_0.10.0         tmaptools_3.3          \n [64] leaflet_2.2.3           classInt_0.4-11         tools_4.4.2            \n [67] units_0.8-7             leaflegend_1.2.1        httpuv_1.6.16          \n [70] glue_1.8.0              satellite_1.0.5         nlme_3.1-166           \n [73] promises_1.3.3          grid_4.4.2              checkmate_2.3.2        \n [76] reshape2_1.4.4          generics_0.1.3          leaflet.providers_2.0.0\n [79] gtable_0.3.6            tzdb_0.4.0              shinyBS_0.61.1         \n [82] class_7.3-22            data.table_1.17.8       hms_1.1.3              \n [85] sp_2.2-0                RANN_2.6.2              foreach_1.5.2          \n [88] pillar_1.11.1           posterior_1.6.1         later_1.4.2            \n [91] splines_4.4.2           lattice_0.22-6          tidyselect_1.2.1       \n [94] knitr_1.50              svglite_2.1.3           stats4_4.4.2           \n [97] xfun_0.52               shinydashboard_0.7.3    leafpop_0.1.0          \n[100] stringi_1.8.4           rematch_2.0.0           yaml_2.3.10            \n[103] boot_1.3-31             evaluate_1.0.4          codetools_0.2-20       \n[106] cli_3.6.5               RcppParallel_5.1.9      systemfonts_1.1.0      \n[109] xtable_1.8-4            jquerylib_0.1.4         secr_5.1.0             \n[112] dichromat_2.0-0.1       Rcpp_1.1.0              spAbundance_0.2.1      \n[115] png_0.1-8               XML_3.99-0.18           parallel_4.4.2         \n[118] prettyunits_1.2.0       lme4_1.1-35.5           mvtnorm_1.3-2          \n[121] scales_1.4.0            e1071_1.7-16            crayon_1.5.3           \n[124] rlang_1.1.6"
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#single-species-occupancy-models",
    "href": "blog/2025-10-15-analysis/index.html#single-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-models",
    "href": "blog/2025-10-15-analysis/index.html#multi-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Multi-species occupancy models",
    "text": "Multi-species occupancy models\nMulti-species occupancy models for estimating the effects of environmental covariates on several species occurrences while accounting for imperfect detection were build on the principle of the Single-species occupancy model, and developed more than 20 years ago.\nMulti-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables."
  },
  {
    "objectID": "blog/2025-10-15-analysis/index.html#objective",
    "href": "blog/2025-10-15-analysis/index.html#objective",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Objective",
    "text": "Objective\nWe want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\nCodelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis) # Tools to Visualize, Manipulate, and Summarize MCMC Output\nlibrary(coda) # Output Analysis and Diagnostics for MCMC\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR) # Camera Trap Data Management and Preparation \nlibrary(spOccupancy) # Single-Species, Multi-Species, and Integrated Spatial Occupancy\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'"
  },
  {
    "objectID": "blog/2025-11-02-Yasuni/index.html",
    "href": "blog/2025-11-02-Yasuni/index.html",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-11-02-Yasuni/index.html#single-species-occupancy-models",
    "href": "blog/2025-11-02-Yasuni/index.html#single-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-11-02-Yasuni/index.html#multi-species-occupancy-models",
    "href": "blog/2025-11-02-Yasuni/index.html#multi-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Multi-species occupancy models",
    "text": "Multi-species occupancy models\nMulti-species occupancy models for estimating the effects of environmental covariates on several species occurrences while accounting for imperfect detection were build on the principle of the Single-species occupancy model, and developed more than 20 years ago.\nMulti-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables."
  },
  {
    "objectID": "blog/2025-11-02-Yasuni/index.html#objective",
    "href": "blog/2025-11-02-Yasuni/index.html#objective",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Objective",
    "text": "Objective\nWe want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\nCodelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis) # Tools to Visualize, Manipulate, and Summarize MCMC Output\nlibrary(coda) # Output Analysis and Diagnostics for MCMC\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR) # Camera Trap Data Management and Preparation \nlibrary(spOccupancy) # Single-Species, Multi-Species, and Integrated Spatial Occupancy\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'"
  },
  {
    "objectID": "blog/2025-11-02-Yasuni/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "href": "blog/2025-11-02-Yasuni/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Fitting a Multi-Species Spatial Occupancy Model",
    "text": "Fitting a Multi-Species Spatial Occupancy Model\nWe use a more computationally efficient approach for fitting spatial multi-species occupancy models. This alternative approach is called a “spatial factor multi-species occupancy model”, and is described in depth in Doser, Finley, and Banerjee (2023). This newer approach also accounts for residual species correlations (i.e., it is a joint species distribution model with imperfect detection). The simulation results from Doser, Finley, and Banerjee (2023) show that this new alternative approach outperforms, or performs equally to spMsPGOcc(), while being substantially faster.\nThe Latent factor multi-species occupancy model is described in detail here\nData from Plantas Medicinales Putumayo\nHere we use the table: - COL-18-Putumayo2023\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_PlantasMed &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PlantasMedicinales/WDPA_WDOECM_May2025_Public_555511938_shp-polygons.shp\")\n\n### Ecu 17, Ecu 18, ECU 20, Ecu 22  \n\n# load data and make array_locID column\nCol_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\") |&gt; mutate(array_locID=paste(\"Col_18\", locationID, sep=\"_\"))\n\n\n# get sites\nCol_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\")\n\n\n\n# get elevation map\nelevation_18 &lt;- rast(get_elev_raster(Col_18_sites, z = 10)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Col_18_sites &lt;- cbind(Col_18_sites, terra::extract(elevation_18, Col_18_sites))\n# covs_Col_17_sites &lt;- cbind(Col_17_sites, terra::extract(elevation_17, Col_17_sites))\n\n\n# get which are in and out\ncovs_Col_18_sites$in_AP = st_intersects(covs_Col_18_sites, AP_PlantasMed, sparse = FALSE)\n# covs_Col_17_sites$in_AP = st_intersects(covs_Col_17_sites, AP_Yasuni, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_18, alpha=0.5) + \n  mapview (AP_PlantasMed, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Col_18_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) \n  # mapview (covs_Col_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n\n\nData fom Bajo Madidi and Heath\nHere we use the tables: - BOL-008a - BOL-008b - BOL14a - BOL14b\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nArea_Madidi &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Area_Madidi/WDPA_WDOECM_Jul2025_Public_303894_shp-polygons.shp\")\n\nMadidi_NP &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Madidi_NP/WDPA_WDOECM_Jul2025_Public_98183_shp-polygons.shp\")\n#AP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\n#Bol_Pacaya &lt;- read_excel(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\", sheet = \"Image\")\n\n\nBol_Madidi_1 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-008a.xlsx\") |&gt; mutate(Point.x=as.character(paste(\"M1\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M1\",Point.y, sep = \"-\")))\n\nBol_Madidi_2 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-008b.xlsx\") |&gt; mutate(Point.x=as.character(paste(\"M2\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M2\",Point.y, sep = \"-\")))\n\nBol_Madidi_3 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-014a.xlsx\")|&gt; mutate(Point.x=as.character(paste(\"M3\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M3\",Point.y, sep = \"-\")))\n\nBol_Madidi_4 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Bolivia/Guido/BOL-014b.xlsx\")|&gt; mutate(Point.x=as.character(paste(\"M4\",Point.x, sep = \"-\"))) |&gt; mutate(Point.y=as.character(paste(\"M1\",Point.y, sep = \"-\")))\n\n\n\n\n# get sites\nBol_Madidi_sites1 &lt;-  Bol_Madidi_1 |&gt; \n   dplyr::bind_rows(Bol_Madidi_2) |&gt; \n   dplyr::bind_rows(Bol_Madidi_3) |&gt; \n   dplyr::bind_rows(Bol_Madidi_4) |&gt; \n  select(\"Latitude\", \"Longitude\", \"Point.x\" \n) |&gt; dplyr::distinct( )  \n\nBol_Madidi_sites &lt;- sf::st_as_sf(Bol_Madidi_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Bol_Madidi_sites) &lt;- 4326\n\n\n# get elevation map\nelevation_17 &lt;- rast(get_elev_raster(Bol_Madidi_sites, z = 9)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n# extract covs using points and add to _sites\ncovs_Bol_Madidi_sites &lt;- cbind(Bol_Madidi_sites, terra::extract(elevation_17, Bol_Madidi_sites))\n# covs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_17, Ecu_17_sites))\n\n\n# get which are in and out\ncovs_Bol_Madidi_sites$in_AP = st_intersects(covs_Bol_Madidi_sites, Madidi_NP, sparse = FALSE)\n# covs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Machalilla, sparse = FALSE)\n\n\n# make a map\nmapview (elevation_17, alpha=0.7) + \n  mapview (Madidi_NP, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (Area_Madidi, color = \"yellow\", col.regions = \"yellow\", alpha = 0.5) +\n  #mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Bol_Madidi_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) \n\n\nTamshiyacu Tahuayo data\nHere we use the tables: - PER-003_BD_ACRCTT_T0.xlsx - PER-002_BD_ACRTT-PILOTO.xlsx\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Pacaya &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PacayaSamiria/WDPA_WDOECM_Jun2025_Public_249_shp-polygons.shp\")\n\nAP_Tahuayo &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Tahuayo/WDPA_WDOECM_Jun2025_Public_555555621_shp-polygons.shp\")\n\n# load data and make array_locID column\nPer_Tahuayo_piloto &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-002_BD_ACRTT-PILOTO.xlsx\")\n\n\n\nPer_Tahuayo &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n \nFLII2016 &lt;- rast(\"C:/CodigoR/WCS_2024/FLI/raster/FLII_final/FLII_2016.tif\")\n\n# get sites\n# Per_Pacaya_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Peru/PER-003_BD_ACRCTT_T0.xlsx\")\n\n# get sites\nPer_Tahuayo_sites1 &lt;- Per_Tahuayo |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_sites &lt;- sf::st_as_sf(Per_Tahuayo_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_sites) &lt;- 4326\n\n\n\n# get Pacaya sites\nPer_Tahuayo_piloto_sites1 &lt;- Per_Tahuayo_piloto |&gt; select(\"Latitude\",\n                                    \"Longitude\",\n                                    \"Camera_Id\" \n                                    ) |&gt; dplyr::distinct( )  \n\nPer_Tahuayo_piloto_sites &lt;- sf::st_as_sf(Per_Tahuayo_piloto_sites1, coords = c(\"Longitude\",\"Latitude\"))\nst_crs(Per_Tahuayo_piloto_sites) &lt;- 4326\n\n\n\n\n# get elevation map\nelevation_PE &lt;- rast(get_elev_raster(Per_Tahuayo_sites, z = 10)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_sites &lt;- cbind(Per_Tahuayo_sites,\n                                terra::extract(elevation_PE,\n                                               Per_Tahuayo_sites)\n                                )\n\n# extract covs using points and add to _sites\ncovs_Per_Tahuayo_piloto_sites &lt;- cbind(Per_Tahuayo_piloto_sites, terra::extract(elevation_PE, Per_Tahuayo_piloto_sites))\n\n\n\n# get which are in and out\ncovs_Per_Tahuayo_sites$in_AP = st_intersects(covs_Per_Tahuayo_sites, AP_Tahuayo, sparse = FALSE)\n\ncovs_Per_Tahuayo_piloto_sites$in_AP = st_intersects(covs_Per_Tahuayo_piloto_sites, AP_Tahuayo, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_PE, alpha=0.5) + \n  mapview (AP_Pacaya, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (AP_Tahuayo, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Per_Tahuayo_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +   \n  mapview (covs_Per_Tahuayo_piloto_sites, \n           zcol = \"in_AP\", \n           col.regions =c(\"blue\"), \n           burst = TRUE) \n\n\nYasuni data\nHere we use the tables Ecu-13, Ecu-17, Ecu-18 y Ecu-20\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_Yasuni &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Yasuni/WDPA_WDOECM_May2025_Public_186_shp-polygons.shp\")\n\n### Ecu 17, Ecu 18, ECU 20, Ecu 22  \n\n# load data and make array_locID column\nEcu_13 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_13\", locationID, sep=\"_\"))\n\n28 cameras in Cameras. \n 28 cameras in Deployment. \n 28 deployments in Deployment. \n 28 points in Deployment. \n 28 cameras in Images. \n 28 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_17 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_17\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2015 \n Jaguar_Design: no \n\nCodeEcu_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_18\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2016 \n Jaguar_Design: no \n\nCodeEcu_20 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_20\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 25 cameras in Deployment. \n 25 deployments in Deployment. \n 25 points in Deployment. \n 25 cameras in Images. \n 25 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# Ecu_21 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_14\", locationID, sep=\"_\"))\nEcu_22 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_22\", locationID, sep=\"_\"))\n\n30 cameras in Cameras. \n 30 cameras in Deployment. \n 30 deployments in Deployment. \n 30 points in Deployment. \n 30 cameras in Images. \n 30 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2018 \n Jaguar_Design: no \n\nCode# get sites\nEcu_13_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-013.xlsx\")\nEcu_17_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-017.xlsx\")\nEcu_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-018.xlsx\")\nEcu_20_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-020_Fix.xlsx\")\n# Ecu_21_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-021.xlsx\")\nEcu_22_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-022.xlsx\")\n\n\nFLII2016 &lt;- rast(\"C:/CodigoR/WCS_2024/FLI/raster/FLII_final/FLII_2016.tif\")\n\n# get elevation map\nelevation_EC &lt;- rast(get_elev_raster(Ecu_17_sites, z = 7)) #z =1-14\nbb &lt;-  st_as_sfc(st_bbox(elevation_EC)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Ecu_13_sites &lt;- cbind(Ecu_13_sites, terra::extract(elevation_EC, Ecu_13_sites))\ncovs_Ecu_17_sites &lt;- cbind(Ecu_17_sites, terra::extract(elevation_EC, Ecu_17_sites))\ncovs_Ecu_18_sites &lt;- cbind(Ecu_18_sites, terra::extract(elevation_EC, Ecu_18_sites))\ncovs_Ecu_20_sites &lt;- cbind(Ecu_20_sites, terra::extract(elevation_EC, Ecu_20_sites))\n#covs_Ecu_21_sites &lt;- cbind(Ecu_21_sites, terra::extract(elevation_17, Ecu_21_sites))\ncovs_Ecu_22_sites &lt;- cbind(Ecu_22_sites, terra::extract(elevation_EC, Ecu_22_sites))\n\n# get which are in and out\ncovs_Ecu_13_sites$in_AP = st_intersects(covs_Ecu_13_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_17_sites$in_AP = st_intersects(covs_Ecu_17_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_18_sites$in_AP = st_intersects(covs_Ecu_18_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_20_sites$in_AP = st_intersects(covs_Ecu_20_sites, AP_Yasuni, sparse = FALSE)\n#covs_Ecu_21_sites$in_AP = st_intersects(covs_Ecu_21_sites, AP_Yasuni, sparse = FALSE)\ncovs_Ecu_22_sites$in_AP = st_intersects(covs_Ecu_22_sites, AP_Yasuni, sparse = FALSE)\n\n# covs_Ecu_16_sites$in_AP = st_intersects(covs_Ecu_16_sites, AP_Llanganates, sparse = FALSE)\n\n\n\n# make a map\nmapview (elevation_EC, alpha=0.5) + \n  mapview (AP_Yasuni, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Ecu_13_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  mapview (covs_Ecu_18_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_20_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n#  mapview (covs_Ecu_21_sites, zcol = \"in_AP\", col.regions =c(\"red\"), burst = TRUE) +\n  mapview (covs_Ecu_22_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"red\") ) #+\n\n\n\n\nCode  # mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\nLlanganates data\nHere we use the tables Ecu-14, Ecu-15 y Ecu-16.\n\nCodeAP_Llanganates &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/Llanganates/WDPA_WDOECM_May2025_Public_97512_shp-polygons.shp\")\n\n### Ecu 14, Ecu 15  y Ecu 16\n\n# load data and make array_locID column\nEcu_14 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-014.xlsx\") |&gt; mutate(array_locID=paste(\"Ecu_14\", locationID, sep=\"_\"))\nEcu_15 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-015.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_15\", locationID, sep=\"_\"))\nEcu_16 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-016.xlsx\")|&gt; mutate(array_locID=paste(\"Ecu_16\", locationID, sep=\"_\"))\n\n\n\n# get sites\nEcu_14_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-014.xlsx\")\nEcu_15_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-015.xlsx\")\nEcu_16_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Ecuador/ECU-016.xlsx\")\n\n\n\n\n# get elevation map\nelevation_14 &lt;- rast(get_elev_raster(Ecu_14_sites, z = 7)) #z =1-14\nbb &lt;-  st_as_sfc(st_bbox(elevation_14)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Ecu_14_sites &lt;- cbind(Ecu_14_sites, terra::extract(elevation_14, Ecu_14_sites))\n\ncovs_Ecu_15_sites &lt;- cbind(Ecu_15_sites, terra::extract(elevation_14, Ecu_15_sites))\n\ncovs_Ecu_16_sites &lt;- cbind(Ecu_16_sites, terra::extract(elevation_14, Ecu_16_sites))\n\n# get which are in and out\ncovs_Ecu_14_sites$in_AP = st_intersects(covs_Ecu_14_sites, AP_Llanganates, sparse = FALSE)\n\ncovs_Ecu_15_sites$in_AP = st_intersects(covs_Ecu_15_sites, AP_Llanganates, sparse = FALSE)\n\ncovs_Ecu_16_sites$in_AP = st_intersects(covs_Ecu_16_sites, AP_Llanganates, sparse = FALSE)\n\n\n\n# make a map\nmapview (elevation_14, alpha=0.7) + \n  mapview (AP_Llanganates, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Ecu_14_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n  mapview (covs_Ecu_15_sites, zcol = \"in_AP\", burst = TRUE, col.regions = c(\"blue\") )+\n  mapview (covs_Ecu_16_sites, zcol = \"in_AP\", burst = TRUE, col.regions =c(\"red\",\"blue\")) \n\n\nPacoche 2014 data\nHere we use the tables Pacoche_DL_CT-RVP-2014\nCamera trap operation data and detection history\n\nCode# Join 3 tables\n# fix count in ECU 13, 17, 22,\nEcu_13$Count &lt;- as.character(Ecu_13$Count)\nEcu_17$Count &lt;- as.character(Ecu_17$Count)\nEcu_22$Count &lt;- as.character(Ecu_22$Count)\n\nEcu_full &lt;- Ecu_13 |&gt; full_join(Ecu_17) |&gt; \n                      full_join(Ecu_18) |&gt; \n                      full_join(Ecu_20) |&gt; \n#                      full_join(Ecu_21) |&gt; \n                      full_join(Ecu_22)\n\n###### Bolivia\n\n# Bol_full &lt;- Bol_Madidi_1  |&gt; \n#    full_join(Bol_Madidi_2) |&gt; \n#    full_join(Bol_Madidi_3) |&gt; \n#    full_join(Bol_Madidi_4) \n# # change camera Id by point. two cameras in one\n# Bol_full &lt;- Bol_full |&gt; mutate(Camera_Id=Point.x)\n\n\n# # Ecu_18$Count &lt;- as.numeric(Ecu_18$Count)\n# Per_Tahuayo_piloto$Longitude &lt;- as.numeric(Per_Tahuayo_piloto$Longitude)\n# Per_Tahuayo_piloto$Latitude &lt;- as.numeric(Per_Tahuayo_piloto$Latitude)\n# \n\n# Per_full &lt;- Per_Tahuayo|&gt; \n#   full_join(Per_Tahuayo_piloto) #|&gt; \n#                       # full_join(Ecu_18) |&gt; \n#                       # full_join(Ecu_20) |&gt; \n#                       # full_join(Ecu_21) |&gt; \n#                       # full_join(Ecu_22)\n\n# rename camera id\n# Per_full$camid &lt;- Per_full$`Camera_Id`\n\nEcu_full$Count &lt;- as.numeric(Ecu_full$Count)\n# Per_full$Count &lt;- as.numeric(Per_full$Count)\n\n\n#################### Ecuador Llanganates\n\n# Join 3 tables\n# Ecu_Llanganates &lt;- Ecu_14 |&gt; full_join(Ecu_15) |&gt; full_join(Ecu_16)\n\n\n# make columns equal to 46\nEcu_full &lt;- Ecu_full[,-47]\n# Col_18 &lt;- Col_18[,-47]\n# Ecu_Llanganates &lt;- Ecu_Llanganates[,-c(50,49,48,47)]\n\n##################################\ndata_full &lt;- Ecu_full# rbind(Ecu_full, \n                   # Per_full,\n                   # Bol_full,\n                   # Col_18,\n                   # Ecu_Llanganates)\n\n\n# fix date format\n# \n# Formatting a Date object\ndata_full$start_date &lt;- as.Date(data_full$\"start_date\", \"%Y/%m/%d\")\ndata_full$start_date &lt;- format(data_full$start_date, \"%Y-%m-%d\")\n\ndata_full$end_date &lt;- as.Date(data_full$\"end_date\", \"%Y/%m/%d\")\ndata_full$end_date &lt;- format(data_full$end_date, \"%Y-%m-%d\")\n\ndata_full$eventDate &lt;- as.Date(data_full$\"Date_Time_Captured\", \"%Y/%m/%d\")\ndata_full$eventDate &lt;- format(data_full$eventDate, \"%Y-%m-%d\")\n\n# Per_full$eventDateTime &lt;- ymd_hms(paste(Per_full$\"photo_date\", Per_full$\"photo_time\", sep=\" \"))\ndata_full$eventDateTime &lt;- ymd_hms(data_full$\"Date_Time_Captured\")\n\n###############################\n# remove duplicated cameras\n################################\nind1 &lt;- which(data_full$Camera_Id==\"ECU-020-C0027\")\nind2 &lt;- which(data_full$Camera_Id==\"ECU-020-C0006\")\nind3 &lt;- which(data_full$Camera_Id==\"ECU-022-C0076\")\ndata_full &lt;- data_full[-ind1,]\ndata_full &lt;- data_full[-ind2,]\ndata_full &lt;- data_full[-ind3,]\n\n# filter 2021 and make uniques\nCToperation  &lt;- data_full |&gt; dplyr::group_by(Camera_Id) |&gt; #(array_locID) |&gt; \n                           mutate(minStart=start_date, maxEnd=end_date) |&gt; distinct(Longitude, Latitude, minStart, maxEnd) |&gt; dplyr::ungroup()\n# remove one duplicated\n# View(CToperation)\n# CToperation &lt;- CToperation[-15,]\n\n# M3-19: M3-21: M4-10: M4-12: M4-18:  From Madidi\n# CToperation &lt;- CToperation[-c(379, 373, 365, 362, 357),]\n\n# CToperation[231,3] &lt;- \"-4.482831\" #Latitude\nCToperation[93,3] &lt;- -0.5548211 #Latitude\nCToperation[93,2] &lt;- -76.48333\n\n# duplicated in llanganates\n# CToperation &lt;- CToperation[-464,] \n\n### Check duplicated\n# View(as.data.frame(sort(table(CToperation$Latitude))))\n# View(as.data.frame(sort(table(CToperation$Longitude))))\n# View(as.data.frame(table(CToperation$Camera_Id)))\n\n# CToperation &lt;- CToperation[-c(90,94),]\n# Latitude -4.48283\n# Latitude -0.554820969700813\n# Longitude -76.4833290316164\n\n# Generamos la matríz de operación de las cámaras\n\ncamop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operación\n                         stationCol= \"Camera_Id\", # Columna que define la estación\n                         setupCol= \"minStart\", #Columna fecha de colocación\n                         retrievalCol= \"maxEnd\", #Columna fecha de retiro\n                         #hasProblems= T, # Hubo fallos de cámaras\n                         dateFormat= \"%Y-%m-%d\")#, #, # Formato de las fechas\n                         #cameraCol=\"Camera_Id\")\n                         # sessionCol= \"Year\")\n\n# Generar las historias de detección ---------------------------------------\n## remove plroblem species\n\n# Per_full$scientificName &lt;- paste(Per_full$genus, Per_full$species, sep=\" \")\n\n#### remove NAs and setups\n# ind &lt;- which(is.na(data_full$scientificName))\n# data_full &lt;- data_full[-ind,]\n# ind &lt;- which(Per_full$scientificName==\"NA NA\")\n# Per_full &lt;- Per_full[-ind,]\n\n# ind &lt;- which(Per_full$scientificName==\"Set up\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Blank\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Unidentifiable\")\n# Per_full &lt;- Per_full[-ind,]\n\n\nDetHist_list &lt;- lapply(unique(data_full$scientificName), FUN = function(x) {\n  detectionHistory(\n    recordTable         = data_full, # abla de registros\n    camOp                = camop, # Matriz de operación de cámaras\n    stationCol           = \"Camera_Id\",\n    speciesCol           = \"scientificName\",\n    recordDateTimeCol    = \"eventDateTime\",\n    recordDateTimeFormat  = \"%Y-%m-%d %H:%M:%S\",\n    species              = x,     # la función reemplaza x por cada una de las especies\n    occasionLength       = 7, # Colapso de las historias a 10 ías\n    day1                 = \"station\", # \"survey\" a specific date, \"station\", #inicie en la fecha de cada survey\n    datesAsOccasionNames = FALSE,\n    includeEffort        = TRUE,\n    scaleEffort          = FALSE,\n    #unmarkedMultFrameInput=TRUE\n    timeZone             = \"America/Bogota\" \n    )\n  }\n)\n\n# names\nnames(DetHist_list) &lt;- unique(data_full$scientificName)\n\n# Finalmente creamos una lista nueva donde estén solo las historias de detección\nylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)\n# otra lista con effort scaled\nefort &lt;- lapply(DetHist_list, FUN = function(x) x$effort)\n\n# number of observetions per sp, collapsed to 7 days\n# lapply(ylist, sum, na.rm = TRUE)\n\n\nArrange spatial covariates\nThe standard EPSG code for a Lambert Azimuthal Equal-Area projection for South America is EPSG:10603 (WGS 84 / GLANCE South America). This projection is specifically designed for the continent and has its center located around the central meridian for the region. The units are meters.\nFLII scores range from 0 (lowest integrity) to 10 (highest). Grantham discretized this range to define three broad illustrative categories: low (≤6.0); medium (&gt;6.0 and &lt;9.6); and high integrity (≥9.6).\n\nCode# #transform coord data to Lambert Azimuthal Equal-Area\n# AP_Tahuayo_UTM &lt;- st_transform(AP_Tahuayo, \"EPSG:10603\")\n# # Convert to LINESTRING\n# AP_Tahuayo_UTM_line &lt;- st_cast(AP_Tahuayo_UTM,\"MULTILINESTRING\")# \"LINESTRING\")\n#transform Yasuni to Lambert Azimuthal Equal-Area\nAP_Yasuni_UTM &lt;- st_transform(AP_Yasuni, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_Yasuni_UTM_line &lt;- st_cast(AP_Yasuni_UTM, \"MULTILINESTRING\")\n\n# #transform Yasuni to Lambert Azimuthal Equal-Area\n# AP_Madidi_UTM &lt;- st_transform(Madidi_NP, \"EPSG:10603\")\n# # Convert to LINESTRING\n# AP_Madidi_UTM_line &lt;- st_cast(AP_Madidi_UTM, \"MULTILINESTRING\")\n# \n# # Plantas\n# AP_PlantasMed_UTM &lt;- st_transform(AP_PlantasMed, \"EPSG:10603\")\n# \n# #Llanganates\n# AP_Llanganates_UTM &lt;- st_transform(AP_Llanganates, \"EPSG:10603\")\n\n\n############## sf AP Union \nAP_merged_sf_UTM &lt;- AP_Yasuni_UTM# st_union(\n                             # AP_Yasuni_UTM,\n                             # AP_Tahuayo_UTM,\n                             # AP_Madidi_UTM,\n                             # AP_PlantasMed_UTM,\n                             # AP_Llanganates_UTM\n                             # )\n\nAP_merged_line &lt;- st_cast(AP_merged_sf_UTM, to=\"MULTILINESTRING\")\n\n\n# make sf() from data table\ndata_full_sf &lt;- CToperation |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"), \n              crs = 4326)\n\n# get the elevation point from AWS\nelev_data &lt;- elevatr::get_elev_point(locations = data_full_sf, src = \"aws\")\n\nMosaicing & Projecting\n\n\nNote: Elevation units are in meters\n\nCode# extract elev and paste to table\ndata_full_sf$elev &lt;- elev_data$elevation\nstr(data_full_sf$elev)\n\n num [1:141] 448 380 577 490 522 404 522 543 456 496 ...\n\nCode# extract in AP\ndata_full_sf$in_AP = as.factor(st_intersects(data_full_sf, AP_Yasuni, sparse = FALSE))\n\nin_AP &lt;- as.numeric((st_drop_geometry(data_full_sf$in_AP)))\n\n# extract FLII\ndata_full_sf$FLII &lt;- terra::extract(FLII2016, data_full_sf)[,2]\nstr(data_full_sf$FLII)\n\n num [1:141] 9.57 9.65 9.69 9.66 9.92 ...\n\nCode# Replace all NAs with min flii in a numeric column\ndata_full_sf$FLII[is.na(data_full_sf$FLII)] &lt;- min(data_full_sf$FLII, na.rm = TRUE)\n\n# mapview(full_sites_14_15_16_sf, zcol = \"in_AP\", burst = TRUE)\n\n# Transform coord to Lambert Azimuthal Equal-Area\ndata_full_sf_UTM &lt;- st_transform(data_full_sf, \"EPSG:10603\")\n\n\ncoords &lt;- st_coordinates(data_full_sf_UTM)\n#str(coords)\n\n#### fix duplicated coord\n# -1840583.53296873  en x\n# -1842515.36969736  en x\n# 1547741.44311964  en y\n# 1541202.24796904 en y\n\n# which(coords[,1]==\"-1840583.53296873\")\n# which(coords[,1]==\"-1842515.36969736\")\nwhich(coords[,1]==\"-1842515.4768445\")\n\n[1] 93\n\nCode# which(coords[,2]==\"1547741.44311964\")\n# which(coords[,2]==\"1541202.24796904\")\nwhich(coords[,2]==\"1541202.22737502\")\n\n[1] 93\n\nCode# make Ecu_14_15_16 an sf object\n#    cam_sf &lt;- st_as_sf(Ecu_14_15_16, coords = c(\"lon\",\"lat\"))   #crs=\"EPSG:4326\")\n    #--- set CRS ---#\n#    st_crs(cam_sf) &lt;- 4326\n\n\n\n\n# Calculate the distance\n#multiplic &lt;- full_sites_14_15_16_sf_UTM |&gt; mutate(multiplic= as.numeric(in_AP)) \nmultiplic=ifelse(data_full_sf_UTM$in_AP==\"TRUE\",-1,1)\ndata_full_sf_UTM$border_dist &lt;- as.numeric(st_distance(data_full_sf_UTM, AP_Yasuni_UTM_line) * multiplic )\n# print(border_dist)\n\n# convert true false to inside 1, outside 0\ndata_full_sf_UTM &lt;- data_full_sf_UTM |&gt;\n  mutate(in_AP = case_when(\n    str_detect(in_AP, \"TRUE\") ~ 1, # \"inside_AP\",\n    str_detect(in_AP, \"FALSE\") ~ 0 #\"outside_AP\"\n  )) |&gt; mutate(in_AP=as.factor(in_AP))\n\n\nhist(data_full_sf_UTM$border_dist)\n\n\n\n\n\n\nCodehist(data_full_sf_UTM$elev)\n\n\n\n\n\n\n\nPrepare the model\n\n\n\n\n\n\nTipData in a 3D array\n\n\n\nThe data must be placed in a three-dimensional array with dimensions corresponding to species, sites, and replicates in that order.\n\n\nThe function sfMsPGOcc\nFits multi-species spatial occupancy models with species correlations (i.e., a spatially-explicit joint species distribution model with imperfect detection). We use Polya-Gamma latent variables and a spatial factor modeling approach. Currently, models are implemented using a Nearest Neighbor Gaussian Process.\n\nCode# Detection-nondetection data ---------\n# Species of interest, can select individually\n# curr.sp &lt;- sort(unique(Ecu_14_15_16$.id))# c('BAWW', 'BLJA', 'GCFL')\n# sort(names(DetHist_list))\nselected.sp &lt;-  c(\n\"Atelocynus microtis\" ,\n\"Coendou sp\" ,\n\"Cuniculus paca\",           \n\"Dasyprocta fuliginosa\",      \n\"Dasypus novemcinctus\" ,    \n\"Didelphis sp\",    \n\"Eira barbara\",  \n\"Herpailurus yagouaroundi\",\n\"Leopardus pardalis\",    \n\"Leopardus tigrinus\" ,\n\"Leopardus wiedii\",     \n\"Mazama murelia\",\n\"Mazama zamora\",\n# \"Mazama americana\",\n# \"Mazama nemorivaga\",\n#\"Mitu tuberosum\" ,\n\"Myoprocta pratti\",\n\"Myrmecophaga tridactyla\",\n\"Nasua nasua\" ,\n# \"Mazama americana\",         \n# \"Myotis myotis\",           \n# \"Nasua narica\",             \n# \"Odocoileus virginianus\",   \n\"Panthera onca\" ,\n# \"Procyon cancrivorus\" ,\n\"Pecari tajacu\",    \n#\"Penelope jacquacu\" ,\n\"Priodontes maximus\" ,\n\"Procyon cancrivorus\",      \n# \"Psophia leucoptera\",\n\"Puma concolor\" ,\n# \"Puma yagouaroundi\",        \n# \"Rattus rattus\" ,\n# \"Roedor sp.\",\n# \"Sciurus sp.\",       \n# \"Sus scrofa\",               \n# \"Sylvilagus brasiliensis\",  \n\"Speothos venaticus\", \n\"Tamandua tetradactyla\",   \n# \"Tapirus pinchaque\" ,\n\"Tapirus terrestris\",\n\"Tayassu pecari\"\n#\"Tinamus major\"            \n              )\n\n# y.msom &lt;- y[which(sp.codes %in% selected.sp), , ]\n# str(y.msom)\n\n# Use selection\ny.selected &lt;- ylist[selected.sp]   \n\n#####################################\n#### three-dimensional array with dimensions corresponding to:\n#### species, sites, and replicates\n#####################################\n\n# 1. Load the abind library to make arrays easily \nlibrary(abind)\nmy_array_abind &lt;- abind(y.selected, # start from list\n                        along = 3, # 3D array\n                        use.first.dimnames=TRUE) # keep names\n\n# Transpose the array to have:\n# species, sites, and sampling occasions in that order\n# The new order is (3rd dim, 1st dim, 2nd dim)\ntransposed_array &lt;- aperm(my_array_abind, c(3, 1, 2))\n\n#### site covs\nsitecovs &lt;- as.data.frame(st_drop_geometry(\n                    data_full_sf_UTM[,5:8]))\n\n sitecovs[, 1] &lt;- as.vector((sitecovs[,1]))   # scale numeric covariates\n sitecovs[, 1] &lt;- as.numeric((sitecovs[,2]))   # scale numeric covariates\n sitecovs[, 3] &lt;- as.vector((sitecovs[,3]))   # scale numeric covariates\n sitecovs[, 4] &lt;- as.vector((sitecovs[,4]))   # scale numeric covariates\n # sitecovs$fact &lt;- factor(c(\"A\", \"A\", \"B\"))    # categorical covariate\n\nnames(sitecovs) &lt;- c(\"elev\", \"in_AP\", \"FLII\", \"border_dist\")\n\n# check consistancy equal number of spatial covariates and rows in data\n# identical(nrow(ylist[[1]]), nrow(covars)) \n\n# Base de datos para los análisis -----------------------------------------\n\n# match the names to \"y\"  \"occ.covs\" \"det.covs\" \"coords\" \ndata_list &lt;- list(y = transposed_array, # Historias de detección\n                  occ.covs = sitecovs, # covs de sitio\n                  det.covs  = list(effort = DetHist_list[[1]]$effort),\n                  coords = st_coordinates(data_full_sf_UTM)\n                  )  # agregamos el esfuerzo de muestreo como covariable de observación\n\n\nRunning the model\nWe let spOccupancy set the initial values by default based on the prior distributions.\n\nCode# Running the model\n\n# 3. 1 Modelo multi-especie  -----------------------------------------\n\n# 2. Model fitting --------------------------------------------------------\n# Fit a non-spatial, multi-species occupancy model. \nout.null &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort) , # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.samples = 6000, \n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 141 sites and 25 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 1 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out.null, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.report = 1000, n.burn = 1000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 2.5138\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -1.3105 0.4167 -2.1151 -1.3082 -0.5148 1.0442 157\nscale(elev)        -0.2105 0.1624 -0.5303 -0.2045  0.0971 1.0085 735\nscale(border_dist) -0.5806 0.1508 -0.8967 -0.5826 -0.2902 1.0090 637\nscale(FLII)         0.0528 0.1801 -0.2932  0.0504  0.4144 1.0122 798\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)        3.0756 1.2796 1.3303 2.8007 6.3426 1.0158  419\nscale(elev)        0.1524 0.0933 0.0384 0.1318 0.3974 1.0065 1171\nscale(border_dist) 0.0833 0.0553 0.0230 0.0688 0.2167 1.0199  885\nscale(FLII)        0.3553 0.2658 0.0769 0.2836 1.0298 1.0161  435\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.0070 0.3171 -2.6847 -1.9973 -1.4368 1.0094  333\nscale(effort)  0.3076 0.0797  0.1546  0.3064  0.4735 1.0077 1500\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.5704 0.7798 0.5276 1.4207 3.5072 1.0240  115\nscale(effort) 0.0616 0.0362 0.0203 0.0529 0.1541 1.0132 1312\n\nCode# Fit a non-spatial, Latent Factor Multi-Species Occupancy Model. \n  out.lfMs &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.omp.threads = 6,\n                 n.samples = 6000, \n                 n.factors = 5, # balance of rare sp. and run time\n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nWarning in msPGOcc(occ.formula = ~scale(elev) + scale(border_dist) +\nscale(FLII), : 'n.factors' is not an argument\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 141 sites and 25 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out.lfMs, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.omp.threads = 6, n.report = 1000, n.burn = 1000, n.thin = 10, \n    n.chains = 3, n.factors = 5)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 2.4513\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -1.3730 0.4235 -2.2148 -1.3615 -0.5564 1.0093 202\nscale(elev)        -0.2155 0.1659 -0.5546 -0.2098  0.1009 1.0012 675\nscale(border_dist) -0.5860 0.1468 -0.8753 -0.5809 -0.2894 1.0499 622\nscale(FLII)         0.0397 0.1715 -0.2733  0.0310  0.4070 1.0043 735\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)        3.1353 1.2452 1.3469 2.9029 6.3244 1.0060  504\nscale(elev)        0.1506 0.0928 0.0392 0.1282 0.3889 1.0048 1032\nscale(border_dist) 0.0817 0.0527 0.0239 0.0687 0.2284 1.0028 1136\nscale(FLII)        0.3335 0.2425 0.0721 0.2723 0.9585 1.0007  469\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -1.9780 0.3088 -2.6604 -1.9477 -1.4650 1.0085  191\nscale(effort)  0.3067 0.0808  0.1437  0.3074  0.4711 1.0029 1144\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.4215 0.7287 0.4925 1.2440 3.3034 1.0388  112\nscale(effort) 0.0591 0.0354 0.0195 0.0501 0.1552 1.0034 1127\n\nCode# Fit a Spatial Factor Multi-Species Occupancy Model\n# latent spatial factors.\ntictoc::tic()\n  out.sp &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 141 sites and 25 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n637.75 sec elapsed\n\nCode#########################\ntictoc::tic()\n  out.sp.cat &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               factor(in_AP) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 141 sites and 25 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n630.81 sec elapsed\n\nCode# tictoc::tic()\n#   out.sp.gaus &lt;- sfMsPGOcc(occ.formula = ~ scale(border_dist) , \n#                            det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,              \n#                            data = data_list, \n#                            n.batch = 400, \n#                            batch.length = 25,\n#                            n.thin = 5, \n#                            n.burn = 5000, \n#                            n.chains = 1,\n#                            NNGP = TRUE,\n#                            n.factors = 5,\n#                            n.neighbors = 15,\n#                            cov.model = 'gaussian',\n#                            n.report = 100);beep(sound = 4)\n# tictoc::toc()\n\n# save the results to not run again\n# save(out, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/result_2.R\") # guardamos los resultados para no correr de nuevo\n# save the results to not run again\n# save(out.sp, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n# save(out.lfMs, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/lfms_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n\n# load(\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\")\n# summary(fit.commu)\n\n\nModel validation\nWe next perform a posterior predictive check using the Freeman-Tukey statistic grouping the data by sites. We summarize the posterior predictive check with the summary() function, which reports a Bayesian p-value. A Bayesian p-value that hovers around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well (Hobbs and Hooten 2015). As always with a simulation-based analysis using MCMC, you will get numerically slightly different values.\n\nCode# 3. Model validation -----------------------------------------------------\n# Perform a posterior predictive check to assess model fit. \nppc.out &lt;- ppcOcc(out.null, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.lfMs &lt;- ppcOcc(out.lfMs, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.sp &lt;- ppcOcc(out.sp, fit.stat = 'freeman-tukey',\n                     group = 1)\n\n# Calculate a Bayesian p-value as a simple measure of Goodness of Fit.\n# Bayesian p-values between 0.1 and 0.9 indicate adequate model fit. \nsummary(ppc.out)\n\n\nCall:\nppcOcc(object = out.null, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3974 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.4387\nCoendou sp Bayesian p-value: 0.5187\nCuniculus paca Bayesian p-value: 0.066\nDasyprocta fuliginosa Bayesian p-value: 0.0747\nDasypus novemcinctus Bayesian p-value: 0.3667\nDidelphis sp Bayesian p-value: 0.472\nEira barbara Bayesian p-value: 0.4567\nHerpailurus yagouaroundi Bayesian p-value: 0.6293\nLeopardus pardalis Bayesian p-value: 0.3467\nLeopardus tigrinus Bayesian p-value: 0.2493\nLeopardus wiedii Bayesian p-value: 0.3733\nMazama murelia Bayesian p-value: 0.3607\nMazama zamora Bayesian p-value: 0.3567\nMyoprocta pratti Bayesian p-value: 0.414\nMyrmecophaga tridactyla Bayesian p-value: 0.55\nNasua nasua Bayesian p-value: 0.5653\nPanthera onca Bayesian p-value: 0.4607\nPecari tajacu Bayesian p-value: 0.3233\nPriodontes maximus Bayesian p-value: 0.6093\nProcyon cancrivorus Bayesian p-value: 0.382\nPuma concolor Bayesian p-value: 0.446\nSpeothos venaticus Bayesian p-value: 0.4853\nTamandua tetradactyla Bayesian p-value: 0.302\nTapirus terrestris Bayesian p-value: 0.262\nTayassu pecari Bayesian p-value: 0.4247\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.lfMs)\n\n\nCall:\nppcOcc(object = out.lfMs, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.4032 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.4653\nCoendou sp Bayesian p-value: 0.5187\nCuniculus paca Bayesian p-value: 0.0673\nDasyprocta fuliginosa Bayesian p-value: 0.058\nDasypus novemcinctus Bayesian p-value: 0.3347\nDidelphis sp Bayesian p-value: 0.4787\nEira barbara Bayesian p-value: 0.4793\nHerpailurus yagouaroundi Bayesian p-value: 0.638\nLeopardus pardalis Bayesian p-value: 0.328\nLeopardus tigrinus Bayesian p-value: 0.2533\nLeopardus wiedii Bayesian p-value: 0.3867\nMazama murelia Bayesian p-value: 0.358\nMazama zamora Bayesian p-value: 0.3453\nMyoprocta pratti Bayesian p-value: 0.4187\nMyrmecophaga tridactyla Bayesian p-value: 0.5947\nNasua nasua Bayesian p-value: 0.5727\nPanthera onca Bayesian p-value: 0.4933\nPecari tajacu Bayesian p-value: 0.2987\nPriodontes maximus Bayesian p-value: 0.6227\nProcyon cancrivorus Bayesian p-value: 0.3913\nPuma concolor Bayesian p-value: 0.452\nSpeothos venaticus Bayesian p-value: 0.4933\nTamandua tetradactyla Bayesian p-value: 0.3133\nTapirus terrestris Bayesian p-value: 0.272\nTayassu pecari Bayesian p-value: 0.4453\nFit statistic:  freeman-tukey \n\nCodesummary(ppc.out.sp)\n\n\nCall:\nppcOcc(object = out.sp, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.3952 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nAtelocynus microtis Bayesian p-value: 0.4613\nCoendou sp Bayesian p-value: 0.531\nCuniculus paca Bayesian p-value: 0.0653\nDasyprocta fuliginosa Bayesian p-value: 0.0883\nDasypus novemcinctus Bayesian p-value: 0.2603\nDidelphis sp Bayesian p-value: 0.4987\nEira barbara Bayesian p-value: 0.487\nHerpailurus yagouaroundi Bayesian p-value: 0.6153\nLeopardus pardalis Bayesian p-value: 0.4347\nLeopardus tigrinus Bayesian p-value: 0.261\nLeopardus wiedii Bayesian p-value: 0.367\nMazama murelia Bayesian p-value: 0.2633\nMazama zamora Bayesian p-value: 0.3557\nMyoprocta pratti Bayesian p-value: 0.424\nMyrmecophaga tridactyla Bayesian p-value: 0.629\nNasua nasua Bayesian p-value: 0.5717\nPanthera onca Bayesian p-value: 0.4383\nPecari tajacu Bayesian p-value: 0.2843\nPriodontes maximus Bayesian p-value: 0.5697\nProcyon cancrivorus Bayesian p-value: 0.3777\nPuma concolor Bayesian p-value: 0.4577\nSpeothos venaticus Bayesian p-value: 0.5477\nTamandua tetradactyla Bayesian p-value: 0.3147\nTapirus terrestris Bayesian p-value: 0.1943\nTayassu pecari Bayesian p-value: 0.3813\nFit statistic:  freeman-tukey \n\n\n\n\n\n\n\n\nImportant\n\n\n\nA Bayesian p-value that around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well.\n\n\nFit plot\n\nCode#### fit plot\nppc.df &lt;- data.frame(fit = ppc.out.sp$fit.y, \n                     fit.rep = ppc.out.sp$fit.y.rep, \n                     color = 'lightskyblue1')\n\nppc.df$color[ppc.df$fit.rep.1 &gt; ppc.df$fit.1] &lt;- 'lightsalmon'\nplot(ppc.df$fit.1, ppc.df$fit.rep.1, bg = ppc.df$color, pch = 21, \n     ylab = 'Fit', xlab = 'True')\nlines(ppc.df$fit.1, ppc.df$fit.1, col = 'black')\n\n\n\nThe most symmetrical, better fit!\n\n\n\nModel comparison\n\nCode# 4. Model comparison -----------------------------------------------------\n# Compute Widely Applicable Information Criterion (WAIC)\n# Lower values indicate better model fit. \nwaicOcc(out.null)\n\n       elpd          pD        WAIC \n-3261.38437    81.61097  6685.99068 \n\nCodewaicOcc(out.lfMs)\n\n       elpd          pD        WAIC \n-3261.87081    82.07571  6687.89304 \n\nCodewaicOcc(out.sp)\n\n      elpd         pD       WAIC \n-2937.7749   346.2816  6568.1129 \n\nCodewaicOcc(out.sp.cat)\n\n      elpd         pD       WAIC \n-2934.5311   348.7836  6566.6294 \n\n\nModel comparison as table\n\nCode# Here we summarize the spatial factor loadings\n# summary(out.sp$lambda.samples)\n\n# Resultados --------------------------------------------------------------\n# Extraemos lo tabla de valores estimados\nmodresult &lt;- cbind(as.data.frame(waicOcc(out.null)),\n                  as.data.frame(waicOcc(out.sp)),\n                  as.data.frame(waicOcc(out.lfMs)),\n                  as.data.frame(waicOcc(out.sp.cat))\n                  #as.data.frame(waicOcc(out.sp.gaus))\n                  )\n# View(modresult)\nmodresult_sorted &lt;- as.data.frame(t(modresult)) |&gt; \n  arrange(WAIC) # sort by\n  \nDT::datatable(modresult_sorted)\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\nLower values in WAIC indicate better model fit.\n\n\nWAIC is the Widely Applicable Information Criterion (Watanabe 2010).\nPosterior Summary\n\nCode# 5. Posterior summaries --------------------------------------------------\n# Concise summary of main parameter estimates\nsummary(out.sp, level = 'community')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 10.6275\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -1.9004 0.5780 -3.0373 -1.9005 -0.7742 1.0117 252\nscale(elev)        -0.3026 0.2473 -0.7818 -0.3017  0.1768 1.0123 915\nscale(border_dist) -0.8487 0.2246 -1.2976 -0.8398 -0.4210 1.0113 667\nscale(FLII)         0.0366 0.2443 -0.4179  0.0220  0.5447 1.0238 915\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat  ESS\n(Intercept)        6.5946 2.7326 2.8517 6.1052 13.0779 1.0046  430\nscale(elev)        0.3012 0.2088 0.0574 0.2514  0.8286 1.0162 1148\nscale(border_dist) 0.1369 0.1078 0.0275 0.1051  0.4098 1.0052 1789\nscale(FLII)        0.6414 0.4785 0.1017 0.5174  1.8928 1.0109  804\n\nDetection Means (logit scale): \n                 Mean     SD   2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.0014 0.3122 -2.651 -1.9877 -1.4357 1.0316  250\nscale(effort)  0.3091 0.0812  0.150  0.3070  0.4742 0.9998 2683\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.5312 0.7843 0.5186 1.3647 3.5614 1.0183  118\nscale(effort) 0.0615 0.0364 0.0200 0.0526 0.1530 1.0051 2660\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1 13.7269 8.0014 0.6750 13.9028 26.6418 1.0007 2843\nphi-2 13.7322 7.9105 0.7179 13.6774 26.8470 1.0049 3000\nphi-3 13.4748 8.0759 0.4572 13.0370 26.9249 1.0008 2609\nphi-4 13.6439 7.9863 0.5321 13.5390 26.8039 1.0014 2827\nphi-5 13.5677 8.0831 0.6575 13.5918 26.8284 1.0028 3000\n\nCodesummary(out.sp, level = 'species')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 10.6275\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis             -2.5128 1.3030 -4.2470 -2.7335\n(Intercept)-Coendou sp                      -3.9762 1.7049 -6.9045 -4.1516\n(Intercept)-Cuniculus paca                   0.1870 0.2871 -0.3508  0.1811\n(Intercept)-Dasyprocta fuliginosa            0.2738 0.3517 -0.3876  0.2628\n(Intercept)-Dasypus novemcinctus            -2.0688 0.6222 -3.4132 -2.0190\n(Intercept)-Didelphis sp                    -4.2873 2.0842 -7.7730 -4.5076\n(Intercept)-Eira barbara                    -3.7574 1.3940 -6.3749 -3.8243\n(Intercept)-Herpailurus yagouaroundi        -1.9744 1.6957 -5.0297 -2.0878\n(Intercept)-Leopardus pardalis              -2.0684 0.6689 -3.3723 -2.0609\n(Intercept)-Leopardus tigrinus              -6.0705 1.2850 -8.7898 -5.9842\n(Intercept)-Leopardus wiedii                -4.1753 1.4582 -6.9157 -4.2085\n(Intercept)-Mazama murelia                  -0.5998 0.7635 -1.9557 -0.6517\n(Intercept)-Mazama zamora                    1.7925 0.5106  0.9311  1.7438\n(Intercept)-Myoprocta pratti                -3.8449 0.7404 -5.4724 -3.7841\n(Intercept)-Myrmecophaga tridactyla         -1.6157 1.3187 -3.9155 -1.6979\n(Intercept)-Nasua nasua                     -4.0631 1.6847 -7.1178 -4.2048\n(Intercept)-Panthera onca                   -0.8588 0.9750 -2.5945 -0.9424\n(Intercept)-Pecari tajacu                    1.7134 0.5536  0.8385  1.6424\n(Intercept)-Priodontes maximus              -0.1326 1.6703 -2.8466 -0.3335\n(Intercept)-Procyon cancrivorus             -3.9133 1.0701 -6.1357 -3.8848\n(Intercept)-Puma concolor                   -1.8649 0.5259 -3.0144 -1.8428\n(Intercept)-Speothos venaticus              -4.2986 1.9431 -7.8873 -4.4031\n(Intercept)-Tamandua tetradactyla           -4.3434 1.6741 -7.2208 -4.5284\n(Intercept)-Tapirus terrestris               0.9599 0.4889  0.1531  0.9020\n(Intercept)-Tayassu pecari                  -0.4809 0.4429 -1.3248 -0.4893\nscale(elev)-Atelocynus microtis             -0.4737 0.4916 -1.4352 -0.4755\nscale(elev)-Coendou sp                      -0.4648 0.5374 -1.5933 -0.4436\nscale(elev)-Cuniculus paca                  -0.3584 0.3405 -1.0283 -0.3596\nscale(elev)-Dasyprocta fuliginosa            0.1427 0.4049 -0.6018  0.1329\nscale(elev)-Dasypus novemcinctus            -0.3089 0.4063 -1.0970 -0.3108\nscale(elev)-Didelphis sp                    -0.1234 0.5432 -1.1716 -0.1300\nscale(elev)-Eira barbara                    -0.3241 0.5036 -1.2994 -0.3176\nscale(elev)-Herpailurus yagouaroundi        -0.3332 0.5282 -1.3915 -0.3369\nscale(elev)-Leopardus pardalis              -0.3590 0.4296 -1.1894 -0.3689\nscale(elev)-Leopardus tigrinus              -0.5066 0.5458 -1.6443 -0.4849\nscale(elev)-Leopardus wiedii                -0.1668 0.5010 -1.1384 -0.1912\nscale(elev)-Mazama murelia                  -0.5848 0.4503 -1.4943 -0.5733\nscale(elev)-Mazama zamora                   -0.0811 0.4324 -0.8885 -0.1022\nscale(elev)-Myoprocta pratti                -0.2542 0.4240 -1.0929 -0.2532\nscale(elev)-Myrmecophaga tridactyla         -0.3651 0.5071 -1.3814 -0.3689\nscale(elev)-Nasua nasua                     -0.5416 0.5578 -1.7241 -0.5147\nscale(elev)-Panthera onca                   -0.3542 0.4677 -1.2756 -0.3528\nscale(elev)-Pecari tajacu                   -0.4186 0.4285 -1.2528 -0.4325\nscale(elev)-Priodontes maximus              -0.3171 0.5253 -1.3301 -0.3326\nscale(elev)-Procyon cancrivorus              0.0140 0.4911 -0.8936 -0.0129\nscale(elev)-Puma concolor                   -1.0840 0.4727 -2.0723 -1.0631\nscale(elev)-Speothos venaticus              -0.4682 0.5558 -1.5677 -0.4544\nscale(elev)-Tamandua tetradactyla           -0.2614 0.5054 -1.2328 -0.2749\nscale(elev)-Tapirus terrestris              -0.0707 0.4335 -0.8511 -0.0876\nscale(elev)-Tayassu pecari                   0.4808 0.4725 -0.3824  0.4538\nscale(border_dist)-Atelocynus microtis      -0.6828 0.3904 -1.4292 -0.6927\nscale(border_dist)-Coendou sp               -0.7873 0.4206 -1.6252 -0.7901\nscale(border_dist)-Cuniculus paca           -0.8343 0.3092 -1.4602 -0.8327\nscale(border_dist)-Dasyprocta fuliginosa    -0.9597 0.3458 -1.6666 -0.9450\nscale(border_dist)-Dasypus novemcinctus     -0.6013 0.3597 -1.2652 -0.6165\nscale(border_dist)-Didelphis sp             -0.9018 0.4135 -1.7471 -0.8808\nscale(border_dist)-Eira barbara             -0.7756 0.4022 -1.5474 -0.7793\nscale(border_dist)-Herpailurus yagouaroundi -0.8359 0.4126 -1.6615 -0.8410\nscale(border_dist)-Leopardus pardalis       -0.8647 0.3666 -1.5620 -0.8684\nscale(border_dist)-Leopardus tigrinus       -0.7717 0.4101 -1.5623 -0.7772\nscale(border_dist)-Leopardus wiedii         -0.8336 0.3910 -1.6125 -0.8316\nscale(border_dist)-Mazama murelia           -0.7455 0.3734 -1.4664 -0.7487\nscale(border_dist)-Mazama zamora            -0.9256 0.3338 -1.5856 -0.9125\nscale(border_dist)-Myoprocta pratti         -0.9819 0.3812 -1.7840 -0.9648\nscale(border_dist)-Myrmecophaga tridactyla  -0.9126 0.3916 -1.7340 -0.8963\nscale(border_dist)-Nasua nasua              -0.8221 0.4291 -1.6939 -0.8266\nscale(border_dist)-Panthera onca            -1.0082 0.3920 -1.8357 -0.9932\nscale(border_dist)-Pecari tajacu            -0.8686 0.3469 -1.5899 -0.8577\nscale(border_dist)-Priodontes maximus       -0.8037 0.4097 -1.6193 -0.8029\nscale(border_dist)-Procyon cancrivorus      -0.9930 0.4051 -1.8558 -0.9753\nscale(border_dist)-Puma concolor            -0.7343 0.3518 -1.4148 -0.7384\nscale(border_dist)-Speothos venaticus       -0.7537 0.4195 -1.5706 -0.7587\nscale(border_dist)-Tamandua tetradactyla    -0.8058 0.3967 -1.5666 -0.8049\nscale(border_dist)-Tapirus terrestris       -0.9506 0.3504 -1.6711 -0.9357\nscale(border_dist)-Tayassu pecari           -1.0954 0.3808 -1.9312 -1.0723\nscale(FLII)-Atelocynus microtis             -0.5822 0.4303 -1.5873 -0.5403\nscale(FLII)-Coendou sp                       0.2433 0.7441 -1.1468  0.1913\nscale(FLII)-Cuniculus paca                  -0.5901 0.3702 -1.4146 -0.5548\nscale(FLII)-Dasyprocta fuliginosa           -0.7084 0.4406 -1.6551 -0.6645\nscale(FLII)-Dasypus novemcinctus            -0.6336 0.4623 -1.7114 -0.5728\nscale(FLII)-Didelphis sp                     0.2202 0.7862 -1.2759  0.1918\nscale(FLII)-Eira barbara                     0.0436 0.6483 -1.2252  0.0300\nscale(FLII)-Herpailurus yagouaroundi        -0.0460 0.7452 -1.6217 -0.0418\nscale(FLII)-Leopardus pardalis               0.4831 0.5475 -0.4671  0.4366\nscale(FLII)-Leopardus tigrinus               0.2894 0.6830 -0.8272  0.2082\nscale(FLII)-Leopardus wiedii                -0.0673 0.6794 -1.5194 -0.0411\nscale(FLII)-Mazama murelia                  -0.0856 0.4245 -0.9453 -0.0700\nscale(FLII)-Mazama zamora                   -0.5200 0.4830 -1.6106 -0.4682\nscale(FLII)-Myoprocta pratti                 0.2775 0.5018 -0.5905  0.2323\nscale(FLII)-Myrmecophaga tridactyla          0.2257 0.6762 -1.0848  0.2200\nscale(FLII)-Nasua nasua                      0.2968 0.7568 -1.0586  0.2254\nscale(FLII)-Panthera onca                    0.7468 0.6968 -0.4501  0.6853\nscale(FLII)-Pecari tajacu                   -0.2823 0.4112 -1.1886 -0.2508\nscale(FLII)-Priodontes maximus               0.2659 0.7464 -1.1339  0.2174\nscale(FLII)-Procyon cancrivorus             -0.7344 0.5369 -1.9682 -0.6613\nscale(FLII)-Puma concolor                    1.1210 0.7357 -0.0587  1.0392\nscale(FLII)-Speothos venaticus               0.1914 0.7821 -1.2241  0.1237\nscale(FLII)-Tamandua tetradactyla            0.2533 0.6923 -0.9948  0.1895\nscale(FLII)-Tapirus terrestris              -0.1850 0.3755 -0.9681 -0.1673\nscale(FLII)-Tayassu pecari                   0.7364 0.5095 -0.2023  0.7009\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis              0.9057 1.0699  168\n(Intercept)-Coendou sp                      -0.0131 1.0107  133\n(Intercept)-Cuniculus paca                   0.7849 1.0005 2379\n(Intercept)-Dasyprocta fuliginosa            0.9908 1.0000 2935\n(Intercept)-Dasypus novemcinctus            -0.9040 1.0034 1038\n(Intercept)-Didelphis sp                     0.8428 1.0649  111\n(Intercept)-Eira barbara                    -0.7099 1.0580  276\n(Intercept)-Herpailurus yagouaroundi         1.8817 1.1131  185\n(Intercept)-Leopardus pardalis              -0.7518 1.0106  978\n(Intercept)-Leopardus tigrinus              -3.7877 1.0057  697\n(Intercept)-Leopardus wiedii                -1.1875 1.0046  178\n(Intercept)-Mazama murelia                   1.1361 1.0168  633\n(Intercept)-Mazama zamora                    2.9254 1.0034 1539\n(Intercept)-Myoprocta pratti                -2.5805 1.0051 1123\n(Intercept)-Myrmecophaga tridactyla          1.3455 1.0430  252\n(Intercept)-Nasua nasua                     -0.3296 1.0141  165\n(Intercept)-Panthera onca                    1.3283 1.0043  427\n(Intercept)-Pecari tajacu                    3.0087 1.0060 1390\n(Intercept)-Priodontes maximus               3.7599 1.0732  195\n(Intercept)-Procyon cancrivorus             -1.8585 1.0316  640\n(Intercept)-Puma concolor                   -0.9251 1.0021 1597\n(Intercept)-Speothos venaticus              -0.3298 1.0562  156\n(Intercept)-Tamandua tetradactyla           -0.3395 1.0428  223\n(Intercept)-Tapirus terrestris               2.1000 1.0086 1512\n(Intercept)-Tayassu pecari                   0.4260 1.0006 1809\nscale(elev)-Atelocynus microtis              0.4951 1.0043 1564\nscale(elev)-Coendou sp                       0.5385 1.0143 1282\nscale(elev)-Cuniculus paca                   0.3111 1.0096 1398\nscale(elev)-Dasyprocta fuliginosa            0.9748 1.0041 1294\nscale(elev)-Dasypus novemcinctus             0.4791 1.0005 1946\nscale(elev)-Didelphis sp                     1.0063 1.0096 1587\nscale(elev)-Eira barbara                     0.6523 1.0048 1500\nscale(elev)-Herpailurus yagouaroundi         0.7446 1.0101 1433\nscale(elev)-Leopardus pardalis               0.4853 1.0052 1510\nscale(elev)-Leopardus tigrinus               0.5245 1.0074 1799\nscale(elev)-Leopardus wiedii                 0.8687 1.0129 1580\nscale(elev)-Mazama murelia                   0.2666 1.0008 1550\nscale(elev)-Mazama zamora                    0.8440 1.0118 1741\nscale(elev)-Myoprocta pratti                 0.5643 1.0004 1802\nscale(elev)-Myrmecophaga tridactyla          0.6118 1.0084 1239\nscale(elev)-Nasua nasua                      0.4557 1.0045 1403\nscale(elev)-Panthera onca                    0.5669 1.0074 1660\nscale(elev)-Pecari tajacu                    0.4392 1.0035 1783\nscale(elev)-Priodontes maximus               0.7670 1.0126 1494\nscale(elev)-Procyon cancrivorus              1.0490 1.0030 1800\nscale(elev)-Puma concolor                   -0.2185 1.0001 1573\nscale(elev)-Speothos venaticus               0.5765 1.0039 1441\nscale(elev)-Tamandua tetradactyla            0.7672 1.0006 1454\nscale(elev)-Tapirus terrestris               0.8665 1.0161 1644\nscale(elev)-Tayassu pecari                   1.5357 1.0087 1117\nscale(border_dist)-Atelocynus microtis       0.1190 1.0047 1211\nscale(border_dist)-Coendou sp                0.0695 1.0078 1480\nscale(border_dist)-Cuniculus paca           -0.2372 1.0189 1349\nscale(border_dist)-Dasyprocta fuliginosa    -0.3054 1.0107 1427\nscale(border_dist)-Dasypus novemcinctus      0.1536 1.0030 1567\nscale(border_dist)-Didelphis sp             -0.1091 1.0007 1518\nscale(border_dist)-Eira barbara              0.0307 1.0028 1637\nscale(border_dist)-Herpailurus yagouaroundi -0.0069 1.0002 1296\nscale(border_dist)-Leopardus pardalis       -0.1439 1.0063 1462\nscale(border_dist)-Leopardus tigrinus        0.0353 1.0057 1365\nscale(border_dist)-Leopardus wiedii         -0.0501 1.0004 1306\nscale(border_dist)-Mazama murelia           -0.0088 1.0010 1664\nscale(border_dist)-Mazama zamora            -0.3030 1.0159 1442\nscale(border_dist)-Myoprocta pratti         -0.2671 1.0008 1302\nscale(border_dist)-Myrmecophaga tridactyla  -0.1750 1.0011 1406\nscale(border_dist)-Nasua nasua               0.0470 1.0015 1351\nscale(border_dist)-Panthera onca            -0.2805 1.0037 1481\nscale(border_dist)-Pecari tajacu            -0.1899 1.0152 1414\nscale(border_dist)-Priodontes maximus        0.0492 1.0029 1372\nscale(border_dist)-Procyon cancrivorus      -0.2398 1.0021 1491\nscale(border_dist)-Puma concolor            -0.0398 1.0034 1527\nscale(border_dist)-Speothos venaticus        0.1245 1.0077 1428\nscale(border_dist)-Tamandua tetradactyla     0.0005 1.0095 1420\nscale(border_dist)-Tapirus terrestris       -0.2964 1.0091 1380\nscale(border_dist)-Tayassu pecari           -0.3936 1.0200 1456\nscale(FLII)-Atelocynus microtis              0.1792 1.0019 1939\nscale(FLII)-Coendou sp                       1.8244 1.0065 1180\nscale(FLII)-Cuniculus paca                   0.0244 1.0078 1509\nscale(FLII)-Dasyprocta fuliginosa            0.0643 1.0199 2318\nscale(FLII)-Dasypus novemcinctus             0.1033 1.0037 1772\nscale(FLII)-Didelphis sp                     1.9119 1.0118 1160\nscale(FLII)-Eira barbara                     1.3484 1.0097 1687\nscale(FLII)-Herpailurus yagouaroundi         1.4892 1.0260 1262\nscale(FLII)-Leopardus pardalis               1.6661 1.0006 1781\nscale(FLII)-Leopardus tigrinus               1.8227 1.0002 1558\nscale(FLII)-Leopardus wiedii                 1.2383 1.0193 1021\nscale(FLII)-Mazama murelia                   0.7201 1.0047 2158\nscale(FLII)-Mazama zamora                    0.2747 1.0179 1909\nscale(FLII)-Myoprocta pratti                 1.3658 1.0022 1972\nscale(FLII)-Myrmecophaga tridactyla          1.5975 1.0014 1137\nscale(FLII)-Nasua nasua                      1.9858 1.0153 1256\nscale(FLII)-Panthera onca                    2.3258 1.0076 1131\nscale(FLII)-Pecari tajacu                    0.4494 1.0149 2245\nscale(FLII)-Priodontes maximus               1.8764 1.0047 1082\nscale(FLII)-Procyon cancrivorus              0.1262 1.0281 1893\nscale(FLII)-Puma concolor                    2.7303 1.0028  962\nscale(FLII)-Speothos venaticus               1.9324 1.0075 1258\nscale(FLII)-Tamandua tetradactyla            1.8139 1.0142 1411\nscale(FLII)-Tapirus terrestris               0.5039 1.0138 2579\nscale(FLII)-Tayassu pecari                   1.8270 1.0022 1445\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -2.6640 0.7999 -4.5022 -2.5970 -1.2942\n(Intercept)-Coendou sp                 -3.1213 1.2292 -5.6345 -3.0436 -0.9605\n(Intercept)-Cuniculus paca             -0.4806 0.1152 -0.7069 -0.4816 -0.2554\n(Intercept)-Dasyprocta fuliginosa      -0.4248 0.1084 -0.6379 -0.4248 -0.2151\n(Intercept)-Dasypus novemcinctus       -1.5136 0.2979 -2.1107 -1.5065 -0.9523\n(Intercept)-Didelphis sp               -3.3004 1.2734 -5.9456 -3.2340 -1.0734\n(Intercept)-Eira barbara               -2.6661 0.7242 -4.1821 -2.6241 -1.3653\n(Intercept)-Herpailurus yagouaroundi   -3.4650 0.7675 -4.9060 -3.4801 -1.9549\n(Intercept)-Leopardus pardalis         -1.6917 0.2726 -2.2718 -1.6857 -1.1822\n(Intercept)-Leopardus tigrinus         -1.1396 0.9360 -3.0844 -1.0886  0.5774\n(Intercept)-Leopardus wiedii           -2.6587 0.8582 -4.4724 -2.6035 -1.1289\n(Intercept)-Mazama murelia             -1.9624 0.2870 -2.5581 -1.9539 -1.4265\n(Intercept)-Mazama zamora              -0.8281 0.1063 -1.0403 -0.8248 -0.6231\n(Intercept)-Myoprocta pratti           -0.9037 0.3046 -1.5301 -0.8901 -0.3558\n(Intercept)-Myrmecophaga tridactyla    -2.8685 0.5125 -3.9003 -2.8584 -1.8662\n(Intercept)-Nasua nasua                -3.1380 1.0257 -5.2303 -3.0960 -1.2575\n(Intercept)-Panthera onca              -2.4220 0.3707 -3.1502 -2.4132 -1.7266\n(Intercept)-Pecari tajacu              -0.9121 0.1124 -1.1307 -0.9122 -0.7039\n(Intercept)-Priodontes maximus         -3.2774 0.5092 -4.2182 -3.2985 -2.2419\n(Intercept)-Procyon cancrivorus        -2.1652 0.5989 -3.3968 -2.1425 -1.0957\n(Intercept)-Puma concolor              -1.3238 0.2195 -1.7619 -1.3225 -0.9137\n(Intercept)-Speothos venaticus         -3.2914 1.2116 -5.5791 -3.2835 -1.0536\n(Intercept)-Tamandua tetradactyla      -2.6054 1.0292 -4.9165 -2.5023 -0.8333\n(Intercept)-Tapirus terrestris         -1.0407 0.1320 -1.3054 -1.0399 -0.7991\n(Intercept)-Tayassu pecari             -1.4252 0.1875 -1.7961 -1.4265 -1.0596\nscale(effort)-Atelocynus microtis       0.3561 0.2369 -0.0983  0.3504  0.8301\nscale(effort)-Coendou sp                0.3192 0.2536 -0.1936  0.3218  0.8377\nscale(effort)-Cuniculus paca            0.3441 0.1106  0.1318  0.3421  0.5694\nscale(effort)-Dasyprocta fuliginosa     0.3194 0.1027  0.1299  0.3171  0.5282\nscale(effort)-Dasypus novemcinctus      0.3068 0.1752 -0.0191  0.2993  0.6669\nscale(effort)-Didelphis sp              0.3158 0.2521 -0.1678  0.3163  0.8139\nscale(effort)-Eira barbara              0.3912 0.2400 -0.0483  0.3789  0.9177\nscale(effort)-Herpailurus yagouaroundi  0.1573 0.2311 -0.3157  0.1649  0.6086\nscale(effort)-Leopardus pardalis        0.1759 0.1652 -0.1429  0.1729  0.5081\nscale(effort)-Leopardus tigrinus        0.3663 0.2540 -0.1170  0.3596  0.8946\nscale(effort)-Leopardus wiedii          0.3468 0.2438 -0.1115  0.3388  0.8527\nscale(effort)-Mazama murelia            0.5080 0.1977  0.1633  0.4925  0.9449\nscale(effort)-Mazama zamora             0.3904 0.1067  0.1972  0.3866  0.6126\nscale(effort)-Myoprocta pratti          0.2838 0.2008 -0.1012  0.2820  0.6847\nscale(effort)-Myrmecophaga tridactyla   0.3333 0.2119 -0.0758  0.3267  0.7775\nscale(effort)-Nasua nasua               0.3370 0.2468 -0.1361  0.3330  0.8521\nscale(effort)-Panthera onca             0.1712 0.1734 -0.1568  0.1688  0.5259\nscale(effort)-Pecari tajacu             0.3633 0.1082  0.1646  0.3561  0.5827\nscale(effort)-Priodontes maximus        0.0704 0.1981 -0.3297  0.0723  0.4445\nscale(effort)-Procyon cancrivorus       0.2285 0.2270 -0.2249  0.2271  0.6608\nscale(effort)-Puma concolor             0.3360 0.1611  0.0466  0.3255  0.6707\nscale(effort)-Speothos venaticus        0.2139 0.2483 -0.2982  0.2171  0.6866\nscale(effort)-Tamandua tetradactyla     0.2185 0.2465 -0.2789  0.2221  0.6886\nscale(effort)-Tapirus terrestris        0.3511 0.1189  0.1263  0.3488  0.5905\nscale(effort)-Tayassu pecari            0.4974 0.1711  0.1927  0.4848  0.8689\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        1.0401  298\n(Intercept)-Coendou sp                 1.0078  272\n(Intercept)-Cuniculus paca             1.0002 3088\n(Intercept)-Dasyprocta fuliginosa      1.0030 3000\n(Intercept)-Dasypus novemcinctus       1.0035 1778\n(Intercept)-Didelphis sp               1.0068  171\n(Intercept)-Eira barbara               1.0194  312\n(Intercept)-Herpailurus yagouaroundi   1.0677  264\n(Intercept)-Leopardus pardalis         1.0131 1453\n(Intercept)-Leopardus tigrinus         1.0000 1704\n(Intercept)-Leopardus wiedii           1.0026  278\n(Intercept)-Mazama murelia             1.0140  938\n(Intercept)-Mazama zamora              1.0041 1504\n(Intercept)-Myoprocta pratti           1.0006 2786\n(Intercept)-Myrmecophaga tridactyla    1.0154  338\n(Intercept)-Nasua nasua                1.0164  189\n(Intercept)-Panthera onca              1.0046  537\n(Intercept)-Pecari tajacu              1.0025 2105\n(Intercept)-Priodontes maximus         1.0363  275\n(Intercept)-Procyon cancrivorus        1.0123 1009\n(Intercept)-Puma concolor              1.0005 2661\n(Intercept)-Speothos venaticus         1.0452  201\n(Intercept)-Tamandua tetradactyla      1.0219  237\n(Intercept)-Tapirus terrestris         1.0030 2630\n(Intercept)-Tayassu pecari             1.0003 2160\nscale(effort)-Atelocynus microtis      1.0017 3000\nscale(effort)-Coendou sp               0.9996 3000\nscale(effort)-Cuniculus paca           1.0054 3522\nscale(effort)-Dasyprocta fuliginosa    1.0014 2844\nscale(effort)-Dasypus novemcinctus     1.0026 3000\nscale(effort)-Didelphis sp             1.0006 3074\nscale(effort)-Eira barbara             1.0069 3000\nscale(effort)-Herpailurus yagouaroundi 1.0002 2837\nscale(effort)-Leopardus pardalis       1.0012 3000\nscale(effort)-Leopardus tigrinus       1.0003 3000\nscale(effort)-Leopardus wiedii         1.0014 3000\nscale(effort)-Mazama murelia           1.0080 2731\nscale(effort)-Mazama zamora            1.0016 3000\nscale(effort)-Myoprocta pratti         1.0074 2684\nscale(effort)-Myrmecophaga tridactyla  1.0075 2738\nscale(effort)-Nasua nasua              1.0001 3000\nscale(effort)-Panthera onca            1.0050 3000\nscale(effort)-Pecari tajacu            1.0002 3064\nscale(effort)-Priodontes maximus       1.0001 2627\nscale(effort)-Procyon cancrivorus      1.0017 3000\nscale(effort)-Puma concolor            1.0062 3000\nscale(effort)-Speothos venaticus       1.0022 3000\nscale(effort)-Tamandua tetradactyla    1.0014 3000\nscale(effort)-Tapirus terrestris       1.0078 2540\nscale(effort)-Tayassu pecari           1.0037 3000\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1 13.7269 8.0014 0.6750 13.9028 26.6418 1.0007 2843\nphi-2 13.7322 7.9105 0.7179 13.6774 26.8470 1.0049 3000\nphi-3 13.4748 8.0759 0.4572 13.0370 26.9249 1.0008 2609\nphi-4 13.6439 7.9863 0.5321 13.5390 26.8039 1.0014 2827\nphi-5 13.5677 8.0831 0.6575 13.5918 26.8284 1.0028 3000\n\nCodesummary(out.sp, level = 'both')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 10.6275\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)        -1.9004 0.5780 -3.0373 -1.9005 -0.7742 1.0117 252\nscale(elev)        -0.3026 0.2473 -0.7818 -0.3017  0.1768 1.0123 915\nscale(border_dist) -0.8487 0.2246 -1.2976 -0.8398 -0.4210 1.0113 667\nscale(FLII)         0.0366 0.2443 -0.4179  0.0220  0.5447 1.0238 915\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat  ESS\n(Intercept)        6.5946 2.7326 2.8517 6.1052 13.0779 1.0046  430\nscale(elev)        0.3012 0.2088 0.0574 0.2514  0.8286 1.0162 1148\nscale(border_dist) 0.1369 0.1078 0.0275 0.1051  0.4098 1.0052 1789\nscale(FLII)        0.6414 0.4785 0.1017 0.5174  1.8928 1.0109  804\n\nDetection Means (logit scale): \n                 Mean     SD   2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.0014 0.3122 -2.651 -1.9877 -1.4357 1.0316  250\nscale(effort)  0.3091 0.0812  0.150  0.3070  0.4742 0.9998 2683\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   1.5312 0.7843 0.5186 1.3647 3.5614 1.0183  118\nscale(effort) 0.0615 0.0364 0.0200 0.0526 0.1530 1.0051 2660\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                               Mean     SD    2.5%     50%\n(Intercept)-Atelocynus microtis             -2.5128 1.3030 -4.2470 -2.7335\n(Intercept)-Coendou sp                      -3.9762 1.7049 -6.9045 -4.1516\n(Intercept)-Cuniculus paca                   0.1870 0.2871 -0.3508  0.1811\n(Intercept)-Dasyprocta fuliginosa            0.2738 0.3517 -0.3876  0.2628\n(Intercept)-Dasypus novemcinctus            -2.0688 0.6222 -3.4132 -2.0190\n(Intercept)-Didelphis sp                    -4.2873 2.0842 -7.7730 -4.5076\n(Intercept)-Eira barbara                    -3.7574 1.3940 -6.3749 -3.8243\n(Intercept)-Herpailurus yagouaroundi        -1.9744 1.6957 -5.0297 -2.0878\n(Intercept)-Leopardus pardalis              -2.0684 0.6689 -3.3723 -2.0609\n(Intercept)-Leopardus tigrinus              -6.0705 1.2850 -8.7898 -5.9842\n(Intercept)-Leopardus wiedii                -4.1753 1.4582 -6.9157 -4.2085\n(Intercept)-Mazama murelia                  -0.5998 0.7635 -1.9557 -0.6517\n(Intercept)-Mazama zamora                    1.7925 0.5106  0.9311  1.7438\n(Intercept)-Myoprocta pratti                -3.8449 0.7404 -5.4724 -3.7841\n(Intercept)-Myrmecophaga tridactyla         -1.6157 1.3187 -3.9155 -1.6979\n(Intercept)-Nasua nasua                     -4.0631 1.6847 -7.1178 -4.2048\n(Intercept)-Panthera onca                   -0.8588 0.9750 -2.5945 -0.9424\n(Intercept)-Pecari tajacu                    1.7134 0.5536  0.8385  1.6424\n(Intercept)-Priodontes maximus              -0.1326 1.6703 -2.8466 -0.3335\n(Intercept)-Procyon cancrivorus             -3.9133 1.0701 -6.1357 -3.8848\n(Intercept)-Puma concolor                   -1.8649 0.5259 -3.0144 -1.8428\n(Intercept)-Speothos venaticus              -4.2986 1.9431 -7.8873 -4.4031\n(Intercept)-Tamandua tetradactyla           -4.3434 1.6741 -7.2208 -4.5284\n(Intercept)-Tapirus terrestris               0.9599 0.4889  0.1531  0.9020\n(Intercept)-Tayassu pecari                  -0.4809 0.4429 -1.3248 -0.4893\nscale(elev)-Atelocynus microtis             -0.4737 0.4916 -1.4352 -0.4755\nscale(elev)-Coendou sp                      -0.4648 0.5374 -1.5933 -0.4436\nscale(elev)-Cuniculus paca                  -0.3584 0.3405 -1.0283 -0.3596\nscale(elev)-Dasyprocta fuliginosa            0.1427 0.4049 -0.6018  0.1329\nscale(elev)-Dasypus novemcinctus            -0.3089 0.4063 -1.0970 -0.3108\nscale(elev)-Didelphis sp                    -0.1234 0.5432 -1.1716 -0.1300\nscale(elev)-Eira barbara                    -0.3241 0.5036 -1.2994 -0.3176\nscale(elev)-Herpailurus yagouaroundi        -0.3332 0.5282 -1.3915 -0.3369\nscale(elev)-Leopardus pardalis              -0.3590 0.4296 -1.1894 -0.3689\nscale(elev)-Leopardus tigrinus              -0.5066 0.5458 -1.6443 -0.4849\nscale(elev)-Leopardus wiedii                -0.1668 0.5010 -1.1384 -0.1912\nscale(elev)-Mazama murelia                  -0.5848 0.4503 -1.4943 -0.5733\nscale(elev)-Mazama zamora                   -0.0811 0.4324 -0.8885 -0.1022\nscale(elev)-Myoprocta pratti                -0.2542 0.4240 -1.0929 -0.2532\nscale(elev)-Myrmecophaga tridactyla         -0.3651 0.5071 -1.3814 -0.3689\nscale(elev)-Nasua nasua                     -0.5416 0.5578 -1.7241 -0.5147\nscale(elev)-Panthera onca                   -0.3542 0.4677 -1.2756 -0.3528\nscale(elev)-Pecari tajacu                   -0.4186 0.4285 -1.2528 -0.4325\nscale(elev)-Priodontes maximus              -0.3171 0.5253 -1.3301 -0.3326\nscale(elev)-Procyon cancrivorus              0.0140 0.4911 -0.8936 -0.0129\nscale(elev)-Puma concolor                   -1.0840 0.4727 -2.0723 -1.0631\nscale(elev)-Speothos venaticus              -0.4682 0.5558 -1.5677 -0.4544\nscale(elev)-Tamandua tetradactyla           -0.2614 0.5054 -1.2328 -0.2749\nscale(elev)-Tapirus terrestris              -0.0707 0.4335 -0.8511 -0.0876\nscale(elev)-Tayassu pecari                   0.4808 0.4725 -0.3824  0.4538\nscale(border_dist)-Atelocynus microtis      -0.6828 0.3904 -1.4292 -0.6927\nscale(border_dist)-Coendou sp               -0.7873 0.4206 -1.6252 -0.7901\nscale(border_dist)-Cuniculus paca           -0.8343 0.3092 -1.4602 -0.8327\nscale(border_dist)-Dasyprocta fuliginosa    -0.9597 0.3458 -1.6666 -0.9450\nscale(border_dist)-Dasypus novemcinctus     -0.6013 0.3597 -1.2652 -0.6165\nscale(border_dist)-Didelphis sp             -0.9018 0.4135 -1.7471 -0.8808\nscale(border_dist)-Eira barbara             -0.7756 0.4022 -1.5474 -0.7793\nscale(border_dist)-Herpailurus yagouaroundi -0.8359 0.4126 -1.6615 -0.8410\nscale(border_dist)-Leopardus pardalis       -0.8647 0.3666 -1.5620 -0.8684\nscale(border_dist)-Leopardus tigrinus       -0.7717 0.4101 -1.5623 -0.7772\nscale(border_dist)-Leopardus wiedii         -0.8336 0.3910 -1.6125 -0.8316\nscale(border_dist)-Mazama murelia           -0.7455 0.3734 -1.4664 -0.7487\nscale(border_dist)-Mazama zamora            -0.9256 0.3338 -1.5856 -0.9125\nscale(border_dist)-Myoprocta pratti         -0.9819 0.3812 -1.7840 -0.9648\nscale(border_dist)-Myrmecophaga tridactyla  -0.9126 0.3916 -1.7340 -0.8963\nscale(border_dist)-Nasua nasua              -0.8221 0.4291 -1.6939 -0.8266\nscale(border_dist)-Panthera onca            -1.0082 0.3920 -1.8357 -0.9932\nscale(border_dist)-Pecari tajacu            -0.8686 0.3469 -1.5899 -0.8577\nscale(border_dist)-Priodontes maximus       -0.8037 0.4097 -1.6193 -0.8029\nscale(border_dist)-Procyon cancrivorus      -0.9930 0.4051 -1.8558 -0.9753\nscale(border_dist)-Puma concolor            -0.7343 0.3518 -1.4148 -0.7384\nscale(border_dist)-Speothos venaticus       -0.7537 0.4195 -1.5706 -0.7587\nscale(border_dist)-Tamandua tetradactyla    -0.8058 0.3967 -1.5666 -0.8049\nscale(border_dist)-Tapirus terrestris       -0.9506 0.3504 -1.6711 -0.9357\nscale(border_dist)-Tayassu pecari           -1.0954 0.3808 -1.9312 -1.0723\nscale(FLII)-Atelocynus microtis             -0.5822 0.4303 -1.5873 -0.5403\nscale(FLII)-Coendou sp                       0.2433 0.7441 -1.1468  0.1913\nscale(FLII)-Cuniculus paca                  -0.5901 0.3702 -1.4146 -0.5548\nscale(FLII)-Dasyprocta fuliginosa           -0.7084 0.4406 -1.6551 -0.6645\nscale(FLII)-Dasypus novemcinctus            -0.6336 0.4623 -1.7114 -0.5728\nscale(FLII)-Didelphis sp                     0.2202 0.7862 -1.2759  0.1918\nscale(FLII)-Eira barbara                     0.0436 0.6483 -1.2252  0.0300\nscale(FLII)-Herpailurus yagouaroundi        -0.0460 0.7452 -1.6217 -0.0418\nscale(FLII)-Leopardus pardalis               0.4831 0.5475 -0.4671  0.4366\nscale(FLII)-Leopardus tigrinus               0.2894 0.6830 -0.8272  0.2082\nscale(FLII)-Leopardus wiedii                -0.0673 0.6794 -1.5194 -0.0411\nscale(FLII)-Mazama murelia                  -0.0856 0.4245 -0.9453 -0.0700\nscale(FLII)-Mazama zamora                   -0.5200 0.4830 -1.6106 -0.4682\nscale(FLII)-Myoprocta pratti                 0.2775 0.5018 -0.5905  0.2323\nscale(FLII)-Myrmecophaga tridactyla          0.2257 0.6762 -1.0848  0.2200\nscale(FLII)-Nasua nasua                      0.2968 0.7568 -1.0586  0.2254\nscale(FLII)-Panthera onca                    0.7468 0.6968 -0.4501  0.6853\nscale(FLII)-Pecari tajacu                   -0.2823 0.4112 -1.1886 -0.2508\nscale(FLII)-Priodontes maximus               0.2659 0.7464 -1.1339  0.2174\nscale(FLII)-Procyon cancrivorus             -0.7344 0.5369 -1.9682 -0.6613\nscale(FLII)-Puma concolor                    1.1210 0.7357 -0.0587  1.0392\nscale(FLII)-Speothos venaticus               0.1914 0.7821 -1.2241  0.1237\nscale(FLII)-Tamandua tetradactyla            0.2533 0.6923 -0.9948  0.1895\nscale(FLII)-Tapirus terrestris              -0.1850 0.3755 -0.9681 -0.1673\nscale(FLII)-Tayassu pecari                   0.7364 0.5095 -0.2023  0.7009\n                                              97.5%   Rhat  ESS\n(Intercept)-Atelocynus microtis              0.9057 1.0699  168\n(Intercept)-Coendou sp                      -0.0131 1.0107  133\n(Intercept)-Cuniculus paca                   0.7849 1.0005 2379\n(Intercept)-Dasyprocta fuliginosa            0.9908 1.0000 2935\n(Intercept)-Dasypus novemcinctus            -0.9040 1.0034 1038\n(Intercept)-Didelphis sp                     0.8428 1.0649  111\n(Intercept)-Eira barbara                    -0.7099 1.0580  276\n(Intercept)-Herpailurus yagouaroundi         1.8817 1.1131  185\n(Intercept)-Leopardus pardalis              -0.7518 1.0106  978\n(Intercept)-Leopardus tigrinus              -3.7877 1.0057  697\n(Intercept)-Leopardus wiedii                -1.1875 1.0046  178\n(Intercept)-Mazama murelia                   1.1361 1.0168  633\n(Intercept)-Mazama zamora                    2.9254 1.0034 1539\n(Intercept)-Myoprocta pratti                -2.5805 1.0051 1123\n(Intercept)-Myrmecophaga tridactyla          1.3455 1.0430  252\n(Intercept)-Nasua nasua                     -0.3296 1.0141  165\n(Intercept)-Panthera onca                    1.3283 1.0043  427\n(Intercept)-Pecari tajacu                    3.0087 1.0060 1390\n(Intercept)-Priodontes maximus               3.7599 1.0732  195\n(Intercept)-Procyon cancrivorus             -1.8585 1.0316  640\n(Intercept)-Puma concolor                   -0.9251 1.0021 1597\n(Intercept)-Speothos venaticus              -0.3298 1.0562  156\n(Intercept)-Tamandua tetradactyla           -0.3395 1.0428  223\n(Intercept)-Tapirus terrestris               2.1000 1.0086 1512\n(Intercept)-Tayassu pecari                   0.4260 1.0006 1809\nscale(elev)-Atelocynus microtis              0.4951 1.0043 1564\nscale(elev)-Coendou sp                       0.5385 1.0143 1282\nscale(elev)-Cuniculus paca                   0.3111 1.0096 1398\nscale(elev)-Dasyprocta fuliginosa            0.9748 1.0041 1294\nscale(elev)-Dasypus novemcinctus             0.4791 1.0005 1946\nscale(elev)-Didelphis sp                     1.0063 1.0096 1587\nscale(elev)-Eira barbara                     0.6523 1.0048 1500\nscale(elev)-Herpailurus yagouaroundi         0.7446 1.0101 1433\nscale(elev)-Leopardus pardalis               0.4853 1.0052 1510\nscale(elev)-Leopardus tigrinus               0.5245 1.0074 1799\nscale(elev)-Leopardus wiedii                 0.8687 1.0129 1580\nscale(elev)-Mazama murelia                   0.2666 1.0008 1550\nscale(elev)-Mazama zamora                    0.8440 1.0118 1741\nscale(elev)-Myoprocta pratti                 0.5643 1.0004 1802\nscale(elev)-Myrmecophaga tridactyla          0.6118 1.0084 1239\nscale(elev)-Nasua nasua                      0.4557 1.0045 1403\nscale(elev)-Panthera onca                    0.5669 1.0074 1660\nscale(elev)-Pecari tajacu                    0.4392 1.0035 1783\nscale(elev)-Priodontes maximus               0.7670 1.0126 1494\nscale(elev)-Procyon cancrivorus              1.0490 1.0030 1800\nscale(elev)-Puma concolor                   -0.2185 1.0001 1573\nscale(elev)-Speothos venaticus               0.5765 1.0039 1441\nscale(elev)-Tamandua tetradactyla            0.7672 1.0006 1454\nscale(elev)-Tapirus terrestris               0.8665 1.0161 1644\nscale(elev)-Tayassu pecari                   1.5357 1.0087 1117\nscale(border_dist)-Atelocynus microtis       0.1190 1.0047 1211\nscale(border_dist)-Coendou sp                0.0695 1.0078 1480\nscale(border_dist)-Cuniculus paca           -0.2372 1.0189 1349\nscale(border_dist)-Dasyprocta fuliginosa    -0.3054 1.0107 1427\nscale(border_dist)-Dasypus novemcinctus      0.1536 1.0030 1567\nscale(border_dist)-Didelphis sp             -0.1091 1.0007 1518\nscale(border_dist)-Eira barbara              0.0307 1.0028 1637\nscale(border_dist)-Herpailurus yagouaroundi -0.0069 1.0002 1296\nscale(border_dist)-Leopardus pardalis       -0.1439 1.0063 1462\nscale(border_dist)-Leopardus tigrinus        0.0353 1.0057 1365\nscale(border_dist)-Leopardus wiedii         -0.0501 1.0004 1306\nscale(border_dist)-Mazama murelia           -0.0088 1.0010 1664\nscale(border_dist)-Mazama zamora            -0.3030 1.0159 1442\nscale(border_dist)-Myoprocta pratti         -0.2671 1.0008 1302\nscale(border_dist)-Myrmecophaga tridactyla  -0.1750 1.0011 1406\nscale(border_dist)-Nasua nasua               0.0470 1.0015 1351\nscale(border_dist)-Panthera onca            -0.2805 1.0037 1481\nscale(border_dist)-Pecari tajacu            -0.1899 1.0152 1414\nscale(border_dist)-Priodontes maximus        0.0492 1.0029 1372\nscale(border_dist)-Procyon cancrivorus      -0.2398 1.0021 1491\nscale(border_dist)-Puma concolor            -0.0398 1.0034 1527\nscale(border_dist)-Speothos venaticus        0.1245 1.0077 1428\nscale(border_dist)-Tamandua tetradactyla     0.0005 1.0095 1420\nscale(border_dist)-Tapirus terrestris       -0.2964 1.0091 1380\nscale(border_dist)-Tayassu pecari           -0.3936 1.0200 1456\nscale(FLII)-Atelocynus microtis              0.1792 1.0019 1939\nscale(FLII)-Coendou sp                       1.8244 1.0065 1180\nscale(FLII)-Cuniculus paca                   0.0244 1.0078 1509\nscale(FLII)-Dasyprocta fuliginosa            0.0643 1.0199 2318\nscale(FLII)-Dasypus novemcinctus             0.1033 1.0037 1772\nscale(FLII)-Didelphis sp                     1.9119 1.0118 1160\nscale(FLII)-Eira barbara                     1.3484 1.0097 1687\nscale(FLII)-Herpailurus yagouaroundi         1.4892 1.0260 1262\nscale(FLII)-Leopardus pardalis               1.6661 1.0006 1781\nscale(FLII)-Leopardus tigrinus               1.8227 1.0002 1558\nscale(FLII)-Leopardus wiedii                 1.2383 1.0193 1021\nscale(FLII)-Mazama murelia                   0.7201 1.0047 2158\nscale(FLII)-Mazama zamora                    0.2747 1.0179 1909\nscale(FLII)-Myoprocta pratti                 1.3658 1.0022 1972\nscale(FLII)-Myrmecophaga tridactyla          1.5975 1.0014 1137\nscale(FLII)-Nasua nasua                      1.9858 1.0153 1256\nscale(FLII)-Panthera onca                    2.3258 1.0076 1131\nscale(FLII)-Pecari tajacu                    0.4494 1.0149 2245\nscale(FLII)-Priodontes maximus               1.8764 1.0047 1082\nscale(FLII)-Procyon cancrivorus              0.1262 1.0281 1893\nscale(FLII)-Puma concolor                    2.7303 1.0028  962\nscale(FLII)-Speothos venaticus               1.9324 1.0075 1258\nscale(FLII)-Tamandua tetradactyla            1.8139 1.0142 1411\nscale(FLII)-Tapirus terrestris               0.5039 1.0138 2579\nscale(FLII)-Tayassu pecari                   1.8270 1.0022 1445\n\nDetection (logit scale): \n                                          Mean     SD    2.5%     50%   97.5%\n(Intercept)-Atelocynus microtis        -2.6640 0.7999 -4.5022 -2.5970 -1.2942\n(Intercept)-Coendou sp                 -3.1213 1.2292 -5.6345 -3.0436 -0.9605\n(Intercept)-Cuniculus paca             -0.4806 0.1152 -0.7069 -0.4816 -0.2554\n(Intercept)-Dasyprocta fuliginosa      -0.4248 0.1084 -0.6379 -0.4248 -0.2151\n(Intercept)-Dasypus novemcinctus       -1.5136 0.2979 -2.1107 -1.5065 -0.9523\n(Intercept)-Didelphis sp               -3.3004 1.2734 -5.9456 -3.2340 -1.0734\n(Intercept)-Eira barbara               -2.6661 0.7242 -4.1821 -2.6241 -1.3653\n(Intercept)-Herpailurus yagouaroundi   -3.4650 0.7675 -4.9060 -3.4801 -1.9549\n(Intercept)-Leopardus pardalis         -1.6917 0.2726 -2.2718 -1.6857 -1.1822\n(Intercept)-Leopardus tigrinus         -1.1396 0.9360 -3.0844 -1.0886  0.5774\n(Intercept)-Leopardus wiedii           -2.6587 0.8582 -4.4724 -2.6035 -1.1289\n(Intercept)-Mazama murelia             -1.9624 0.2870 -2.5581 -1.9539 -1.4265\n(Intercept)-Mazama zamora              -0.8281 0.1063 -1.0403 -0.8248 -0.6231\n(Intercept)-Myoprocta pratti           -0.9037 0.3046 -1.5301 -0.8901 -0.3558\n(Intercept)-Myrmecophaga tridactyla    -2.8685 0.5125 -3.9003 -2.8584 -1.8662\n(Intercept)-Nasua nasua                -3.1380 1.0257 -5.2303 -3.0960 -1.2575\n(Intercept)-Panthera onca              -2.4220 0.3707 -3.1502 -2.4132 -1.7266\n(Intercept)-Pecari tajacu              -0.9121 0.1124 -1.1307 -0.9122 -0.7039\n(Intercept)-Priodontes maximus         -3.2774 0.5092 -4.2182 -3.2985 -2.2419\n(Intercept)-Procyon cancrivorus        -2.1652 0.5989 -3.3968 -2.1425 -1.0957\n(Intercept)-Puma concolor              -1.3238 0.2195 -1.7619 -1.3225 -0.9137\n(Intercept)-Speothos venaticus         -3.2914 1.2116 -5.5791 -3.2835 -1.0536\n(Intercept)-Tamandua tetradactyla      -2.6054 1.0292 -4.9165 -2.5023 -0.8333\n(Intercept)-Tapirus terrestris         -1.0407 0.1320 -1.3054 -1.0399 -0.7991\n(Intercept)-Tayassu pecari             -1.4252 0.1875 -1.7961 -1.4265 -1.0596\nscale(effort)-Atelocynus microtis       0.3561 0.2369 -0.0983  0.3504  0.8301\nscale(effort)-Coendou sp                0.3192 0.2536 -0.1936  0.3218  0.8377\nscale(effort)-Cuniculus paca            0.3441 0.1106  0.1318  0.3421  0.5694\nscale(effort)-Dasyprocta fuliginosa     0.3194 0.1027  0.1299  0.3171  0.5282\nscale(effort)-Dasypus novemcinctus      0.3068 0.1752 -0.0191  0.2993  0.6669\nscale(effort)-Didelphis sp              0.3158 0.2521 -0.1678  0.3163  0.8139\nscale(effort)-Eira barbara              0.3912 0.2400 -0.0483  0.3789  0.9177\nscale(effort)-Herpailurus yagouaroundi  0.1573 0.2311 -0.3157  0.1649  0.6086\nscale(effort)-Leopardus pardalis        0.1759 0.1652 -0.1429  0.1729  0.5081\nscale(effort)-Leopardus tigrinus        0.3663 0.2540 -0.1170  0.3596  0.8946\nscale(effort)-Leopardus wiedii          0.3468 0.2438 -0.1115  0.3388  0.8527\nscale(effort)-Mazama murelia            0.5080 0.1977  0.1633  0.4925  0.9449\nscale(effort)-Mazama zamora             0.3904 0.1067  0.1972  0.3866  0.6126\nscale(effort)-Myoprocta pratti          0.2838 0.2008 -0.1012  0.2820  0.6847\nscale(effort)-Myrmecophaga tridactyla   0.3333 0.2119 -0.0758  0.3267  0.7775\nscale(effort)-Nasua nasua               0.3370 0.2468 -0.1361  0.3330  0.8521\nscale(effort)-Panthera onca             0.1712 0.1734 -0.1568  0.1688  0.5259\nscale(effort)-Pecari tajacu             0.3633 0.1082  0.1646  0.3561  0.5827\nscale(effort)-Priodontes maximus        0.0704 0.1981 -0.3297  0.0723  0.4445\nscale(effort)-Procyon cancrivorus       0.2285 0.2270 -0.2249  0.2271  0.6608\nscale(effort)-Puma concolor             0.3360 0.1611  0.0466  0.3255  0.6707\nscale(effort)-Speothos venaticus        0.2139 0.2483 -0.2982  0.2171  0.6866\nscale(effort)-Tamandua tetradactyla     0.2185 0.2465 -0.2789  0.2221  0.6886\nscale(effort)-Tapirus terrestris        0.3511 0.1189  0.1263  0.3488  0.5905\nscale(effort)-Tayassu pecari            0.4974 0.1711  0.1927  0.4848  0.8689\n                                         Rhat  ESS\n(Intercept)-Atelocynus microtis        1.0401  298\n(Intercept)-Coendou sp                 1.0078  272\n(Intercept)-Cuniculus paca             1.0002 3088\n(Intercept)-Dasyprocta fuliginosa      1.0030 3000\n(Intercept)-Dasypus novemcinctus       1.0035 1778\n(Intercept)-Didelphis sp               1.0068  171\n(Intercept)-Eira barbara               1.0194  312\n(Intercept)-Herpailurus yagouaroundi   1.0677  264\n(Intercept)-Leopardus pardalis         1.0131 1453\n(Intercept)-Leopardus tigrinus         1.0000 1704\n(Intercept)-Leopardus wiedii           1.0026  278\n(Intercept)-Mazama murelia             1.0140  938\n(Intercept)-Mazama zamora              1.0041 1504\n(Intercept)-Myoprocta pratti           1.0006 2786\n(Intercept)-Myrmecophaga tridactyla    1.0154  338\n(Intercept)-Nasua nasua                1.0164  189\n(Intercept)-Panthera onca              1.0046  537\n(Intercept)-Pecari tajacu              1.0025 2105\n(Intercept)-Priodontes maximus         1.0363  275\n(Intercept)-Procyon cancrivorus        1.0123 1009\n(Intercept)-Puma concolor              1.0005 2661\n(Intercept)-Speothos venaticus         1.0452  201\n(Intercept)-Tamandua tetradactyla      1.0219  237\n(Intercept)-Tapirus terrestris         1.0030 2630\n(Intercept)-Tayassu pecari             1.0003 2160\nscale(effort)-Atelocynus microtis      1.0017 3000\nscale(effort)-Coendou sp               0.9996 3000\nscale(effort)-Cuniculus paca           1.0054 3522\nscale(effort)-Dasyprocta fuliginosa    1.0014 2844\nscale(effort)-Dasypus novemcinctus     1.0026 3000\nscale(effort)-Didelphis sp             1.0006 3074\nscale(effort)-Eira barbara             1.0069 3000\nscale(effort)-Herpailurus yagouaroundi 1.0002 2837\nscale(effort)-Leopardus pardalis       1.0012 3000\nscale(effort)-Leopardus tigrinus       1.0003 3000\nscale(effort)-Leopardus wiedii         1.0014 3000\nscale(effort)-Mazama murelia           1.0080 2731\nscale(effort)-Mazama zamora            1.0016 3000\nscale(effort)-Myoprocta pratti         1.0074 2684\nscale(effort)-Myrmecophaga tridactyla  1.0075 2738\nscale(effort)-Nasua nasua              1.0001 3000\nscale(effort)-Panthera onca            1.0050 3000\nscale(effort)-Pecari tajacu            1.0002 3064\nscale(effort)-Priodontes maximus       1.0001 2627\nscale(effort)-Procyon cancrivorus      1.0017 3000\nscale(effort)-Puma concolor            1.0062 3000\nscale(effort)-Speothos venaticus       1.0022 3000\nscale(effort)-Tamandua tetradactyla    1.0014 3000\nscale(effort)-Tapirus terrestris       1.0078 2540\nscale(effort)-Tayassu pecari           1.0037 3000\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n         Mean     SD   2.5%     50%   97.5%   Rhat  ESS\nphi-1 13.7269 8.0014 0.6750 13.9028 26.6418 1.0007 2843\nphi-2 13.7322 7.9105 0.7179 13.6774 26.8470 1.0049 3000\nphi-3 13.4748 8.0759 0.4572 13.0370 26.9249 1.0008 2609\nphi-4 13.6439 7.9863 0.5321 13.5390 26.8039 1.0014 2827\nphi-5 13.5677 8.0831 0.6575 13.5918 26.8284 1.0028 3000\n\n\nBayesian p-values can be inspected to check for lack of fit (overall or by species). Lack of fit at significance level = 0.05 is indicated by Bayesian p-values below 0.025 or greater than 0.975. The overall Bayesian p-value (Bpvalue) indicates no problems with lack of fit. Likewise, species-level Bayesian p-values (Bpvalue_species) indicate no lack of fit for any species.\n\nGelman and Rubin’s convergence diagnostic: Approximate convergence is diagnosed when the upper limit is close to 1.\n\nConvergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable. The gelman.diag diagnostic is applied to a single variable from the chain. It is based a comparison of within-chain and between-chain variances, and is similar to a classical analysis of variance.\nValues substantially above 1 indicate lack of convergence.\nModel Diagnostics\n\nCode#| eval: true\n#| echo: true\n#| code-fold: true\n#| warning: false\n#| message: false\n# Extract posterior draws for later use\nposterior1 &lt;- as.array(out.sp)\n\n# Trace plots to check chain mixing. Extract posterior samples and bind in a single matrix.\nPOSTERIOR.MATRIX &lt;- cbind(out.sp$alpha.comm.samples, \n                          out.sp$beta.comm.samples,  \n                          out.sp$alpha.samples, \n                          out.sp$beta.samples)\n\n# Matrix output is all chains combined, split into 3 chains.\nCHAIN.1 &lt;- as.mcmc(POSTERIOR.MATRIX[1:1000,])\nCHAIN.2 &lt;- as.mcmc(POSTERIOR.MATRIX[1001:2000,])\nCHAIN.3 &lt;- as.mcmc(POSTERIOR.MATRIX[2001:3000,])\n# CHAIN.4 &lt;- as.mcmc(POSTERIOR.MATRIX[8001:10000,])\n\n# Bind four chains as coda mcmc.list object.\nPOSTERIOR.CHAINS &lt;- mcmc.list(CHAIN.1, CHAIN.2, CHAIN.3)#, CHAIN.4)\n\n# Create an empty folder.\n# dir.create (\"Beetle_plots\")\n\n# Plot chain mixing of each parameter to a multi-panel plot and save to the new folder. ART 5 mins\n\n######################################\n#### SAVE Diagnostics at PDF\n# MCMCtrace(POSTERIOR.CHAINS, params = \"all\", Rhat = TRUE, n.eff = TRUE)#, pdf = TRUE, filename = \"Beetle_240909_traceplots.pdf\", wd = \"Beetle_plots\")\n\n\n\n#mcmc_trace(fit.commu, parms = c(\"beta.ranef.cont.border_dist.mean\"))\n\n#posterior2 &lt;- extract(fit.commu, inc_warmup = TRUE, permuted = FALSE)\n\n#color_scheme_set(\"mix-blue-pink\")\n#p &lt;- mcmc_trace(posterior1,  pars = c(\"mu\", \"tau\"), n_warmup = 300,\n#                facet_args = list(nrow = 2, labeller = label_parsed))\n#p + facet_text(size = 15)\n\n\n\n#outMCMC &lt;- fit.commu #Convert output to MCMC object\n#diagnostics chains \n\n# all as pdf\n# MCMCtrace(outMCMC)\n\n# MCMCtrace(outMCMC, params = c(\"alpha0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(out.sp, params = c(\"beta.ranef.cont.border_dist.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n\n### density\n# MCMCtrace(outMCMC, params = c(\"Nspecies\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n#MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n#coda::gelman.diag(outMCMC,  multivariate = FALSE, transform=FALSE)\n                    \n# coda::gelman.plot(outMCMC,  multivariate = FALSE)\n\n\n\n# \n# mcmc_intervals(outMCMC, pars = c(\"Nspecies_in_AP[1]\",\n#                                  \"Nspecies_in_AP[2]\"),\n#                point_est = \"mean\",\n#                prob = 0.75, prob_outer = 0.95) +\n#   ggtitle(\"Number of species\") + \n#   scale_y_discrete(labels = c(\"Nspecies_in_AP[1]\"=levels(sitecovs$in_AP)[1],\n#              \"Nspecies_in_AP[2]\"=levels(sitecovs$in_AP)[2]))\n# \n# #Continuous\n# p &lt;- mcmc_intervals(outMCMC, \n#                pars = c(\"beta.ranef.cont.border_dist.mean\",\n#                          #\"beta.ranef.cont.elev.mean\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"))\n# \n# # relabel parameters\n# p + scale_y_discrete(\n#   labels = c(\"beta.ranef.cont.border_dist.mean\"=\"Dist_border\",\n#                          #\"beta.ranef.cont.elev.mean\"=\"Elevation\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"=\"in_AP\")\n# ) +\n#   ggtitle(\"Treatment effect on all species\")\n# \n\n\nPosterior Summary (effect)\nCommunity effects\nCode# Create simple plot summaries using MCMCvis package.\n# Detection covariate effects --------- \nMCMCplot(out.sp$alpha.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n# Occupancy community-level effects \nMCMCplot(out.sp$beta.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) Detection\n\n\n\n\n\n\n\n\n\n(b) Occupancy\n\n\n\n\n\n\nFigure 1: Community effects\n\n\nSpecies effects\nCode# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,26:50], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,51:75], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,76:100], ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) elevation\n\n\n\n\n\n\n\n\n\n(b) distance border\n\n\n\n\n\n\n\n\n\n\n\n(c) FLII\n\n\n\n\n\n\nFigure 2: Species effects\n\n\nSpecies effects using bayesplot\n\n\nCodelibrary(bayesplot)\n#mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n# mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n\nmcmc_intervals(out.sp$beta.samples[,26:50] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,51:75] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\nCodemcmc_intervals(out.sp$beta.samples[,76:100] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\n\n\n\n\n\nPrediction as graph\nThis prediction uses the non spatial model\n\nCode# 6. Prediction -----------------------------------------------------------\n# Predict occupancy along a gradient of elev   \n# Create a set of values across the range of observed elev values\nelev.pred.vals &lt;- seq(min(data_list$occ.covs$elev), \n                              max(data_list$occ.covs$elev), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nelev.pred.vals.scale &lt;- (elev.pred.vals - mean(data_list$occ.covs$elev)) / \n                             sd(data_list$occ.covs$elev)\n# Create a set of values across the range of observed elev values\nborder_dist.pred.vals &lt;- seq(min(data_list$occ.covs$border_dist), \n                              max(data_list$occ.covs$border_dist), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nborder_dist.pred.vals.scale &lt;- (border_dist.pred.vals -\n                                  mean(data_list$occ.covs$border_dist)) /\n                                  sd(data_list$occ.covs$border_dist)\n\n# Create a set of values across the range of observed FLII values\nFLII.pred.vals &lt;- seq(min(data_list$occ.covs$FLII), \n                              max(data_list$occ.covs$FLII), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nFLII.pred.vals.scale &lt;- (FLII.pred.vals -\n                                  mean(data_list$occ.covs$FLII)) /\n                                  sd(data_list$occ.covs$FLII)\n\n# Predict occupancy across elev  values at mean values of all other variables\npred.df1 &lt;- as.matrix(data.frame(intercept = 1, \n                                 elev = elev.pred.vals.scale, \n                                 border_dist = 0,\n                                 FLII=0))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df2 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = border_dist.pred.vals.scale,\n                         FLII= 0 ))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df3 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = 0,\n                         FLII= FLII.pred.vals.scale ))#, catchment = 0, density = 0, \n                         # slope = 0))\n\nout.pred1 &lt;- predict(out.null, pred.df1) # using non spatial\nstr(out.pred1)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.2 0.427 0.357 0.246 0.105 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 1 0 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out.null, X.0 = pred.df1)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred1$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           elev = elev.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(elev.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = elev, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'elevation (m)', y = 'Occupancy Probability') \n\n\n\n\n\n\nCodeout.pred2 &lt;- predict(out.null, pred.df2) # using non spatial\nstr(out.pred2)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.3322 0.4227 0.4671 0.3285 0.0758 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 0 1 0 0 0 0 0 0 0 ...\n $ call         : language predict.msPGOcc(object = out.null, X.0 = pred.df2)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred2$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           border_dist = border_dist.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(border_dist.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = border_dist/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'border_dist (Km)', y = 'Occupancy Probability') \n\n\n\n\n\n\nCodeout.pred3 &lt;- predict(out.null, pred.df3) # using non spatial\nstr(out.pred3)\n\nList of 3\n $ psi.0.samples: num [1:1500, 1:25, 1:100] 0.388 0.986 0.849 0.881 0.362 ...\n $ z.0.samples  : int [1:1500, 1:25, 1:100] 0 1 1 1 0 1 1 0 1 0 ...\n $ call         : language predict.msPGOcc(object = out.null, X.0 = pred.df3)\n - attr(*, \"class\")= chr \"predict.msPGOcc\"\n\nCodepsi.0.quants &lt;- apply(out.pred3$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           FLII = FLII.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(FLII.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = FLII/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'FLII', y = 'Occupancy Probability') \n\n\n\n\n\n\n\nSpatial Prediction in elevation_EC\n\nCode#aggregate  resolution to (factor = 3)\n#transform coord data to UTM\nelevation_UTM &lt;- project(elevation_EC, \"EPSG:10603\")\nelevation_17.aggregate &lt;- aggregate(elevation_UTM, fact=10)\nres(elevation_17.aggregate)\n\n# Convert the SpatRaster to a data frame with coordinates\ndf_coords &lt;- as.data.frame(elevation_17.aggregate, xy = TRUE)\nnames(df_coords) &lt;-c(\"X\",\"Y\",\"elev\")\n\nelev.pred &lt;- (df_coords$elev - mean(data_list$occ.covs$elev)) / sd(data_list$occ.covs$elev)\n\n\n############### Predict new data ############### \n# we predict at one covariate varing and others at mean value = 0\n# intercept = 1, elev = 0, border_dist = 0, FLII= 0\n# in that order\n################ ################ ################ \npredict_data &lt;- cbind(1, elev.pred, 0, 0)\ncolnames(predict_data) &lt;- c(\"intercept\",\n                            \"elev\",\n                            \"border_dist\",\n                            \"FLII\" )\n\n# X.0 &lt;- cbind(1, 1, elev.pred)#, elev.pred^2)\n\n# coords.0 &lt;- as.matrix(hbefElev[, c('Easting', 'Northing')])\nout.sp.ms.pred &lt;- predict(out.sp, \n                          X.0=predict_data, \n                          df_coords[,1:2],\n                          threads=4) #Warning :'threads' is not an argument\n\n# extract the array of interest= occupancy\npredicted_array &lt;- out.sp.ms.pred$psi.0.samples\n\n\n\ndim(predicted_array)\n# df_plot &lt;- NA # empty column\npredicted_raster_list &lt;- list() # rast(nrows = 52, ncols = 103,\n                         #ext(elevation_17.aggregate), \n                         # crs = \"EPSG:32717\")\n\n###################################################\n# simpler way to make mean in the array by species\n# array order: itera=3000, sp=22, pixels=5202\n# we wan to keep index 2 and 3\nlibrary(plyr)\naresult = (plyr::aaply(predicted_array, # mean fo all iterations\n                       c(2,3), \n                       mean))\n\n##############################################\n#### Loop to make rasters and put in a list\n# array order: itera=3000, sp=22, pixels=5202\nfor (i in 1:dim(predicted_array)[2]){\n # Convert array slice to data frame\n # df_plot[i] &lt;- as.data.frame(predicted_array[1, i, ]) # sp_i\n # df_plot[i] &lt;- as.vector(aresult[i,]) # Extract sp\n # Producing an SDM for all (posterior mean)\n plot.dat &lt;- data.frame(x = df_coords$X, \n                        y = df_coords$Y, \n                        psi.sp = as.vector(aresult[i,]))\n pred_rast &lt;- rast(plot.dat, \n                   type = \"xyz\", \n                   crs = \"EPSG:10603\") # Replace EPSG:4326 with your CRS\n predicted_raster_list[[i]] &lt;- pred_rast\n}\n\n# Convert the list to a SpatRaster stack\npredictad_raster_stack &lt;- rast(predicted_raster_list)\n# put species names\nnames(predictad_raster_stack) &lt;- selected.sp\n\nplot(predictad_raster_stack)\n\n# get the mean\npredicted_mean &lt;- mean(predictad_raster_stack)\n\nplot(predicted_mean, main=\"mean occupancy\")\n\nmapview(predicted_mean) + mapview(AP_Yasuni_UTM_line)\n#"
  },
  {
    "objectID": "blog/2025-11-02-Yasuni/index.html#package-citation",
    "href": "blog/2025-11-02-Yasuni/index.html#package-citation",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: abind v. 1.4.8 (Plate and Heiberger 2024), bayesplot v. 1.14.0 (Gabry et al. 2019; Gabry and Mahr 2025), beepr v. 2.0 (Bååth 2024), camtrapR v. 3.0.0 (Niedballa et al. 2016), coda v. 0.19.4.1 (Plummer et al. 2006), DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), MCMCvis v. 0.16.3 (Youngflesh 2018), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), snow v. 0.4.4 (Tierney et al. 2021), snowfall v. 1.84.6.3 (Knaus 2023), spOccupancy v. 0.8.0 (Doser et al. 2022, 2024; Doser, Finley, and Banerjee 2023), terra v. 1.8.70 (Hijmans 2025), tictoc v. 1.2.1 (Izrailev 2024), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018)."
  },
  {
    "objectID": "blog/2025-11-02-Yasuni/index.html#sesion-info",
    "href": "blog/2025-11-02-Yasuni/index.html#sesion-info",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: internal\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] abind_1.4-8       lubridate_1.9.4   forcats_1.0.0     stringr_1.5.2    \n [5] dplyr_1.1.4       purrr_1.1.0       readr_2.1.5       tidyr_1.3.1      \n [9] tibble_3.2.1      ggplot2_4.0.0     tidyverse_2.0.0   spOccupancy_0.8.0\n[13] camtrapR_3.0.0    snowfall_1.84-6.3 snow_0.4-4        beepr_2.0        \n[17] coda_0.19-4.1     MCMCvis_0.16.3    tictoc_1.2.1      bayesplot_1.14.0 \n[21] elevatr_0.99.0    terra_1.8-70      tmap_4.2          maps_3.4.3       \n[25] mapview_2.11.4    sf_1.0-21         DT_0.34.0         readxl_1.4.3     \n[29] grateful_0.3.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3      tensorA_0.36.2.1        rstudioapi_0.17.1      \n  [4] audio_0.1-11            jsonlite_2.0.0          wk_0.9.4               \n  [7] magrittr_2.0.3          farver_2.1.2            nloptr_2.1.1           \n [10] rmarkdown_2.30          vctrs_0.6.5             minqa_1.2.8            \n [13] base64enc_0.1-3         RcppNumerical_0.6-0     progress_1.2.3         \n [16] htmltools_0.5.8.1       leafsync_0.1.0          distributional_0.5.0   \n [19] curl_7.0.0              raster_3.6-32           cellranger_1.1.0       \n [22] s2_1.1.9                sass_0.4.10             bslib_0.9.0            \n [25] slippymath_0.3.1        KernSmooth_2.23-24      htmlwidgets_1.6.4      \n [28] plyr_1.8.9              cachem_1.1.0            stars_0.6-8            \n [31] uuid_1.2-1              mime_0.13               lifecycle_1.0.4        \n [34] iterators_1.0.14        pkgconfig_2.0.3         cols4all_0.8-1         \n [37] Matrix_1.7-1            R6_2.6.1                fastmap_1.2.0          \n [40] shiny_1.9.1             digest_0.6.37           colorspace_2.1-1       \n [43] leafem_0.2.4            crosstalk_1.2.1         labeling_0.4.3         \n [46] lwgeom_0.2-14           progressr_0.15.0        spacesXYZ_1.6-0        \n [49] timechange_0.3.0        httr_1.4.7              mgcv_1.9-1             \n [52] compiler_4.4.2          microbenchmark_1.5.0    proxy_0.4-27           \n [55] withr_3.0.2             doParallel_1.0.17       backports_1.5.0        \n [58] brew_1.0-10             S7_0.2.0                DBI_1.2.3              \n [61] logger_0.4.0            MASS_7.3-61             maptiles_0.10.0        \n [64] tmaptools_3.3           leaflet_2.2.3           classInt_0.4-11        \n [67] tools_4.4.2             units_0.8-7             leaflegend_1.2.1       \n [70] httpuv_1.6.16           glue_1.8.0              satellite_1.0.5        \n [73] nlme_3.1-166            promises_1.3.3          grid_4.4.2             \n [76] checkmate_2.3.2         reshape2_1.4.4          generics_0.1.3         \n [79] leaflet.providers_2.0.0 gtable_0.3.6            tzdb_0.4.0             \n [82] shinyBS_0.61.1          class_7.3-22            data.table_1.17.8      \n [85] hms_1.1.3               sp_2.2-0                RANN_2.6.2             \n [88] foreach_1.5.2           pillar_1.11.1           posterior_1.6.1        \n [91] later_1.4.2             splines_4.4.2           lattice_0.22-6         \n [94] tidyselect_1.2.1        knitr_1.50              svglite_2.1.3          \n [97] stats4_4.4.2            xfun_0.52               shinydashboard_0.7.3   \n[100] leafpop_0.1.0           stringi_1.8.4           rematch_2.0.0          \n[103] yaml_2.3.10             boot_1.3-31             evaluate_1.0.4         \n[106] codetools_0.2-20        cli_3.6.5               RcppParallel_5.1.9     \n[109] systemfonts_1.1.0       xtable_1.8-4            jquerylib_0.1.4        \n[112] secr_5.1.0              dichromat_2.0-0.1       Rcpp_1.1.0             \n[115] spAbundance_0.2.1       png_0.1-8               XML_3.99-0.18          \n[118] parallel_4.4.2          prettyunits_1.2.0       lme4_1.1-35.5          \n[121] mvtnorm_1.3-2           scales_1.4.0            e1071_1.7-16           \n[124] crayon_1.5.3            rlang_1.1.6"
  },
  {
    "objectID": "blog/2025-11-01-Putumayo/index.html",
    "href": "blog/2025-11-01-Putumayo/index.html",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-11-01-Putumayo/index.html#single-species-occupancy-models",
    "href": "blog/2025-11-01-Putumayo/index.html#single-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "",
    "text": "Single-species occupancy models (MacKenzie et al., 2002) are widely used in ecology to estimate and predict the spatial distribution of a species from data collected in presence–absence repeated surveys. The popularity of these models stems from their ability to estimate the effects of environmental or management covariates on species occurrences, while accounting for false-negative errors in detection, which are common in surveys of natural populations."
  },
  {
    "objectID": "blog/2025-11-01-Putumayo/index.html#multi-species-occupancy-models",
    "href": "blog/2025-11-01-Putumayo/index.html#multi-species-occupancy-models",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Multi-species occupancy models",
    "text": "Multi-species occupancy models\nMulti-species occupancy models for estimating the effects of environmental covariates on several species occurrences while accounting for imperfect detection were build on the principle of the Single-species occupancy model, and developed more than 20 years ago.\nMulti-species occupancy models are a powerful tool for combining information from multiple species to estimate both individual and community-level responses to management and environmental variables."
  },
  {
    "objectID": "blog/2025-11-01-Putumayo/index.html#objective",
    "href": "blog/2025-11-01-Putumayo/index.html#objective",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Objective",
    "text": "Objective\nWe want to asses the effect of protected areas on the occupancy of the species. We hypothesize that several mammal species have benefited of the conservation actions provided by protected areas, so we expect a decreases in occupancy from the interior of the protected area to the exterior as a function of the distance to the protected area border.\nTo account for several ecological factors we also tested and included elevation and forest integrity index as occupancy covariates.\nWe used the newly developed R package spOccupancy as approach to modelling the probability of occurrence of each species as a function of fixed effects of measured environmental covariates and random effects designed to account for unobserved sources of spatial dependence (spatial autocorrelation).\n\nCodelibrary(grateful) # Facilitate Citation of R Packages\nlibrary(readxl) # Read Excel Files\nlibrary(DT) # A Wrapper of the JavaScript Library 'DataTables'\nlibrary(sf) # Simple Features for R\nlibrary(mapview) # Interactive Viewing of Spatial Data in R\nlibrary(maps) # Draw Geographical Maps\nlibrary(tmap) # Thematic Maps\nlibrary(terra) # Spatial Data Analysis\nlibrary(elevatr) # Access Elevation Data from Various APIs\n\n# library(rjags) # Bayesian Graphical Models using MCMC \nlibrary(bayesplot) # Plotting for Bayesian Models # Plotting for Bayesian Models\nlibrary(tictoc) # Functions for Timing R Scripts, as Well as Implementations of \"Stack\" and \"StackList\" Structures \nlibrary(MCMCvis) # Tools to Visualize, Manipulate, and Summarize MCMC Output\nlibrary(coda) # Output Analysis and Diagnostics for MCMC\nlibrary(beepr) # Easily Play Notification Sounds on any Platform \nlibrary(snowfall) # Easier Cluster Computing (Based on 'snow')\n\n#library(ggmcmc)\nlibrary(camtrapR) # Camera Trap Data Management and Preparation \nlibrary(spOccupancy) # Single-Species, Multi-Species, and Integrated Spatial Occupancy\nlibrary(tidyverse) # Easily Install and Load the 'Tidyverse'"
  },
  {
    "objectID": "blog/2025-11-01-Putumayo/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "href": "blog/2025-11-01-Putumayo/index.html#fitting-a-multi-species-spatial-occupancy-model",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Fitting a Multi-Species Spatial Occupancy Model",
    "text": "Fitting a Multi-Species Spatial Occupancy Model\nWe use a more computationally efficient approach for fitting spatial multi-species occupancy models. This alternative approach is called a “spatial factor multi-species occupancy model”, and is described in depth in Doser, Finley, and Banerjee (2023). This newer approach also accounts for residual species correlations (i.e., it is a joint species distribution model with imperfect detection). The simulation results from Doser, Finley, and Banerjee (2023) show that this new alternative approach outperforms, or performs equally to spMsPGOcc(), while being substantially faster.\nThe Latent factor multi-species occupancy model is described in detail here\nData from Plantas Medicinales Putumayo\nHere we use the table: - COL-18-Putumayo2023\n\nCodesource(\"C:/CodigoR/WCS-CameraTrap/R/organiza_datos_v3.R\")\n\nAP_PlantasMed &lt;- read_sf(\"C:/CodigoR/Occu_APs/shp/PlantasMedicinales/WDPA_WDOECM_May2025_Public_555511938_shp-polygons.shp\")\n\nFLII2016 &lt;- rast(\"C:/CodigoR/WCS_2024/FLI/raster/FLII_final/FLII_2016.tif\") \n\n# load data and make array_locID column\nCol_18 &lt;- loadproject(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\") |&gt; mutate(array_locID=paste(\"Col_18\", locationID, sep=\"_\"))\n\n60 cameras in Cameras. \n 60 cameras in Deployment. \n 60 deployments in Deployment. \n 60 points in Deployment. \n 51 cameras in Images. \n 51 points in Images. \n\n\n[1] \"dates ok\"\nyear: 2024 \n Jaguar_Design: no year: 2023 \n Jaguar_Design: no \n\nCode# get sites\nCol_18_sites &lt;- get.sites(\"F:/WCS-CameraTrap/data/BDcorregidas/Colombia/COL-018-Putumayo2023_WCS_WI.xlsx\")\n\n\n\n# get elevation map\nelevation_18 &lt;- rast(get_elev_raster(Col_18_sites, z = 10)) #z =1-14\n# bb &lt;-  st_as_sfc(st_bbox(elevation_17)) # make bounding box \n\n\n\n\n# extract covs using points and add to _sites\ncovs_Col_18_sites &lt;- cbind(Col_18_sites, terra::extract(elevation_18, Col_18_sites))\n# covs_Col_17_sites &lt;- cbind(Col_17_sites, terra::extract(elevation_17, Col_17_sites))\n\n\n# get which are in and out\ncovs_Col_18_sites$in_AP = st_intersects(covs_Col_18_sites, AP_PlantasMed, sparse = FALSE)\n# covs_Col_17_sites$in_AP = st_intersects(covs_Col_17_sites, AP_Yasuni, sparse = FALSE)\n\n\n\n\n# make a map\nmapview (elevation_18, alpha=0.5) + \n  mapview (AP_PlantasMed, color = \"green\", col.regions = \"green\", alpha = 0.5) +\n  mapview (covs_Col_18_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) \n\n\n\n\nCode  # mapview (covs_Col_17_sites, zcol = \"in_AP\", col.regions =c(\"red\",\"blue\"), burst = TRUE) +\n\n\nData fom Bajo Madidi and Heath\nHere we use the tables: - BOL-008a - BOL-008b - BOL14a - BOL14b\nTamshiyacu Tahuayo data\nHere we use the tables: - PER-003_BD_ACRCTT_T0.xlsx - PER-002_BD_ACRTT-PILOTO.xlsx\nYasuni data\nHere we use the tables Ecu-13, Ecu-17, Ecu-18 y Ecu-20\nLlanganates data\nHere we use the tables Ecu-14, Ecu-15 y Ecu-16.\nPacoche 2014 data\nHere we use the tables Pacoche_DL_CT-RVP-2014\nCamera trap operation data and detection history\n\nCode# \n# \n# \n# # Join 3 tables\n# # fix count in ECU 13, 17, 22,\n# Ecu_13$Count &lt;- as.character(Ecu_13$Count)\n# Ecu_17$Count &lt;- as.character(Ecu_17$Count)\n# Ecu_22$Count &lt;- as.character(Ecu_22$Count)\n# \n# Ecu_full &lt;- Ecu_13 |&gt; full_join(Ecu_17) |&gt; \n#                       full_join(Ecu_18) |&gt; \n#                       full_join(Ecu_20) |&gt; \n# #                      full_join(Ecu_21) |&gt; \n#                       full_join(Ecu_22)\n# \n# ###### Bolivia\n# \n# Bol_full &lt;- Bol_Madidi_1  |&gt; \n#    full_join(Bol_Madidi_2) |&gt; \n#    full_join(Bol_Madidi_3) |&gt; \n#    full_join(Bol_Madidi_4) \n# # change camera Id by point. two cameras in one\n# Bol_full &lt;- Bol_full |&gt; mutate(Camera_Id=Point.x)\n# \n# \n# # Ecu_18$Count &lt;- as.numeric(Ecu_18$Count)\n# Per_Tahuayo_piloto$Longitude &lt;- as.numeric(Per_Tahuayo_piloto$Longitude)\n# Per_Tahuayo_piloto$Latitude &lt;- as.numeric(Per_Tahuayo_piloto$Latitude)\n# \n# \n# Per_full &lt;- Per_Tahuayo|&gt; \n#   full_join(Per_Tahuayo_piloto) #|&gt; \n#                       # full_join(Ecu_18) |&gt; \n#                       # full_join(Ecu_20) |&gt; \n#                       # full_join(Ecu_21) |&gt; \n#                       # full_join(Ecu_22)\n# \n# # rename camera id\n# # Per_full$camid &lt;- Per_full$`Camera_Id`\n# \n# Ecu_full$Count &lt;- as.numeric(Ecu_full$Count)\n# Per_full$Count &lt;- as.numeric(Per_full$Count)\n# \n# \n# #################### Ecuador Llanganates\n# \n# # Join 3 tables\n# Ecu_Llanganates &lt;- Ecu_14 |&gt; full_join(Ecu_15) |&gt; full_join(Ecu_16)\n# \n# \n# # make columns equal to 46\n# Ecu_full &lt;- Ecu_full[,-47]\nCol_18 &lt;- Col_18[,-47]\n# Ecu_Llanganates &lt;- Ecu_Llanganates[,-c(50,49,48,47)]\n\n##################################\ndata_full &lt;- Col_18# rbind(Ecu_full, \n                   # Per_full,\n                   # Bol_full,\n                   # Col_18# ,\n                   #Ecu_Llanganates)\n\n\n# fix date format\n# \n# Formatting a Date object\ndata_full$start_date &lt;- as.Date(data_full$\"start_date\", \"%Y/%m/%d\")\ndata_full$start_date &lt;- format(data_full$start_date, \"%Y-%m-%d\")\n\ndata_full$end_date &lt;- as.Date(data_full$\"end_date\", \"%Y/%m/%d\")\ndata_full$end_date &lt;- format(data_full$end_date, \"%Y-%m-%d\")\n\ndata_full$eventDate &lt;- as.Date(data_full$\"Date_Time_Captured\", \"%Y/%m/%d\")\ndata_full$eventDate &lt;- format(data_full$eventDate, \"%Y-%m-%d\")\n\n# Per_full$eventDateTime &lt;- ymd_hms(paste(Per_full$\"photo_date\", Per_full$\"photo_time\", sep=\" \"))\ndata_full$eventDateTime &lt;- ymd_hms(data_full$\"Date_Time_Captured\")\n\n###############################\n# remove duplicated cameras\n################################\n# ind1 &lt;- which(data_full$Camera_Id==\"ECU-020-C0027\")\n# ind2 &lt;- which(data_full$Camera_Id==\"ECU-020-C0006\")\n# data_full &lt;- data_full[-ind1,]\n# data_full &lt;- data_full[-ind2,]\n\n\n# filter 2021 and make uniques\nCToperation  &lt;- data_full |&gt; dplyr::group_by(Camera_Id) |&gt; #(array_locID) |&gt; \n                           mutate(minStart=start_date, maxEnd=end_date) |&gt; distinct(Longitude, Latitude, minStart, maxEnd) |&gt; dplyr::ungroup()\n# remove one duplicated\n# View(CToperation)\n# CToperation &lt;- CToperation[-15,]\n\n# M3-19: M3-21: M4-10: M4-12: M4-18:  From Madidi\n# CToperation &lt;- CToperation[-c(379, 373, 365, 362, 357),]\n\n# CToperation[231,3] &lt;- \"-4.482831\" #Latitude\n# CToperation[93,3] &lt;- \"-0.5548211\" #Latitude\n# CToperation[93,2] &lt;- \"-76.48333\"\n\n# duplicated in llanganates\n# CToperation &lt;- CToperation[-464,] \n\n### Check duplicated\n# View(as.data.frame(sort(table(CToperation$Latitude))))\n# View(as.data.frame(sort(table(CToperation$Longitude))))\n# View(as.data.frame(table(CToperation$Camera_Id)))\n\n# CToperation &lt;- CToperation[-c(90,94),]\n# Latitude -4.48283\n# Latitude -0.554820969700813\n# Longitude -76.4833290316164\n\n# Generamos la matríz de operación de las cámaras\n\ncamop &lt;- cameraOperation(CTtable= CToperation, # Tabla de operación\n                         stationCol= \"Camera_Id\", # Columna que define la estación\n                         setupCol= \"minStart\", #Columna fecha de colocación\n                         retrievalCol= \"maxEnd\", #Columna fecha de retiro\n                         #hasProblems= T, # Hubo fallos de cámaras\n                         dateFormat= \"%Y-%m-%d\")#, #, # Formato de las fechas\n                         #cameraCol=\"Camera_Id\")\n                         # sessionCol= \"Year\")\n\n# Generar las historias de detección ---------------------------------------\n## remove plroblem species\n\n# Per_full$scientificName &lt;- paste(Per_full$genus, Per_full$species, sep=\" \")\n\n#### remove NAs and setups\nind &lt;- which(is.na(data_full$scientificName))\ndata_full &lt;- data_full[-ind,]\n# ind &lt;- which(Per_full$scientificName==\"NA NA\")\n# Per_full &lt;- Per_full[-ind,]\n\n# ind &lt;- which(Per_full$scientificName==\"Set up\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Blank\")\n# Per_full &lt;- Per_full[-ind,]\n# \n# ind &lt;- which(Per_full$scientificName==\"Unidentifiable\")\n# Per_full &lt;- Per_full[-ind,]\n\n\nDetHist_list &lt;- lapply(unique(data_full$scientificName), FUN = function(x) {\n  detectionHistory(\n    recordTable         = data_full, # abla de registros\n    camOp                = camop, # Matriz de operación de cámaras\n    stationCol           = \"Camera_Id\",\n    speciesCol           = \"scientificName\",\n    recordDateTimeCol    = \"eventDateTime\",\n    recordDateTimeFormat  = \"%Y-%m-%d %H:%M:%S\",\n    species              = x,     # la función reemplaza x por cada una de las especies\n    occasionLength       = 7, # Colapso de las historias a 10 ías\n    day1                 = \"station\", # \"survey\" a specific date, \"station\", #inicie en la fecha de cada survey\n    datesAsOccasionNames = FALSE,\n    includeEffort        = TRUE,\n    scaleEffort          = FALSE,\n    #unmarkedMultFrameInput=TRUE\n    timeZone             = \"America/Bogota\" \n    )\n  }\n)\n\n# names\nnames(DetHist_list) &lt;- unique(data_full$scientificName)\n\n# Finalmente creamos una lista nueva donde estén solo las historias de detección\nylist &lt;- lapply(DetHist_list, FUN = function(x) x$detection_history)\n# otra lista con effort scaled\nefort &lt;- lapply(DetHist_list, FUN = function(x) x$effort)\n\n# number of observetions per sp, collapsed to 7 days\n# lapply(ylist, sum, na.rm = TRUE)\n\n\nArrange spatial covariates\nThe standard EPSG code for a Lambert Azimuthal Equal-Area projection for South America is EPSG:10603 (WGS 84 / GLANCE South America). This projection is specifically designed for the continent and has its center located around the central meridian for the region. The units are meters.\nFLII scores range from 0 (lowest integrity) to 10 (highest). Grantham discretized this range to define three broad illustrative categories: low (≤6.0); medium (&gt;6.0 and &lt;9.6); and high integrity (≥9.6).\n\nCode#transform coord data to Lambert Azimuthal Equal-Area\n# AP_Tahuayo_UTM &lt;- st_transform(AP_Tahuayo, \"EPSG:10603\")\n# Convert to LINESTRING\n# AP_Tahuayo_UTM_line &lt;- st_cast(AP_Tahuayo_UTM,\"MULTILINESTRING\")# \"LINESTRING\")\n#transform Yasuni to Lambert Azimuthal Equal-Area\n# AP_Yasuni_UTM &lt;- st_transform(AP_Yasuni, \"EPSG:10603\")\n# Convert to LINESTRING\n# AP_Yasuni_UTM_line &lt;- st_cast(AP_Yasuni_UTM, \"MULTILINESTRING\")\n\n#transform Yasuni to Lambert Azimuthal Equal-Area\n# AP_Madidi_UTM &lt;- st_transform(Madidi_NP, \"EPSG:10603\")\n# Convert to LINESTRING\n# AP_Madidi_UTM_line &lt;- st_cast(AP_Madidi_UTM, \"MULTILINESTRING\")\n\n# Plantas\nAP_PlantasMed_UTM &lt;- st_transform(AP_PlantasMed, \"EPSG:10603\")\n# Convert to LINESTRING\nAP_PlantasMed_UTM_line &lt;- st_cast(AP_PlantasMed_UTM, \"MULTILINESTRING\")\n\n#Llanganates\n# AP_Llanganates_UTM &lt;- st_transform(AP_Llanganates, \"EPSG:10603\")\n\n\n############## sf AP Union \nAP_merged_sf_UTM &lt;- AP_PlantasMed_UTM \n                     # st_union(\n                     #         AP_Yasuni_UTM,\n                     #         AP_Tahuayo_UTM,\n                     #         AP_Madidi_UTM,\n                     #         AP_PlantasMed_UTM,\n                     #         AP_Llanganates_UTM\n                     #         )\n\nAP_merged_line &lt;- st_cast(AP_merged_sf_UTM, to=\"MULTILINESTRING\")\n\n\n# make sf() from data table\ndata_full_sf &lt;- CToperation |&gt; \n    st_as_sf(coords = c(\"Longitude\", \"Latitude\"), \n              crs = 4326)\n\n# get the elevation point from AWS\nelev_data &lt;- elevatr::get_elev_point(locations = data_full_sf, src = \"aws\")\n\nMosaicing & Projecting\n\n\nNote: Elevation units are in meters\n\nCode# extract elev and paste to table\ndata_full_sf$elev &lt;- elev_data$elevation\nstr(data_full_sf$elev)\n\n num [1:51] 707 857 857 680 854 737 854 857 778 737 ...\n\nCode# extract in AP\ndata_full_sf$in_AP = as.factor(st_intersects(data_full_sf, AP_PlantasMed, sparse = FALSE))\n\nin_AP &lt;- as.numeric((st_drop_geometry(data_full_sf$in_AP)))\n\n# extract FLII\ndata_full_sf$FLII &lt;- terra::extract(FLII2016, data_full_sf)[,2]\nstr(data_full_sf$FLII)\n\n num [1:51] 8.58 9.52 9.52 8.44 8.73 ...\n\nCode# Replace all NAs with min flii in a numeric column\ndata_full_sf$FLII[is.na(data_full_sf$FLII)] &lt;- min(data_full_sf$FLII, na.rm = TRUE)\n\n# mapview(full_sites_14_15_16_sf, zcol = \"in_AP\", burst = TRUE)\n\n# Transform coord to Lambert Azimuthal Equal-Area\ndata_full_sf_UTM &lt;- st_transform(data_full_sf, \"EPSG:10603\")\n\n\ncoords &lt;- st_coordinates(data_full_sf_UTM)\n#str(coords)\n\n#### fix duplicated coord\n# -1840583.53296873  en x\n# -1842515.36969736  en x\n# 1547741.44311964  en y\n# 1541202.24796904 en y\n\n# which(coords[,1]==\"-1840583.53296873\")\n# which(coords[,1]==\"-1842515.36969736\")\n# which(coords[,2]==\"1547741.44311964\")\n# which(coords[,2]==\"1541202.24796904\")\n\n# make Ecu_14_15_16 an sf object\n#    cam_sf &lt;- st_as_sf(Ecu_14_15_16, coords = c(\"lon\",\"lat\"))   #crs=\"EPSG:4326\")\n    #--- set CRS ---#\n#    st_crs(cam_sf) &lt;- 4326\n\n\n\n\n# Calculate the distance\n#multiplic &lt;- full_sites_14_15_16_sf_UTM |&gt; mutate(multiplic= as.numeric(in_AP)) \nmultiplic=ifelse(data_full_sf_UTM$in_AP==\"TRUE\",-1,1)\ndata_full_sf_UTM$border_dist &lt;- as.numeric(st_distance(data_full_sf_UTM, AP_PlantasMed_UTM_line) * multiplic )\n# print(border_dist)\n\n# convert true false to inside 1, outside 0\ndata_full_sf_UTM &lt;- data_full_sf_UTM |&gt;\n  mutate(in_AP = case_when(\n    str_detect(in_AP, \"TRUE\") ~ 1, # \"inside_AP\",\n    str_detect(in_AP, \"FALSE\") ~ 0 #\"outside_AP\"\n  )) |&gt; mutate(in_AP=as.factor(in_AP))\n\n\nhist(data_full_sf_UTM$border_dist)\n\n\n\n\n\n\nCodehist(data_full_sf_UTM$elev)\n\n\n\n\n\n\n\nPrepare the model\n\n\n\n\n\n\nTipData in a 3D array\n\n\n\nThe data must be placed in a three-dimensional array with dimensions corresponding to species, sites, and replicates in that order.\n\n\nThe function sfMsPGOcc\nFits multi-species spatial occupancy models with species correlations (i.e., a spatially-explicit joint species distribution model with imperfect detection). We use Polya-Gamma latent variables and a spatial factor modeling approach. Currently, models are implemented using a Nearest Neighbor Gaussian Process.\n\nCode# Detection-nondetection data ---------\n# Species of interest, can select individually\n# curr.sp &lt;- sort(unique(Ecu_14_15_16$.id))# c('BAWW', 'BLJA', 'GCFL')\n# sort(names(DetHist_list))\nselected.sp &lt;-  c(\n# \"Atelocynus microtis\" ,\n\"Cabassous unicinctus\",\n# \"Coendou prehensilis\" ,\n\"Coendou\" ,\n\"Cuniculus paca\",\n\"Dasyprocta fuliginosa\",      \n\"Dasypus novemcinctus\" ,    \n\"Didelphis marsupialis\", \n\"Eira barbara\",  \n\"Galictis vittata\",\n#\"Herpailurus yagouaroundi\",\n\"Leopardus\",    \n# \"Leopardus tigrinus\" ,\n# \"Leopardus wiedii\",         \n\"Mazama americana\",\n# \"Mazama nemorivaga\",\n#\"Mitu tuberosum\" ,\n\"Myoprocta pratti\",\n# \"Myrmecophaga tridactyla\",\n\"Nasua nasua\" ,\n# \"Mazama americana\",         \n# \"Myotis myotis\",           \n# \"Nasua narica\",             \n# \"Odocoileus virginianus\",   \n\"Panthera onca\" ,\n# \"Procyon cancrivorus\" ,\n\"Pecari tajacu\",    \n# \"Penelope jacquacu\" ,\n# \"Priodontes maximus\" ,\n\"Procyon cancrivorous\",      \n# \"Psophia leucoptera\",\n\"Puma concolor\" ,\n\"Speothos venaticus\",\n# \"Puma yagouaroundi\",        \n# \"Rattus rattus\" ,\n# \"Roedor sp.\",\n# \"Sciurus sp.\",       \n# \"Sus scrofa\",               \n# \"Sylvilagus brasiliensis\",  \n\"Tamandua tetradactyla\",   \n#\"Tapirus pinchaque\" ,\n\"Tapirus terrestris\"\n# \"Tayassu pecari\"\n#\"Tinamus major\"            \n              )\n\n# y.msom &lt;- y[which(sp.codes %in% selected.sp), , ]\n# str(y.msom)\n\n# Use selection\ny.selected &lt;- ylist[selected.sp]   \n\n#####################################\n#### three-dimensional array with dimensions corresponding to:\n#### species, sites, and replicates\n#####################################\n\n# 1. Load the abind library to make arrays easily \nlibrary(abind)\nmy_array_abind &lt;- abind(y.selected, # start from list\n                        along = 3, # 3D array\n                        use.first.dimnames=TRUE) # keep names\n\n# Transpose the array to have:\n# species, sites, and sampling occasions in that order\n# The new order is (3rd dim, 1st dim, 2nd dim)\ntransposed_array &lt;- aperm(my_array_abind, c(3, 1, 2))\n\n#### site covs\nsitecovs &lt;- as.data.frame(st_drop_geometry(\n                    data_full_sf_UTM[,5:8]))\n\n sitecovs[, 1] &lt;- as.vector((sitecovs[,1]))   # scale numeric covariates\n sitecovs[, 1] &lt;- as.numeric((sitecovs[,2]))   # scale numeric covariates\n sitecovs[, 3] &lt;- as.vector((sitecovs[,3]))   # scale numeric covariates\n sitecovs[, 4] &lt;- as.vector((sitecovs[,4]))   # scale numeric covariates\n # sitecovs$fact &lt;- factor(c(\"A\", \"A\", \"B\"))    # categorical covariate\n\nnames(sitecovs) &lt;- c(\"elev\", \"in_AP\", \"FLII\", \"border_dist\")\n\n# check consistancy equal number of spatial covariates and rows in data\n# identical(nrow(ylist[[1]]), nrow(covars)) \n\n# Base de datos para los análisis -----------------------------------------\n\n# match the names to \"y\"  \"occ.covs\" \"det.covs\" \"coords\" \ndata_list &lt;- list(y = transposed_array, # Historias de detección\n                  occ.covs = sitecovs, # covs de sitio\n                  det.covs  = list(effort = DetHist_list[[1]]$effort),\n                  coords = st_coordinates(data_full_sf_UTM)\n                  )  # agregamos el esfuerzo de muestreo como covariable de observación\n\n\nRunning the model\nWe let spOccupancy set the initial values by default based on the prior distributions.\n\nCode# Running the model\n\n# 3. 1 Modelo multi-especie  -----------------------------------------\n\n# 2. Model fitting --------------------------------------------------------\n# Fit a non-spatial, multi-species occupancy model. \nout.null &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort) , # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.samples = 6000, \n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 51 sites and 18 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 1 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out.null, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.report = 1000, n.burn = 1000, n.thin = 10, n.chains = 3)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 0.837\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%  97.5%   Rhat ESS\n(Intercept)        -1.0769 0.5961 -2.1822 -1.0963 0.1722 1.0221 387\nscale(elev)         0.0462 0.2525 -0.4465  0.0555 0.5528 1.0169 803\nscale(border_dist) -0.0010 0.2531 -0.4923 -0.0044 0.4772 1.0038 534\nscale(FLII)         0.1187 0.3189 -0.4549  0.0877 0.8066 1.0038 613\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat ESS\n(Intercept)        4.2682 2.8290 1.2668 3.5861 11.3341 1.0261 251\nscale(elev)        0.2649 0.3048 0.0349 0.1686  1.0144 1.0156 535\nscale(border_dist) 0.2272 0.2568 0.0320 0.1535  0.8735 1.0119 628\nscale(FLII)        0.8390 0.9101 0.0890 0.6087  2.9360 1.0679 235\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.2063 0.4458 -3.1458 -2.2052 -1.3615 1.0156  493\nscale(effort)  0.4540 0.1581  0.1655  0.4487  0.7943 1.0094 1310\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   2.7575 1.3375 1.0464 2.4594 6.1069 1.0052  487\nscale(effort) 0.1483 0.1291 0.0293 0.1077 0.5036 1.0032 1048\n\nCode# Fit a non-spatial, Latent Factor Multi-Species Occupancy Model. \n  out.lfMs &lt;- msPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year\n                 data = data_list, \n                 n.omp.threads = 6,\n                 n.samples = 6000, \n                 n.factors = 5, # balance of rare sp. and run time\n                 n.thin = 10, \n                 n.burn = 1000, \n                 n.chains = 3,\n                 n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nWarning in msPGOcc(occ.formula = ~scale(elev) + scale(border_dist) +\nscale(FLII), : 'n.factors' is not an argument\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nNo prior specified for tau.sq.alpha.ig.\nSetting prior shape to 0.1 and prior scale to 0.1\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting to initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\n----------------------------------------\n    Model description\n----------------------------------------\nMulti-species Occupancy Model with Polya-Gamma latent\nvariable fit with 51 sites and 18 species.\n\nSamples per Chain: 6000 \nBurn-in: 1000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 1500 \n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nSampled: 1000 of 6000, 16.67%\n-------------------------------------------------\nSampled: 2000 of 6000, 33.33%\n-------------------------------------------------\nSampled: 3000 of 6000, 50.00%\n-------------------------------------------------\nSampled: 4000 of 6000, 66.67%\n-------------------------------------------------\nSampled: 5000 of 6000, 83.33%\n-------------------------------------------------\nSampled: 6000 of 6000, 100.00%\n\nCodesummary(out.lfMs, level = 'community')\n\n\nCall:\nmsPGOcc(occ.formula = ~scale(elev) + scale(border_dist) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, n.samples = 6000, \n    n.omp.threads = 6, n.report = 1000, n.burn = 1000, n.thin = 10, \n    n.chains = 3, n.factors = 5)\n\nSamples per Chain: 6000\nBurn-in: 1000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 1500\nRun Time (min): 0.8412\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                      Mean     SD    2.5%     50%  97.5%   Rhat ESS\n(Intercept)        -1.0426 0.5903 -2.1271 -1.0664 0.1932 1.0628 258\nscale(elev)         0.0225 0.2540 -0.4787  0.0264 0.5074 1.0088 769\nscale(border_dist) -0.0074 0.2501 -0.5221 -0.0012 0.4705 1.0111 727\nscale(FLII)         0.0982 0.3267 -0.4551  0.0783 0.8234 1.0166 752\n\nOccurrence Variances (logit scale): \n                     Mean     SD   2.5%    50%   97.5%   Rhat ESS\n(Intercept)        4.2469 2.6484 1.3794 3.5146 10.9348 1.0909 210\nscale(elev)        0.2774 0.3162 0.0382 0.1802  1.1586 1.0080 350\nscale(border_dist) 0.2290 0.3115 0.0325 0.1423  0.9730 1.1946 353\nscale(FLII)        0.8409 0.8987 0.0866 0.5816  3.0295 1.1434 234\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat ESS\n(Intercept)   -2.2128 0.4530 -3.1837 -2.2079 -1.3761 1.0197 633\nscale(effort)  0.4604 0.1688  0.1477  0.4563  0.8075 1.0110 592\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat ESS\n(Intercept)   2.8373 1.4476 0.9928 2.5078 6.4614 1.0615 268\nscale(effort) 0.1578 0.1438 0.0300 0.1173 0.5267 1.0291 955\n\nCode# Fit a Spatial Factor Multi-Species Occupancy Model\n# latent spatial factors.\ntictoc::tic()\n  out.sp &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               scale(border_dist) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 51 sites and 18 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n276.31 sec elapsed\n\nCode#########################\ntictoc::tic()\n  out.sp.cat &lt;- sfMsPGOcc(occ.formula = ~ scale(elev) +\n                               factor(in_AP) + \n                               scale(FLII) , \n               det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,            \n                      data = data_list, \n                      n.omp.threads = 6,\n                      n.batch = 600, \n                      batch.length = 25, # iter=600*25\n                      n.thin = 10, \n                      n.burn = 5000, \n                      n.chains = 3,\n                      NNGP = TRUE,\n                      n.factors = 5, # balance of rare sp. and run time\n                      n.neighbors = 15,\n                      cov.model = 'exponential',\n                      n.report = 1000);beep(sound = 4)\n\n----------------------------------------\n    Preparing to run the model\n----------------------------------------\n\n\nNo prior specified for beta.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for alpha.comm.normal.\nSetting prior mean to 0 and prior variance to 2.72\n\n\nNo prior specified for tau.sq.beta.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for tau.sq.alpha.\nUsing an inverse-Gamma prior with prior shape 0.1 and prior scale 0.1\n\n\nNo prior specified for phi.unif.\nSetting uniform bounds based on the range of observed spatial coordinates.\n\n\nz is not specified in initial values.\nSetting initial values based on observed data\n\n\nbeta.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\nalpha.comm is not specified in initial values.\nSetting initial values to random values from the prior distribution\n\n\ntau.sq.beta is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\ntau.sq.alpha is not specified in initial values.\nSetting initial values to random values between 0.5 and 10\n\n\nbeta is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nalpha is not specified in initial values.\nSetting initial values to random values from the community-level normal distribution\n\n\nphi is not specified in initial values.\nSetting initial value to random values from the prior distribution\n\n\nlambda is not specified in initial values.\nSetting initial values of the lower triangle to 0\n\n\n----------------------------------------\n    Building the neighbor list\n----------------------------------------\n----------------------------------------\nBuilding the neighbors of neighbors list\n----------------------------------------\n----------------------------------------\n    Model description\n----------------------------------------\nSpatial Factor NNGP Multi-species Occupancy Model with Polya-Gamma latent\nvariable fit with 51 sites and 18 species.\n\nSamples per chain: 15000 (600 batches of length 25)\nBurn-in: 5000 \nThinning Rate: 10 \nNumber of Chains: 3 \nTotal Posterior Samples: 3000 \n\nUsing the exponential spatial correlation model.\n\nUsing 5 latent spatial factors.\nUsing 15 nearest neighbors.\n\nSource compiled with OpenMP support and model fit using 6 thread(s).\n\nAdaptive Metropolis with target acceptance rate: 43.0\n----------------------------------------\n    Chain 1\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 2\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n----------------------------------------\n    Chain 3\n----------------------------------------\nSampling ... \nBatch: 600 of 600, 100.00%\n\nCodetictoc::toc()\n\n274.33 sec elapsed\n\nCode# tictoc::tic()\n#   out.sp.gaus &lt;- sfMsPGOcc(occ.formula = ~ scale(border_dist) , \n#                            det.formula = ~ scale(effort), # Ordinal.day + I(Ordinal.day^2) + Year,              \n#                            data = data_list, \n#                            n.batch = 400, \n#                            batch.length = 25,\n#                            n.thin = 5, \n#                            n.burn = 5000, \n#                            n.chains = 1,\n#                            NNGP = TRUE,\n#                            n.factors = 5,\n#                            n.neighbors = 15,\n#                            cov.model = 'gaussian',\n#                            n.report = 100);beep(sound = 4)\n# tictoc::toc()\n\n# save the results to not run again\n# save(out, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/result_2.R\") # guardamos los resultados para no correr de nuevo\n# save the results to not run again\n# save(out.sp, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n# save(out.lfMs, file=\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/lfms_result_2.R\") # guardamos los resultados para no correr de nuevo\n\n\n# load(\"C:/CodigoR/Occu_APs_all/blog/2025-10-15-analysis/result/sp_result_2.R\")\n# summary(fit.commu)\n\n\nModel comparison\n\nCode# 4. Model comparison -----------------------------------------------------\n# Compute Widely Applicable Information Criterion (WAIC)\n# Lower values indicate better model fit. \nwaicOcc(out.null)\n\n      elpd         pD       WAIC \n-932.43187   61.04599 1986.95571 \n\nCodewaicOcc(out.lfMs)\n\n      elpd         pD       WAIC \n-932.34833   61.70634 1988.10934 \n\nCodewaicOcc(out.sp)\n\n     elpd        pD      WAIC \n-827.7398  113.2061 1881.8920 \n\nCodewaicOcc(out.sp.cat)\n\n     elpd        pD      WAIC \n-828.1037  112.6926 1881.5927 \n\n\nModel comparison as table\n\nCode# Here we summarize the spatial factor loadings\n# summary(out.sp$lambda.samples)\n\n# Resultados --------------------------------------------------------------\n# Extraemos lo tabla de valores estimados\nmodresult &lt;- cbind(as.data.frame(waicOcc(out.null)),\n                  as.data.frame(waicOcc(out.sp)),\n                  as.data.frame(waicOcc(out.lfMs)),\n                  as.data.frame(waicOcc(out.sp.cat))\n                  #as.data.frame(waicOcc(out.sp.gaus))\n                  )\n# View(modresult)\nmodresult_sorted &lt;- as.data.frame(t(modresult)) |&gt; \n  arrange(WAIC) # sort by\n  \nDT::datatable(modresult_sorted)\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\nLower values in WAIC indicate better model fit.\n\n\nWAIC is the Widely Applicable Information Criterion (Watanabe 2010).\nModel validation\nWe next perform a posterior predictive check using the Freeman-Tukey statistic grouping the data by sites. We summarize the posterior predictive check with the summary() function, which reports a Bayesian p-value. A Bayesian p-value that hovers around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well (Hobbs and Hooten 2015). As always with a simulation-based analysis using MCMC, you will get numerically slightly different values.\n\nCode# 3. Model validation -----------------------------------------------------\n# Perform a posterior predictive check to assess model fit. \nppc.out &lt;- ppcOcc(out.null, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.lfMs &lt;- ppcOcc(out.lfMs, fit.stat = 'freeman-tukey', \n                  group = 1)\nppc.out.sp &lt;- ppcOcc(out.sp, fit.stat = 'freeman-tukey',\n                     group = 1)\nppc.out.sp.cat &lt;- ppcOcc(out.sp.cat, fit.stat = 'freeman-tukey',\n                     group = 1)\n\n# Calculate a Bayesian p-value as a simple measure of Goodness of Fit.\n# Bayesian p-values between 0.1 and 0.9 indicate adequate model fit. \n# summary(ppc.out)\n# summary(ppc.out.lfMs)\n# summary(ppc.out.sp)\nsummary(ppc.out.sp.cat)\n\n\nCall:\nppcOcc(object = out.sp.cat, fit.stat = \"freeman-tukey\", group = 1)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\n\n----------------------------------------\n    Community Level\n----------------------------------------\nBayesian p-value:  0.374 \n\n----------------------------------------\n    Species Level\n----------------------------------------\nCabassous unicinctus Bayesian p-value: 0.4363\nCoendou Bayesian p-value: 0.3833\nCuniculus paca Bayesian p-value: 0.0163\nDasyprocta fuliginosa Bayesian p-value: 0.3483\nDasypus novemcinctus Bayesian p-value: 0.0583\nDidelphis marsupialis Bayesian p-value: 0.464\nEira barbara Bayesian p-value: 0.9563\nGalictis vittata Bayesian p-value: 0.3777\nLeopardus Bayesian p-value: 0.532\nMazama americana Bayesian p-value: 0.4003\nMyoprocta pratti Bayesian p-value: 0.0863\nNasua nasua Bayesian p-value: 0.6027\nPanthera onca Bayesian p-value: 0.183\nPecari tajacu Bayesian p-value: 0.3913\nPuma concolor Bayesian p-value: 0.3803\nSpeothos venaticus Bayesian p-value: 0.4097\nTamandua tetradactyla Bayesian p-value: 0.6413\nTapirus terrestris Bayesian p-value: 0.0647\nFit statistic:  freeman-tukey \n\n\n\n\n\n\n\n\nImportant\n\n\n\nA Bayesian p-value that around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well.\n\n\nFit plot\n\nCode#### fit plot\nppc.df &lt;- data.frame(fit = ppc.out.sp.cat$fit.y, \n                     fit.rep = ppc.out.sp.cat$fit.y.rep, \n                     color = 'lightskyblue1')\n\nppc.df$color[ppc.df$fit.rep.1 &gt; ppc.df$fit.1] &lt;- 'lightsalmon'\nplot(ppc.df$fit.1, ppc.df$fit.rep.1, bg = ppc.df$color, pch = 21, \n     ylab = 'Fit', xlab = 'True')\nlines(ppc.df$fit.1, ppc.df$fit.1, col = 'black')\n\n\n\nThe most symmetrical, better fit!\n\n\n\nPosterior Summary\n\nCode# 5. Posterior summaries --------------------------------------------------\n# Concise summary of main parameter estimates\nsummary(out.sp.cat, level = 'community')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + factor(in_AP) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 4.571\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                  Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)    -1.7140 0.7301 -3.0593 -1.7564 -0.2302 1.0098  505\nscale(elev)     0.1165 0.6099 -1.0235  0.1313  1.3341 1.0096  231\nfactor(in_AP)1 -0.4151 1.5058 -3.3190 -0.4193  2.4249 1.0070  194\nscale(FLII)     0.1042 0.3996 -0.5886  0.0754  1.0076 1.0007 1119\n\nOccurrence Variances (logit scale): \n                 Mean     SD   2.5%    50%   97.5%   Rhat  ESS\n(Intercept)    5.7135 4.2356 1.3131 4.7624 16.0379 1.0316  287\nscale(elev)    0.3349 0.3894 0.0374 0.2086  1.3884 1.0227 1088\nfactor(in_AP)1 1.5747 2.9810 0.0476 0.5704  9.0443 1.0232 1007\nscale(FLII)    1.2269 1.3918 0.0863 0.7902  4.9032 1.0242  496\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.1668 0.4407 -3.0691 -2.1551 -1.3347 1.0125  878\nscale(effort)  0.4651 0.1607  0.1659  0.4593  0.7922 1.0009 2020\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   2.7807 1.4367 0.9724 2.4685 6.5935 1.0075  880\nscale(effort) 0.1521 0.1278 0.0294 0.1164 0.5143 1.0047 2109\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n        Mean     SD  2.5%    50%  97.5%   Rhat  ESS\nphi-1 0.0076 0.0036 7e-04 0.0078 0.0133 0.9999  914\nphi-2 0.0070 0.0039 4e-04 0.0071 0.0133 1.0032  662\nphi-3 0.0071 0.0038 6e-04 0.0071 0.0132 1.0004 1052\nphi-4 0.0065 0.0040 3e-04 0.0063 0.0132 1.0016  705\nphi-5 0.0067 0.0040 4e-04 0.0067 0.0132 0.9998 1084\n\nCodesummary(out.sp.cat, level = 'species')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + factor(in_AP) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 4.571\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                        Mean     SD    2.5%     50%   97.5%\n(Intercept)-Cabassous unicinctus     -2.7758 1.2546 -5.0922 -2.8560 -0.1333\n(Intercept)-Coendou                  -3.1256 1.8358 -6.5074 -3.2049  0.5983\n(Intercept)-Cuniculus paca            0.5201 0.6470 -0.7042  0.5139  1.8204\n(Intercept)-Dasyprocta fuliginosa    -0.0082 0.7535 -1.5797  0.0030  1.4513\n(Intercept)-Dasypus novemcinctus     -0.3732 0.7193 -1.8345 -0.3561  1.0104\n(Intercept)-Didelphis marsupialis    -2.2422 2.1392 -5.6147 -2.4288  2.4900\n(Intercept)-Eira barbara              1.0723 1.6256 -1.4826  0.8289  4.9249\n(Intercept)-Galictis vittata         -2.6962 2.2591 -6.5000 -2.8923  1.7274\n(Intercept)-Leopardus                -2.0144 2.0958 -5.6284 -2.1667  2.6677\n(Intercept)-Mazama americana         -0.8346 1.4728 -3.3096 -0.9663  2.4236\n(Intercept)-Myoprocta pratti         -4.3281 1.1562 -6.8593 -4.2229 -2.3501\n(Intercept)-Nasua nasua              -0.1339 1.1841 -2.1737 -0.2156  2.3010\n(Intercept)-Panthera onca            -3.9956 1.1069 -6.4235 -3.9481 -2.0321\n(Intercept)-Pecari tajacu            -2.6057 2.0913 -6.4009 -2.7070  1.8162\n(Intercept)-Puma concolor            -3.2762 1.3207 -5.9005 -3.2926 -0.5684\n(Intercept)-Speothos venaticus       -3.1509 2.0718 -7.0844 -3.2127  1.1610\n(Intercept)-Tamandua tetradactyla    -0.7010 1.9179 -3.6035 -0.9875  4.2013\n(Intercept)-Tapirus terrestris       -3.7718 1.0710 -6.0364 -3.6937 -1.8598\nscale(elev)-Cabassous unicinctus     -0.0103 0.7951 -1.6226  0.0046  1.5342\nscale(elev)-Coendou                   0.4521 0.8154 -1.0475  0.4214  2.1827\nscale(elev)-Cuniculus paca           -0.0356 0.7098 -1.4452 -0.0250  1.3337\nscale(elev)-Dasyprocta fuliginosa     0.4158 0.7421 -1.0180  0.4074  1.9160\nscale(elev)-Dasypus novemcinctus      0.2868 0.7153 -1.1006  0.2857  1.7301\nscale(elev)-Didelphis marsupialis     0.0220 0.8211 -1.6078  0.0385  1.6332\nscale(elev)-Eira barbara              0.2015 0.7736 -1.2403  0.1845  1.7841\nscale(elev)-Galictis vittata          0.0718 0.8175 -1.5567  0.0779  1.6193\nscale(elev)-Leopardus                 0.0124 0.8246 -1.7004  0.0367  1.6183\nscale(elev)-Mazama americana          0.0943 0.7836 -1.4347  0.1038  1.6575\nscale(elev)-Myoprocta pratti          0.2028 0.7189 -1.1817  0.1991  1.6365\nscale(elev)-Nasua nasua               0.0527 0.7630 -1.4399  0.0632  1.5997\nscale(elev)-Panthera onca            -0.0585 0.7892 -1.6926 -0.0477  1.4454\nscale(elev)-Pecari tajacu             0.0577 0.8014 -1.4870  0.0695  1.6154\nscale(elev)-Puma concolor            -0.0350 0.7969 -1.6315 -0.0093  1.4907\nscale(elev)-Speothos venaticus        0.4087 0.7957 -1.0495  0.3891  2.0876\nscale(elev)-Tamandua tetradactyla     0.1734 0.7958 -1.3354  0.1644  1.8019\nscale(elev)-Tapirus terrestris       -0.1162 0.8014 -1.8196 -0.0736  1.3446\nfactor(in_AP)1-Cabassous unicinctus  -0.7269 1.9006 -4.7769 -0.6542  2.7499\nfactor(in_AP)1-Coendou                0.0557 1.9287 -3.4537 -0.0015  4.0973\nfactor(in_AP)1-Cuniculus paca        -0.5701 1.7590 -4.1106 -0.5554  2.8054\nfactor(in_AP)1-Dasyprocta fuliginosa  0.1250 1.8592 -3.2592  0.0772  3.9660\nfactor(in_AP)1-Dasypus novemcinctus  -0.1405 1.7838 -3.6023 -0.1156  3.3838\nfactor(in_AP)1-Didelphis marsupialis -0.5953 1.9121 -4.6882 -0.5549  2.9858\nfactor(in_AP)1-Eira barbara          -0.1080 1.9464 -3.7221 -0.1555  3.9745\nfactor(in_AP)1-Galictis vittata      -0.5671 1.8545 -4.2783 -0.5501  2.8810\nfactor(in_AP)1-Leopardus             -0.6177 1.9173 -4.5919 -0.5213  2.9021\nfactor(in_AP)1-Mazama americana      -0.4355 1.8491 -4.1216 -0.4489  3.2084\nfactor(in_AP)1-Myoprocta pratti      -0.4033 1.7726 -3.9496 -0.4079  3.0311\nfactor(in_AP)1-Nasua nasua           -0.4554 1.8282 -4.1406 -0.4114  3.0325\nfactor(in_AP)1-Panthera onca         -0.8269 1.9289 -5.0110 -0.7403  2.5568\nfactor(in_AP)1-Pecari tajacu         -0.5518 1.9810 -4.5634 -0.5506  3.1582\nfactor(in_AP)1-Puma concolor         -0.7231 1.8940 -4.6968 -0.6211  2.7517\nfactor(in_AP)1-Speothos venaticus    -0.0425 1.9422 -3.6583 -0.1278  3.9264\nfactor(in_AP)1-Tamandua tetradactyla -0.2259 1.9097 -3.7931 -0.2644  3.7070\nfactor(in_AP)1-Tapirus terrestris    -0.8839 1.9006 -5.0176 -0.8356  2.5788\nscale(FLII)-Cabassous unicinctus     -1.0168 0.6930 -2.5501 -0.9626  0.1412\nscale(FLII)-Coendou                   0.4073 1.0112 -1.3835  0.3176  2.7329\nscale(FLII)-Cuniculus paca           -0.3199 0.5053 -1.4167 -0.2843  0.5865\nscale(FLII)-Dasyprocta fuliginosa    -0.7356 0.6143 -2.0894 -0.6863  0.2871\nscale(FLII)-Dasypus novemcinctus     -0.4116 0.5372 -1.5246 -0.3840  0.5704\nscale(FLII)-Didelphis marsupialis     0.3626 0.9887 -1.4839  0.2839  2.6071\nscale(FLII)-Eira barbara              0.0951 0.7107 -1.4648  0.1034  1.4272\nscale(FLII)-Galictis vittata         -0.4991 1.0653 -3.1583 -0.3575  1.2653\nscale(FLII)-Leopardus                 0.3803 1.0770 -1.4682  0.2658  2.9072\nscale(FLII)-Mazama americana          0.9323 1.0164 -0.6458  0.8016  3.2334\nscale(FLII)-Myoprocta pratti          0.9450 0.8994 -0.4354  0.8044  3.0356\nscale(FLII)-Nasua nasua              -0.4827 0.7135 -2.0764 -0.4092  0.7852\nscale(FLII)-Panthera onca             0.5434 0.8182 -0.7759  0.4536  2.4598\nscale(FLII)-Pecari tajacu             0.3740 1.1045 -1.4775  0.2461  3.0545\nscale(FLII)-Puma concolor             0.3724 0.8446 -1.1195  0.2882  2.2880\nscale(FLII)-Speothos venaticus        0.4722 1.0640 -1.2948  0.3391  3.0043\nscale(FLII)-Tamandua tetradactyla    -0.4591 0.8587 -2.4009 -0.3876  1.0347\nscale(FLII)-Tapirus terrestris        0.9849 0.9166 -0.3795  0.8441  3.2136\n                                       Rhat  ESS\n(Intercept)-Cabassous unicinctus     1.0461  687\n(Intercept)-Coendou                  1.0037  470\n(Intercept)-Cuniculus paca           1.0098  669\n(Intercept)-Dasyprocta fuliginosa    1.0292  691\n(Intercept)-Dasypus novemcinctus     1.0107  894\n(Intercept)-Didelphis marsupialis    1.0069  301\n(Intercept)-Eira barbara             1.0026  431\n(Intercept)-Galictis vittata         1.0263  320\n(Intercept)-Leopardus                1.0381  338\n(Intercept)-Mazama americana         1.0046  568\n(Intercept)-Myoprocta pratti         1.0118  970\n(Intercept)-Nasua nasua              1.0221  734\n(Intercept)-Panthera onca            1.0036  844\n(Intercept)-Pecari tajacu            1.0432  345\n(Intercept)-Puma concolor            1.0029  842\n(Intercept)-Speothos venaticus       1.0537  371\n(Intercept)-Tamandua tetradactyla    1.0226  295\n(Intercept)-Tapirus terrestris       1.0047  773\nscale(elev)-Cabassous unicinctus     1.0009  325\nscale(elev)-Coendou                  1.0132  339\nscale(elev)-Cuniculus paca           1.0082  293\nscale(elev)-Dasyprocta fuliginosa    1.0151  303\nscale(elev)-Dasypus novemcinctus     1.0155  303\nscale(elev)-Didelphis marsupialis    1.0072  305\nscale(elev)-Eira barbara             1.0097  356\nscale(elev)-Galictis vittata         1.0046  314\nscale(elev)-Leopardus                1.0002  357\nscale(elev)-Mazama americana         1.0013  321\nscale(elev)-Myoprocta pratti         1.0045  296\nscale(elev)-Nasua nasua              1.0037  288\nscale(elev)-Panthera onca            1.0113  317\nscale(elev)-Pecari tajacu            1.0005  377\nscale(elev)-Puma concolor            1.0059  379\nscale(elev)-Speothos venaticus       1.0130  396\nscale(elev)-Tamandua tetradactyla    1.0082  402\nscale(elev)-Tapirus terrestris       1.0043  383\nfactor(in_AP)1-Cabassous unicinctus  1.0243  300\nfactor(in_AP)1-Coendou               1.0012  310\nfactor(in_AP)1-Cuniculus paca        1.0068  243\nfactor(in_AP)1-Dasyprocta fuliginosa 1.0018  287\nfactor(in_AP)1-Dasypus novemcinctus  1.0042  283\nfactor(in_AP)1-Didelphis marsupialis 1.0104  311\nfactor(in_AP)1-Eira barbara          1.0009  307\nfactor(in_AP)1-Galictis vittata      1.0034  279\nfactor(in_AP)1-Leopardus             1.0073  322\nfactor(in_AP)1-Mazama americana      1.0061  282\nfactor(in_AP)1-Myoprocta pratti      1.0071  269\nfactor(in_AP)1-Nasua nasua           1.0078  264\nfactor(in_AP)1-Panthera onca         1.0087  324\nfactor(in_AP)1-Pecari tajacu         1.0193  298\nfactor(in_AP)1-Puma concolor         1.0111  310\nfactor(in_AP)1-Speothos venaticus    1.0016  334\nfactor(in_AP)1-Tamandua tetradactyla 1.0031  312\nfactor(in_AP)1-Tapirus terrestris    1.0096  290\nscale(FLII)-Cabassous unicinctus     1.0118 1096\nscale(FLII)-Coendou                  1.0043 1242\nscale(FLII)-Cuniculus paca           1.0070 1952\nscale(FLII)-Dasyprocta fuliginosa    1.0006 1403\nscale(FLII)-Dasypus novemcinctus     1.0046 1912\nscale(FLII)-Didelphis marsupialis    1.0045 1439\nscale(FLII)-Eira barbara             1.0029 1767\nscale(FLII)-Galictis vittata         1.0054  883\nscale(FLII)-Leopardus                1.0128  740\nscale(FLII)-Mazama americana         1.0071  760\nscale(FLII)-Myoprocta pratti         1.0111 1118\nscale(FLII)-Nasua nasua              1.0088 1470\nscale(FLII)-Panthera onca            1.0022 1474\nscale(FLII)-Pecari tajacu            1.0077  796\nscale(FLII)-Puma concolor            1.0061 1505\nscale(FLII)-Speothos venaticus       1.0046  909\nscale(FLII)-Tamandua tetradactyla    1.0225 1063\nscale(FLII)-Tapirus terrestris       1.0106  816\n\nDetection (logit scale): \n                                       Mean     SD    2.5%     50%   97.5%\n(Intercept)-Cabassous unicinctus    -2.4851 0.7730 -4.1419 -2.4247 -1.1347\n(Intercept)-Coendou                 -3.4320 1.2406 -5.8909 -3.4184 -1.0581\n(Intercept)-Cuniculus paca          -0.1105 0.1324 -0.3714 -0.1085  0.1374\n(Intercept)-Dasyprocta fuliginosa   -0.6898 0.1583 -1.0079 -0.6871 -0.3829\n(Intercept)-Dasypus novemcinctus    -0.1587 0.1489 -0.4495 -0.1569  0.1333\n(Intercept)-Didelphis marsupialis   -3.6001 1.0085 -5.5356 -3.6189 -1.6318\n(Intercept)-Eira barbara            -2.7524 0.3461 -3.4472 -2.7549 -2.0858\n(Intercept)-Galictis vittata        -3.8043 1.2003 -6.0692 -3.8168 -1.4391\n(Intercept)-Leopardus               -3.6796 1.0176 -5.6716 -3.6724 -1.7777\n(Intercept)-Mazama americana        -2.7969 0.5205 -3.8185 -2.7862 -1.8089\n(Intercept)-Myoprocta pratti        -0.8651 0.5105 -1.9547 -0.8507  0.0949\n(Intercept)-Nasua nasua             -2.2986 0.3258 -2.9371 -2.2840 -1.7034\n(Intercept)-Panthera onca           -1.0784 0.5287 -2.2165 -1.0354 -0.1278\n(Intercept)-Pecari tajacu           -3.8346 1.2116 -6.1795 -3.8567 -1.5436\n(Intercept)-Puma concolor           -2.1948 0.7460 -3.7684 -2.1435 -0.8914\n(Intercept)-Speothos venaticus      -3.7074 1.2149 -6.0807 -3.7154 -1.3665\n(Intercept)-Tamandua tetradactyla   -3.2761 0.5980 -4.4721 -3.2799 -2.0895\n(Intercept)-Tapirus terrestris      -0.4445 0.3873 -1.2379 -0.4357  0.2817\nscale(effort)-Cabassous unicinctus   0.2025 0.3435 -0.5058  0.2136  0.8672\nscale(effort)-Coendou                0.4346 0.3754 -0.2774  0.4290  1.2421\nscale(effort)-Cuniculus paca         0.4540 0.1604  0.1543  0.4525  0.7848\nscale(effort)-Dasyprocta fuliginosa  0.7235 0.2522  0.2862  0.6999  1.2837\nscale(effort)-Dasypus novemcinctus   0.4952 0.1772  0.1570  0.4833  0.8582\nscale(effort)-Didelphis marsupialis  0.5238 0.3855 -0.2092  0.5033  1.3484\nscale(effort)-Eira barbara           0.4360 0.2839 -0.0702  0.4220  1.0690\nscale(effort)-Galictis vittata       0.4279 0.3685 -0.2726  0.4270  1.1894\nscale(effort)-Leopardus              0.4990 0.4023 -0.2495  0.4713  1.3957\nscale(effort)-Mazama americana       0.6527 0.3758  0.0361  0.6173  1.5209\nscale(effort)-Myoprocta pratti       0.6277 0.3931 -0.0388  0.5902  1.4947\nscale(effort)-Nasua nasua            0.6603 0.3289  0.0992  0.6339  1.3833\nscale(effort)-Panthera onca          0.4926 0.3608 -0.2059  0.4807  1.2570\nscale(effort)-Pecari tajacu          0.4776 0.3866 -0.2461  0.4680  1.2966\nscale(effort)-Puma concolor          0.2873 0.3618 -0.4280  0.2940  0.9962\nscale(effort)-Speothos venaticus     0.4853 0.3948 -0.2631  0.4669  1.3459\nscale(effort)-Tamandua tetradactyla  0.2350 0.3189 -0.3699  0.2337  0.8722\nscale(effort)-Tapirus terrestris     0.2700 0.3303 -0.4267  0.2786  0.9121\n                                      Rhat  ESS\n(Intercept)-Cabassous unicinctus    1.0251 1138\n(Intercept)-Coendou                 1.0058  672\n(Intercept)-Cuniculus paca          1.0000 3000\n(Intercept)-Dasyprocta fuliginosa   1.0106 3176\n(Intercept)-Dasypus novemcinctus    1.0009 3000\n(Intercept)-Didelphis marsupialis   1.0130  512\n(Intercept)-Eira barbara            1.0029  946\n(Intercept)-Galictis vittata        1.0032  623\n(Intercept)-Leopardus               1.0615  442\n(Intercept)-Mazama americana        1.0010  880\n(Intercept)-Myoprocta pratti        1.0020 3000\n(Intercept)-Nasua nasua             1.0026 1529\n(Intercept)-Panthera onca           1.0003 3000\n(Intercept)-Pecari tajacu           1.0424  317\n(Intercept)-Puma concolor           1.0053  993\n(Intercept)-Speothos venaticus      1.0530  452\n(Intercept)-Tamandua tetradactyla   1.0096  609\n(Intercept)-Tapirus terrestris      1.0006 3000\nscale(effort)-Cabassous unicinctus  1.0004 2815\nscale(effort)-Coendou               1.0010 2834\nscale(effort)-Cuniculus paca        1.0026 2684\nscale(effort)-Dasyprocta fuliginosa 1.0060 2772\nscale(effort)-Dasypus novemcinctus  1.0028 2833\nscale(effort)-Didelphis marsupialis 1.0046 2576\nscale(effort)-Eira barbara          1.0000 2716\nscale(effort)-Galictis vittata      1.0000 2387\nscale(effort)-Leopardus             1.0020 2012\nscale(effort)-Mazama americana      1.0062 2116\nscale(effort)-Myoprocta pratti      1.0013 2692\nscale(effort)-Nasua nasua           1.0001 2703\nscale(effort)-Panthera onca         1.0014 3000\nscale(effort)-Pecari tajacu         1.0002 3167\nscale(effort)-Puma concolor         1.0057 2797\nscale(effort)-Speothos venaticus    1.0029 2551\nscale(effort)-Tamandua tetradactyla 1.0009 2593\nscale(effort)-Tapirus terrestris    1.0013 2778\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n        Mean     SD  2.5%    50%  97.5%   Rhat  ESS\nphi-1 0.0076 0.0036 7e-04 0.0078 0.0133 0.9999  914\nphi-2 0.0070 0.0039 4e-04 0.0071 0.0133 1.0032  662\nphi-3 0.0071 0.0038 6e-04 0.0071 0.0132 1.0004 1052\nphi-4 0.0065 0.0040 3e-04 0.0063 0.0132 1.0016  705\nphi-5 0.0067 0.0040 4e-04 0.0067 0.0132 0.9998 1084\n\nCodesummary(out.sp.cat, level = 'both')\n\n\nCall:\nsfMsPGOcc(occ.formula = ~scale(elev) + factor(in_AP) + scale(FLII), \n    det.formula = ~scale(effort), data = data_list, cov.model = \"exponential\", \n    NNGP = TRUE, n.neighbors = 15, n.factors = 5, n.batch = 600, \n    batch.length = 25, n.omp.threads = 6, n.report = 1000, n.burn = 5000, \n    n.thin = 10, n.chains = 3)\n\nSamples per Chain: 15000\nBurn-in: 5000\nThinning Rate: 10\nNumber of Chains: 3\nTotal Posterior Samples: 3000\nRun Time (min): 4.571\n\n----------------------------------------\n    Community Level\n----------------------------------------\nOccurrence Means (logit scale): \n                  Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)    -1.7140 0.7301 -3.0593 -1.7564 -0.2302 1.0098  505\nscale(elev)     0.1165 0.6099 -1.0235  0.1313  1.3341 1.0096  231\nfactor(in_AP)1 -0.4151 1.5058 -3.3190 -0.4193  2.4249 1.0070  194\nscale(FLII)     0.1042 0.3996 -0.5886  0.0754  1.0076 1.0007 1119\n\nOccurrence Variances (logit scale): \n                 Mean     SD   2.5%    50%   97.5%   Rhat  ESS\n(Intercept)    5.7135 4.2356 1.3131 4.7624 16.0379 1.0316  287\nscale(elev)    0.3349 0.3894 0.0374 0.2086  1.3884 1.0227 1088\nfactor(in_AP)1 1.5747 2.9810 0.0476 0.5704  9.0443 1.0232 1007\nscale(FLII)    1.2269 1.3918 0.0863 0.7902  4.9032 1.0242  496\n\nDetection Means (logit scale): \n                 Mean     SD    2.5%     50%   97.5%   Rhat  ESS\n(Intercept)   -2.1668 0.4407 -3.0691 -2.1551 -1.3347 1.0125  878\nscale(effort)  0.4651 0.1607  0.1659  0.4593  0.7922 1.0009 2020\n\nDetection Variances (logit scale): \n                Mean     SD   2.5%    50%  97.5%   Rhat  ESS\n(Intercept)   2.7807 1.4367 0.9724 2.4685 6.5935 1.0075  880\nscale(effort) 0.1521 0.1278 0.0294 0.1164 0.5143 1.0047 2109\n\n----------------------------------------\n    Species Level\n----------------------------------------\nOccurrence (logit scale): \n                                        Mean     SD    2.5%     50%   97.5%\n(Intercept)-Cabassous unicinctus     -2.7758 1.2546 -5.0922 -2.8560 -0.1333\n(Intercept)-Coendou                  -3.1256 1.8358 -6.5074 -3.2049  0.5983\n(Intercept)-Cuniculus paca            0.5201 0.6470 -0.7042  0.5139  1.8204\n(Intercept)-Dasyprocta fuliginosa    -0.0082 0.7535 -1.5797  0.0030  1.4513\n(Intercept)-Dasypus novemcinctus     -0.3732 0.7193 -1.8345 -0.3561  1.0104\n(Intercept)-Didelphis marsupialis    -2.2422 2.1392 -5.6147 -2.4288  2.4900\n(Intercept)-Eira barbara              1.0723 1.6256 -1.4826  0.8289  4.9249\n(Intercept)-Galictis vittata         -2.6962 2.2591 -6.5000 -2.8923  1.7274\n(Intercept)-Leopardus                -2.0144 2.0958 -5.6284 -2.1667  2.6677\n(Intercept)-Mazama americana         -0.8346 1.4728 -3.3096 -0.9663  2.4236\n(Intercept)-Myoprocta pratti         -4.3281 1.1562 -6.8593 -4.2229 -2.3501\n(Intercept)-Nasua nasua              -0.1339 1.1841 -2.1737 -0.2156  2.3010\n(Intercept)-Panthera onca            -3.9956 1.1069 -6.4235 -3.9481 -2.0321\n(Intercept)-Pecari tajacu            -2.6057 2.0913 -6.4009 -2.7070  1.8162\n(Intercept)-Puma concolor            -3.2762 1.3207 -5.9005 -3.2926 -0.5684\n(Intercept)-Speothos venaticus       -3.1509 2.0718 -7.0844 -3.2127  1.1610\n(Intercept)-Tamandua tetradactyla    -0.7010 1.9179 -3.6035 -0.9875  4.2013\n(Intercept)-Tapirus terrestris       -3.7718 1.0710 -6.0364 -3.6937 -1.8598\nscale(elev)-Cabassous unicinctus     -0.0103 0.7951 -1.6226  0.0046  1.5342\nscale(elev)-Coendou                   0.4521 0.8154 -1.0475  0.4214  2.1827\nscale(elev)-Cuniculus paca           -0.0356 0.7098 -1.4452 -0.0250  1.3337\nscale(elev)-Dasyprocta fuliginosa     0.4158 0.7421 -1.0180  0.4074  1.9160\nscale(elev)-Dasypus novemcinctus      0.2868 0.7153 -1.1006  0.2857  1.7301\nscale(elev)-Didelphis marsupialis     0.0220 0.8211 -1.6078  0.0385  1.6332\nscale(elev)-Eira barbara              0.2015 0.7736 -1.2403  0.1845  1.7841\nscale(elev)-Galictis vittata          0.0718 0.8175 -1.5567  0.0779  1.6193\nscale(elev)-Leopardus                 0.0124 0.8246 -1.7004  0.0367  1.6183\nscale(elev)-Mazama americana          0.0943 0.7836 -1.4347  0.1038  1.6575\nscale(elev)-Myoprocta pratti          0.2028 0.7189 -1.1817  0.1991  1.6365\nscale(elev)-Nasua nasua               0.0527 0.7630 -1.4399  0.0632  1.5997\nscale(elev)-Panthera onca            -0.0585 0.7892 -1.6926 -0.0477  1.4454\nscale(elev)-Pecari tajacu             0.0577 0.8014 -1.4870  0.0695  1.6154\nscale(elev)-Puma concolor            -0.0350 0.7969 -1.6315 -0.0093  1.4907\nscale(elev)-Speothos venaticus        0.4087 0.7957 -1.0495  0.3891  2.0876\nscale(elev)-Tamandua tetradactyla     0.1734 0.7958 -1.3354  0.1644  1.8019\nscale(elev)-Tapirus terrestris       -0.1162 0.8014 -1.8196 -0.0736  1.3446\nfactor(in_AP)1-Cabassous unicinctus  -0.7269 1.9006 -4.7769 -0.6542  2.7499\nfactor(in_AP)1-Coendou                0.0557 1.9287 -3.4537 -0.0015  4.0973\nfactor(in_AP)1-Cuniculus paca        -0.5701 1.7590 -4.1106 -0.5554  2.8054\nfactor(in_AP)1-Dasyprocta fuliginosa  0.1250 1.8592 -3.2592  0.0772  3.9660\nfactor(in_AP)1-Dasypus novemcinctus  -0.1405 1.7838 -3.6023 -0.1156  3.3838\nfactor(in_AP)1-Didelphis marsupialis -0.5953 1.9121 -4.6882 -0.5549  2.9858\nfactor(in_AP)1-Eira barbara          -0.1080 1.9464 -3.7221 -0.1555  3.9745\nfactor(in_AP)1-Galictis vittata      -0.5671 1.8545 -4.2783 -0.5501  2.8810\nfactor(in_AP)1-Leopardus             -0.6177 1.9173 -4.5919 -0.5213  2.9021\nfactor(in_AP)1-Mazama americana      -0.4355 1.8491 -4.1216 -0.4489  3.2084\nfactor(in_AP)1-Myoprocta pratti      -0.4033 1.7726 -3.9496 -0.4079  3.0311\nfactor(in_AP)1-Nasua nasua           -0.4554 1.8282 -4.1406 -0.4114  3.0325\nfactor(in_AP)1-Panthera onca         -0.8269 1.9289 -5.0110 -0.7403  2.5568\nfactor(in_AP)1-Pecari tajacu         -0.5518 1.9810 -4.5634 -0.5506  3.1582\nfactor(in_AP)1-Puma concolor         -0.7231 1.8940 -4.6968 -0.6211  2.7517\nfactor(in_AP)1-Speothos venaticus    -0.0425 1.9422 -3.6583 -0.1278  3.9264\nfactor(in_AP)1-Tamandua tetradactyla -0.2259 1.9097 -3.7931 -0.2644  3.7070\nfactor(in_AP)1-Tapirus terrestris    -0.8839 1.9006 -5.0176 -0.8356  2.5788\nscale(FLII)-Cabassous unicinctus     -1.0168 0.6930 -2.5501 -0.9626  0.1412\nscale(FLII)-Coendou                   0.4073 1.0112 -1.3835  0.3176  2.7329\nscale(FLII)-Cuniculus paca           -0.3199 0.5053 -1.4167 -0.2843  0.5865\nscale(FLII)-Dasyprocta fuliginosa    -0.7356 0.6143 -2.0894 -0.6863  0.2871\nscale(FLII)-Dasypus novemcinctus     -0.4116 0.5372 -1.5246 -0.3840  0.5704\nscale(FLII)-Didelphis marsupialis     0.3626 0.9887 -1.4839  0.2839  2.6071\nscale(FLII)-Eira barbara              0.0951 0.7107 -1.4648  0.1034  1.4272\nscale(FLII)-Galictis vittata         -0.4991 1.0653 -3.1583 -0.3575  1.2653\nscale(FLII)-Leopardus                 0.3803 1.0770 -1.4682  0.2658  2.9072\nscale(FLII)-Mazama americana          0.9323 1.0164 -0.6458  0.8016  3.2334\nscale(FLII)-Myoprocta pratti          0.9450 0.8994 -0.4354  0.8044  3.0356\nscale(FLII)-Nasua nasua              -0.4827 0.7135 -2.0764 -0.4092  0.7852\nscale(FLII)-Panthera onca             0.5434 0.8182 -0.7759  0.4536  2.4598\nscale(FLII)-Pecari tajacu             0.3740 1.1045 -1.4775  0.2461  3.0545\nscale(FLII)-Puma concolor             0.3724 0.8446 -1.1195  0.2882  2.2880\nscale(FLII)-Speothos venaticus        0.4722 1.0640 -1.2948  0.3391  3.0043\nscale(FLII)-Tamandua tetradactyla    -0.4591 0.8587 -2.4009 -0.3876  1.0347\nscale(FLII)-Tapirus terrestris        0.9849 0.9166 -0.3795  0.8441  3.2136\n                                       Rhat  ESS\n(Intercept)-Cabassous unicinctus     1.0461  687\n(Intercept)-Coendou                  1.0037  470\n(Intercept)-Cuniculus paca           1.0098  669\n(Intercept)-Dasyprocta fuliginosa    1.0292  691\n(Intercept)-Dasypus novemcinctus     1.0107  894\n(Intercept)-Didelphis marsupialis    1.0069  301\n(Intercept)-Eira barbara             1.0026  431\n(Intercept)-Galictis vittata         1.0263  320\n(Intercept)-Leopardus                1.0381  338\n(Intercept)-Mazama americana         1.0046  568\n(Intercept)-Myoprocta pratti         1.0118  970\n(Intercept)-Nasua nasua              1.0221  734\n(Intercept)-Panthera onca            1.0036  844\n(Intercept)-Pecari tajacu            1.0432  345\n(Intercept)-Puma concolor            1.0029  842\n(Intercept)-Speothos venaticus       1.0537  371\n(Intercept)-Tamandua tetradactyla    1.0226  295\n(Intercept)-Tapirus terrestris       1.0047  773\nscale(elev)-Cabassous unicinctus     1.0009  325\nscale(elev)-Coendou                  1.0132  339\nscale(elev)-Cuniculus paca           1.0082  293\nscale(elev)-Dasyprocta fuliginosa    1.0151  303\nscale(elev)-Dasypus novemcinctus     1.0155  303\nscale(elev)-Didelphis marsupialis    1.0072  305\nscale(elev)-Eira barbara             1.0097  356\nscale(elev)-Galictis vittata         1.0046  314\nscale(elev)-Leopardus                1.0002  357\nscale(elev)-Mazama americana         1.0013  321\nscale(elev)-Myoprocta pratti         1.0045  296\nscale(elev)-Nasua nasua              1.0037  288\nscale(elev)-Panthera onca            1.0113  317\nscale(elev)-Pecari tajacu            1.0005  377\nscale(elev)-Puma concolor            1.0059  379\nscale(elev)-Speothos venaticus       1.0130  396\nscale(elev)-Tamandua tetradactyla    1.0082  402\nscale(elev)-Tapirus terrestris       1.0043  383\nfactor(in_AP)1-Cabassous unicinctus  1.0243  300\nfactor(in_AP)1-Coendou               1.0012  310\nfactor(in_AP)1-Cuniculus paca        1.0068  243\nfactor(in_AP)1-Dasyprocta fuliginosa 1.0018  287\nfactor(in_AP)1-Dasypus novemcinctus  1.0042  283\nfactor(in_AP)1-Didelphis marsupialis 1.0104  311\nfactor(in_AP)1-Eira barbara          1.0009  307\nfactor(in_AP)1-Galictis vittata      1.0034  279\nfactor(in_AP)1-Leopardus             1.0073  322\nfactor(in_AP)1-Mazama americana      1.0061  282\nfactor(in_AP)1-Myoprocta pratti      1.0071  269\nfactor(in_AP)1-Nasua nasua           1.0078  264\nfactor(in_AP)1-Panthera onca         1.0087  324\nfactor(in_AP)1-Pecari tajacu         1.0193  298\nfactor(in_AP)1-Puma concolor         1.0111  310\nfactor(in_AP)1-Speothos venaticus    1.0016  334\nfactor(in_AP)1-Tamandua tetradactyla 1.0031  312\nfactor(in_AP)1-Tapirus terrestris    1.0096  290\nscale(FLII)-Cabassous unicinctus     1.0118 1096\nscale(FLII)-Coendou                  1.0043 1242\nscale(FLII)-Cuniculus paca           1.0070 1952\nscale(FLII)-Dasyprocta fuliginosa    1.0006 1403\nscale(FLII)-Dasypus novemcinctus     1.0046 1912\nscale(FLII)-Didelphis marsupialis    1.0045 1439\nscale(FLII)-Eira barbara             1.0029 1767\nscale(FLII)-Galictis vittata         1.0054  883\nscale(FLII)-Leopardus                1.0128  740\nscale(FLII)-Mazama americana         1.0071  760\nscale(FLII)-Myoprocta pratti         1.0111 1118\nscale(FLII)-Nasua nasua              1.0088 1470\nscale(FLII)-Panthera onca            1.0022 1474\nscale(FLII)-Pecari tajacu            1.0077  796\nscale(FLII)-Puma concolor            1.0061 1505\nscale(FLII)-Speothos venaticus       1.0046  909\nscale(FLII)-Tamandua tetradactyla    1.0225 1063\nscale(FLII)-Tapirus terrestris       1.0106  816\n\nDetection (logit scale): \n                                       Mean     SD    2.5%     50%   97.5%\n(Intercept)-Cabassous unicinctus    -2.4851 0.7730 -4.1419 -2.4247 -1.1347\n(Intercept)-Coendou                 -3.4320 1.2406 -5.8909 -3.4184 -1.0581\n(Intercept)-Cuniculus paca          -0.1105 0.1324 -0.3714 -0.1085  0.1374\n(Intercept)-Dasyprocta fuliginosa   -0.6898 0.1583 -1.0079 -0.6871 -0.3829\n(Intercept)-Dasypus novemcinctus    -0.1587 0.1489 -0.4495 -0.1569  0.1333\n(Intercept)-Didelphis marsupialis   -3.6001 1.0085 -5.5356 -3.6189 -1.6318\n(Intercept)-Eira barbara            -2.7524 0.3461 -3.4472 -2.7549 -2.0858\n(Intercept)-Galictis vittata        -3.8043 1.2003 -6.0692 -3.8168 -1.4391\n(Intercept)-Leopardus               -3.6796 1.0176 -5.6716 -3.6724 -1.7777\n(Intercept)-Mazama americana        -2.7969 0.5205 -3.8185 -2.7862 -1.8089\n(Intercept)-Myoprocta pratti        -0.8651 0.5105 -1.9547 -0.8507  0.0949\n(Intercept)-Nasua nasua             -2.2986 0.3258 -2.9371 -2.2840 -1.7034\n(Intercept)-Panthera onca           -1.0784 0.5287 -2.2165 -1.0354 -0.1278\n(Intercept)-Pecari tajacu           -3.8346 1.2116 -6.1795 -3.8567 -1.5436\n(Intercept)-Puma concolor           -2.1948 0.7460 -3.7684 -2.1435 -0.8914\n(Intercept)-Speothos venaticus      -3.7074 1.2149 -6.0807 -3.7154 -1.3665\n(Intercept)-Tamandua tetradactyla   -3.2761 0.5980 -4.4721 -3.2799 -2.0895\n(Intercept)-Tapirus terrestris      -0.4445 0.3873 -1.2379 -0.4357  0.2817\nscale(effort)-Cabassous unicinctus   0.2025 0.3435 -0.5058  0.2136  0.8672\nscale(effort)-Coendou                0.4346 0.3754 -0.2774  0.4290  1.2421\nscale(effort)-Cuniculus paca         0.4540 0.1604  0.1543  0.4525  0.7848\nscale(effort)-Dasyprocta fuliginosa  0.7235 0.2522  0.2862  0.6999  1.2837\nscale(effort)-Dasypus novemcinctus   0.4952 0.1772  0.1570  0.4833  0.8582\nscale(effort)-Didelphis marsupialis  0.5238 0.3855 -0.2092  0.5033  1.3484\nscale(effort)-Eira barbara           0.4360 0.2839 -0.0702  0.4220  1.0690\nscale(effort)-Galictis vittata       0.4279 0.3685 -0.2726  0.4270  1.1894\nscale(effort)-Leopardus              0.4990 0.4023 -0.2495  0.4713  1.3957\nscale(effort)-Mazama americana       0.6527 0.3758  0.0361  0.6173  1.5209\nscale(effort)-Myoprocta pratti       0.6277 0.3931 -0.0388  0.5902  1.4947\nscale(effort)-Nasua nasua            0.6603 0.3289  0.0992  0.6339  1.3833\nscale(effort)-Panthera onca          0.4926 0.3608 -0.2059  0.4807  1.2570\nscale(effort)-Pecari tajacu          0.4776 0.3866 -0.2461  0.4680  1.2966\nscale(effort)-Puma concolor          0.2873 0.3618 -0.4280  0.2940  0.9962\nscale(effort)-Speothos venaticus     0.4853 0.3948 -0.2631  0.4669  1.3459\nscale(effort)-Tamandua tetradactyla  0.2350 0.3189 -0.3699  0.2337  0.8722\nscale(effort)-Tapirus terrestris     0.2700 0.3303 -0.4267  0.2786  0.9121\n                                      Rhat  ESS\n(Intercept)-Cabassous unicinctus    1.0251 1138\n(Intercept)-Coendou                 1.0058  672\n(Intercept)-Cuniculus paca          1.0000 3000\n(Intercept)-Dasyprocta fuliginosa   1.0106 3176\n(Intercept)-Dasypus novemcinctus    1.0009 3000\n(Intercept)-Didelphis marsupialis   1.0130  512\n(Intercept)-Eira barbara            1.0029  946\n(Intercept)-Galictis vittata        1.0032  623\n(Intercept)-Leopardus               1.0615  442\n(Intercept)-Mazama americana        1.0010  880\n(Intercept)-Myoprocta pratti        1.0020 3000\n(Intercept)-Nasua nasua             1.0026 1529\n(Intercept)-Panthera onca           1.0003 3000\n(Intercept)-Pecari tajacu           1.0424  317\n(Intercept)-Puma concolor           1.0053  993\n(Intercept)-Speothos venaticus      1.0530  452\n(Intercept)-Tamandua tetradactyla   1.0096  609\n(Intercept)-Tapirus terrestris      1.0006 3000\nscale(effort)-Cabassous unicinctus  1.0004 2815\nscale(effort)-Coendou               1.0010 2834\nscale(effort)-Cuniculus paca        1.0026 2684\nscale(effort)-Dasyprocta fuliginosa 1.0060 2772\nscale(effort)-Dasypus novemcinctus  1.0028 2833\nscale(effort)-Didelphis marsupialis 1.0046 2576\nscale(effort)-Eira barbara          1.0000 2716\nscale(effort)-Galictis vittata      1.0000 2387\nscale(effort)-Leopardus             1.0020 2012\nscale(effort)-Mazama americana      1.0062 2116\nscale(effort)-Myoprocta pratti      1.0013 2692\nscale(effort)-Nasua nasua           1.0001 2703\nscale(effort)-Panthera onca         1.0014 3000\nscale(effort)-Pecari tajacu         1.0002 3167\nscale(effort)-Puma concolor         1.0057 2797\nscale(effort)-Speothos venaticus    1.0029 2551\nscale(effort)-Tamandua tetradactyla 1.0009 2593\nscale(effort)-Tapirus terrestris    1.0013 2778\n\n----------------------------------------\n    Spatial Covariance\n----------------------------------------\n        Mean     SD  2.5%    50%  97.5%   Rhat  ESS\nphi-1 0.0076 0.0036 7e-04 0.0078 0.0133 0.9999  914\nphi-2 0.0070 0.0039 4e-04 0.0071 0.0133 1.0032  662\nphi-3 0.0071 0.0038 6e-04 0.0071 0.0132 1.0004 1052\nphi-4 0.0065 0.0040 3e-04 0.0063 0.0132 1.0016  705\nphi-5 0.0067 0.0040 4e-04 0.0067 0.0132 0.9998 1084\n\n\nBayesian p-values can be inspected to check for lack of fit (overall or by species). Lack of fit at significance level = 0.05 is indicated by Bayesian p-values below 0.025 or greater than 0.975. The overall Bayesian p-value (Bpvalue) indicates no problems with lack of fit. Likewise, species-level Bayesian p-values (Bpvalue_species) indicate no lack of fit for any species.\n\nGelman and Rubin’s convergence diagnostic: Approximate convergence is diagnosed when the upper limit is close to 1.\n\nConvergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable. The gelman.diag diagnostic is applied to a single variable from the chain. It is based a comparison of within-chain and between-chain variances, and is similar to a classical analysis of variance.\nValues substantially above 1 indicate lack of convergence.\nModel Diagnostics\n\nCode# Extract posterior draws for later use\nposterior1 &lt;- as.array(out.sp.cat)\n\n# Trace plots to check chain mixing. Extract posterior samples and bind in a single matrix.\nPOSTERIOR.MATRIX &lt;- cbind(out.sp.cat$alpha.comm.samples, \n                          out.sp.cat$beta.comm.samples,  \n                          out.sp.cat$alpha.samples, \n                          out.sp.cat$beta.samples)\n\n# Matrix output is all chains combined, split into 3 chains.\nCHAIN.1 &lt;- as.mcmc(POSTERIOR.MATRIX[1:1000,])\nCHAIN.2 &lt;- as.mcmc(POSTERIOR.MATRIX[1001:2000,])\nCHAIN.3 &lt;- as.mcmc(POSTERIOR.MATRIX[2001:3000,])\n# CHAIN.4 &lt;- as.mcmc(POSTERIOR.MATRIX[8001:10000,])\n\n# Bind four chains as coda mcmc.list object.\nPOSTERIOR.CHAINS &lt;- mcmc.list(CHAIN.1, CHAIN.2, CHAIN.3)#, CHAIN.4)\n\n# Create an empty folder.\n# dir.create (\"Beetle_plots\")\n\n# Plot chain mixing of each parameter to a multi-panel plot and save to the new folder. ART 5 mins\n\n######################################\n#### SAVE Diagnostics at PDF\n# MCMCtrace(POSTERIOR.CHAINS, params = \"all\", Rhat = TRUE, n.eff = TRUE)#, pdf = TRUE, filename = \"Beetle_240909_traceplots.pdf\", wd = \"Beetle_plots\")\n\n\n\n#mcmc_trace(fit.commu, parms = c(\"beta.ranef.cont.border_dist.mean\"))\n\n#posterior2 &lt;- extract(fit.commu, inc_warmup = TRUE, permuted = FALSE)\n\n#color_scheme_set(\"mix-blue-pink\")\n#p &lt;- mcmc_trace(posterior1,  pars = c(\"mu\", \"tau\"), n_warmup = 300,\n#                facet_args = list(nrow = 2, labeller = label_parsed))\n#p + facet_text(size = 15)\n\n\n\n#outMCMC &lt;- fit.commu #Convert output to MCMC object\n#diagnostics chains \n\n# all as pdf\n# MCMCtrace(outMCMC)\n\n# MCMCtrace(outMCMC, params = c(\"alpha0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta0\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(out.sp, params = c(\"beta.ranef.cont.border_dist.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev\"), type = 'trace', Rhat = TRUE, n.eff = TRUE)\n\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), type = 'trace', pdf = F, Rhat = TRUE, n.eff = TRUE)\n\n\n### density\n# MCMCtrace(outMCMC, params = c(\"Nspecies\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n# MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.elev.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n### density\n#MCMCtrace(outMCMC, params = c(\"beta.ranef.cont.border_dist.mean\"), ISB = FALSE, pdf = F, exact = TRUE, post_zm = TRUE, type = 'density', Rhat = TRUE, n.eff = TRUE, ind = TRUE)\n\n#coda::gelman.diag(outMCMC,  multivariate = FALSE, transform=FALSE)\n                    \n# coda::gelman.plot(outMCMC,  multivariate = FALSE)\n\n\n\n# \n# mcmc_intervals(outMCMC, pars = c(\"Nspecies_in_AP[1]\",\n#                                  \"Nspecies_in_AP[2]\"),\n#                point_est = \"mean\",\n#                prob = 0.75, prob_outer = 0.95) +\n#   ggtitle(\"Number of species\") + \n#   scale_y_discrete(labels = c(\"Nspecies_in_AP[1]\"=levels(sitecovs$in_AP)[1],\n#              \"Nspecies_in_AP[2]\"=levels(sitecovs$in_AP)[2]))\n# \n# #Continuous\n# p &lt;- mcmc_intervals(outMCMC, \n#                pars = c(\"beta.ranef.cont.border_dist.mean\",\n#                          #\"beta.ranef.cont.elev.mean\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"))\n# \n# # relabel parameters\n# p + scale_y_discrete(\n#   labels = c(\"beta.ranef.cont.border_dist.mean\"=\"Dist_border\",\n#                          #\"beta.ranef.cont.elev.mean\"=\"Elevation\",\n#                         \"beta.ranef.categ.in_AP.mean[2]\"=\"in_AP\")\n# ) +\n#   ggtitle(\"Treatment effect on all species\")\n# \n\n\nPosterior Summary (effect)\nCommunity effects\nCode# Create simple plot summaries using MCMCvis package.\n# Detection covariate effects --------- \nMCMCplot(out.sp.cat$alpha.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n# Occupancy community-level effects \nMCMCplot(out.sp.cat$beta.comm.samples, ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) Detection\n\n\n\n\n\n\n\n\n\n(b) Occupancy\n\n\n\n\n\n\nFigure 1: Community effects\n\n\nSpecies effects\nCode# Occupancy species-level effects \nMCMCplot(out.sp.cat$beta.samples[,19:36], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp$beta.samples[,37:54], ref_ovl = TRUE, ci = c(50, 95))\n\n# Occupancy species-level effects \nMCMCplot(out.sp.cat$beta.samples[,55:72], ref_ovl = TRUE, ci = c(50, 95))\n\n\n\n\n\n\n\n\n\n(a) elevation\n\n\n\n\n\n\n\n\n\n(b) distance border\n\n\n\n\n\n\n\n\n\n\n\n(c) FLII\n\n\n\n\n\n\nFigure 2: Species effects\n\n\nSpecies effects using bayesplot\n\n\nCodelibrary(bayesplot)\n#mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n# mcmc_areas(outMCMC, regex_pars = \"Nspecies_in_AP\")\n\nmcmc_intervals(out.sp$beta.samples[,27:52] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\nmcmc_intervals(out.sp$beta.samples[,53:78] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\nmcmc_intervals(out.sp$beta.samples[,79:104] , point_est = \"mean\",\n               prob = 0.75, prob_outer = 0.95) + \n  geom_vline(xintercept = 0, color = \"red\", linetype = \"dashed\", size = 0.5)\n\n\nPrediction as graph\nThis prediction uses the non spatial model\n\nCode# 6. Prediction -----------------------------------------------------------\n# Predict occupancy along a gradient of elev   \n# Create a set of values across the range of observed elev values\nelev.pred.vals &lt;- seq(min(data_list$occ.covs$elev), \n                              max(data_list$occ.covs$elev), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nelev.pred.vals.scale &lt;- (elev.pred.vals - mean(data_list$occ.covs$elev)) / \n                             sd(data_list$occ.covs$elev)\n# Create a set of values across the range of observed elev values\nborder_dist.pred.vals &lt;- seq(min(data_list$occ.covs$border_dist), \n                              max(data_list$occ.covs$border_dist), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nborder_dist.pred.vals.scale &lt;- (border_dist.pred.vals -\n                                  mean(data_list$occ.covs$border_dist)) /\n                                  sd(data_list$occ.covs$border_dist)\n\n# Create a set of values across the range of observed FLII values\nFLII.pred.vals &lt;- seq(min(data_list$occ.covs$FLII), \n                              max(data_list$occ.covs$FLII), \n                              length.out = 100)\n# Scale predicted values by mean and standard deviation used to fit the model\nFLII.pred.vals.scale &lt;- (FLII.pred.vals -\n                                  mean(data_list$occ.covs$FLII)) /\n                                  sd(data_list$occ.covs$FLII)\n\n# Predict occupancy across elev  values at mean values of all other variables\npred.df1 &lt;- as.matrix(data.frame(intercept = 1, \n                                 elev = elev.pred.vals.scale, \n                                 border_dist = 0,\n                                 FLII=0))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df2 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = border_dist.pred.vals.scale,\n                         FLII= 0 ))#, catchment = 0, density = 0, \n                         # slope = 0))\n# Predict occupancy across elev  values at mean values of all other variables\npred.df3 &lt;- as.matrix(data.frame(intercept = 1, elev = 0, \n                         border_dist = 0,\n                         FLII= FLII.pred.vals.scale ))#, catchment = 0, density = 0, \n                         # slope = 0))\n\nout.pred1 &lt;- predict(out.null, pred.df1) # using non spatial\nstr(out.pred1)\npsi.0.quants &lt;- apply(out.pred1$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           elev = elev.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(elev.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = elev, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'elevation (m)', y = 'Occupancy Probability') \n\n\nout.pred2 &lt;- predict(out.null, pred.df2) # using non spatial\nstr(out.pred2)\npsi.0.quants &lt;- apply(out.pred2$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           border_dist = border_dist.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(border_dist.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = border_dist/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'border_dist (Km)', y = 'Occupancy Probability') \n\n\nout.pred3 &lt;- predict(out.null, pred.df3) # using non spatial\nstr(out.pred3)\npsi.0.quants &lt;- apply(out.pred3$psi.0.samples, c(2, 3), quantile, \n                          prob = c(0.025, 0.5, 0.975))\nsp.codes &lt;- attr(data_list$y, \"dimnames\")[[1]]\npsi.plot.dat &lt;- data.frame(psi.med = c(t(psi.0.quants[2, , ])), \n                                 psi.low = c(t(psi.0.quants[1, , ])), \n                                 psi.high = c(t(psi.0.quants[3, , ])), \n                           FLII = FLII.pred.vals, \n                                 sp.codes = rep(sp.codes, \n                                                each = length(FLII.pred.vals)))\n\nggplot(psi.plot.dat, aes(x = FLII/1000, y = psi.med)) + \n  geom_ribbon(aes(ymin = psi.low, ymax = psi.high), fill = 'grey70') +\n  geom_line() + \n  facet_wrap(vars(sp.codes)) + \n  theme_bw() + \n  labs(x = 'FLII', y = 'Occupancy Probability') \n\n\nSpatial Prediction in elevation_EC\n\nCode#aggregate  resolution to (factor = 3)\n#transform coord data to UTM\nelevation_UTM &lt;- project(elevation_EC, \"EPSG:10603\")\nelevation_17.aggregate &lt;- aggregate(elevation_UTM, fact=10)\nres(elevation_17.aggregate)\n\n# Convert the SpatRaster to a data frame with coordinates\ndf_coords &lt;- as.data.frame(elevation_17.aggregate, xy = TRUE)\nnames(df_coords) &lt;-c(\"X\",\"Y\",\"elev\")\n\nelev.pred &lt;- (df_coords$elev - mean(data_list$occ.covs$elev)) / sd(data_list$occ.covs$elev)\n\n\n############### Predict new data ############### \n# we predict at one covariate varing and others at mean value = 0\n# intercept = 1, elev = 0, border_dist = 0, FLII= 0\n# in that order\n################ ################ ################ \npredict_data &lt;- cbind(1, elev.pred, 0, 0)\ncolnames(predict_data) &lt;- c(\"intercept\",\n                            \"elev\",\n                            \"border_dist\",\n                            \"FLII\" )\n\n# X.0 &lt;- cbind(1, 1, elev.pred)#, elev.pred^2)\n\n# coords.0 &lt;- as.matrix(hbefElev[, c('Easting', 'Northing')])\nout.sp.ms.pred &lt;- predict(out.sp, \n                          X.0=predict_data, \n                          df_coords[,1:2],\n                          threads=4) #Warning :'threads' is not an argument\n\n# extract the array of interest= occupancy\npredicted_array &lt;- out.sp.ms.pred$psi.0.samples\n\n\n\ndim(predicted_array)\n# df_plot &lt;- NA # empty column\npredicted_raster_list &lt;- list() # rast(nrows = 52, ncols = 103,\n                         #ext(elevation_17.aggregate), \n                         # crs = \"EPSG:32717\")\n\n###################################################\n# simpler way to make mean in the array by species\n# array order: itera=3000, sp=22, pixels=5202\n# we wan to keep index 2 and 3\nlibrary(plyr)\naresult = (plyr::aaply(predicted_array, # mean fo all iterations\n                       c(2,3), \n                       mean))\n\n##############################################\n#### Loop to make rasters and put in a list\n# array order: itera=3000, sp=22, pixels=5202\nfor (i in 1:dim(predicted_array)[2]){\n # Convert array slice to data frame\n # df_plot[i] &lt;- as.data.frame(predicted_array[1, i, ]) # sp_i\n # df_plot[i] &lt;- as.vector(aresult[i,]) # Extract sp\n # Producing an SDM for all (posterior mean)\n plot.dat &lt;- data.frame(x = df_coords$X, \n                        y = df_coords$Y, \n                        psi.sp = as.vector(aresult[i,]))\n pred_rast &lt;- rast(plot.dat, \n                   type = \"xyz\", \n                   crs = \"EPSG:10603\") # Replace EPSG:4326 with your CRS\n predicted_raster_list[[i]] &lt;- pred_rast\n}\n\n# Convert the list to a SpatRaster stack\npredictad_raster_stack &lt;- rast(predicted_raster_list)\n# put species names\nnames(predictad_raster_stack) &lt;- selected.sp\n\nplot(predictad_raster_stack)\n\n# get the mean\npredicted_mean &lt;- mean(predictad_raster_stack)\n\nplot(predicted_mean, main=\"mean occupancy\")\n\nmapview(predicted_mean) + mapview(AP_Yasuni_UTM_line)\n#"
  },
  {
    "objectID": "blog/2025-11-01-Putumayo/index.html#package-citation",
    "href": "blog/2025-11-01-Putumayo/index.html#package-citation",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Package Citation",
    "text": "Package Citation\n\nCodepkgs &lt;- cite_packages(output = \"paragraph\", pkgs=\"Session\", out.dir = \".\")\n# knitr::kable(pkgs)\npkgs\n\nWe used R v. 4.4.2 (R Core Team 2024) and the following R packages: abind v. 1.4.8 (Plate and Heiberger 2024), bayesplot v. 1.14.0 (Gabry et al. 2019; Gabry and Mahr 2025), beepr v. 2.0 (Bååth 2024), camtrapR v. 3.0.0 (Niedballa et al. 2016), coda v. 0.19.4.1 (Plummer et al. 2006), DT v. 0.34.0 (Xie et al. 2025), elevatr v. 0.99.0 (Hollister et al. 2023), maps v. 3.4.3 (Becker et al. 2025), mapview v. 2.11.4 (Appelhans et al. 2025), MCMCvis v. 0.16.3 (Youngflesh 2018), sf v. 1.0.21 (Pebesma 2018; Pebesma and Bivand 2023), snow v. 0.4.4 (Tierney et al. 2021), snowfall v. 1.84.6.3 (Knaus 2023), spOccupancy v. 0.8.0 (Doser et al. 2022, 2024; Doser, Finley, and Banerjee 2023), terra v. 1.8.70 (Hijmans 2025), tictoc v. 1.2.1 (Izrailev 2024), tidyverse v. 2.0.0 (Wickham et al. 2019), tmap v. 4.2 (Tennekes 2018)."
  },
  {
    "objectID": "blog/2025-11-01-Putumayo/index.html#sesion-info",
    "href": "blog/2025-11-01-Putumayo/index.html#sesion-info",
    "title": "Fitting a Spatial Factor Multi-Species Occupancy Model",
    "section": "Sesion info",
    "text": "Sesion info\n\n\n\n\n\n\nNote\n\n\n\n\n\n\nCodeprint(sessionInfo(), locale = FALSE)\n\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: internal\n\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] abind_1.4-8       lubridate_1.9.4   forcats_1.0.0     stringr_1.5.2    \n [5] dplyr_1.1.4       purrr_1.1.0       readr_2.1.5       tidyr_1.3.1      \n [9] tibble_3.2.1      ggplot2_4.0.0     tidyverse_2.0.0   spOccupancy_0.8.0\n[13] camtrapR_3.0.0    snowfall_1.84-6.3 snow_0.4-4        beepr_2.0        \n[17] coda_0.19-4.1     MCMCvis_0.16.3    tictoc_1.2.1      bayesplot_1.14.0 \n[21] elevatr_0.99.0    terra_1.8-70      tmap_4.2          maps_3.4.3       \n[25] mapview_2.11.4    sf_1.0-21         DT_0.34.0         readxl_1.4.3     \n[29] grateful_0.3.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3      rstudioapi_0.17.1       audio_0.1-11           \n  [4] jsonlite_2.0.0          wk_0.9.4                magrittr_2.0.3         \n  [7] farver_2.1.2            nloptr_2.1.1            rmarkdown_2.30         \n [10] vctrs_0.6.5             minqa_1.2.8             base64enc_0.1-3        \n [13] RcppNumerical_0.6-0     progress_1.2.3          htmltools_0.5.8.1      \n [16] leafsync_0.1.0          curl_7.0.0              raster_3.6-32          \n [19] cellranger_1.1.0        s2_1.1.9                sass_0.4.10            \n [22] bslib_0.9.0             slippymath_0.3.1        KernSmooth_2.23-24     \n [25] htmlwidgets_1.6.4       cachem_1.1.0            stars_0.6-8            \n [28] uuid_1.2-1              mime_0.13               lifecycle_1.0.4        \n [31] iterators_1.0.14        pkgconfig_2.0.3         cols4all_0.8-1         \n [34] Matrix_1.7-1            R6_2.6.1                fastmap_1.2.0          \n [37] shiny_1.9.1             digest_0.6.37           colorspace_2.1-1       \n [40] leafem_0.2.4            crosstalk_1.2.1         lwgeom_0.2-14          \n [43] progressr_0.15.0        spacesXYZ_1.6-0         timechange_0.3.0       \n [46] httr_1.4.7              mgcv_1.9-1              compiler_4.4.2         \n [49] microbenchmark_1.5.0    proxy_0.4-27            withr_3.0.2            \n [52] doParallel_1.0.17       brew_1.0-10             S7_0.2.0               \n [55] DBI_1.2.3               logger_0.4.0            MASS_7.3-61            \n [58] maptiles_0.10.0         tmaptools_3.3           leaflet_2.2.3          \n [61] classInt_0.4-11         tools_4.4.2             units_0.8-7            \n [64] leaflegend_1.2.1        httpuv_1.6.16           glue_1.8.0             \n [67] satellite_1.0.5         nlme_3.1-166            promises_1.3.3         \n [70] grid_4.4.2              generics_0.1.3          leaflet.providers_2.0.0\n [73] gtable_0.3.6            tzdb_0.4.0              shinyBS_0.61.1         \n [76] class_7.3-22            data.table_1.17.8       hms_1.1.3              \n [79] sp_2.2-0                RANN_2.6.2              foreach_1.5.2          \n [82] pillar_1.11.1           later_1.4.2             splines_4.4.2          \n [85] lattice_0.22-6          tidyselect_1.2.1        knitr_1.50             \n [88] svglite_2.1.3           stats4_4.4.2            xfun_0.52              \n [91] shinydashboard_0.7.3    leafpop_0.1.0           stringi_1.8.4          \n [94] rematch_2.0.0           yaml_2.3.10             boot_1.3-31            \n [97] evaluate_1.0.4          codetools_0.2-20        cli_3.6.5              \n[100] RcppParallel_5.1.9      systemfonts_1.1.0       xtable_1.8-4           \n[103] jquerylib_0.1.4         secr_5.1.0              dichromat_2.0-0.1      \n[106] Rcpp_1.1.0              spAbundance_0.2.1       png_0.1-8              \n[109] XML_3.99-0.18           parallel_4.4.2          prettyunits_1.2.0      \n[112] lme4_1.1-35.5           mvtnorm_1.3-2           scales_1.4.0           \n[115] e1071_1.7-16            crayon_1.5.3            rlang_1.1.6"
  }
]